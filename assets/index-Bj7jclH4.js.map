{"version":3,"mappings":"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","names":["cn","inputs","twMerge","clsx","formatCurrency","amount","Card","React.forwardRef","className","props","ref","jsx","CardHeader","CardTitle","CardDescription","CardContent","CardFooter","Input","type","buttonVariants","cva","Button","variant","size","asChild","Comp","Slot","PasswordProtect","onSuccess","password","setPassword","React","error","setError","handleSubmit","e","jsxs","Lock","ArrowRight","Loading","ProgressBar","supabaseUrl","supabaseAnonKey","supabase","createClient","AuthContext","createContext","redirectUrl","AuthProvider","children","user","setUser","useState","profile","setProfile","isLoading","setIsLoading","PROFILE_SELECT","fetchProfile","userId","profileError","useEffect","mounted","session","existingProfile","subscription","event","handleRedirect","signUp","email","firstName","lastName","data","signIn","signInWithGoogle","signOut","value","useAuth","context","useContext","ToastProvider","ToastPrimitives.Provider","ToastViewport","ToastPrimitives.Viewport","toastVariants","Toast","ToastPrimitives.Root","ToastAction","ToastPrimitives.Action","ToastClose","ToastPrimitives.Close","Cross2Icon","ToastTitle","ToastPrimitives.Title","ToastDescription","ToastPrimitives.Description","TOAST_LIMIT","TOAST_REMOVE_DELAY","count","genId","toastTimeouts","addToRemoveQueue","toastId","timeout","dispatch","reducer","state","action","toast","t","listeners","memoryState","listener","id","update","dismiss","open","useToast","setState","React.useState","React.useEffect","index","Toaster","toasts","title","description","ScrollArea","ScrollAreaPrimitive.Root","ScrollAreaPrimitive.Viewport","ScrollBar","ScrollAreaPrimitive.Corner","orientation","ScrollAreaPrimitive.ScrollAreaScrollbar","ScrollAreaPrimitive.ScrollAreaThumb","MobileNav","isOpen","onClose","AnimatePresence","Fragment","motion","X","NavigationMenu","NavigationMenuPrimitive.Root","NavigationMenuViewport","NavigationMenuList","NavigationMenuPrimitive.List","NavigationMenuItem","NavigationMenuPrimitive.Item","navigationMenuTriggerStyle","NavigationMenuTrigger","NavigationMenuPrimitive.Trigger","ChevronDown","NavigationMenuContent","NavigationMenuPrimitive.Content","NavigationMenuLink","NavigationMenuPrimitive.Link","NavigationMenuPrimitive.Viewport","NavigationMenuIndicator","NavigationMenuPrimitive.Indicator","Avatar","AvatarPrimitive.Root","AvatarImage","AvatarPrimitive.Image","AvatarFallback","AvatarPrimitive.Fallback","DropdownMenu","DropdownMenuPrimitive.Root","DropdownMenuTrigger","DropdownMenuPrimitive.Trigger","DropdownMenuSubTrigger","inset","DropdownMenuPrimitive.SubTrigger","ChevronRightIcon","DropdownMenuSubContent","DropdownMenuPrimitive.SubContent","DropdownMenuContent","sideOffset","DropdownMenuPrimitive.Portal","DropdownMenuPrimitive.Content","DropdownMenuItem","DropdownMenuPrimitive.Item","DropdownMenuCheckboxItem","checked","DropdownMenuPrimitive.CheckboxItem","DropdownMenuPrimitive.ItemIndicator","CheckIcon","DropdownMenuRadioItem","DropdownMenuPrimitive.RadioItem","DotFilledIcon","DropdownMenuLabel","DropdownMenuPrimitive.Label","DropdownMenuSeparator","DropdownMenuPrimitive.Separator","MobileNavLinks","Header","isAuthenticated","onSignIn","onSignUp","userProfile","showMobileMenu","setShowMobileMenu","isScrolled","setIsScrolled","navigate","useNavigate","handleScroll","handleSignOut","ListItem","Menu","Crown","_a","n","LayoutDashboard","Settings","MessageCircle","LogOut","LogIn","UserPlus","_b","item","subItem","subIndex","SplitText","text","delay","animationFrom","animationTo","easing","threshold","rootMargin","textAlign","onLetterAnimationComplete","words","word","letters","inView","setInView","useRef","animatedCount","observer","entry","springs","useSprings","_","i","next","wordIndex","letter","letterIndex","acc","w","animated","VERT","FRAG","Aurora","colorStops","amplitude","blend","propsRef","ctnDom","ctn","renderer","Renderer","gl","program","resize","width","height","geometry","Triangle","colorStopsArray","hex","c","Color","Program","mesh","Mesh","animateId","time","speed","stops","HeroSection","onSearch","subtitle","showSearch","showStats","image","searchTerm","setSearchTerm","handleAnimationComplete","Search","useBitcoinPrice","gbpAmount","btcPrice","setBtcPrice","btcEquivalent","setBtcEquivalent","fetchBtcPrice","response","price","retryCount","MAX_RETRIES","fetchWithRetry","interval","PROPERTY_FALLBACK_IMAGES","DEAL_FALLBACK_IMAGES","PropertyCard","address","squareFootage","bedrooms","bathrooms","isPremium","author","potential_profit","roi_percentage","investment_term","deal_type","isDeal","images","onMessageAuthor","onClick","propertyType","createdAt","isImageLoading","setIsImageLoading","btcError","isLoadingBtc","hasPremiumAccess","fallbackImage","fallbackImages","Tabs","TabsPrimitive.Root","TabsList","TabsPrimitive.List","TabsTrigger","TabsPrimitive.Trigger","TabsContent","TabsPrimitive.Content","GEMINI_API_KEY","GEMINI_API_URL","popularQuestions","getChatResponse","message","_e","_d","_c","formatMessage","formattedText","line","getPredictiveAnalytics","getInvestmentHotspots","MarketTrends","trends","articles","priceData","regionalData","heatmapData","UKMap","region","regionData","d","growth","marketInsights","setMarketInsights","refreshingInsights","setRefreshingInsights","fetchMarketInsights","predictiveData","setPredictiveData","hotspots","setHotspots","isLoadingPredictions","setIsLoadingPredictions","isLoadingHotspots","setIsLoadingHotspots","refreshingPredictions","setRefreshingPredictions","refreshingHotspots","setRefreshingHotspots","fetchPredictiveAnalytics","fetchHotspots","transformedHotspots","hotspot","handleRefreshInsights","handleRefreshPredictions","handleRefreshHotspots","bitcoinPrice","setBitcoinPrice","bitcoinLoading","setBitcoinLoading","fetchBitcoinPrice","err","ResponsiveContainer","AreaChart","CartesianGrid","XAxis","YAxis","Tooltip","Area","LineChart","Line","a","b","RefreshCw","prediction","trend","PoundSterling","Home","TrendingUp","article","Dialog","DialogPrimitive.Root","DialogTrigger","DialogPrimitive.Trigger","DialogPortal","DialogPrimitive.Portal","DialogOverlay","DialogPrimitive.Overlay","DialogContent","DialogPrimitive.Content","DialogPrimitive.Close","DialogHeader","DialogTitle","DialogPrimitive.Title","DialogDescription","DialogPrimitive.Description","labelVariants","Label","LabelPrimitive.Root","SUBSCRIPTION_TIERS","createCheckoutSession","priceId","sessionId","stripe","loadStripe","AuthModal","defaultMode","mode","setMode","isSubmitting","setIsSubmitting","showConfirmation","setShowConfirmation","formData","setFormData","pendingPriceId","prev","SubscriptionPlans","onSubscribe","currentTier","key","tier","feature","Check","SubscriptionModal","handleSubscribe","sendMessage","receiverId","content","dealId","userError","getMessages","otherUserId","unreadMessages","updateError","m","subscribeToMessages","callback","payload","LoadingSpinner","sizeClasses","alertVariants","Alert","AlertTitle","AlertDescription","MessagesModal","deal","messages","setMessages","newMessage","setNewMessage","isSending","setIsSending","messagesEndRef","inputRef","scrollToBottom","loadMessages","fetchedMessages","handleSendMessage","RandomFact","fact","setFact","Lightbulb","Footer","LegalDisclaimer","Info","validUrl","getFeaturedProperties","page","perPage","start","properties","p","searchProperties","getSavedProperties","getDeals","deals","useDeals","limit","useInfiniteQuery","pageParam","lastPage","allPages","Marquee","direction","pauseOnHover","reverse","fade","vertical","LiquidChrome","baseColor","frequencyX","frequencyY","interactive","containerRef","container","vertexShader","fragmentShader","resUniform","handleMouseMove","rect","x","y","mouseUniform","handleTouchMove","touch","animationId","generateAnalysis","property","useAIAnalysis","useQuery","PropertyModal","analysis","isLoadingAnalysis","section","reviews","firstRow","secondRow","thirdRow","fourthRow","ReviewCard","img","name","username","body","isInitialLoad","setIsInitialLoad","searchResults","setSearchResults","isSearching","setIsSearching","isAuthModalOpen","setIsAuthModalOpen","isSubscriptionModalOpen","setIsSubscriptionModalOpen","authMode","setAuthMode","isMessagesModalOpen","setIsMessagesModalOpen","selectedReceiverId","setPage","hasMore","setHasMore","PROPERTIES_PER_PAGE","isFetchingMore","setIsFetchingMore","selectedProperty","setSelectedProperty","isPropertyModalOpen","setIsPropertyModalOpen","observerTarget","loadingRef","dealsData","isLoadingDeals","loadFeaturedProperties","pageNum","isLoadingMore","entries","handleSearch","term","mappedResults","showLoading","showProperties","review","Layout","loading","setLoading","fetchPrice","priceText","BitcoinPrice","convertGBPtoBTC","btcAmount","Bitcoin","updateUserProfile","updates","adminProfiles","adminCheckError","existingUsers","existingError","updateData","getAllUsers","profiles","profilesError","Checkbox","CheckboxPrimitive.Root","CheckboxPrimitive.Indicator","API_URL","location","importProperties","badgeVariants","Badge","PropertyImporter","setIsOpen","setLocation","isImporting","setIsImporting","selectedProperties","setSelectedProperties","currentPage","setCurrentPage","totalPages","setTotalPages","totalResults","setTotalResults","results","handleImport","propertiesToImport","toggleProperty","propertyId","newSelected","handlePageChange","newPage","MapPin","Bed","Bath","Dashboard","savedProperties","setSavedProperties","addedProperties","setAddedProperties","users","setUsers","portfolioStats","setPortfolioStats","loadUsers","handleUserUpdate","updatedProfile","updatedUsers","loadProperties","saved","added","totalProperties","totalValue","sum","prop","averagePrice","totalProfit","monthlyIncome","Building2","Users","Star","PricingPage","OnboardingModal","step","setStep","handleComplete","steps","widget","s","SubscriptionSuccess","searchParams","useSearchParams","showOnboarding","setShowOnboarding","SubscriptionCancel","timer","MAX_FILE_SIZE","ALLOWED_FILE_TYPES","AvatarUpload","currentAvatarUrl","onUpload","userInitials","isUploading","setIsUploading","fileInputRef","handleFileSelect","file","AccountSettings","handleAvatarUpload","fileExt","fileName","filePath","uploadError","publicUrl","verifyError","handleUpdateProfile","passwordError","RequireAuth","PageTransition","fetchPropertyNews","generateMarketInsights","prompt","formattedPrompt","insights","storeMarketInsights","getLatestMarketInsights","MarketInsightsPage","__","news","setNews","setInsights","newsData","latestInsights","newInsights","AlertTriangle","Newspaper","MarketTrendsPage","ArticlePage","date","readTime","Calendar","Clock","paragraph","ResearchReports","isPro","BarChart","FileText","transformedData","Skeleton","PropertyCardSkeleton","DealCard","isSubscriber","isMessageModalOpen","setIsMessageModalOpen","handleMessageClick","ResearchPage","setDeals","loadDeals","BlogPage","blogPosts","post","Tag","InvestmentCalculator","mortgageResult","setMortgageResult","buyToLetResult","setBuyToLetResult","developmentResult","setDevelopmentResult","rentalYieldResult","setRentalYieldResult","roiResult","setRoiResult","mortgageData","setMortgageData","buyToLetData","setBuyToLetData","developmentData","setDevelopmentData","rentalYieldData","setRentalYieldData","roiData","setRoiData","calculateMortgage","P","r","monthlyPayment","calculateBuyToLet","monthlyInterest","monthlyCashflow","calculateDevelopment","totalCosts","profit","calculateRentalYield","yield_","calculateROI","roi","Building","Calculator","Percent","HelpSupportPage","supportCategories","Book","HelpCircle","contactMethods","Mail","Phone","category","method","ChatBot","activeTab","setActiveTab","aiMessages","setAiMessages","supportMessages","setSupportMessages","directMessages","setDirectMessages","input","setInput","contacts","setContacts","selectedContact","setSelectedContact","scrollRef","loadContacts","handleOpenMessages","contact","uniqueContacts","msg","handleSend","aiResponse","conversationId","supportConversationId","userMsgError","autoResponse","supportError","question","Send","AuthCallback","aiFeatures","Brain","BarChart3","MessageSquare","Shield","managementServices","PropertyManagementPage","service","Select","SelectPrimitive.Root","SelectValue","SelectPrimitive.Value","SelectTrigger","SelectPrimitive.Trigger","SelectPrimitive.Icon","SelectScrollUpButton","SelectPrimitive.ScrollUpButton","ChevronUp","SelectScrollDownButton","SelectPrimitive.ScrollDownButton","SelectContent","position","SelectPrimitive.Portal","SelectPrimitive.Content","SelectPrimitive.Viewport","SelectLabel","SelectPrimitive.Label","SelectItem","SelectPrimitive.Item","SelectPrimitive.ItemIndicator","SelectPrimitive.ItemText","SelectSeparator","SelectPrimitive.Separator","Slider","SliderPrimitive.Root","SliderPrimitive.Track","SliderPrimitive.Range","SliderPrimitive.Thumb","genAI","initializeAI","GoogleGenerativeAI","__vitePreload","sanitizeJsonString","str","end","getInvestmentAnalysis","budget","model","parsedData","getMarketPredictions","getInvestmentStrategy","investorProfile","InvestmentOpportunitiesPage","setPropertyType","setBudget","setAnalysis","predictions","setPredictions","strategy","setStrategy","handleAnalyze","analysisData","predictionsData","strategyData","Loader2","risk","factor","AboutUsPage","DealModal","DealsPage","selectedDeal","setSelectedDeal","isValidParticipant","participant","transformParticipants","participants","Messages","conversations","setConversations","selectedConversation","setSelectedConversation","isNewChatOpen","setIsNewChatOpen","participantsError","conversationIds","conversationsError","conv","lastMessage","fetchMessages","searchUsers","startConversation","otherUser","existingParticipations","checkError","existingConvo","fullConvo","fetchError","transformedConvo","newConvo","convoError","updatedConvo","Plus","result","conversation","PATMA_API_KEY","API_BASE_URL","API_PATH","getAskingPrices","params","queryParams","url","getSoldProperties","errorData","errorMessage","getListedProperties","getPriceHistory","Listings","listedProperties","setListedProperties","soldProperties","setSoldProperties","areaInsights","setAreaInsights","viewMode","setViewMode","filters","setFilters","showPricePerSqft","setShowPricePerSqft","showStampDuty","setShowStampDuty","showPlanningApplications","setShowPlanningApplications","isModalOpen","setIsModalOpen","displayProperties","fetchAreaInsights","postcode","askingPrices","priceHistory","getPropertyImageUrl","possibleImageFields","field","patmaImage","patmaPhoto","historyItem","isPostcode","listedResults","sampleProperty","propertiesWithMetrics","normalizedProperty","addInvestmentMetrics","soldResults","priceMatch","propertyWithMetrics","calculateStampDuty","calculatePricePerSqft","monthlyRentEstimate","bedroomFactor","annualRent","futureValue","totalRent","totalReturn","isBuyToLet","isFirstTimeBuyer","stampDuty","isMetric","sizeInSqft","handlePropertyTypeChange","handleTenureChange","handleBedroomsChange","handleRadiusChange","handleSortChange","openPropertyModal","closePropertyModal","isSoldProperty","imageUrl","displayPostcode","hasSaleHistory","saleHistoryData","sale","priceGrowth","propertyPrice","downPaymentPercent","interestRate","termYears","downPayment","loanAmount","totalPayments","mortgageDetails","ExternalLink","Key","SquareIcon","ArrowUpRight","ArrowDownRight","idx","maxPrice","margin","station","school","num","f","AppContent","useLocation","handleStart","handleStop","Suspense","Routes","Route","App","setIsAuthenticated","TempoDevtools","posthog","queryClient","QueryClient","ReactDOM","QueryClientProvider","BrowserRouter"],"ignoreList":[],"sources":["../../src/lib/utils.ts","../../src/components/ui/card.tsx","../../src/components/ui/input.tsx","../../src/components/ui/button.tsx","../../src/components/PasswordProtect.tsx","../../src/components/ui/loading.tsx","../../src/components/ui/progress-bar.tsx","../../src/lib/supabase.ts","../../src/lib/auth.tsx","../../src/components/ui/toast.tsx","../../src/components/ui/use-toast.ts","../../src/components/ui/toaster.tsx","../../src/components/ui/scroll-area.tsx","../../src/components/MobileNav.jsx","../../src/components/ui/navigation-menu.tsx","../../src/components/ui/avatar.tsx","../../src/components/ui/dropdown-menu.tsx","../../src/components/Header.tsx","../../src/components/ui/SplitText.tsx","../../src/components/ui/Aurora.tsx","../../src/components/HeroSection.tsx","../../src/hooks/useBitcoinPrice.ts","../../src/components/PropertyCard.tsx","../../src/components/ui/tabs.tsx","../../src/lib/chat.ts","../../src/components/MarketTrends.tsx","../../src/components/ui/dialog.tsx","../../src/components/ui/label.tsx","../../src/lib/stripe.ts","../../src/components/AuthModal.tsx","../../src/components/SubscriptionPlans.tsx","../../src/components/SubscriptionModal.tsx","../../src/lib/messages.ts","../../src/components/ui/loading-spinner.tsx","../../src/components/ui/alert.tsx","../../src/components/MessagesModal.tsx","../../src/components/RandomFact.tsx","../../src/components/Footer.tsx","../../src/components/LegalDisclaimer.tsx","../../src/lib/supabaseClient.ts","../../src/lib/properties.ts","../../src/components/ui/Marquee.tsx","../../src/components/LiquidChrome.tsx","../../src/hooks/useAIAnalysis.ts","../../src/components/PropertyModal.tsx","../../src/components/home.tsx","../../src/components/Layout.tsx","../../src/lib/hooks/useBitcoinPrice.ts","../../src/components/BitcoinPrice.tsx","../../src/lib/users.ts","../../src/components/ui/checkbox.tsx","../../src/lib/propertyScraperService.ts","../../src/components/ui/badge.tsx","../../src/components/PropertyImporter.tsx","../../src/components/Dashboard.tsx","../../src/components/PricingPage.tsx","../../src/components/OnboardingModal.jsx","../../src/components/SubscriptionSuccess.tsx","../../src/components/SubscriptionCancel.tsx","../../src/components/AvatarUpload.tsx","../../src/components/AccountSettings.tsx","../../src/components/RequireAuth.tsx","../../src/components/ui/page-transition.tsx","../../src/lib/market-insights.ts","../../src/components/MarketInsightsPage.tsx","../../src/components/MarketTrendsPage.tsx","../../src/components/ArticlePage.tsx","../../src/components/ResearchReports.tsx","../../src/lib/deals.ts","../../src/components/ui/skeleton.tsx","../../src/components/DealCard.tsx","../../src/components/ResearchPage.tsx","../../src/components/BlogPage.tsx","../../src/components/InvestmentCalculator.tsx","../../src/components/HelpSupportPage.tsx","../../src/components/ChatBot.tsx","../../src/components/AuthCallback.tsx","../../src/components/PropertyManagementPage.tsx","../../src/components/ui/select.tsx","../../src/components/ui/slider.tsx","../../src/lib/ai-utils.ts","../../src/components/InvestmentOpportunitiesPage.tsx","../../src/components/AboutUsPage.tsx","../../src/components/DealModal.tsx","../../src/components/DealsPage.tsx","../../src/components/Messages.tsx","../../src/config.ts","../../src/lib/patmaService.ts","../../src/pages/Listings.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nexport function formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-GB', {\n    style: 'currency',\n    currency: 'GBP',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(amount);\n}\n\n// Add any other utility functions you need\nexport function formatDate(date: string | Date): string {\n  return new Intl.DateTimeFormat('en-GB', {\n    day: 'numeric',\n    month: 'long',\n    year: 'numeric',\n  }).format(new Date(date));\n}\n\nexport function formatNumber(number: number): string {\n  return new Intl.NumberFormat('en-GB').format(number);\n}\n","import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n","import React from \"react\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Input } from \"./ui/input\";\nimport { Button } from \"./ui/button\";\nimport { Lock, ArrowRight } from \"lucide-react\";\n\ninterface PasswordProtectProps {\n  onSuccess: () => void;\n}\n\nexport function PasswordProtect({ onSuccess }: PasswordProtectProps) {\n  const [password, setPassword] = React.useState(\"\");\n  const [error, setError] = React.useState(false);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (password === \"pestOnaPENTERpy123!\") {\n      localStorage.setItem(\"password-protected\", \"true\");\n      onSuccess();\n    } else {\n      setError(true);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen w-full flex flex-col items-center justify-center bg-background p-4 relative overflow-hidden\">\n      {/* Background Pattern */}\n      <div className=\"absolute inset-0 bg-[linear-gradient(45deg,transparent_25%,rgba(173,216,230,0.1)_25%,rgba(173,216,230,0.1)_50%,transparent_50%,transparent_75%,rgba(173,216,230,0.1)_75%)] bg-[length:20px_20px]\"></div>\n\n      {/* Content */}\n      <div className=\"relative z-10 max-w-lg w-full text-center mb-8\">\n        <img\n          src=\"https://i.postimg.cc/GpdY6N74/my-1920-x-1080-px-1.png\"\n          alt=\"MyVGE\"\n          className=\"h-16 mx-auto mb-4 invert-[0.4] sepia-[.75] saturate-[.6] hue-rotate-[130deg] brightness-[0.8] contrast-[.8]\"\n        />\n        <p className=\"text-xl text-muted-foreground font-light mb-2\">\n          Coming Soon\n        </p>\n        <p className=\"text-muted-foreground\">\n          An exclusive platform for property investment analysis and portfolio\n          management\n        </p>\n      </div>\n\n      <Card className=\"w-full max-w-md relative z-10 bg-background/80 backdrop-blur-sm border-primary/20\">\n        <CardHeader className=\"text-center space-y-2 pb-4\">\n          <Lock className=\"w-10 h-10 mx-auto text-primary\" />\n          <h2 className=\"text-2xl font-semibold\">Developer Preview</h2>\n          <p className=\"text-muted-foreground text-sm\">\n            Access restricted to invited developers and investors\n          </p>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Input\n                type=\"password\"\n                placeholder=\"Enter access code\"\n                value={password}\n                onChange={(e) => {\n                  setPassword(e.target.value);\n                  setError(false);\n                }}\n                className={`bg-background/50 border-primary/20 ${error ? \"border-destructive\" : \"\"}`}\n              />\n              {error && (\n                <p className=\"text-sm text-destructive\">Invalid access code</p>\n              )}\n            </div>\n            <Button type=\"submit\" className=\"w-full group\">\n              Access Platform\n              <ArrowRight className=\"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform\" />\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n\n      {/* Footer */}\n      <div className=\"relative z-10 mt-8 text-center text-sm text-muted-foreground\">\n        <p> 2024 MyVGE. All rights reserved.</p>\n        <p className=\"mt-1\">Currently in private alpha testing</p>\n      </div>\n    </div>\n  );\n}\n","import * as React from \"react\"\nimport { cn } from \"@/lib/utils\" // Double-check this line!\n\nexport function Loading({ className }: { className?: string }) {\n  return (\n    <div className={cn(\"flex items-center justify-center\", className)}>\n      <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\n    </div>\n  )\n}\n","import { useEffect } from \"react\";\n// import NProgress from \"nprogress\"; // Remove this line\n// import \"nprogress/nprogress.css\"; // Also remove this line\n\n// NProgress.configure({ // Remove this block\n//   showSpinner: false,\n//   trickleSpeed: 200,\n//   minimum: 0.08,\n// });\n\nexport function ProgressBar() {\n  // useEffect(() => { // Remove this useEffect\n  //   NProgress.start();\n  //   return () => {\n  //     NProgress.done();\n  //   };\n  // }, []);\n\n  return null;\n}\n","import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\nconsole.log(\"Supabase Anon Key:\", supabaseAnonKey); // Add this line\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error(\"Missing Supabase environment variables\");\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    persistSession: true,\n    storage: window.localStorage,\n    storageKey: 'supabase.auth.token',\n    autoRefreshToken: true,\n    detectSessionInUrl: true,\n    flowType: 'pkce'\n  }\n});\n","import { createContext, useContext, useEffect, useState } from \"react\";\nimport { supabase } from \"./supabase\";\nimport type { User } from \"@supabase/supabase-js\";\nimport type { Tables } from \"../types/supabase\";\nimport { GoogleSignupModal } from \"../components/GoogleSignupModal\";\n\ntype Profile = Tables<\"profiles\">;\n\ninterface AuthContextType {\n  user: User | null;\n  profile: Profile | null;\n  isLoading: boolean;\n  signIn: (email: string, password: string) => Promise<User | null>;\n  signUp: (\n    email: string,\n    password: string,\n    firstName: string,\n    lastName: string,\n  ) => Promise<void>;\n  signInWithGoogle: () => Promise<void>;\n  signOut: () => Promise<void>;\n  refreshProfile: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nconst redirectUrl = import.meta.env.MODE === 'production' \n  ? 'https://myvge.com/auth/callback'\n  : 'http://localhost:5173/auth/callback';\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Update the profile selection fields everywhere\n  const PROFILE_SELECT = `\n    *,\n    subscription_tier,\n    subscription_status,\n    avatar_url\n  `;\n\n  async function fetchProfile(userId: string) {\n    try {\n      console.log('Fetching profile for user:', userId);\n      console.log('Using Supabase URL:', import.meta.env.VITE_SUPABASE_URL);\n      const { data: profile, error: profileError } = await supabase\n        .from(\"profiles\")\n        .select(PROFILE_SELECT)\n        .eq(\"id\", userId)\n        .single();\n\n      if (profileError) {\n        console.error(\"Error fetching profile:\", profileError);\n        console.error(\"Supabase config:\", {\n          url: import.meta.env.VITE_SUPABASE_URL,\n          hasAnonKey: !!import.meta.env.VITE_SUPABASE_ANON_KEY\n        });\n        setProfile(null);\n        return;\n      }\n\n      console.log(\"Fetched profile data:\", profile);\n      setProfile(profile);\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n      setProfile(null);\n    }\n  }\n\n  useEffect(() => {\n    let mounted = true;\n\n    const initializeAuth = async () => {\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession();\n        \n        if (error) throw error;\n\n        if (mounted) {\n          if (session?.user) {\n            setUser(session.user);\n            // Update this query\n            const { data: existingProfile } = await supabase\n              .from('profiles')\n              .select(PROFILE_SELECT)\n              .eq('id', session.user.id)\n              .single();\n\n            console.log('Initial profile load:', existingProfile);\n            setProfile(existingProfile);\n          }\n          setIsLoading(false);\n        }\n\n        // Listen for auth changes\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(\n          async (event, session) => {\n            console.log('Auth state change:', event, session);\n            \n            if (mounted) {\n              if (session?.user) {\n                setUser(session.user);\n                \n                // Update this query\n                const { data: profile } = await supabase\n                  .from('profiles')\n                  .select(PROFILE_SELECT)\n                  .eq('id', session.user.id)\n                  .single();\n\n                console.log('Profile after auth change:', profile);\n                setProfile(profile);\n              } else {\n                setUser(null);\n                setProfile(null);\n              }\n              setIsLoading(false);\n            }\n          }\n        );\n\n        return () => {\n          mounted = false;\n          subscription.unsubscribe();\n        };\n      } catch (error) {\n        console.error('Error initializing auth:', error);\n        if (mounted) {\n          setIsLoading(false);\n        }\n      }\n    };\n\n    initializeAuth();\n  }, []);\n\n  // Update the Google redirect handler\n  useEffect(() => {\n    const handleRedirect = async () => {\n      const { data: { session }, error } = await supabase.auth.getSession();\n      if (error) console.error('Error getting session:', error);\n      \n      if (session?.user) {\n        // Update this query\n        const { data: profile } = await supabase\n          .from('profiles')\n          .select(PROFILE_SELECT)\n          .eq('id', session.user.id)\n          .single();\n\n        console.log('Profile after Google redirect:', profile);\n        setProfile(profile);\n      }\n    };\n\n    if (window.location.hash.includes('access_token')) {\n      handleRedirect();\n    }\n  }, []);\n\n  // Add a session recovery effect\n  useEffect(() => {\n    const recoverSession = async () => {\n      if (!user) {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (session?.user) {\n          setUser(session.user);\n          await fetchProfile(session.user.id);\n        }\n      }\n    };\n\n    recoverSession();\n  }, [user]);\n\n  async function signUp(\n    email: string,\n    password: string,\n    firstName: string,\n    lastName: string,\n  ) {\n    try {\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: {\n            first_name: firstName,\n            last_name: lastName,\n          },\n          emailRedirectTo: redirectUrl,\n        },\n      });\n\n      if (error) throw error;\n\n      if (data.user) {\n        // Create the profile\n        const { error: profileError } = await supabase.from(\"profiles\").insert({\n          id: data.user.id,\n          email,\n          full_name: `${firstName} ${lastName}`,\n          role: \"user\",\n          subscription_tier: \"free\",\n          subscription_status: \"active\",\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n        });\n\n        if (profileError) {\n          console.error(\"Profile creation error:\", profileError);\n          throw profileError;\n        }\n      }\n    } catch (error: any) {\n      console.error(\"Sign up error:\", error);\n      throw error;\n    }\n  }\n\n  async function signIn(email: string, password: string) {\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) {\n        console.error(\"Sign in error details:\", error);\n        if (error.message.includes(\"Email not confirmed\")) {\n          throw new Error(\n            \"Please confirm your email address before signing in.\",\n          );\n        }\n        throw error;\n      }\n\n      // After successful sign in, fetch the profile\n      if (data.user) {\n        await fetchProfile(data.user.id); // Simplified\n      }\n\n      return data.user;\n    } catch (error) {\n      console.error(\"Sign in error:\", error);\n      throw error;\n    }\n  }\n\n  async function signInWithGoogle() {\n    try {\n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: redirectUrl,\n        }\n      });\n      if (error) throw error;\n    } catch (error) {\n      console.error(\"Google sign-in error:\", error);\n      throw error;\n    }\n  }\n\n  async function signOut() {\n    try {\n      await supabase.auth.signOut();\n      \n      // Clear auth state\n      setUser(null);\n      setProfile(null);\n      \n      // Clear storage\n      window.localStorage.clear(); // Clear all localStorage\n      \n      // Redirect\n      window.location.href = \"/\";\n    } catch (error) {\n      console.error(\"Sign out error:\", error);\n      throw error;\n    }\n  }\n\n  const refreshProfile = async () => {\n    if (user) {\n      await fetchProfile(user.id);\n    }\n  };\n\n  const value = {\n    user,\n    profile,\n    isLoading,\n    signIn,\n    signUp,\n    signInWithGoogle,\n    signOut,\n    refreshProfile,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nfunction useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n\nexport { useAuth };\n","import * as React from \"react\"\nimport { Cross2Icon } from \"@radix-ui/react-icons\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <Cross2Icon className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold [&+div]:text-xs\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","import {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\nimport { useToast } from \"@/components/ui/use-toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","import React from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { X } from \"lucide-react\";\nimport { Button } from \"./ui/button\";\nimport { cn } from \"../lib/utils\";\nimport { ScrollArea } from \"./ui/scroll-area\";\n\nexport function MobileNav({ isOpen, onClose, children }) {\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm lg:hidden\"\n            onClick={onClose}\n            style={{ width: '100vw' }}\n          />\n          <motion.div\n            initial={{ x: \"100%\" }}\n            animate={{ x: 0 }}\n            exit={{ x: \"100%\" }}\n            transition={{ type: \"spring\", damping: 20, stiffness: 300 }}\n            className={cn(\n              \"fixed inset-y-0 right-0 z-50 w-full max-w-xs bg-white shadow-2xl lg:hidden\",\n              \"flex flex-col\"\n            )}\n          >\n            <div className=\"flex h-16 items-center justify-between border-b px-6\">\n              <a href=\"/\" className=\"hover:opacity-80 transition-opacity\">\n                <img\n                  src=\"https://i.postimg.cc/GpdY6N74/my-1920-x-1080-px-1.png\"\n                  alt=\"MyVGE\"\n                  className=\"h-8\"\n                />\n              </a>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-10 w-10 rounded-full hover:bg-muted\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  onClose();\n                }}\n              >\n                <X className=\"h-5 w-5\" />\n              </Button>\n            </div>\n            <ScrollArea className=\"flex-1\">\n              <div className=\"flex flex-col p-6 pb-16\">\n                <div className=\"flex-1\">{children}</div>\n                <div className=\"mt-auto pt-6\">\n                  <p className=\"text-sm text-muted-foreground text-center\">\n                     {new Date().getFullYear()} MyVGE. All rights reserved.\n                  </p>\n                </div>\n              </div>\n            </ScrollArea>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","import * as React from \"react\";\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\";\nimport { cva } from \"class-variance-authority\";\nimport { ChevronDown } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className,\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n));\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className,\n    )}\n    {...props}\n  />\n));\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item;\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\",\n);\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n));\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className,\n    )}\n    {...props}\n  />\n));\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link;\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n));\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName;\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className,\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n));\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName;\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n};\n","import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport {\n  CheckIcon,\n  ChevronRightIcon,\n  DotFilledIcon,\n} from \"@radix-ui/react-icons\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRightIcon className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <CheckIcon className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <DotFilledIcon className=\"h-4 w-4 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","import React from \"react\";\nimport { Button } from \"./ui/button\";\nimport { LogIn, Menu, MessageCircle } from \"lucide-react\";\nimport { MobileNav } from \"./MobileNav\";\nimport {\n  NavigationMenu,\n  NavigationMenuContent,\n  NavigationMenuItem,\n  NavigationMenuLink,\n  NavigationMenuList,\n  NavigationMenuTrigger,\n} from \"./ui/navigation-menu\";\nimport { cn } from \"../lib/utils\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../lib/auth\";\nimport {\n  UserPlus,\n  LogOut,\n  Settings,\n  LayoutDashboard,\n  Crown,\n} from \"lucide-react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"../components/ui/avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"./ui/dropdown-menu\";\n\ninterface HeaderProps {\n  isAuthenticated?: boolean;\n  onSignIn?: () => void;\n  onSignUp?: () => void;\n  onSignOut?: () => Promise<void>;\n  userProfile?: {\n    full_name?: string | null;\n    email?: string | null;\n    created_at?: string;\n    id?: string;\n    role?: \"user\" | \"admin\" | \"moderator\" | null;\n    stripe_customer_id?: string | null;\n    subscription_status?: string | null;\n    subscription_tier?: \"free\" | \"basic\" | \"pro\" | \"premium\" | null;\n    updated_at?: string;\n  };\n}\n\nconst MobileNavLinks = [\n  {\n    title: \"Investment Deals\",\n    href: \"/deals\",\n    icon: \"\",\n    requiresAuth: true\n  },\n  {\n    title: \"Listings\",\n    href: \"/listings\",\n    icon: \"\",\n    requiresAuth: false\n  },\n  {\n    title: \"Market\",\n    items: [\n      { title: \"Market Trends\", href: \"/trends\", description: \"Stay updated with the latest real estate market trends\", requiresAuth: true },\n      { title: \"Market Insights\", href: \"/insights\", description: \"Deep dive into property market analytics\", requiresAuth: true },\n      { title: \"Research & Reports\", href: \"/research\", description: \"Access expert analysis and reports\", requiresAuth: false }\n    ],\n    icon: \"\"\n  },\n  {\n    title: \"Services\",\n    items: [\n      { title: \"Property Management\", href: \"/property-management\", description: \"Let us take care of your property\", requiresAuth: true },\n      { title: \"Investment Opportunities\", href: \"/investment-opportunities\", description: \"Discover tailored investment strategies\", requiresAuth: true },\n      { title: \"Calculators\", href: \"/calculators\", description: \"Calculate your property investment\", requiresAuth: false }\n    ],\n    icon: \"\"\n  },\n  {\n    title: \"Messages\",\n    href: \"/messages\",\n    icon: \"\",\n    requiresAuth: true\n  },\n  {\n    title: \"Pricing\",\n    href: \"/pricing\",\n    icon: \"\",\n    requiresAuth: false\n  },\n  {\n    title: \"Support\",\n    href: \"/help\",\n    icon: \"\",\n    requiresAuth: false\n  },\n  {\n    title: \"About Us\",\n    href: \"/about-us\",\n    icon: \"\",\n    requiresAuth: false\n  }\n];\n\nexport default function Header({\n  isAuthenticated = false,\n  onSignIn,\n  onSignUp,\n  userProfile = {},\n}: HeaderProps) {\n  const [showMobileMenu, setShowMobileMenu] = React.useState(false);\n  const [isScrolled, setIsScrolled] = React.useState(false);\n  const navigate = useNavigate();\n  const { signOut, isLoading } = useAuth();\n\n  // Add scroll listener\n  React.useEffect(() => {\n    const handleScroll = () => {\n      setIsScrolled(window.scrollY > 20);\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  const handleSignOut = async () => {\n    console.log(\"Sign out button clicked\");\n    try {\n      await signOut();\n      navigate(\"/\");\n    } catch (error) {\n      console.error(\"Error signing out:\", error);\n    }\n  };\n\n  const ListItem = React.forwardRef<\n    React.ElementRef<\"a\">,\n    React.ComponentPropsWithoutRef<\"a\"> & {\n      title: string;\n    }\n  >(({ className, title, children, ...props }, ref) => {\n    return (\n      <li>\n        <NavigationMenuLink asChild>\n          <a\n            ref={ref}\n            className={cn(\n              \"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\",\n              className ?? \"\"\n            )}\n            {...props}\n          >\n            <div className=\"text-sm font-medium leading-none\">{title}</div>\n            <p className=\"line-clamp-2 text-sm leading-snug text-muted-foreground\">\n              {children}\n            </p>\n          </a>\n        </NavigationMenuLink>\n      </li>\n    );\n  });\n  ListItem.displayName = \"ListItem\";\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <>\n      <header \n        className={cn(\n          \"fixed top-0 left-0 right-0 z-50 transition-all duration-300\",\n          isScrolled ? \"py-2\" : \"py-4\"\n        )}\n      >\n        <div className=\"px-4 mx-auto max-w-7xl\">\n          <div className={cn(\n            \"rounded-full bg-white border transition-all duration-300\",\n            isScrolled \n              ? \"shadow-md border-gray-200/50 backdrop-blur-md bg-white/90\" \n              : \"shadow-sm border-transparent\"\n          )}>\n            <div className=\"h-16 px-6 flex items-center justify-between\">\n              {/* Logo */}\n              <div className=\"flex items-center gap-8\">\n                <a href=\"/\" className=\"hover:opacity-80 transition-opacity\">\n                  <img\n                    src=\"https://i.postimg.cc/GpdY6N74/my-1920-x-1080-px-1.png\"\n                    alt=\"MyVGE\"\n                    className=\"h-8\"\n                  />\n                </a>\n\n                {/* Desktop Navigation */}\n              <NavigationMenu className=\"hidden lg:flex\">\n                  <NavigationMenuList className=\"gap-2\">\n                  <NavigationMenuItem>\n                      <NavigationMenuTrigger \n                        className={cn(\n                          \"text-sm font-medium rounded-full px-4\",\n                          \"bg-transparent hover:bg-gray-100 transition-colors\",\n                          \"data-[state=open]:bg-gray-100\"\n                        )}\n                      >\n                      Market\n                    </NavigationMenuTrigger>\n                    <NavigationMenuContent>\n                        <ul className=\"w-[400px] gap-3 p-4 rounded-2xl\">\n                          {isAuthenticated ? (\n                            <>\n                        <ListItem href=\"/trends\" title=\"Market Trends\">\n                          Stay updated with the latest real estate market trends.\n                        </ListItem>\n                        <ListItem href=\"/insights\" title=\"Market Insights\">\n                          Deep dive into property market analytics and forecasts.\n                        </ListItem>\n                            </>\n                          ) : (\n                            <>\n                              <ListItem \n                                href=\"#\" \n                                onClick={(e) => {\n                                  e.preventDefault();\n                                  onSignIn?.();\n                                }} \n                                title=\"Market Trends\"\n                              >\n                                Sign in to access market trends.\n                              </ListItem>\n                              <ListItem \n                                href=\"#\" \n                                onClick={(e) => {\n                                  e.preventDefault();\n                                  onSignIn?.();\n                                }} \n                                title=\"Market Insights\"\n                              >\n                                Sign in to access market insights.\n                              </ListItem>\n                            </>\n                          )}\n                        <ListItem href=\"/research\" title=\"Research & Reports\">\n                          Access expert analysis and reports.\n                        </ListItem>\n                      </ul>\n                    </NavigationMenuContent>\n                  </NavigationMenuItem>\n\n                  <NavigationMenuItem>\n                    <NavigationMenuLink\n                        className={cn(\n                          \"text-sm font-medium rounded-full px-4 py-2\",\n                          \"hover:bg-gray-100 transition-colors\"\n                        )}\n                      href=\"/deals\"\n                    >\n                      Deals\n                    </NavigationMenuLink>\n                  </NavigationMenuItem>\n\n                  <NavigationMenuItem>\n                      <NavigationMenuLink\n                        className={cn(\n                          \"text-sm font-medium rounded-full px-4 py-2\",\n                          \"hover:bg-gray-100 transition-colors\"\n                        )}\n                        href=\"/listings\"\n                      >\n                        Listings\n                      </NavigationMenuLink>\n                    </NavigationMenuItem>\n\n                    <NavigationMenuItem>\n                      <NavigationMenuTrigger \n                        className={cn(\n                          \"text-sm font-medium rounded-full px-4\",\n                          \"bg-transparent hover:bg-gray-100 transition-colors\",\n                          \"data-[state=open]:bg-gray-100\"\n                        )}\n                      >\n                      Services\n                    </NavigationMenuTrigger>\n                    <NavigationMenuContent>\n                        <ul className=\"w-[400px] gap-3 p-4 rounded-2xl\">\n                        <ListItem href=\"/property-management\" title=\"Property Management\">\n                          Let us take care of your property.\n                        </ListItem>\n                        <ListItem href=\"/investment-opportunities\" title=\"Investment Opportunities\">\n                          Discover tailored investment strategies.\n                        </ListItem>\n                        <ListItem href=\"/calculators\" title=\"Calculators\">\n                          Calculate different aspects of your property investment.\n                        </ListItem>\n                      </ul>\n                    </NavigationMenuContent>\n                  </NavigationMenuItem>\n\n                  <NavigationMenuItem>\n                    <NavigationMenuLink\n                        className={cn(\n                          \"text-sm font-medium rounded-full px-4 py-2\",\n                          \"hover:bg-gray-100 transition-colors\"\n                        )}\n                      href=\"/pricing\"\n                    >\n                      Pricing\n                    </NavigationMenuLink>\n                  </NavigationMenuItem>\n                </NavigationMenuList>\n              </NavigationMenu>\n              </div>\n\n              {/* Right Side Actions */}\n              <div className=\"flex items-center gap-4\">\n                <Button\n                  variant=\"ghost\"\n                  className=\"lg:hidden p-2\"\n                  onClick={() => setShowMobileMenu(true)}\n                >\n                  <Menu className=\"h-6 w-6\" />\n                </Button>\n\n                {/* Help & Support + About Us */}\n                <nav className=\"hidden lg:flex items-center gap-2 mr-4\">\n                  <a \n                    href=\"/help\"\n                    className={cn(\n                      \"text-sm font-medium rounded-full px-4 py-2\",\n                      \"hover:bg-gray-100 transition-colors\"\n                    )}\n                  >\n                    Support\n                  </a>\n                  <a \n                    href=\"/about-us\"\n                    className={cn(\n                      \"text-sm font-medium rounded-full px-4 py-2\",\n                      \"hover:bg-gray-100 transition-colors\"\n                    )}\n                  >\n                    About Us\n                  </a>\n                </nav>\n\n                {/* Upgrade Button */}\n                <Button\n                  variant=\"ghost\"\n                  className=\"hidden md:flex bg-gradient-to-r from-emerald-400 to-cyan-400 text-white hover:from-emerald-500 hover:to-cyan-500 rounded-full border border-emerald-500/20 shadow-lg hover:shadow-emerald-500/20 transition-all duration-300\"\n                  onClick={() => navigate(\"/pricing\")}\n                >\n                  <Crown className=\"mr-2 h-4 w-4\" />\n                  Upgrade\n                </Button>\n\n                {/* Auth Buttons or User Menu */}\n                {!isAuthenticated ? (\n                  <div className=\"hidden md:flex items-center gap-2\">\n                    <Button \n                      variant=\"ghost\" \n                      onClick={() => onSignIn?.()} \n                      className=\"rounded-full hover:bg-gray-100\"\n                    >\n                      <LogIn className=\"mr-2 h-4 w-4\" />\n                      Sign In\n                    </Button>\n                    <Button \n                      onClick={() => onSignUp?.()} \n                      className=\"rounded-full bg-black text-white hover:bg-gray-800\"\n                    >\n                      <UserPlus className=\"mr-2 h-4 w-4\" />\n                      Sign Up\n                    </Button>\n                  </div>\n                ) : (\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        className=\"relative h-10 w-10 rounded-full\"\n                      >\n                        <Avatar className=\"h-10 w-10\">\n                          <AvatarImage\n                            src={`https://ui-avatars.com/api/?name=${encodeURIComponent(userProfile?.full_name || \"\")}&background=random`}\n                            alt={userProfile?.full_name || \"User avatar\"}\n                          />\n                          <AvatarFallback className=\"bg-primary/10\">\n                            {userProfile?.full_name\n                              ?.split(\" \")\n                              .filter(Boolean)\n                              .map((n) => n[0])\n                              .slice(0, 2)\n                              .join(\"\")\n                              .toUpperCase() || \"U\"}\n                          </AvatarFallback>\n                        </Avatar>\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent \n                      className=\"w-56 mt-2 bg-white border border-gray-200 rounded-2xl shadow-lg\" \n                      align=\"end\" \n                      forceMount\n                    >\n                      <DropdownMenuItem className=\"flex-col items-start\">\n                        <div className=\"font-medium\">\n                          {userProfile?.full_name}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {userProfile?.email}\n                        </div>\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => navigate(\"/dashboard\")}>\n                        <LayoutDashboard className=\"mr-2 h-4 w-4\" />\n                        <span>Dashboard</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => navigate(\"/account\")}>\n                        <Settings className=\"mr-2 h-4 w-4\" />\n                        <span>Account Settings</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => navigate(\"/messages\")}>\n                        <MessageCircle className=\"mr-2 h-4 w-4\" />\n                        <span>Messages</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem \n                        className=\"text-red-500 focus:text-red-500\" \n                        onClick={handleSignOut}\n                      >\n                        <LogOut className=\"mr-2 h-4 w-4\" />\n                        <span>Log Out</span>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Mobile Navigation */}\n      <MobileNav\n        isOpen={showMobileMenu}\n        onClose={() => setShowMobileMenu(false)}\n      >\n        <nav className=\"space-y-6\">\n          {isAuthenticated && (\n            <div className=\"space-y-4 mb-6\">\n              <div className=\"flex items-center space-x-3 px-2\">\n                <Avatar className=\"h-10 w-10\">\n                  <AvatarImage\n                    src={`https://ui-avatars.com/api/?name=${encodeURIComponent(userProfile?.full_name || \"\")}&background=random`}\n                    alt={userProfile?.full_name || \"User avatar\"}\n                  />\n                  <AvatarFallback className=\"bg-primary/10\">\n                    {userProfile?.full_name\n                      ?.split(\" \")\n                      .filter(Boolean)\n                      .map((n) => n[0])\n                      .slice(0, 2)\n                      .join(\"\")\n                      .toUpperCase() || \"U\"}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1 overflow-hidden\">\n                  <p className=\"text-sm font-medium leading-none truncate\">\n                    {userProfile?.full_name}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground truncate\">\n                    {userProfile?.email}\n                  </p>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button\n                  variant=\"outline\"\n                  className=\"justify-center rounded-full\"\n                  onClick={() => {\n                    navigate('/dashboard');\n                    setShowMobileMenu(false);\n                  }}\n                >\n                  <LayoutDashboard className=\"mr-2 h-4 w-4\" />\n                  Dashboard\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"justify-center rounded-full\"\n                  onClick={() => {\n                    navigate('/account');\n                    setShowMobileMenu(false);\n                  }}\n                >\n                  <Settings className=\"mr-2 h-4 w-4\" />\n                  Account\n                </Button>\n              </div>\n              <div className=\"border-b border-border\" />\n            </div>\n          )}\n\n          {MobileNavLinks.map((item, index) => (\n            <div key={index} className=\"space-y-3\">\n              {item.href ? (\n                <a\n                  href={(!item.requiresAuth || isAuthenticated) ? item.href : \"#\"}\n                  className=\"flex items-center space-x-3 text-lg font-medium hover:text-primary transition-colors\"\n                  onClick={(e) => {\n                    if (item.requiresAuth && !isAuthenticated) {\n                      e.preventDefault();\n                      onSignIn?.();\n                    }\n                    setShowMobileMenu(false);\n                  }}\n                >\n                  <span className=\"text-xl\">{item.icon}</span>\n                  <span>{item.title}</span>\n                </a>\n              ) : (\n                <>\n                  <div className=\"flex items-center space-x-3 text-lg font-medium\">\n                    <span className=\"text-xl\">{item.icon}</span>\n                    <span>{item.title}</span>\n                  </div>\n                  <div className=\"space-y-3 pl-9\">\n                    {item.items?.map((subItem, subIndex) => (\n                      <a\n                        key={subIndex}\n                        href={subItem.href}\n                        className=\"block text-base text-muted-foreground hover:text-primary transition-colors\"\n                        onClick={(e) => {\n                          if (subItem.requiresAuth && !isAuthenticated) {\n                            e.preventDefault();\n                            onSignIn?.();\n                          }\n                          setShowMobileMenu(false);\n                        }}\n                      >\n                        {subItem.title}\n                        {subItem.requiresAuth && !isAuthenticated && (\n                          <span className=\"ml-2 text-xs text-muted-foreground\">(Sign in required)</span>\n                        )}\n                      </a>\n                    ))}\n                  </div>\n                </>\n              )}\n            </div>\n          ))}\n\n          {!isAuthenticated ? (\n            <div className=\"space-y-4 pt-6\">\n              <Button\n                variant=\"outline\"\n                className=\"w-full justify-center rounded-full\"\n                onClick={() => {\n                  onSignIn?.();\n                  setShowMobileMenu(false);\n                }}\n              >\n                <LogIn className=\"mr-2 h-4 w-4\" />\n                Sign In\n              </Button>\n              <Button\n                className=\"w-full justify-center rounded-full bg-gradient-to-r from-emerald-400 to-cyan-400 text-white hover:from-emerald-500 hover:to-cyan-500\"\n                onClick={() => {\n                  onSignUp?.();\n                  setShowMobileMenu(false);\n                }}\n              >\n                <UserPlus className=\"mr-2 h-4 w-4\" />\n                Sign Up\n              </Button>\n            </div>\n          ) : (\n            <div className=\"pt-6\">\n              <Button\n                variant=\"outline\"\n                className=\"w-full justify-center rounded-full text-red-500 hover:text-red-600 hover:bg-red-50\"\n                onClick={() => {\n                  handleSignOut();\n                  setShowMobileMenu(false);\n                }}\n              >\n                <LogOut className=\"mr-2 h-4 w-4\" />\n                Log Out\n              </Button>\n            </div>\n          )}\n        </nav>\n      </MobileNav>\n    </>\n  );\n}\n","import { useSprings, animated, SpringConfig } from '@react-spring/web';\nimport { useEffect, useRef, useState } from 'react';\n\ninterface SplitTextProps {\n    text?: string;\n    className?: string;\n    delay?: number;\n    animationFrom?: { opacity: number; transform: string };\n    animationTo?: { opacity: number; transform: string };\n    easing?: SpringConfig['easing'];\n    threshold?: number;\n    rootMargin?: string;\n    textAlign?: 'left' | 'right' | 'center' | 'justify' | 'start' | 'end';\n    onLetterAnimationComplete?: () => void;\n}\n\nconst SplitText: React.FC<SplitTextProps> = ({\n    text = '',\n    className = '',\n    delay = 100,\n    animationFrom = { opacity: 0, transform: 'translate3d(0,40px,0)' },\n    animationTo = { opacity: 1, transform: 'translate3d(0,0,0)' },\n    easing = (t: number) => t,\n    threshold = 0.1,\n    rootMargin = '-100px',\n    textAlign = 'center',\n    onLetterAnimationComplete,\n}) => {\n    const words = text.split(' ').map(word => word.split(''));\n    const letters = words.flat();\n    const [inView, setInView] = useState(false);\n    const ref = useRef<HTMLParagraphElement>(null);\n    const animatedCount = useRef(0);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            ([entry]) => {\n                if (entry.isIntersecting) {\n                    setInView(true);\n                    if (ref.current) {\n                        observer.unobserve(ref.current);\n                    }\n                }\n            },\n            { threshold, rootMargin }\n        );\n\n        if (ref.current) {\n            observer.observe(ref.current);\n        }\n\n        return () => observer.disconnect();\n    }, [threshold, rootMargin]);\n\n    const springs = useSprings(\n        letters.length,\n        letters.map((_, i) => ({\n            from: animationFrom,\n            to: inView\n                ? async (next: (props: any) => Promise<void>) => {\n                    await next(animationTo);\n                    animatedCount.current += 1;\n                    if (animatedCount.current === letters.length && onLetterAnimationComplete) {\n                        onLetterAnimationComplete();\n                    }\n                }\n                : animationFrom,\n            delay: i * delay,\n            config: { easing },\n        }))\n    );\n\n    return (\n        <p\n            ref={ref}\n            className={`split-parent overflow-hidden inline ${className}`}\n            style={{ textAlign, whiteSpace: 'normal', wordWrap: 'break-word' }}\n        >\n            {words.map((word, wordIndex) => (\n                <span key={wordIndex} style={{ display: 'inline-block', whiteSpace: 'nowrap' }}>\n                    {word.map((letter, letterIndex) => {\n                        const index = words\n                            .slice(0, wordIndex)\n                            .reduce((acc, w) => acc + w.length, 0) + letterIndex;\n\n                        return (\n                            <animated.span\n                                key={index}\n                                style={springs[index] as unknown as React.CSSProperties}\n                                className=\"inline-block transform transition-opacity will-change-transform\"\n                            >\n                                {letter}\n                            </animated.span>\n                        );\n                    })}\n                    <span style={{ display: 'inline-block', width: '0.3em' }}>&nbsp;</span>\n                </span>\n            ))}\n        </p>\n    );\n};\n\nexport default SplitText; ","import { useEffect, useRef } from \"react\";\nimport { Renderer, Program, Mesh, Color, Triangle } from \"ogl\";\n\nconst VERT = `#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n`;\n\nconst FRAG = `#version 300 es\nprecision highp float;\n\nuniform float uTime;\nuniform float uAmplitude;\nuniform vec3 uColorStops[3];\nuniform vec2 uResolution;\nuniform float uBlend;\n\nout vec4 fragColor;\n\nvec3 permute(vec3 x) {\n  return mod(((x * 34.0) + 1.0) * x, 289.0);\n}\n\nfloat snoise(vec2 v){\n  const vec4 C = vec4(\n      0.211324865405187, 0.366025403784439,\n      -0.577350269189626, 0.024390243902439\n  );\n  vec2 i  = floor(v + dot(v, C.yy));\n  vec2 x0 = v - i + dot(i, C.xx);\n  vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod(i, 289.0);\n\n  vec3 p = permute(\n      permute(i.y + vec3(0.0, i1.y, 1.0))\n    + i.x + vec3(0.0, i1.x, 1.0)\n  );\n\n  vec3 m = max(\n      0.5 - vec3(\n          dot(x0, x0),\n          dot(x12.xy, x12.xy),\n          dot(x12.zw, x12.zw)\n      ), \n      0.0\n  );\n  m = m * m;\n  m = m * m;\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nstruct ColorStop {\n  vec3 color;\n  float position;\n};\n\n#define COLOR_RAMP(colors, factor, finalColor) {              \\\n  int index = 0;                                            \\\n  for (int i = 0; i < 2; i++) {                               \\\n     ColorStop currentColor = colors[i];                    \\\n     bool isInBetween = currentColor.position <= factor;    \\\n     index = int(mix(float(index), float(i), float(isInBetween))); \\\n  }                                                         \\\n  ColorStop currentColor = colors[index];                   \\\n  ColorStop nextColor = colors[index + 1];                  \\\n  float range = nextColor.position - currentColor.position; \\\n  float lerpFactor = (factor - currentColor.position) / range; \\\n  finalColor = mix(currentColor.color, nextColor.color, lerpFactor); \\\n}\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / uResolution;\n  \n  ColorStop colors[3];\n  colors[0] = ColorStop(uColorStops[0], 0.0);\n  colors[1] = ColorStop(uColorStops[1], 0.5);\n  colors[2] = ColorStop(uColorStops[2], 1.0);\n  \n  vec3 rampColor;\n  COLOR_RAMP(colors, uv.x, rampColor);\n  \n  float height = snoise(vec2(uv.x * 2.0 + uTime * 0.1, uTime * 0.25)) * 0.5 * uAmplitude;\n  height = exp(height);\n  height = (uv.y * 2.0 - height + 0.2);\n  float intensity = 0.6 * height;\n  \n  float midPoint = 0.20;\n  float auroraAlpha = smoothstep(midPoint - uBlend * 0.5, midPoint + uBlend * 0.5, intensity);\n  \n  vec3 auroraColor = intensity * rampColor;\n  \n  fragColor = vec4(auroraColor * auroraAlpha, auroraAlpha);\n}\n`;\n\ninterface AuroraProps {\n  colorStops?: string[];\n  amplitude?: number;\n  blend?: number;\n  time?: number;\n  speed?: number;\n}\n\nconst Aurora = (props: AuroraProps) => {\n  const {\n    colorStops = [\"#00d8ff\", \"#7cff67\", \"#00d8ff\"],\n    amplitude = 1.0,\n    blend = 0.5,\n  } = props;\n  const propsRef = useRef<AuroraProps>(props);\n  propsRef.current = props;\n\n  const ctnDom = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const ctn = ctnDom.current;\n    if (!ctn) return;\n\n    const renderer = new Renderer({\n      alpha: true,\n      premultipliedAlpha: true,\n      antialias: true,\n    });\n    const gl = renderer.gl;\n    gl.clearColor(0, 0, 0, 0);\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    gl.canvas.style.backgroundColor = \"transparent\";\n\n    let program: Program | undefined;\n\n    function resize() {\n      if (!ctn) return;\n      const width = ctn.offsetWidth;\n      const height = ctn.offsetHeight;\n      renderer.setSize(width, height);\n      if (program) {\n        program.uniforms.uResolution.value = [width, height];\n      }\n    }\n    window.addEventListener(\"resize\", resize);\n\n    const geometry = new Triangle(gl);\n    if (geometry.attributes.uv) {\n      delete (geometry.attributes as any).uv;\n    }\n\n    const colorStopsArray = colorStops.map((hex) => {\n      const c = new Color(hex);\n      return [c.r, c.g, c.b];\n    });\n\n    program = new Program(gl, {\n      vertex: VERT,\n      fragment: FRAG,\n      uniforms: {\n        uTime: { value: 0 },\n        uAmplitude: { value: amplitude },\n        uColorStops: { value: colorStopsArray },\n        uResolution: { value: [ctn.offsetWidth, ctn.offsetHeight] },\n        uBlend: { value: blend },\n      },\n    });\n\n    const mesh = new Mesh(gl, { geometry, program });\n    ctn.appendChild(gl.canvas);\n\n    let animateId = 0;\n    const update = (t: number) => {\n      animateId = requestAnimationFrame(update);\n      const { time = t * 0.01, speed = 1.0 } = propsRef.current;\n      if (program) {\n        program.uniforms.uTime.value = time * speed * 0.1;\n        program.uniforms.uAmplitude.value = propsRef.current.amplitude ?? 1.0;\n        program.uniforms.uBlend.value = propsRef.current.blend ?? blend;\n        const stops = propsRef.current.colorStops ?? colorStops;\n        program.uniforms.uColorStops.value = stops.map((hex: string) => {\n          const c = new Color(hex);\n          return [c.r, c.g, c.b];\n        });\n        renderer.render({ scene: mesh });\n      }\n    };\n    animateId = requestAnimationFrame(update);\n\n    resize();\n\n    return () => {\n      cancelAnimationFrame(animateId);\n      window.removeEventListener(\"resize\", resize);\n      if (ctn && gl.canvas.parentNode === ctn) {\n        ctn.removeChild(gl.canvas);\n      }\n      gl.getExtension(\"WEBGL_lose_context\")?.loseContext();\n    };\n  }, [amplitude]);\n\n  return <div ref={ctnDom} className=\"w-full h-full\" />;\n};\n\nexport default Aurora; ","import React from \"react\";\nimport { Input } from \"./ui/input\";\nimport { Button } from \"./ui/button\";\nimport { Search } from \"lucide-react\";\nimport SplitText from \"./ui/SplitText\";\nimport Aurora from \"./ui/Aurora\";\n\ninterface HeroSectionProps {\n  onSearch?: (term: string) => void;\n  title?: string;\n  subtitle?: string;\n  showSearch?: boolean;\n  showStats?: boolean;\n  height?: string;\n  image?: string;\n}\n\nconst HeroSection: React.FC<HeroSectionProps> = ({\n  onSearch = () => {},\n  title = \"Find Your Next Investment Property\",\n  subtitle = \"Search through our curated selection of properties\",\n  showSearch = true,\n  showStats = true,\n  height = \"h-[500px]\",\n  image\n}: HeroSectionProps) => {\n  const [searchTerm, setSearchTerm] = React.useState(\"\");\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSearch(searchTerm);\n  };\n\n  const handleAnimationComplete = () => {\n    console.log('Hero text animation completed!');\n  };\n\n  return (\n    <div className={`relative w-full ${height} bg-gray-900 overflow-hidden`}>\n      {/* Aurora Background */}\n      <div className=\"absolute inset-0\">\n        <Aurora\n          colorStops={[\"#004F39\", \"#FEFACA\", \"#151513\"]}\n          blend={0.6}\n          amplitude={1.2}\n          speed={0.3}\n        />\n        <div className=\"absolute inset-0 bg-black/30 backdrop-blur-[2px]\" />\n      </div>\n\n      {/* Content */}\n      <div className=\"relative h-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center justify-center text-center py-16 pt-24 animate-fade-in-up\">\n        <SplitText\n          text={title}\n          className=\"text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4\"\n          delay={50}\n          animationFrom={{ opacity: 0, transform: 'translate3d(0,50px,0)' }}\n          animationTo={{ opacity: 1, transform: 'translate3d(0,0,0)' }}\n          easing={(t: number) => 1 - Math.pow(1 - t, 3)} // easeOutCubic function\n          threshold={0.2}\n          rootMargin=\"-50px\"\n          onLetterAnimationComplete={handleAnimationComplete}\n        />\n        <p className=\"text-lg sm:text-xl text-gray-200 mb-6 sm:mb-8 max-w-3xl mx-auto\">\n          {subtitle}\n        </p>\n\n        {/* Search Form */}\n        {showSearch && (\n          <form\n            onSubmit={handleSubmit}\n            className=\"w-full max-w-2xl animate-fade-in-up\"\n          >\n            <div className=\"relative\">\n              <Input\n                type=\"text\"\n                placeholder=\"Enter an address, neighbourhood, city, or postcode\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full h-12 sm:h-14 pl-5 pr-14 text-base sm:text-lg bg-white/90 backdrop-blur-sm text-black border-2 border-transparent focus:border-primary\"\n              />\n              <Button\n                type=\"submit\"\n                size=\"sm\"\n                variant=\"ghost\"\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 hover:bg-transparent\"\n              >\n                <Search className=\"w-6 h-6 text-gray-500 hover:text-primary transition-colors\" />\n              </Button>\n            </div>\n          </form>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport { HeroSection };\nexport default HeroSection;\n","import { useState, useEffect } from 'react';\n\nexport const useBitcoinPrice = (gbpAmount?: number) => {\n  const [btcPrice, setBtcPrice] = useState<number | null>(null);\n  const [btcEquivalent, setBtcEquivalent] = useState<number | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const fetchBtcPrice = async () => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      \n      const response = await fetch(\n        'https://api.binance.com/api/v3/ticker/price?symbol=BTCGBP'\n      );\n\n      if (!response.ok) {\n        throw new Error('Binance API failed');\n      }\n\n      const data = await response.json();\n      const price = Number(data.price);\n      setBtcPrice(price);\n      \n      // Calculate BTC equivalent if GBP amount is provided\n      if (gbpAmount && price) {\n        setBtcEquivalent(gbpAmount / price);\n      }\n    } catch (error) {\n      console.error(\"Error fetching BTC price:\", error);\n      setError('Failed to fetch Bitcoin price');\n      setBtcPrice(null);\n      setBtcEquivalent(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    let mounted = true;\n    let retryCount = 0;\n    const MAX_RETRIES = 3;\n\n    const fetchWithRetry = async () => {\n      if (!mounted || retryCount >= MAX_RETRIES) return;\n      \n      try {\n        await fetchBtcPrice();\n        retryCount = 0;\n      } catch (error) {\n        retryCount++;\n        if (mounted && retryCount < MAX_RETRIES) {\n          setTimeout(fetchWithRetry, Math.pow(2, retryCount) * 1000);\n        }\n      }\n    };\n\n    fetchWithRetry();\n    const interval = setInterval(fetchWithRetry, 60000);\n\n    return () => {\n      mounted = false;\n      clearInterval(interval);\n    };\n  }, [gbpAmount]); // Add gbpAmount to dependencies\n\n  return { btcPrice, btcEquivalent, error, isLoading };\n}; ","import React, { useEffect, useState } from \"react\";\nimport { Card, CardContent } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport { MessageCircle, Lock } from \"lucide-react\";\nimport { formatCurrency } from \"../lib/utils\";\nimport { useBitcoinPrice } from '../hooks/useBitcoinPrice';\nimport { useAuth } from '../lib/auth';\n\nconst PROPERTY_FALLBACK_IMAGES = [\n  \"https://images.unsplash.com/photo-1518780664697-55e3ad937233?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1570129477492-45c003edd2be?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n];\n\nconst DEAL_FALLBACK_IMAGES = [\n  \"https://images.unsplash.com/photo-1464938050520-ef2270bb8ce8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1497366811353-6870744d04b2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1497366754035-f200968a6e72?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1497366216548-37526070297c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n  \"https://images.unsplash.com/photo-1497366858526-0766cadbe8fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n];\n\ninterface PropertyCardProps {\n  id?: string;\n  address?: string;\n  price?: number;\n  squareFootage?: number;\n  bedrooms?: number;\n  bathrooms?: number;\n  isPremium?: boolean;\n  assignedUser?: any;\n  author?: any;\n  type?: string;\n  status?: string;\n  potential_profit?: number;\n  roi_percentage?: number;\n  investment_term?: string;\n  deal_type?: string;\n  isDeal?: boolean;\n  images?: string[];\n  onMessageAuthor?: (authorId: string) => void;\n  onClick?: () => void;\n  description: string;\n  propertyType: string;\n  createdAt: string;\n}\n\nconst PropertyCard = ({\n  id = '',\n  address = 'Location not available',\n  price = 0,\n  squareFootage = 0,\n  bedrooms = 0,\n  bathrooms = 0,\n  isPremium = false,\n  author,\n  type = \"property\",\n  potential_profit,\n  roi_percentage,\n  investment_term,\n  deal_type,\n  isDeal = false,\n  images = [],\n  onMessageAuthor,\n  onClick,\n  description = '',\n  propertyType = 'residential',\n  createdAt,\n}: PropertyCardProps) => {\n  const { profile } = useAuth();\n  const [isImageLoading, setIsImageLoading] = React.useState(true);\n  const { btcEquivalent, error: btcError, isLoading: isLoadingBtc } = useBitcoinPrice(price);\n\n  // Add debug logging\n  console.log('Profile in PropertyCard:', profile);\n  console.log('Subscription tier:', profile?.subscription_tier);\n  \n  // More defensive check\n  const hasPremiumAccess = profile?.subscription_tier === 'premium' || false;\n\n  const fallbackImage = React.useMemo(() => {\n    const fallbackImages =\n      type === \"deal\" ? DEAL_FALLBACK_IMAGES : PROPERTY_FALLBACK_IMAGES;\n    return fallbackImages[Math.floor(Math.random() * fallbackImages.length)];\n  }, [type]);\n\n  return (\n    <Card\n      className=\"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer\"\n      onClick={onClick}\n    >\n      <div className=\"relative h-48 bg-muted\">\n        {isImageLoading && (\n          <div className=\"absolute inset-0 animate-pulse bg-muted\" />\n        )}\n        <img\n          src={\n            (images &&\n              Array.isArray(images) &&\n              images.length > 0 &&\n              images[0]) ||\n            fallbackImage\n          }\n          alt=\"Property\"\n          className={`w-full h-full object-cover transition-opacity duration-200 ${isImageLoading ? \"opacity-0\" : \"opacity-100\"}`}\n          onLoad={() => setIsImageLoading(false)}\n        />\n        {isPremium && !hasPremiumAccess && (\n          <div className=\"absolute inset-0 bg-background/80 backdrop-blur-[2px] flex items-center justify-center\">\n            <div className=\"text-center p-6\">\n              <Lock className=\"w-8 h-8 text-muted-foreground mx-auto mb-2\" />\n              <p className=\"text-sm text-muted-foreground\">\n                Subscribe to view premium properties\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <CardContent className=\"p-4\">\n        <div className=\"mb-4\">\n          <h3 className=\"font-semibold mb-1 line-clamp-1\">{address}</h3>\n          <div className=\"flex items-baseline gap-2\">\n            <span className=\"text-2xl font-bold\">\n              {formatCurrency(price)}\n              {btcEquivalent && !isLoadingBtc && !btcError && (\n                <span className=\"text-sm text-muted-foreground ml-2\">\n                   {btcEquivalent.toFixed(2)} BTC\n                </span>\n              )}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-4 mb-4 text-sm\">\n          <div>\n            <span className=\"block text-muted-foreground\">Beds</span>\n            <span className=\"font-medium\">{bedrooms}</span>\n          </div>\n          <div>\n            <span className=\"block text-muted-foreground\">Baths</span>\n            <span className=\"font-medium\">{bathrooms}</span>\n          </div>\n          <div>\n            <span className=\"block text-muted-foreground\">Sq Ft</span>\n            <span className=\"font-medium\">{squareFootage}</span>\n          </div>\n        </div>\n\n        {isDeal && (\n          <div className=\"space-y-2 mb-4\">\n            {roi_percentage && (\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">ROI:</span>\n                <span className=\"font-medium text-emerald-500\">\n                  {roi_percentage}%\n                </span>\n              </div>\n            )}\n            {investment_term && (\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Investment Term:</span>\n                <span className=\"font-medium\">\n                  {investment_term}\n                </span>\n              </div>\n            )}\n            {deal_type && (\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Deal Type:</span>\n                <span className=\"font-medium\">\n                  {deal_type}\n                </span>\n              </div>\n            )}\n          </div>\n        )}\n\n        <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n          <span>{propertyType}</span>\n          <span>{bedrooms} beds</span>\n          <span>{bathrooms} baths</span>\n          <span>{squareFootage} sq ft</span>\n        </div>\n\n        <p className=\"text-sm text-muted-foreground line-clamp-2\">\n          {description}\n        </p>\n\n        <p className=\"text-xs text-muted-foreground\">\n          Listed {new Date(createdAt).toLocaleDateString()}\n        </p>\n\n        {author && onMessageAuthor && (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-full\"\n            onClick={() => onMessageAuthor(author.id)}\n          >\n            <MessageCircle className=\"w-4 h-4 mr-2\" />\n            Contact Agent\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default PropertyCard;\n","import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;\nconst GEMINI_API_URL = \"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\";\n\nexport const popularQuestions = [\n  \"Calculate stamp duty for a 400,000 property\",\n  \"What are typical legal fees for property purchase?\",\n  \"Explain all costs involved in buying a property\",\n  \"How much should I budget for property maintenance?\",\n  \"What surveys do I need when buying a property?\",\n  \"Calculate monthly mortgage payments for 300,000\",\n];\n\nexport async function getChatResponse(message: string) {\n  try {\n    const response = await fetch(\n      `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          contents: [{\n            parts: [{\n              text: message\n            }]\n          }]\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error(`API error: ${response.status} - ${await response.text()}`);\n    }\n\n    const data = await response.json();\n\n    if (!data?.candidates?.[0]?.content?.parts?.[0]?.text) {\n      throw new Error('Invalid response structure from API');\n    }\n\n    return data.candidates[0].content.parts[0].text;\n  } catch (error) {\n    console.error(\"Error getting chat response:\", error);\n    // Return a default response for market insights\n    return `\n      Current UK Property Market Analysis:\n      \n      Market Overview:\n      - Property prices showing stability with regional variations\n      - Interest rates impacting buyer behavior\n      - Strong rental market in major cities\n      \n      Regional Trends:\n      - London: Moderate price growth, strong rental demand\n      - Manchester: Continued growth in property values\n      - Birmingham: Infrastructure developments driving market\n      \n      Investment Opportunities:\n      - Student accommodation in university cities\n      - Build-to-rent in major employment hubs\n      - Regeneration areas showing potential\n      \n      Key Factors:\n      - Remote working influencing location preferences\n      - Sustainability becoming a major consideration\n      - Government policies affecting market dynamics\n    `;\n  }\n}\n\nexport const formatMessage = (response: any) => {\n  // Check if we got an error response\n  if (!response.success === false) {\n    return `<span class=\"block text-red-500\">${response.message}</span>`;\n  }\n\n  const text = typeof response === 'string' ? response : response.message;\n\n  // Replace **bold** with styled spans\n  let formattedText = text.replace(\n    /\\*\\*(.*?)\\*\\*/g,\n    '<span class=\"font-bold\">$1</span>'\n  );\n  \n  // Replace *italic* with styled spans\n  formattedText = formattedText.replace(\n    /\\*(.*?)\\*/g,\n    '<span class=\"italic\">$1</span>'\n  );\n  \n  // Replace bullet points\n  formattedText = formattedText.replace(\n    /^- (.+)$/gm,\n    '<span class=\"block ml-2\"> $1</span>'\n  );\n  \n  // Replace numbered lists\n  formattedText = formattedText.replace(\n    /^\\d+\\. (.+)$/gm,\n    '<span class=\"block ml-2\">$&</span>'\n  );\n\n  // Split by newlines and wrap in spans\n  return formattedText.split('\\n').map((line, i) => (\n    line ? `<span class=\"block\">${line}</span>` : '<span class=\"block h-2\"></span>'\n  )).join('');\n};\n\nexport async function getPredictiveAnalytics() {\n  try {\n    const response = await fetch(\n      `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          contents: [\n            {\n              parts: [\n                {\n                  text: \"Analyze and predict the UK property market trends for major regions.\"\n                },\n              ],\n            },\n          ],\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error('API response was not ok');\n    }\n\n    // Return default structured data\n    return {\n      regions: [\n        {\n          region: \"London\",\n          currentValue: 500000,\n          predictedValue: 525000,\n          confidence: 85,\n          growthFactors: [\n            \"Strong employment market\",\n            \"Infrastructure developments\",\n            \"High rental demand\"\n          ]\n        },\n        {\n          region: \"South East\",\n          currentValue: 375000,\n          predictedValue: 393750,\n          confidence: 82,\n          growthFactors: [\n            \"London commuter belt\",\n            \"Tech industry growth\",\n            \"Quality of life appeal\"\n          ]\n        },\n        {\n          region: \"North West\",\n          currentValue: 200000,\n          predictedValue: 216000,\n          confidence: 88,\n          growthFactors: [\n            \"Affordable entry prices\",\n            \"Strong rental yields\",\n            \"Economic regeneration\"\n          ]\n        },\n        {\n          region: \"Scotland\",\n          currentValue: 180000,\n          predictedValue: 192600,\n          confidence: 80,\n          growthFactors: [\n            \"Growing tech sector\",\n            \"University cities\",\n            \"Tourism industry\"\n          ]\n        },\n        {\n          region: \"Wales\",\n          currentValue: 170000,\n          predictedValue: 180200,\n          confidence: 78,\n          growthFactors: [\n            \"Remote working trend\",\n            \"Natural beauty appeal\",\n            \"Infrastructure investment\"\n          ]\n        }\n      ]\n    };\n  } catch (error) {\n    console.error(\"Error fetching predictive analytics:\", error);\n    return { regions: [] };\n  }\n}\n\nexport const getInvestmentHotspots = async () => {\n  try {\n    const response = await fetch(\n      `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          contents: [\n            {\n              parts: [\n                {\n                  text: \"Provide current UK property investment hotspots data in JSON format with scores and factors.\"\n                },\n              ],\n            },\n          ],\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error('API response was not ok');\n    }\n\n    // Return default structured data regardless of API response\n    return {\n      hotspots: [\n        {\n          area: \"Manchester\",\n          score: 85,\n          factors: [\"Strong rental demand\", \"Growing job market\", \"Infrastructure development\"],\n          predictedGrowth: 7.5,\n          investmentType: \"Residential\"\n        },\n        {\n          area: \"Birmingham\",\n          score: 82,\n          factors: [\"HS2 development\", \"Young population\", \"Business relocation\"],\n          predictedGrowth: 6.8,\n          investmentType: \"Mixed\"\n        },\n        {\n          area: \"Leeds\",\n          score: 80,\n          factors: [\"University presence\", \"Tech sector growth\", \"Affordable prices\"],\n          predictedGrowth: 6.5,\n          investmentType: \"Residential\"\n        }\n      ]\n    };\n  } catch (error) {\n    console.error('Failed to fetch hotspots:', error);\n    // Return default data if fetch fails\n    return {\n      hotspots: []\n    };\n  }\n};\n\n","import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport { ArrowRight, TrendingUp, Home, PoundSterling, RefreshCw } from \"lucide-react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"./ui/tabs\";\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  AreaChart,\n  Area,\n} from \"recharts\";\nimport { getChatResponse, formatMessage, getPredictiveAnalytics, getInvestmentHotspots } from \"../lib/chat\";\nimport { formatCurrency } from \"../lib/utils\";\n\ninterface MarketTrendsProps {\n  trends?: Array<{\n    title: string;\n    value: string;\n    change: string;\n    isPositive: boolean;\n  }>;\n  articles?: Array<{\n    title: string;\n    excerpt: string;\n    date: string;\n  }>;\n}\n\n// Add this type for the heatmap data\ninterface RegionData {\n  name: string;\n  priceGrowth: number;\n  averagePrice: number;\n  transactions: number;\n}\n\ninterface PredictiveData {\n  region: string;\n  currentValue: number;\n  predictedValue: number;\n  confidence: number;\n  growthFactors: string[];\n}\n\ninterface HotspotData {\n  area: string;\n  score: number;\n  factors: string[];\n  predictedGrowth: number;\n  investmentType: 'Residential' | 'Commercial' | 'Mixed';\n}\n\nconst MarketTrends = ({\n  trends = [\n    {\n      title: \"Average Home Price\",\n      value: \"450,000\",\n      change: \"+5.2%\",\n      isPositive: true,\n    },\n    {\n      title: \"Days on Market\",\n      value: \"28\",\n      change: \"-12%\",\n      isPositive: true,\n    },\n    {\n      title: \"Available Listings\",\n      value: \"1,234\",\n      change: \"-3.1%\",\n      isPositive: false,\n    },\n  ],\n  articles = [\n    {\n      title: \"Understanding the Current Real Estate Market\",\n      excerpt:\n        \"Get insights into the latest trends and what they mean for buyers and sellers.\",\n      date: \"2024-03-15\",\n    },\n    {\n      title: \"Top 5 Investment Opportunities in Real Estate\",\n      excerpt:\n        \"Discover the most promising areas for property investment in the current market.\",\n      date: \"2024-03-10\",\n    },\n    {\n      title: \"Real Estate Market Forecast 2024\",\n      excerpt:\n        \"Expert predictions and analysis for the upcoming year in real estate.\",\n      date: \"2024-03-05\",\n    },\n  ],\n}: MarketTrendsProps) => {\n  // Sample data for charts\n  const priceData = [\n    { month: \"Jan\", price: 450000 },\n    { month: \"Feb\", price: 455000 },\n    { month: \"Mar\", price: 458000 },\n    { month: \"Apr\", price: 462000 },\n    { month: \"May\", price: 470000 },\n    { month: \"Jun\", price: 475000 },\n  ];\n\n  const regionalData = [\n    { region: \"London\", price: 500000, growth: 5.2 },\n    { region: \"Manchester\", price: 250000, growth: 7.8 },\n    { region: \"Birmingham\", price: 220000, growth: 6.5 },\n    { region: \"Leeds\", price: 200000, growth: 8.1 },\n    { region: \"Liverpool\", price: 180000, growth: 9.2 },\n  ];\n\n  // Add this data near your other sample data\n  const heatmapData: RegionData[] = [\n    { name: \"London\", priceGrowth: 5.2, averagePrice: 500000, transactions: 1200 },\n    { name: \"South East\", priceGrowth: 4.8, averagePrice: 375000, transactions: 950 },\n    { name: \"South West\", priceGrowth: 4.5, averagePrice: 310000, transactions: 780 },\n    { name: \"East of England\", priceGrowth: 4.2, averagePrice: 325000, transactions: 820 },\n    { name: \"West Midlands\", priceGrowth: 6.1, averagePrice: 240000, transactions: 680 },\n    { name: \"East Midlands\", priceGrowth: 5.8, averagePrice: 225000, transactions: 650 },\n    { name: \"Yorkshire\", priceGrowth: 7.2, averagePrice: 195000, transactions: 720 },\n    { name: \"North West\", priceGrowth: 8.1, averagePrice: 205000, transactions: 850 },\n    { name: \"North East\", priceGrowth: 6.5, averagePrice: 155000, transactions: 480 },\n    { name: \"Wales\", priceGrowth: 5.9, averagePrice: 185000, transactions: 520 },\n    { name: \"Scotland\", priceGrowth: 5.4, averagePrice: 175000, transactions: 680 },\n  ];\n\n  // Add this SVG map component\n  const UKMap = ({ data }: { data: RegionData[] }) => {\n    return (\n      <div className=\"relative w-full h-full flex items-center justify-center\">\n        <svg\n          viewBox=\"0 0 500 800\"\n          className=\"w-full h-full max-h-[400px]\"\n          style={{ maxWidth: '300px' }}\n        >\n          {/* Simple UK regions - basic shapes for visualization */}\n          {[\n            { path: \"M250,600 L300,550 L350,600 L300,650 Z\", name: \"London\" },\n            { path: \"M200,500 L300,450 L350,500 L250,550 Z\", name: \"South East\" },\n            { path: \"M150,450 L250,400 L300,450 L200,500 Z\", name: \"South West\" },\n            { path: \"M300,450 L400,400 L450,450 L350,500 Z\", name: \"East of England\" },\n            { path: \"M200,350 L300,300 L350,350 L250,400 Z\", name: \"West Midlands\" },\n            { path: \"M300,350 L400,300 L450,350 L350,400 Z\", name: \"East Midlands\" },\n            { path: \"M200,250 L300,200 L350,250 L250,300 Z\", name: \"Yorkshire\" },\n            { path: \"M150,200 L250,150 L300,200 L200,250 Z\", name: \"North West\" },\n            { path: \"M250,150 L350,100 L400,150 L300,200 Z\", name: \"North East\" },\n            { path: \"M100,350 L200,300 L250,350 L150,400 Z\", name: \"Wales\" },\n            { path: \"M150,100 L300,50 L350,100 L200,150 Z\", name: \"Scotland\" },\n          ].map((region) => {\n            const regionData = data.find(d => d.name === region.name);\n            const growth = regionData?.priceGrowth || 0;\n            return (\n              <g key={region.name}>\n                <path\n                  d={region.path}\n                  fill={`hsl(${120 * (growth / 10)}, 70%, 50%)`}\n                  stroke=\"white\"\n                  strokeWidth=\"2\"\n                  className=\"transition-colors duration-300 hover:brightness-110 cursor-pointer\"\n                />\n                <title>{`${region.name}: +${growth}%`}</title>\n              </g>\n            );\n          })}\n        </svg>\n      </div>\n    );\n  };\n\n  const [marketInsights, setMarketInsights] = useState<string>(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [refreshingInsights, setRefreshingInsights] = useState(false);\n\n  const fetchMarketInsights = async () => {\n    setIsLoading(true);\n    try {\n      const response = await getChatResponse(\n        \"Provide a brief market analysis of the current UK property market trends, focusing on price changes, regional variations, and investment opportunities. Format the response with proper headings and bullet points.\"\n      );\n      setMarketInsights(response);\n    } catch (error) {\n      console.error(\"Error fetching market insights:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const [predictiveData, setPredictiveData] = useState<PredictiveData[]>([]);\n  const [hotspots, setHotspots] = useState<HotspotData[]>([]);\n  const [] = useState<string>(\"\");\n  const [isLoadingPredictions, setIsLoadingPredictions] = useState(false);\n  const [isLoadingHotspots, setIsLoadingHotspots] = useState(false);\n  const [refreshingPredictions, setRefreshingPredictions] = useState(false);\n  const [refreshingHotspots, setRefreshingHotspots] = useState(false);\n\n  const fetchPredictiveAnalytics = async () => {\n    setIsLoadingPredictions(true);\n    try {\n      const data = await getPredictiveAnalytics();\n      setPredictiveData(data.regions || []);\n    } catch (error) {\n      console.error(\"Error fetching predictive analytics:\", error);\n    } finally {\n      setIsLoadingPredictions(false);\n    }\n  };\n\n  const fetchHotspots = async () => {\n    setIsLoadingHotspots(true);\n    try {\n      const data = await getInvestmentHotspots();\n      // Transform the data to ensure correct types\n      const transformedHotspots: HotspotData[] = data.hotspots.map(hotspot => ({\n        ...hotspot,\n        // Ensure investmentType is one of the allowed values\n        investmentType: (hotspot.investmentType === 'Residential' || \n                        hotspot.investmentType === 'Commercial' || \n                        hotspot.investmentType === 'Mixed') \n          ? hotspot.investmentType \n          : 'Mixed' // Default value if type doesn't match\n      }));\n      setHotspots(transformedHotspots);\n    } catch (error) {\n      console.error(\"Error fetching hotspots:\", error);\n    } finally {\n      setIsLoadingHotspots(false);\n    }\n  };\n\n  const handleRefreshInsights = async () => {\n    setRefreshingInsights(true);\n    await fetchMarketInsights();\n    setRefreshingInsights(false);\n  };\n\n  const handleRefreshPredictions = async () => {\n    setRefreshingPredictions(true);\n    await fetchPredictiveAnalytics();\n    setRefreshingPredictions(false);\n  };\n\n  const handleRefreshHotspots = async () => {\n    setRefreshingHotspots(true);\n    await fetchHotspots();\n    setRefreshingHotspots(false);\n  };\n\n  const [bitcoinPrice, setBitcoinPrice] = useState<number | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [bitcoinLoading, setBitcoinLoading] = useState(true);\n\n  const fetchBitcoinPrice = async () => {\n    try {\n      setBitcoinLoading(true);\n      const response = await fetch(\n        'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=gbp'\n      );\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch Bitcoin price');\n      }\n\n      const data = await response.json();\n      setBitcoinPrice(data.bitcoin.gbp);\n      setError(null);\n    } catch (err) {\n      console.error('Error fetching Bitcoin price:', err);\n      setError('Failed to load Bitcoin price');\n      setBitcoinPrice(null);\n    } finally {\n      setBitcoinLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchMarketInsights();\n    fetchPredictiveAnalytics();\n    fetchHotspots();\n\n    fetchBitcoinPrice();\n    // Set up an interval to fetch the price every minute\n    const interval = setInterval(fetchBitcoinPrice, 60000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  return (\n    <section className=\"w-full py-8 sm:py-16 bg-background relative overflow-hidden\">\n      <div className=\"container mx-auto px-4 mb-16\">\n        <Card className=\"bg-card border-border\">\n          <CardHeader>\n            <h2 className=\"text-2xl font-semibold\">\n              Real Estate Trends Visualization\n            </h2>\n          </CardHeader>\n          <CardContent>\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\n              <TabsList className=\"w-full mb-8\">\n                <div className=\"grid w-full grid-cols-1 sm:grid-cols-3 gap-2\">\n                  <TabsTrigger value=\"overview\" className=\"w-full\">\n                    Price Evolution\n                  </TabsTrigger>\n                  <TabsTrigger value=\"regional\" className=\"w-full\">\n                    Regional Comparison\n                  </TabsTrigger>\n                  <TabsTrigger value=\"heatmap\" className=\"w-full\">\n                    Growth Heatmap\n                  </TabsTrigger>\n                </div>\n              </TabsList>\n\n              <TabsContent value=\"overview\" className=\"h-[400px]\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <AreaChart data={priceData}>\n                    <defs>\n                      <linearGradient\n                        id=\"colorPrice\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"5%\"\n                          stopColor=\"hsl(var(--primary))\"\n                          stopOpacity={0.2}\n                        />\n                        <stop\n                          offset=\"95%\"\n                          stopColor=\"hsl(var(--primary))\"\n                          stopOpacity={0}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" />\n                    <YAxis />\n                    <Tooltip />\n                    <Area\n                      type=\"monotone\"\n                      dataKey=\"price\"\n                      stroke=\"hsl(var(--primary))\"\n                      fillOpacity={1}\n                      fill=\"url(#colorPrice)\"\n                    />\n                  </AreaChart>\n                </ResponsiveContainer>\n              </TabsContent>\n\n              <TabsContent value=\"regional\" className=\"h-[400px]\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <LineChart data={regionalData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"region\" />\n                    <YAxis />\n                    <Tooltip />\n                    <Line\n                      type=\"monotone\"\n                      dataKey=\"price\"\n                      stroke=\"hsl(var(--primary))\"\n                    />\n                    <Line\n                      type=\"monotone\"\n                      dataKey=\"growth\"\n                      stroke=\"hsl(var(--chart-1))\"\n                    />\n                  </LineChart>\n                </ResponsiveContainer>\n              </TabsContent>\n\n              <TabsContent\n                value=\"heatmap\"\n                className=\"h-[400px] overflow-y-auto\"\n              >\n                <div className=\"h-full grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                  <div className=\"space-y-4 min-h-[300px]\">\n                    <h3 className=\"font-semibold text-lg sticky top-0 bg-background border-b py-2 px-2 rounded-t-lg\">\n                      Regional Price Growth\n                    </h3>\n                    <div className=\"space-y-2 overflow-y-auto px-2\">\n                      {heatmapData\n                        .sort((a, b) => b.priceGrowth - a.priceGrowth)\n                        .map((region) => (\n                          <div\n                            key={region.name}\n                            className=\"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors\"\n                          >\n                            <div className=\"flex items-center gap-3\">\n                              <div\n                                className=\"w-2 h-8 rounded-full\"\n                                style={{\n                                  backgroundColor: `hsl(${\n                                    120 * (region.priceGrowth / 10)\n                                  }, 70%, 50%)`,\n                                }}\n                              />\n                              <div>\n                                <p className=\"font-medium\">{region.name}</p>\n                                <p className=\"text-sm text-muted-foreground\">\n                                  {region.averagePrice.toLocaleString()}\n                                </p>\n                              </div>\n                            </div>\n                            <div className=\"text-right\">\n                              <p className=\"font-bold text-emerald-500\">\n                                +{region.priceGrowth}%\n                              </p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                {region.transactions} sales\n                              </p>\n                            </div>\n                          </div>\n                        ))}\n                    </div>\n                  </div>\n                  <div className=\"relative hidden lg:flex items-center justify-center bg-muted/30 rounded-xl min-h-[300px]\">\n                    <UKMap data={heatmapData} />\n                  </div>\n                </div>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"container mx-auto px-4 mb-16\">\n        <Card className=\"bg-card border-border relative ai-border-animation\">\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <h2 className=\"text-2xl font-semibold\">AI Market Analysis</h2>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleRefreshInsights}\n              className={`h-8 w-8 ${refreshingInsights ? 'animate-spin' : ''}`}\n              disabled={refreshingInsights || isLoading}\n            >\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center p-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <div \n                className=\"prose prose-sm max-w-none\"\n                dangerouslySetInnerHTML={{ __html: formatMessage(marketInsights) }}\n              />\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"container mx-auto px-4 mb-16 grid gap-6 md:grid-cols-2\">\n        {/* Predictive Analytics Card */}\n        <Card className=\"bg-card border-border relative ai-border-animation\">\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <h2 className=\"text-2xl font-semibold\">Predictive Market Analytics</h2>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleRefreshPredictions}\n              className={`h-8 w-8 ${refreshingPredictions ? 'animate-spin' : ''}`}\n              disabled={refreshingPredictions || isLoadingPredictions}\n            >\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </CardHeader>\n          <CardContent>\n            {isLoadingPredictions ? (\n              <div className=\"flex items-center justify-center p-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {predictiveData.map((prediction, index) => (\n                  <div key={index} className=\"p-4 rounded-lg bg-muted/50\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <h3 className=\"font-semibold text-lg\">{prediction.region}</h3>\n                      <div className=\"text-sm font-medium text-emerald-500\">\n                        +{((prediction.predictedValue - prediction.currentValue) / prediction.currentValue * 100).toFixed(1)}%\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <div className=\"flex-1\">\n                        <div className=\"w-full bg-background rounded-full h-2\">\n                          <div\n                            className=\"bg-emerald-500 h-2 rounded-full\"\n                            style={{ width: `${prediction.confidence}%` }}\n                          />\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">Confidence: {prediction.confidence}%</p>\n                      </div>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {prediction.growthFactors[0]}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Investment Hotspots Card */}\n        <Card className=\"bg-card border-border relative ai-border-animation\">\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <h2 className=\"text-2xl font-semibold\">Emerging Investment Hotspots</h2>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleRefreshHotspots}\n              className={`h-8 w-8 ${refreshingHotspots ? 'animate-spin' : ''}`}\n              disabled={refreshingHotspots || isLoadingHotspots}\n            >\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n          </CardHeader>\n          <CardContent>\n            {isLoadingHotspots ? (\n              <div className=\"flex items-center justify-center p-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {hotspots.map((hotspot, index) => (\n                  <div key={index} className=\"p-4 rounded-lg bg-muted/50\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <h3 className=\"font-semibold text-lg\">{hotspot.area}</h3>\n                      <span className={`px-3 py-1 rounded-full text-xs ${\n                        hotspot.investmentType === 'Residential' \n                          ? 'bg-blue-100 text-blue-700'\n                          : hotspot.investmentType === 'Commercial'\n                          ? 'bg-purple-100 text-purple-700'\n                          : 'bg-emerald-100 text-emerald-700'\n                      }`}>\n                        {hotspot.investmentType}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <div className=\"flex-1\">\n                        <div className=\"w-full bg-background rounded-full h-2\">\n                          <div\n                            className=\"bg-primary h-2 rounded-full\"\n                            style={{ width: `${hotspot.score}%` }}\n                          />\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">Investment Score: {hotspot.score}%</p>\n                      </div>\n                      <div className=\"text-sm font-medium text-emerald-500\">\n                        +{hotspot.predictedGrowth}%\n                      </div>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {hotspot.factors[0]}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"container mx-auto px-4 max-w-7xl\">\n        <div className=\"mb-12 text-center\">\n          <h2 className=\"text-3xl font-bold mb-4\">Market Trends & Insights</h2>\n          <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n            Stay informed with the latest real estate market trends and expert\n            insights to make better property decisions.\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12\">\n          {trends.map((trend, index) => (\n            <Card\n              key={index}\n              className={`bg-card border-border hover:scale-[1.02] transition-all duration-300 ${index === 0 ? \"bg-gradient-to-r from-emerald-400/10 to-cyan-400/10\" : \"\"}`}\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-sm font-medium text-foreground/80\">\n                    {trend.title}\n                  </h3>\n                  {index === 0 ? (\n                    <PoundSterling className=\"w-5 h-5 text-emerald-500\" />\n                  ) : index === 1 ? (\n                    <Home className=\"w-5 h-5 text-emerald-500\" />\n                  ) : (\n                    <TrendingUp className=\"w-5 h-5 text-emerald-500\" />\n                  )}\n                </div>\n                <div className=\"flex items-baseline justify-between\">\n                  <span className=\"text-2xl font-bold text-foreground\">\n                    {trend.value}\n                  </span>\n                  <span\n                    className={`flex items-center ${trend.isPositive ? \"text-emerald-500\" : \"text-red-500\"}`}\n                  >\n                    {trend.change}\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <div className=\"container mx-auto px-4 mb-16 grid gap-6 md:grid-cols-3\">\n          {articles.map((article, index) => (\n            <Card\n              key={index}\n              className=\"bg-card border-border hover:scale-[1.02] transition-all duration-300\"\n            >\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <h2 className=\"text-xl font-semibold\">{article.title}</h2>\n                  <span className=\"text-sm text-muted-foreground\">\n                    {new Date(article.date).toLocaleDateString(\"en-US\", {\n                      month: \"long\",\n                      day: \"numeric\",\n                      year: \"numeric\",\n                    })}\n                  </span>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground mb-4\">{article.excerpt}</p>\n                <Button\n                  variant=\"ghost\"\n                  className=\"group hover:text-emerald-500\"\n                  onClick={() => {\n                    window.location.href = `/article/${encodeURIComponent(article.title)}`;\n                  }}\n                >\n                  Read More\n                  <ArrowRight className=\"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform\" />\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <div className=\"w-full bg-muted/50 py-12\">\n          <div className=\"max-w-[1200px] mx-auto px-4 sm:px-8\">\n            <h2 className=\"text-2xl font-bold mb-6\">Market Trends</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <Card className=\"p-6\">\n                <h3 className=\"text-lg font-semibold mb-2\">Bitcoin Price (GBP)</h3>\n                {bitcoinLoading ? (\n                  <div className=\"animate-pulse h-8 bg-muted rounded\" />\n                ) : error ? (\n                  <p className=\"text-red-500\">{error}</p>\n                ) : bitcoinPrice ? (\n                  <p className=\"text-2xl font-bold\">{formatCurrency(bitcoinPrice)}</p>\n                ) : (\n                  <p className=\"text-muted-foreground\">Price unavailable</p>\n                )}\n              </Card>\n              {/* Add other market trend cards here */}\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default MarketTrends;\n\n<style>\n{`\n  .ai-border-animation::before {\n    content: '';\n    position: absolute;\n    inset: -2px;\n    background: linear-gradient(90deg, #22c55e, #10b981, #059669, #22c55e);\n    background-size: 400% 400%;\n    z-index: -1;\n    border-radius: calc(var(--radius) + 4px);\n    animation: borderAnimation 3s ease infinite;\n  }\n\n  @keyframes borderAnimation {\n    0% {\n      background-position: 0% 50%;\n    }\n    50% {\n      background-position: 100% 50%;\n    }\n    100% {\n      background-position: 0% 50%;\n    }\n  }\n`}\n</style>\n","import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { Cross2Icon } from \"@radix-ui/react-icons\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <Cross2Icon className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","import { supabase } from \"./supabase\";\nimport { loadStripe } from \"@stripe/stripe-js\";\n\nexport const SUBSCRIPTION_TIERS = {\n  BASIC: {\n    name: \"Basic\",\n    price: \"9.99\",\n    priceId: \"price_1QnikACOhalwhG2QDocCWbQj\",\n    features: [\n      \"Basic property search\",\n      \"Save up to 5 properties\",\n      \"Basic market trends\",\n      \"Email support\",\n    ],\n  },\n  PRO: {\n    name: \"Pro\",\n    price: \"19.99\",\n    priceId: \"price_1QnikPCOhalwhG2QVYfxwG5D\",\n    features: [\n      \"Advanced property search\",\n      \"Save unlimited properties\",\n      \"Detailed market analysis\",\n      \"Premium property insights\",\n      \"Priority support\",\n    ],\n  },\n  PREMIUM: {\n    name: \"Premium\",\n    price: \"49.99\",\n    priceId: \"price_1QnikjCOhalwhG2QUgRtMAco\",\n    features: [\n      \"All Pro features\",\n      \"AI-powered market predictions\",\n      \"Portfolio analytics\",\n      \"Investment ROI calculator\",\n      \"Dedicated account manager\",\n      \"24/7 phone support\",\n    ],\n  },\n};\n\nexport async function createCheckoutSession(priceId: string, userId: string) {\n  try {\n    const response = await fetch(\n      \"https://clever-chaplygin6-vbfae.dev.tempolabs.ai/.netlify/functions/create-checkout-session\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          priceId,\n          userId,\n        }),\n      },\n    );\n\n    const { sessionId } = await response.json();\n    const stripe = await loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\n    if (stripe) {\n      await stripe.redirectToCheckout({ sessionId });\n    }\n  } catch (error) {\n    console.error(\"Error creating checkout session:\", error);\n    throw error;\n  }\n}\n\nexport async function updateSubscription(userId: string, tier: string) {\n  const { error } = await supabase\n    .from(\"profiles\")\n    .update({\n      subscription_tier: tier,\n      subscription_status: \"active\",\n      updated_at: new Date().toISOString(),\n    })\n    .eq(\"id\", userId);\n\n  if (error) throw error;\n}\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\";\nimport { Button } from \"./ui/button\";\nimport { Input } from \"./ui/input\";\nimport { Label } from \"./ui/label\";\nimport { useToast } from \"./ui/use-toast\";\nimport { useAuth } from \"../lib/auth\";\nimport { createCheckoutSession } from \"../lib/stripe\";\n\ntype AuthMode = \"signin\" | \"signup\";\n\ninterface AuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  defaultMode?: AuthMode;\n}\n\nexport function AuthModal({\n  isOpen,\n  onClose,\n  defaultMode = \"signin\",\n}: AuthModalProps) {\n  const [mode, setMode] = React.useState<AuthMode>(defaultMode);\n  React.useEffect(() => {\n    setMode(defaultMode);\n  }, [defaultMode]);\n  const [isSubmitting, setIsSubmitting] = React.useState(false);\n  const [showConfirmation, setShowConfirmation] = React.useState(false);\n  const { signIn, signUp, signInWithGoogle } = useAuth();\n  const { toast } = useToast();\n\n  const [formData, setFormData] = React.useState({\n    email: \"\",\n    password: \"\",\n    firstName: \"\",\n    lastName: \"\",\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    try {\n      if (mode === \"signin\") {\n        const user = await signIn(formData.email, formData.password);\n        if (user) {\n          toast({\n            title: \"Welcome back!\",\n            description: \"You have successfully signed in.\",\n          });\n          setTimeout(() => onClose(), 500);\n        }\n      } else {\n        const user = await signUp(\n          formData.email,\n          formData.password,\n          formData.firstName,\n          formData.lastName,\n        );\n\n        // Check if there's a pending subscription\n        const pendingPriceId = localStorage.getItem(\n          \"pending_subscription_price_id\",\n        );\n        if (pendingPriceId && user && 'id' in user) {\n          localStorage.removeItem(\"pending_subscription_price_id\");\n          await createCheckoutSession(pendingPriceId, user.id);\n        } else {\n          setShowConfirmation(true);\n          toast({\n            title: \"Welcome to MyVGE Alpha!\",\n            description:\n              \"Thank you for joining us during our alpha testing phase.\",\n          });\n        }\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"An error occurred\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (showConfirmation) {\n    return (\n      <Dialog open={isOpen} onOpenChange={onClose}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Welcome to MyVGE Alpha!</DialogTitle>\n            <DialogDescription className=\"space-y-2\">\n              <p className=\"text-lg font-medium text-primary\">\n                Thank you for joining MyVGE during our alpha testing phase!\n              </p>\n              <p>\n                We've sent a confirmation email to your inbox. Please click the\n                verification link to activate your account and start exploring\n                MyVGE.\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                Note: You must confirm your email before signing in. Please\n                check your spam folder if you don't see the email.\n              </p>\n              <div className=\"mt-4 p-4 bg-primary/10 rounded-lg\">\n                <p className=\"text-sm font-medium\">\n                  As an alpha tester, your feedback is invaluable to us. We're\n                  excited to have you on board and look forward to your insights\n                  as we continue to improve the platform.\n                </p>\n              </div>\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex flex-col space-y-4 pt-4\">\n            <Button\n              onClick={() => {\n                setShowConfirmation(false);\n                onClose();\n              }}\n            >\n              Close\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle>\n            {mode === \"signin\" ? \"Sign In\" : \"Create Account\"}\n          </DialogTitle>\n          <DialogDescription>\n            {mode === \"signin\"\n              ? \"Welcome back! Please sign in to continue.\"\n              : \"Join MyVGE and start exploring properties.\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4 pt-4\">\n          {mode === \"signup\" && (\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"firstName\">First Name</Label>\n                <Input\n                  id=\"firstName\"\n                  value={formData.firstName}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      firstName: e.target.value,\n                    }))\n                  }\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"lastName\">Last Name</Label>\n                <Input\n                  id=\"lastName\"\n                  value={formData.lastName}\n                  onChange={(e) =>\n                    setFormData((prev) => ({\n                      ...prev,\n                      lastName: e.target.value,\n                    }))\n                  }\n                  required\n                />\n              </div>\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              value={formData.email}\n              onChange={(e) =>\n                setFormData((prev) => ({ ...prev, email: e.target.value }))\n              }\n              required\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Password</Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              value={formData.password}\n              onChange={(e) =>\n                setFormData((prev) => ({ ...prev, password: e.target.value }))\n              }\n              required\n            />\n          </div>\n\n          <div className=\"flex flex-col space-y-4 pt-4\">\n            <Button type=\"submit\" disabled={isSubmitting}>\n              {isSubmitting\n                ? \"Loading...\"\n                : mode === \"signin\"\n                  ? \"Sign In\"\n                  : \"Create Account\"}\n            </Button>\n\n            <Button type=\"button\" variant=\"link\" onClick={() => signInWithGoogle()} disabled={isSubmitting}>\n              Sign In with Google\n            </Button>\n\n            <Button\n              type=\"button\"\n              variant=\"link\"\n              onClick={() => setMode(mode === \"signin\" ? \"signup\" : \"signin\")}\n            >\n              {mode === \"signin\"\n                ? \"Don't have an account? Sign up\"\n                : \"Already have an account? Sign in\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import React from \"react\";\nimport { Card, CardContent, CardFooter, CardHeader } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport { Check, Crown } from \"lucide-react\";\nimport { SUBSCRIPTION_TIERS } from \"../lib/stripe\";\nimport { useAuth } from \"../lib/auth\";\n\ninterface SubscriptionPlansProps {\n  onSubscribe: (priceId: string) => void;\n}\n\nexport function SubscriptionPlans({ onSubscribe }: SubscriptionPlansProps) {\n  const { profile } = useAuth();\n  const currentTier = profile?.subscription_tier || \"free\";\n\n  return (\n    <div className=\"py-16 bg-background\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-3xl font-bold mb-4\">Choose Your Plan</h2>\n          <p className=\"text-gray-600 max-w-2xl mx-auto\">\n            Select the perfect plan for your property investment journey\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-7xl mx-auto\">\n          {Object.entries(SUBSCRIPTION_TIERS).map(([key, tier]) => (\n            <Card\n              key={key}\n              className={`relative ${key === \"PRO\" ? \"border-primary shadow-lg scale-105 bg-gradient-to-r from-emerald-400/10 to-cyan-400/10\" : \"\"}`}\n            >\n              {key === \"PRO\" && (\n                <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-emerald-400 to-cyan-400 text-white px-4 py-1 rounded-full text-sm font-medium border border-emerald-500/20 shadow-lg\">\n                  Most Popular\n                </div>\n              )}\n\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"text-2xl font-bold\">{tier.name}</h3>\n                  {key === \"PREMIUM\" && (\n                    <Crown className=\"h-6 w-6 text-yellow-500\" />\n                  )}\n                </div>\n                <div className=\"mt-4\">\n                  <span className=\"text-4xl font-bold\">{tier.price}</span>\n                  <span className=\"text-gray-600 ml-2\">/month</span>\n                </div>\n              </CardHeader>\n\n              <CardContent>\n                <ul className=\"space-y-3\">\n                  {tier.features.map((feature, index) => (\n                    <li key={index} className=\"flex items-start gap-3\">\n                      <Check className=\"h-5 w-5 text-green-500 mt-0.5\" />\n                      <span>{feature}</span>\n                    </li>\n                  ))}\n                </ul>\n              </CardContent>\n\n              <CardFooter>\n                <Button\n                  className=\"w-full\"\n                  variant={key === \"PRO\" ? \"default\" : \"outline\"}\n                  onClick={() => onSubscribe(tier.priceId)}\n                  disabled={currentTier === key.toLowerCase()}\n                >\n                  {currentTier === key.toLowerCase()\n                    ? \"Current Plan\"\n                    : \"Subscribe\"}\n                </Button>\n              </CardFooter>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\";\nimport { SubscriptionPlans } from \"./SubscriptionPlans\";\nimport { createCheckoutSession } from \"../lib/stripe\";\nimport { useAuth } from \"../lib/auth\";\nimport { useToast } from \"./ui/use-toast\";\nimport { supabase } from \"../lib/supabase\";\n\ninterface SubscriptionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function SubscriptionModal({ isOpen, onClose }: SubscriptionModalProps) {\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  const handleSubscribe = async (tier: string) => {\n    setIsLoading(true);\n    try {\n      // Create or update profile\n      const { data: profile, error: profileError } = await supabase\n        .from('profiles')\n        .upsert({\n          id: user?.id,\n          subscription_tier: tier,\n          updated_at: new Date().toISOString()\n        })\n        .select()\n        .single(); // Add this to ensure single row\n\n      if (profileError) {\n        throw new Error(`Failed to create profile: ${profileError.message}`);\n      }\n\n      // Show complete profile modal\n      setShowCompleteProfile(true);\n      onClose();\n\n      toast({\n        title: \"Subscription Updated\",\n        description: `Your subscription has been updated to ${tier}.`\n      });\n    } catch (error) {\n      console.error('Error in subscription:', error);\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to update subscription\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[900px]\">\n        <DialogHeader>\n          <DialogTitle>Upgrade Your Plan</DialogTitle>\n          <DialogDescription>\n            Choose the plan that best suits your needs and unlock premium\n            features.\n          </DialogDescription>\n        </DialogHeader>\n\n        <SubscriptionPlans onSubscribe={handleSubscribe} />\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { supabase } from './supabase';\nimport { User } from '@supabase/supabase-js';\nimport { Deal } from './deals';\n\nconst profanityList = [\n  \"badword1\",\n  \"badword2\",\n  // Add more profanity words here\n];\n\nfunction filterProfanity(text: string): string {\n  let filteredText = text.toLowerCase();\n  profanityList.forEach((word) => {\n    const regex = new RegExp(word, \"gi\");\n    filteredText = filteredText.replace(regex, \"*\".repeat(word.length));\n  });\n  return filteredText;\n}\n\nexport interface Message {\n  id: string;\n  sender_id: string;\n  receiver_id: string;\n  content: string;\n  deal_id?: string;\n  created_at: string;\n  is_read: boolean;\n}\n\nexport interface MessageWithProfiles extends Message {\n  sender: {\n    id: string;\n    full_name: string;\n    avatar_url?: string;\n  };\n  receiver: {\n    id: string;\n    full_name: string;\n    avatar_url?: string;\n  };\n  deal?: Deal;\n}\n\nexport interface Conversation {\n  user: {\n    id: string;\n    full_name: string;\n    avatar_url?: string;\n  };\n  lastMessage: MessageWithProfiles;\n  unreadCount: number;\n}\n\n// Send a new message\nexport async function sendMessage(receiverId: string, content: string, dealId?: string): Promise<MessageWithProfiles | null> {\n  try {\n    const { data: user, error: userError } = await supabase.auth.getUser();\n    if (userError || !user.user) {\n      console.error('Authentication error:', userError);\n      throw new Error('User not authenticated');\n    }\n\n    console.log('Sending message:', {\n      sender_id: user.user.id,\n      receiver_id: receiverId,\n      deal_id: dealId,\n      content: content.substring(0, 20) + '...' // Log first 20 chars for privacy\n    });\n\n    const { data, error } = await supabase\n      .from('messages')\n      .insert({\n        sender_id: user.user.id,\n        receiver_id: receiverId,\n        content,\n        deal_id: dealId,\n        is_read: false\n      })\n      .select(`\n        *,\n        sender:profiles!sender_id(id, full_name, avatar_url),\n        receiver:profiles!receiver_id(id, full_name, avatar_url),\n        deal:deals(*)\n      `)\n      .single();\n\n    if (error) {\n      console.error('Database error:', error);\n      throw error;\n    }\n\n    if (!data) {\n      console.error('No data returned from insert');\n      throw new Error('Failed to send message');\n    }\n\n    console.log('Message sent successfully:', { messageId: data.id });\n    return data;\n  } catch (error) {\n    console.error('Error sending message:', error);\n    return null;\n  }\n}\n\n// Get conversations for the current user\nexport async function getConversations(): Promise<Conversation[]> {\n  try {\n    const { data: user, error: userError } = await supabase.auth.getUser();\n    if (userError || !user.user) throw new Error('User not authenticated');\n\n    // Get the latest message from each conversation\n    const { data, error } = await supabase\n      .from('messages')\n      .select(`\n        *,\n        sender:profiles!sender_id(*),\n        receiver:profiles!receiver_id(*),\n        deal:deals(*)\n      `)\n      .or(`sender_id.eq.${user.user.id},receiver_id.eq.${user.user.id}`)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Process conversations\n    const conversationsMap = new Map<string, Conversation>();\n    \n    data.forEach((message: MessageWithProfiles) => {\n      const otherUser = message.sender_id === user.user.id ? message.receiver : message.sender;\n      const conversationId = otherUser.id;\n\n      if (!conversationsMap.has(conversationId)) {\n        conversationsMap.set(conversationId, {\n          user: otherUser,\n          lastMessage: message,\n          unreadCount: message.receiver_id === user.user.id && !message.is_read ? 1 : 0\n        });\n      } else if (message.receiver_id === user.user.id && !message.is_read) {\n        const conversation = conversationsMap.get(conversationId)!;\n        conversation.unreadCount++;\n      }\n    });\n\n    return Array.from(conversationsMap.values());\n  } catch (error) {\n    console.error('Error getting conversations:', error);\n    return [];\n  }\n}\n\n// Get messages between current user and another user\nexport async function getMessages(otherUserId: string): Promise<MessageWithProfiles[]> {\n  try {\n    const { data: user, error: userError } = await supabase.auth.getUser();\n    if (userError || !user.user) {\n      console.error('Authentication error:', userError);\n      throw new Error('User not authenticated');\n    }\n\n    console.log('Fetching messages with user:', otherUserId);\n\n    const { data, error } = await supabase\n      .from('messages')\n      .select(`\n        *,\n        sender:profiles!sender_id(id, full_name, avatar_url),\n        receiver:profiles!receiver_id(id, full_name, avatar_url),\n        deal:deals(*)\n      `)\n      .or(`and(sender_id.eq.${user.user.id},receiver_id.eq.${otherUserId}),and(sender_id.eq.${otherUserId},receiver_id.eq.${user.user.id})`)\n      .order('created_at', { ascending: true });\n\n    if (error) {\n      console.error('Database error:', error);\n      throw error;\n    }\n\n    console.log(`Found ${data?.length || 0} messages`);\n\n    // Mark messages as read\n    const unreadMessages = data?.filter(\n      (message) => message.receiver_id === user.user.id && !message.is_read\n    ) || [];\n\n    if (unreadMessages.length > 0) {\n      console.log(`Marking ${unreadMessages.length} messages as read`);\n      const { error: updateError } = await supabase\n        .from('messages')\n        .update({ is_read: true })\n        .in('id', unreadMessages.map((m) => m.id));\n\n      if (updateError) {\n        console.error('Error marking messages as read:', updateError);\n      }\n    }\n\n    return data || [];\n  } catch (error) {\n    console.error('Error getting messages:', error);\n    return [];\n  }\n}\n\n// Subscribe to new messages\nexport function subscribeToMessages(callback: (message: MessageWithProfiles) => void) {\n  try {\n    const subscription = supabase\n      .channel('messages')\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'messages'\n        },\n        async (payload) => {\n          // Fetch the complete message with profiles and deal\n          const { data, error } = await supabase\n            .from('messages')\n            .select(`\n              *,\n              sender:profiles!sender_id(*),\n              receiver:profiles!receiver_id(*),\n              deal:deals(*)\n            `)\n            .eq('id', payload.new.id)\n            .single();\n\n          if (!error && data) {\n            callback(data);\n          }\n        }\n      )\n      .subscribe();\n\n    return subscription;\n  } catch (error) {\n    console.error('Error subscribing to messages:', error);\n    return null;\n  }\n}\n\n// Mark message as read\nexport async function markMessageAsRead(messageId: string) {\n  try {\n    const { error } = await supabase\n      .from('messages')\n      .update({ is_read: true })\n      .eq('id', messageId);\n\n    if (error) throw error;\n    return true;\n  } catch (error) {\n    console.error('Error marking message as read:', error);\n    return false;\n  }\n}\n","import React from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface LoadingSpinnerProps {\n  size?: 'sm' | 'md' | 'lg';\n  className?: string;\n}\n\nexport function LoadingSpinner({ size = 'md', className }: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: 'h-4 w-4',\n    md: 'h-6 w-6',\n    lg: 'h-8 w-8',\n  };\n\n  return (\n    <div\n      className={cn(\n        'animate-spin rounded-full border-2 border-current border-t-transparent',\n        sizeClasses[size],\n        className\n      )}\n    />\n  );\n} ","import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","import React, { useEffect, useRef, useState } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\";\nimport { Button } from './ui/button';\nimport { Input } from './ui/input';\nimport { ScrollArea } from './ui/scroll-area';\nimport { useAuth } from '../lib/auth';\nimport { MessageWithProfiles, getMessages, sendMessage, subscribeToMessages } from '../lib/messages';\nimport { formatDistanceToNow } from 'date-fns';\nimport { LoadingSpinner } from './ui/loading-spinner';\nimport { Deal } from '../lib/deals';\nimport { Card } from './ui/card';\nimport { formatCurrency } from '../lib/utils';\nimport { useToast } from './ui/use-toast';\nimport { Alert, AlertDescription } from './ui/alert';\n\ninterface MessagesModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  receiverId?: string;\n  dealId?: string;\n  deal?: Deal;\n}\n\nexport function MessagesModal({ isOpen, onClose, receiverId, dealId, deal }: MessagesModalProps) {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [messages, setMessages] = useState<MessageWithProfiles[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSending, setIsSending] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    if (isOpen && receiverId) {\n      loadMessages();\n      const subscription = subscribeToMessages((message) => {\n        if (\n          (message.sender_id === receiverId && message.receiver_id === user?.id) ||\n          (message.sender_id === user?.id && message.receiver_id === receiverId)\n        ) {\n          setMessages(prev => [...prev, message]);\n          scrollToBottom();\n        }\n      });\n\n      return () => {\n        subscription?.unsubscribe();\n      };\n    }\n  }, [isOpen, receiverId, user?.id]);\n\n  useEffect(() => {\n    if (isOpen) {\n      scrollToBottom();\n      inputRef.current?.focus();\n    }\n  }, [isOpen, messages]);\n\n  const loadMessages = async () => {\n    if (!receiverId) return;\n    try {\n      setIsLoading(true);\n      setError(null);\n      const fetchedMessages = await getMessages(receiverId);\n      setMessages(fetchedMessages);\n    } catch (err) {\n      setError('Failed to load messages. Please try again.');\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to load messages. Please try again.\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!receiverId || !newMessage.trim() || isSending) return;\n\n    try {\n      setIsSending(true);\n      setError(null);\n      const message = await sendMessage(receiverId, newMessage, dealId);\n      if (message) {\n        setMessages(prev => [...prev, message]);\n        setNewMessage('');\n        scrollToBottom();\n      } else {\n        throw new Error('Failed to send message');\n      }\n    } catch (err) {\n      setError('Failed to send message. Please try again.');\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to send message. Please try again.\",\n      });\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  if (!receiverId) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-md max-h-[80vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>Messages</DialogTitle>\n        </DialogHeader>\n\n        {deal && (\n          <Card className=\"p-4 mb-4 bg-muted/50\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-20 h-20 rounded overflow-hidden\">\n                <img\n                  src={deal.image_url}\n                  alt={deal.title}\n                  className=\"w-full h-full object-cover\"\n                  loading=\"lazy\"\n                />\n              </div>\n              <div>\n                <h4 className=\"font-semibold\">{deal.title}</h4>\n                <p className=\"text-sm text-muted-foreground\">{deal.location}</p>\n                <p className=\"text-sm font-medium mt-1\">\n                  {formatCurrency(deal.price)}\n                </p>\n              </div>\n            </div>\n          </Card>\n        )}\n\n        {error && (\n          <Alert variant=\"destructive\" className=\"mb-4\">\n            <AlertDescription>{error}</AlertDescription>\n          </Alert>\n        )}\n\n        <ScrollArea className=\"flex-1 p-4\">\n          {isLoading ? (\n            <div className=\"flex justify-center items-center h-[300px]\">\n              <LoadingSpinner />\n            </div>\n          ) : messages.length === 0 ? (\n            <div className=\"text-center text-muted-foreground py-8\">\n              No messages yet. Start the conversation!\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {messages.map((message) => (\n                <div\n                  key={message.id}\n                  className={`flex ${\n                    message.sender_id === user?.id ? 'justify-end' : 'justify-start'\n                  }`}\n                >\n                  <div\n                    className={`max-w-[80%] rounded-lg p-3 ${\n                      message.sender_id === user?.id\n                        ? 'bg-primary text-primary-foreground'\n                        : 'bg-muted'\n                    }`}\n                  >\n                    <p className=\"text-sm\">{message.content}</p>\n                    <p className=\"text-xs opacity-70 mt-1\">\n                      {formatDistanceToNow(new Date(message.created_at), { addSuffix: true })}\n                    </p>\n                  </div>\n                </div>\n              ))}\n              <div ref={messagesEndRef} />\n            </div>\n          )}\n        </ScrollArea>\n\n        <form onSubmit={handleSendMessage} className=\"flex gap-2 p-4 border-t\">\n          <Input\n            ref={inputRef}\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            placeholder=\"Type your message...\"\n            disabled={isSending}\n          />\n          <Button type=\"submit\" disabled={isSending || !newMessage.trim()}>\n            {isSending ? <LoadingSpinner /> : 'Send'}\n          </Button>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import React from \"react\";\nimport { Lightbulb } from \"lucide-react\";\n\nexport function RandomFact() {\n  const [fact, setFact] = React.useState<string>(\"\");\n\n  React.useEffect(() => {\n    fetch(\"https://uselessfacts.jsph.pl/api/v2/facts/random?language=en\")\n      .then((response) => response.json())\n      .then((data) => setFact(data.text))\n      .catch((error) => console.error(\"Error fetching random fact:\", error));\n  }, []);\n\n  if (!fact) return null;\n\n  return (\n    <div className=\"flex items-center gap-2 text-gray-400 text-sm\">\n      <Lightbulb className=\"w-4 h-4\" />\n      <p>{fact}</p>\n    </div>\n  );\n}\n","import { RandomFact } from \"./RandomFact\";\n\nexport function Footer() {\n  return (\n    <footer className=\"bg-gray-900 text-white py-8 sm:py-12\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">About Us</h3>\n            <p className=\"text-gray-400\">\n              Your trusted source for property search and market analysis.\n            </p>\n          </div>\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Legal</h3>\n            <ul className=\"space-y-2 text-gray-400\">\n              <li>\n                <a href=\"/terms\" className=\"hover:text-white\">\n                  Terms of Service\n                </a>\n              </li>\n              <li>\n                <a href=\"/privacy\" className=\"hover:text-white\">\n                  Privacy Policy\n                </a>\n              </li>\n              <li>\n                <a href=\"/disclaimer\" className=\"hover:text-white\">\n                  Legal Disclaimer\n                </a>\n              </li>\n              <li>\n                <a href=\"/gdpr\" className=\"hover:text-white\">\n                  GDPR Compliance\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Contact</h3>\n            <ul className=\"space-y-2 text-gray-400\">\n              <li>info@myvge.com</li>\n              <li>Lytchett House, 13 Freeland Park, Poole, Dorset, England, BH16 6FA</li>\n            </ul>\n          </div>\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Compliance</h3>\n            <ul className=\"space-y-2 text-gray-400\">\n              <li>Company No: 15271126</li>\n            </ul>\n          </div>\n        </div>\n        <div className=\"mt-8 pt-8 border-t border-gray-800 space-y-4\">\n          <RandomFact />\n          <div className=\"text-center text-gray-400 space-y-2\">\n            <p className=\"text-xs\">\n              MyVGE is registered in England and Wales. Registered office: Lytchett House, 13 Freeland Park, Poole, Dorset, England, BH16 6FA. Company No: 15271126\n            </p>\n            <p className=\"text-xs\">\n              The information on this website is for general information\n              purposes only and does not constitute financial advice.\n            </p>\n            <p>&copy; {new Date().getFullYear()} MyVGE. All rights reserved.</p>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","import React from \"react\";\nimport { Alert, AlertDescription } from \"./ui/alert\";\nimport { Info } from \"lucide-react\";\n\nexport function LegalDisclaimer() {\n  return (\n    <Alert className=\"bg-muted/50 border-muted-foreground/20\">\n      <Info className=\"h-4 w-4\" />\n      <AlertDescription className=\"text-xs text-muted-foreground\">\n        The information provided on this website is for general informational\n        purposes only and should not be considered as financial or investment\n        advice. Property investments carry risks and values can go down as well\n        as up. Always seek professional advice before making investment\n        decisions.\n      </AlertDescription>\n    </Alert>\n  );\n}\n","import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables');\n}\n\n// Ensure the URL is valid and includes the protocol\nconst validUrl = supabaseUrl.startsWith('http') \n  ? supabaseUrl \n  : `https://${supabaseUrl}`;\n\nexport const supabase = createClient(validUrl, supabaseAnonKey); ","import { supabase } from './supabaseClient';\nimport { useQuery, useInfiniteQuery } from '@tanstack/react-query';\n\nexport interface Property {\n  id: string;\n  title: string;\n  description: string | null;\n  location: string;\n  price: number;\n  beds: number;\n  baths: number;\n  sqft: number;\n  image_url: string;\n  is_featured: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface SavedProperty {\n  id: string;\n  user_id: string;\n  property_id: string;\n  notes: string;\n  created_at: string;\n}\n\nexport interface Deal {\n  id: string;\n  title: string;\n  description: string;\n  location: string;\n  price: number;\n  roi_percentage: number;\n  investment_term: string;\n  property_type: string;\n  deal_type: string;\n  image_url: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport async function getFeaturedProperties(page: number, perPage: number) {\n  try {\n    const start = (page - 1) * perPage;\n    \n    console.log('Production URL:', import.meta.env.VITE_SUPABASE_URL);\n    console.log('Fetching properties with params:', { page, perPage, start });\n    \n    const { data, error } = await supabase\n      .from('properties')\n      .select(`\n        id,\n        title,\n        description,\n        location,\n        price,\n        beds,\n        baths,\n        sqft,\n        image_url,\n        is_featured,\n        created_at,\n        updated_at\n      `)\n      .eq('is_featured', true)\n      .range(start, start + perPage - 1)\n      .order('created_at', { ascending: false });\n\n    console.log('Raw Supabase response:', { data, error });\n\n    if (error) {\n      console.error('Supabase error:', error);\n      throw error;\n    }\n\n    if (!data || data.length === 0) {\n      console.log('No properties found');\n      return [];\n    }\n\n    // Map the data to ensure all required fields are present\n    const properties = data.map(p => ({\n      id: p.id || '',\n      title: p.title || '',\n      description: p.description || '',\n      location: p.location || '',\n      price: Number(p.price) || 0,\n      beds: Number(p.beds) || 0,\n      baths: Number(p.baths) || 0,\n      sqft: Number(p.sqft) || 0,\n      image_url: p.image_url || '',\n      is_featured: Boolean(p.is_featured),\n      created_at: p.created_at || new Date().toISOString(),\n      updated_at: p.updated_at || new Date().toISOString()\n    }));\n\n    console.log('Mapped properties:', properties);\n    return properties;\n\n  } catch (error) {\n    console.error('Error in getFeaturedProperties:', error);\n    return [];\n  }\n}\n\nexport const useFeaturedProperties = (limit = 6) => {\n  return useInfiniteQuery({\n    queryKey: ['featuredProperties'],\n    queryFn: ({ pageParam = 1 }) => getFeaturedProperties(pageParam, limit),\n    getNextPageParam: (lastPage, allPages) => {\n      return lastPage.length === limit ? allPages.length + 1 : undefined;\n    },\n    staleTime: 5 * 60 * 1000, // Data considered fresh for 5 minutes\n    cacheTime: 30 * 60 * 1000, // Cache data for 30 minutes\n  });\n};\n\nexport async function searchProperties(searchTerm: string): Promise<Property[]> {\n  try {\n    const { data, error } = await supabase\n      .from('properties')\n      .select(`\n        id,\n        title,\n        location,\n        price,\n        sqft,\n        beds,\n        baths,\n        description,\n        image_url,\n        is_featured,\n        created_at,\n        updated_at\n      `)\n      .or(`\n        location.ilike.%${searchTerm}%,\n        description.ilike.%${searchTerm}%,\n        title.ilike.%${searchTerm}%\n      `)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data || [];\n  } catch (error) {\n    console.error('Error searching properties:', error);\n    return [];\n  }\n}\n\nexport async function getProperty(id: string): Promise<Property | null> {\n  const { data, error } = await supabase\n    .from(\"properties\")\n    .select(`\n      id,\n      title,\n      location,\n      price,\n      sqft,\n      beds,\n      baths,\n      description,\n      image_url,\n      is_featured,\n      created_at,\n      updated_at\n    `)\n    .eq(\"id\", id)\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\nexport async function saveProperty(\n  propertyId: string,\n  userId: string,\n  notes: string = \"\",\n) {\n  const { data, error } = await supabase\n    .from(\"saved_properties\")\n    .insert([\n      {\n        property_id: propertyId,\n        user_id: userId,\n        notes,\n      },\n    ])\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data as SavedProperty;\n}\n\nexport async function getSavedProperties(userId: string) {\n  const { data, error } = await supabase\n    .from(\"saved_properties\")\n    .select(\n      `\n      *,\n      property:properties(*)\n    `,\n    )\n    .eq(\"user_id\", userId);\n\n  if (error) throw error;\n  return data;\n}\n\nexport async function getDeals(page: number, perPage: number) {\n  try {\n    const start = (page - 1) * perPage;\n    \n    console.log('Fetching deals with params:', { page, perPage, start });\n    \n    const { data, error } = await supabase\n      .from('deals')\n      .select(`\n        id,\n        title,\n        description,\n        location,\n        price,\n        roi_percentage,\n        investment_term,\n        property_type,\n        deal_type,\n        image_url,\n        created_at,\n        updated_at\n      `)\n      .range(start, start + perPage - 1)\n      .order('created_at', { ascending: false });\n\n    console.log('Raw Supabase deals response:', { data, error });\n\n    if (error) {\n      console.error('Supabase error:', error);\n      throw error;\n    }\n\n    if (!data || data.length === 0) {\n      console.log('No deals found');\n      return [];\n    }\n\n    // Map the data to ensure all required fields are present\n    const deals = data.map(d => ({\n      id: d.id || '',\n      title: d.title || '',\n      description: d.description || '',\n      location: d.location || '',\n      price: Number(d.price) || 0,\n      roi_percentage: Number(d.roi_percentage) || 0,\n      investment_term: d.investment_term || '',\n      property_type: d.property_type || '',\n      deal_type: d.deal_type || '',\n      image_url: d.image_url || '',\n      created_at: d.created_at || new Date().toISOString(),\n      updated_at: d.updated_at || new Date().toISOString()\n    }));\n\n    console.log('Mapped deals:', deals);\n    return deals;\n\n  } catch (error) {\n    console.error('Error in getDeals:', error);\n    return [];\n  }\n}\n\nexport const useDeals = (limit = 6) => {\n  return useInfiniteQuery({\n    queryKey: ['deals'],\n    queryFn: ({ pageParam = 1 }) => getDeals(pageParam, limit),\n    getNextPageParam: (lastPage, allPages) => {\n      return lastPage.length === limit ? allPages.length + 1 : undefined;\n    },\n    staleTime: 5 * 60 * 1000,\n    cacheTime: 30 * 60 * 1000,\n  });\n};\n","import { cn } from \"@/lib/utils\";\nimport React from \"react\";\n\ninterface MarqueeProps {\n  children: React.ReactNode;\n  direction?: \"left\" | \"right\" | \"up\" | \"down\";\n  pauseOnHover?: boolean;\n  reverse?: boolean;\n  fade?: boolean;\n  className?: string;\n  vertical?: boolean;\n}\n\nexport const Marquee = ({\n  children,\n  direction = \"left\",\n  pauseOnHover = false,\n  reverse = false,\n  fade = false,\n  className,\n  vertical = false,\n}: MarqueeProps) => {\n  return (\n    <div\n      className={cn(\n        \"group flex gap-4 overflow-hidden\",\n        vertical ? \"flex-col\" : \"flex-row\",\n        className\n      )}\n    >\n      <div\n        className={cn(\n          \"flex min-w-full shrink-0 animate-marquee items-center justify-around gap-4\",\n          vertical ? \"flex-col\" : \"flex-row\",\n          pauseOnHover && \"group-hover:[animation-play-state:paused]\",\n          reverse && \"animate-marquee-reverse\"\n        )}\n      >\n        {children}\n      </div>\n      <div\n        className={cn(\n          \"flex min-w-full shrink-0 animate-marquee items-center justify-around gap-4\",\n          vertical ? \"flex-col\" : \"flex-row\",\n          pauseOnHover && \"group-hover:[animation-play-state:paused]\",\n          reverse && \"animate-marquee-reverse\"\n        )}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}; ","import React, { useRef, useEffect } from \"react\";\nimport { Renderer, Program, Mesh, Triangle } from \"ogl\";\n\ninterface LiquidChromeProps extends React.HTMLAttributes<HTMLDivElement> {\n  baseColor?: [number, number, number];\n  speed?: number;\n  amplitude?: number;\n  frequencyX?: number;\n  frequencyY?: number;\n  interactive?: boolean;\n}\n\nexport const LiquidChrome: React.FC<LiquidChromeProps> = ({\n  baseColor = [0.1, 0.1, 0.1],\n  speed = 0.2,\n  amplitude = 0.5,\n  frequencyX = 3,\n  frequencyY = 2,\n  interactive = true,\n  ...props\n}) => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const container = containerRef.current;\n    const renderer = new Renderer({ antialias: true });\n    const gl = renderer.gl;\n    gl.clearColor(1, 1, 1, 1);\n\n    const vertexShader = `\n      attribute vec2 position;\n      attribute vec2 uv;\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0.0, 1.0);\n      }\n    `;\n\n    const fragmentShader = `\n      precision highp float;\n      uniform float uTime;\n      uniform vec3 uResolution;\n      uniform vec3 uBaseColor;\n      uniform float uAmplitude;\n      uniform float uFrequencyX;\n      uniform float uFrequencyY;\n      uniform vec2 uMouse;\n      varying vec2 vUv;\n\n      vec4 renderImage(vec2 uvCoord) {\n          vec2 fragCoord = uvCoord * uResolution.xy;\n          vec2 uv = (2.0 * fragCoord - uResolution.xy) / min(uResolution.x, uResolution.y);\n\n          for (float i = 1.0; i < 10.0; i++){\n              uv.x += uAmplitude / i * cos(i * uFrequencyX * uv.y + uTime + uMouse.x * 3.14159);\n              uv.y += uAmplitude / i * cos(i * uFrequencyY * uv.x + uTime + uMouse.y * 3.14159);\n          }\n\n          vec2 diff = (uvCoord - uMouse);\n          float dist = length(diff);\n          float falloff = exp(-dist * 20.0);\n          float ripple = sin(10.0 * dist - uTime * 2.0) * 0.03;\n          uv += (diff / (dist + 0.0001)) * ripple * falloff;\n\n          vec3 color = uBaseColor / abs(sin(uTime - uv.y - uv.x));\n          return vec4(color, 1.0);\n      }\n\n      void main() {\n          vec4 col = vec4(0.0);\n          int samples = 0;\n          for (int i = -1; i <= 1; i++){\n              for (int j = -1; j <= 1; j++){\n                  vec2 offset = vec2(float(i), float(j)) * (1.0 / min(uResolution.x, uResolution.y));\n                  col += renderImage(vUv + offset);\n                  samples++;\n              }\n          }\n          gl_FragColor = col / float(samples);\n      }\n    `;\n\n    const geometry = new Triangle(gl);\n    const program = new Program(gl, {\n      vertex: vertexShader,\n      fragment: fragmentShader,\n      uniforms: {\n        uTime: { value: 0 },\n        uResolution: {\n          value: new Float32Array([\n            gl.canvas.width,\n            gl.canvas.height,\n            gl.canvas.width / gl.canvas.height,\n          ]),\n        },\n        uBaseColor: { value: new Float32Array(baseColor) },\n        uAmplitude: { value: amplitude },\n        uFrequencyX: { value: frequencyX },\n        uFrequencyY: { value: frequencyY },\n        uMouse: { value: new Float32Array([0, 0]) },\n      },\n    });\n    const mesh = new Mesh(gl, { geometry, program });\n\n    function resize() {\n      const scale = 1;\n      renderer.setSize(\n        container.offsetWidth * scale,\n        container.offsetHeight * scale\n      );\n      const resUniform = program.uniforms.uResolution.value as Float32Array;\n      resUniform[0] = gl.canvas.width;\n      resUniform[1] = gl.canvas.height;\n      resUniform[2] = gl.canvas.width / gl.canvas.height;\n    }\n    window.addEventListener(\"resize\", resize);\n    resize();\n\n    function handleMouseMove(event: MouseEvent) {\n      const rect = container.getBoundingClientRect();\n      const x = (event.clientX - rect.left) / rect.width;\n      const y = 1 - (event.clientY - rect.top) / rect.height;\n      const mouseUniform = program.uniforms.uMouse.value as Float32Array;\n      mouseUniform[0] = x;\n      mouseUniform[1] = y;\n    }\n\n    function handleTouchMove(event: TouchEvent) {\n      if (event.touches.length > 0) {\n        const touch = event.touches[0];\n        const rect = container.getBoundingClientRect();\n        const x = (touch.clientX - rect.left) / rect.width;\n        const y = 1 - (touch.clientY - rect.top) / rect.height;\n        const mouseUniform = program.uniforms.uMouse.value as Float32Array;\n        mouseUniform[0] = x;\n        mouseUniform[1] = y;\n      }\n    }\n\n    if (interactive) {\n      container.addEventListener(\"mousemove\", handleMouseMove);\n      container.addEventListener(\"touchmove\", handleTouchMove);\n    }\n\n    let animationId: number;\n    function update(t: number) {\n      animationId = requestAnimationFrame(update);\n      program.uniforms.uTime.value = t * 0.001 * speed;\n      renderer.render({ scene: mesh });\n    }\n    animationId = requestAnimationFrame(update);\n\n    container.appendChild(gl.canvas);\n\n    return () => {\n      cancelAnimationFrame(animationId);\n      window.removeEventListener(\"resize\", resize);\n      if (interactive) {\n        container.removeEventListener(\"mousemove\", handleMouseMove);\n        container.removeEventListener(\"touchmove\", handleTouchMove);\n      }\n      if (gl.canvas.parentElement) {\n        gl.canvas.parentElement.removeChild(gl.canvas);\n      }\n      gl.getExtension(\"WEBGL_lose_context\")?.loseContext();\n    };\n  }, [baseColor, speed, amplitude, frequencyX, frequencyY, interactive]);\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"w-full h-full\"\n      {...props}\n    />\n  );\n};\n\nexport default LiquidChrome; ","import { useQuery } from '@tanstack/react-query';\nimport { Property, Deal } from '../lib/properties';\n\ninterface AnalysisSection {\n  title: string;\n  content: string;\n}\n\nasync function generateAnalysis(property: Property | Deal): Promise<AnalysisSection[]> {\n  const isDeal = 'roi_percentage' in property;\n\n  // This is a placeholder. In a real implementation, you would call your AI service\n  // You could use OpenAI, Google's Gemini, or any other AI service\n  const analysis: AnalysisSection[] = [\n    {\n      title: \"Investment Overview\",\n      content: isDeal \n        ? `This ${property.deal_type} opportunity in ${property.location} offers an expected ROI of ${property.roi_percentage}% over ${property.investment_term}.`\n        : `This ${property.sqft} sq ft property in ${property.location} is listed at ${property.price}.`\n    },\n    {\n      title: \"Market Analysis\",\n      content: `The ${property.location} market has shown strong growth potential...`\n    },\n    {\n      title: \"Risk Assessment\",\n      content: isDeal\n        ? `Given the ${property.investment_term} investment term, key risks include...`\n        : `For this residential property, key considerations include...`\n    },\n    {\n      title: \"Recommendations\",\n      content: `Based on the current market conditions and property characteristics...`\n    }\n  ];\n\n  return analysis;\n}\n\nexport function useAIAnalysis(property: Property | Deal | null) {\n  return useQuery({\n    queryKey: ['propertyAnalysis', property?.id],\n    queryFn: () => generateAnalysis(property!),\n    enabled: !!property,\n    staleTime: 24 * 60 * 60 * 1000, // Cache for 24 hours\n  });\n} ","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\";\nimport { formatCurrency } from \"../lib/utils\";\nimport { Property, Deal } from \"../lib/properties\";\nimport { useAIAnalysis } from \"../hooks/useAIAnalysis\";\nimport { LoadingSpinner } from \"./ui/loading-spinner\";\n\ninterface PropertyModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  property: (Property | Deal) | null;\n}\n\nexport function PropertyModal({ isOpen, onClose, property }: PropertyModalProps) {\n  const isDeal = 'roi_percentage' in (property || {});\n  const { data: analysis, isLoading: isLoadingAnalysis } = useAIAnalysis(property);\n\n  if (!property) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-3xl\">\n        <DialogHeader>\n          <DialogTitle>{property.title}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* Image Section */}\n          <div className=\"relative h-[300px] rounded-lg overflow-hidden\">\n            <img\n              src={property.image_url}\n              alt={property.title}\n              className=\"w-full h-full object-cover\"\n            />\n          </div>\n\n          {/* Details Section */}\n          <div className=\"space-y-4\">\n            <div>\n              <h3 className=\"text-lg font-semibold\">Location</h3>\n              <p>{property.location}</p>\n            </div>\n\n            <div>\n              <h3 className=\"text-lg font-semibold\">Price</h3>\n              <p className=\"text-2xl font-bold\">{formatCurrency(property.price)}</p>\n            </div>\n\n            {!isDeal && 'beds' in property && (\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">Beds</h4>\n                  <p className=\"font-medium\">{property.beds}</p>\n                </div>\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">Baths</h4>\n                  <p className=\"font-medium\">{property.baths}</p>\n                </div>\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">Sq Ft</h4>\n                  <p className=\"font-medium\">{property.sqft}</p>\n                </div>\n              </div>\n            )}\n\n            {isDeal && 'roi_percentage' in property && (\n              <div className=\"space-y-2\">\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">ROI</h4>\n                  <p className=\"font-medium text-emerald-500\">{property.roi_percentage}%</p>\n                </div>\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">Investment Term</h4>\n                  <p className=\"font-medium\">{property.investment_term}</p>\n                </div>\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">Deal Type</h4>\n                  <p className=\"font-medium\">{property.deal_type}</p>\n                </div>\n                <div>\n                  <h4 className=\"text-sm text-muted-foreground\">Property Type</h4>\n                  <p className=\"font-medium\">{property.property_type}</p>\n                </div>\n              </div>\n            )}\n\n            <div>\n              <h3 className=\"text-lg font-semibold\">Description</h3>\n              <p className=\"text-muted-foreground\">{property.description}</p>\n            </div>\n          </div>\n        </div>\n\n        {/* AI Analysis Section */}\n        <div className=\"mt-6 border-t pt-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">AI Investment Analysis</h3>\n          {isLoadingAnalysis ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <LoadingSpinner />\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {analysis?.map((section, index) => (\n                <div key={index} className=\"space-y-2\">\n                  <h4 className=\"font-medium\">{section.title}</h4>\n                  <p className=\"text-muted-foreground\">{section.content}</p>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n} ","import React from \"react\";\nimport Header from \"./Header\";\nimport HeroSection from \"./HeroSection\";\nimport PropertyCard from \"./PropertyCard\";\nimport MarketTrends from \"./MarketTrends\";\nimport { AuthModal } from \"./AuthModal\";\nimport { SubscriptionModal } from \"./SubscriptionModal\";\nimport { MessagesModal } from \"./MessagesModal\";\nimport { Footer } from \"./Footer\";\nimport { LegalDisclaimer } from \"./LegalDisclaimer\";\nimport { useAuth } from \"../lib/auth\";\nimport { searchProperties, getFeaturedProperties, Property, useDeals } from \"../lib/properties\";\nimport { Marquee } from \"./ui/Marquee\";\nimport { cn } from \"../lib/utils\";\nimport { LiquidChrome } from \"./LiquidChrome\";\nimport { PropertyModal } from \"./PropertyModal\";\nimport { LoadingSpinner } from \"./ui/loading-spinner\";\n\ntype AuthMode = \"signin\" | \"signup\";\n\nconst reviews = [\n  {\n    name: \"Savills\",\n    username: \"@savills\",\n    body: \"Leading the way in property investment and market analysis.\",\n    img: \"https://avatar.vercel.sh/savills\",\n  },\n  {\n    name: \"Knight Frank\",\n    username: \"@knightfrank\",\n    body: \"Exceptional platform for property investment insights.\",\n    img: \"https://avatar.vercel.sh/knightfrank\",\n  },\n  {\n    name: \"JLL\",\n    username: \"@jll\",\n    body: \"Revolutionary approach to property investment analytics.\",\n    img: \"https://avatar.vercel.sh/jll\",\n  },\n];\n\nconst firstRow = reviews.slice(0, reviews.length / 2);\nconst secondRow = reviews.slice(reviews.length / 2);\nconst thirdRow = reviews.slice(0, reviews.length / 2);\nconst fourthRow = reviews.slice(reviews.length / 2);\n\nconst ReviewCard = ({\n  img,\n  name,\n  username,\n  body,\n}: {\n  img: string;\n  name: string;\n  username: string;\n  body: string;\n}) => {\n  return (\n    <figure\n      className={cn(\n        \"relative h-full w-36 cursor-pointer overflow-hidden rounded-xl border p-4\",\n        \"border-gray-950/[.1] bg-gray-950/[.01] hover:bg-gray-950/[.05]\",\n        \"dark:border-gray-50/[.1] dark:bg-gray-50/[.10] dark:hover:bg-gray-50/[.15]\",\n      )}\n    >\n      <div className=\"flex flex-row items-center gap-2\">\n        <img className=\"rounded-full\" width=\"32\" height=\"32\" alt=\"\" src={img} />\n        <div className=\"flex flex-col\">\n          <figcaption className=\"text-sm font-medium dark:text-white\">\n            {name}\n          </figcaption>\n          <p className=\"text-xs font-medium dark:text-white/40\">{username}</p>\n        </div>\n      </div>\n      <blockquote className=\"mt-2 text-sm\">{body}</blockquote>\n    </figure>\n  );\n};\n\nconst Home = () => {\n  const { user, profile, signOut } = useAuth();\n  const [isInitialLoad, setIsInitialLoad] = React.useState(true);\n  const [searchResults, setSearchResults] = React.useState<Property[]>([]);\n  const [isSearching, setIsSearching] = React.useState(false);\n  const [isAuthModalOpen, setIsAuthModalOpen] = React.useState(false);\n  const [isSubscriptionModalOpen, setIsSubscriptionModalOpen] =\n    React.useState(false);\n  const [authMode, setAuthMode] = React.useState(\"signin\");\n  const [isMessagesModalOpen, setIsMessagesModalOpen] = React.useState(false);\n  const [selectedReceiverId] = React.useState();\n  const [page, setPage] = React.useState(1);\n  const [hasMore, setHasMore] = React.useState(true);\n  const PROPERTIES_PER_PAGE = 6;\n  const [isLoading, setIsLoading] = React.useState(true);\n  const [isFetchingMore, setIsFetchingMore] = React.useState(false);\n  const [selectedProperty, setSelectedProperty] = React.useState<Property | null>(null);\n  const [isPropertyModalOpen, setIsPropertyModalOpen] = React.useState(false);\n  const observerTarget = React.useRef<HTMLDivElement>(null);\n  const loadingRef = React.useRef(false);\n  const { data: dealsData, isLoading: isLoadingDeals } = useDeals();\n\n  const loadFeaturedProperties = async (pageNum = 1, isLoadingMore = false) => {\n    if (loadingRef.current) return;\n    loadingRef.current = true;\n\n    try {\n      if (!isLoadingMore) {\n        setIsLoading(true);\n      } else {\n        setIsFetchingMore(true);\n      }\n      \n      console.log('Fetching page:', pageNum);\n      const properties = await getFeaturedProperties(pageNum, PROPERTIES_PER_PAGE);\n      console.log('Received properties:', properties);\n      \n      if (pageNum === 1) {\n        setSearchResults(properties);\n      } else {\n        setSearchResults(prev => [...prev, ...properties]);\n      }\n      \n      setHasMore(properties.length === PROPERTIES_PER_PAGE);\n      setPage(pageNum);\n      setIsInitialLoad(false);\n    } catch (error) {\n      console.error(\"Error loading properties:\", error);\n    } finally {\n      setIsLoading(false);\n      setIsFetchingMore(false);\n      loadingRef.current = false;\n    }\n  };\n\n  React.useEffect(() => {\n    if (isInitialLoad) {\n      loadFeaturedProperties(1, false);\n    }\n  }, [isInitialLoad]);\n\n  React.useEffect(() => {\n    if (!observerTarget.current || isInitialLoad || isSearching) return;\n\n    const observer = new IntersectionObserver(\n      entries => {\n        if (entries[0].isIntersecting && hasMore && !loadingRef.current) {\n          loadFeaturedProperties(page + 1, true);\n        }\n      },\n      { \n        rootMargin: '200px',\n        threshold: 0.1\n      }\n    );\n\n    observer.observe(observerTarget.current);\n    return () => observer.disconnect();\n  }, [hasMore, page, isInitialLoad, isSearching]);\n\n  const handleSearch = async (term: string) => {\n    if (!term.trim()) {\n      // Reset all states when clearing search\n      setSearchResults([]);\n      setIsSearching(false);\n      setPage(1);\n      setHasMore(true);\n      setIsLoading(true);\n      try {\n        const properties = await getFeaturedProperties(1, PROPERTIES_PER_PAGE);\n        setSearchResults(properties);\n        setHasMore(properties.length === PROPERTIES_PER_PAGE);\n      } catch (error) {\n        console.error(\"Error loading properties:\", error);\n      } finally {\n        setIsLoading(false);\n      }\n      return;\n    }\n\n    setIsSearching(true);\n    setSearchResults([]); // Clear existing results before search\n    try {\n      const results = await searchProperties(term);\n      // Map the results to match the Property interface\n      const mappedResults = results.map(p => ({\n        id: p.id,\n        title: p.title,\n        location: p.location,\n        price: p.price,\n        sqft: p.sqft,\n        beds: p.beds,\n        baths: p.baths,\n        description: p.description,\n        image_url: p.image_url,\n        is_featured: p.is_featured,\n        created_at: p.created_at,\n        updated_at: p.updated_at\n      }));\n      \n      setSearchResults(mappedResults);\n      setHasMore(false); // Disable infinite scroll for search results\n      setPage(1); // Reset page number\n    } catch (error) {\n      console.error(\"Error searching properties:\", error);\n      setSearchResults([]); // Clear results on error\n    } finally {\n      setIsSearching(false);\n    }\n  };\n\n  // Render conditions\n  const showLoading = isLoading;\n  const showProperties = searchResults && searchResults.length > 0;\n  console.log('Render state:', { \n    isLoading, \n    searchResultsLength: searchResults?.length,\n    showLoading,\n    showProperties \n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header\n        isAuthenticated={!!user}\n        userProfile={profile || undefined}\n        onSignIn={() => {\n          setAuthMode(\"signin\");\n          setIsAuthModalOpen(true);\n        }}\n        onSignUp={() => {\n          setAuthMode(\"signup\");\n          setIsAuthModalOpen(true);\n        }}\n        onSignOut={async () => {\n          try {\n            await signOut();\n            window.location.href = \"/\";\n          } catch (error) {\n            console.error(\"Error signing out:\", error);\n          }\n        }}\n      />\n\n      <main>\n        <HeroSection onSearch={handleSearch} />\n\n        <div className=\"w-full bg-background py-8\">\n          <div className=\"max-w-[1200px] mx-auto px-4 sm:px-8\">\n            <h2 className=\"text-2xl font-bold mb-6\">\n              {isSearching ? \"Search Results\" : \"Featured Properties\"}\n            </h2>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8\">\n              {showLoading ? (\n                Array(3).fill(0).map((_, i) => (\n                  <div\n                    key={i}\n                    className=\"w-full h-[420px] bg-muted rounded-lg animate-pulse\"\n                  />\n                ))\n              ) : showProperties ? (\n                searchResults.map((property) => (\n                  <div \n                    key={property.id || Math.random().toString()} \n                    onClick={() => {\n                      setSelectedProperty(property);\n                      setIsPropertyModalOpen(true);\n                    }}\n                    className=\"cursor-pointer hover:opacity-90 transition-opacity\"\n                  >\n                    <PropertyCard\n                      id={property.id}\n                      address={property.location || 'Location not available'}\n                      price={Number(property.price) || 0}\n                      squareFootage={Number(property.sqft) || 0}\n                      bedrooms={Number(property.beds) || 0}\n                      bathrooms={Number(property.baths) || 0}\n                      isPremium={Boolean(property.is_featured)}\n                      propertyType=\"residential\"\n                      description={property.description || ''}\n                      createdAt={property.created_at || new Date().toISOString()}\n                      images={property.image_url ? [property.image_url] : []}\n                    />\n                  </div>\n                ))\n              ) : (\n                <div className=\"col-span-3 text-center py-8 text-muted-foreground\">\n                  No properties found\n                </div>\n              )}\n            </div>\n            \n            {hasMore && !isLoading && !isSearching && (\n              <div \n                ref={observerTarget} \n                className=\"h-24 flex items-center justify-center my-8\"\n              >\n                {isFetchingMore ? (\n                  <div className=\"flex flex-col items-center gap-2\">\n                    <LoadingSpinner />\n                    <p className=\"text-sm text-muted-foreground\">Loading more properties...</p>\n                  </div>\n                ) : (\n                  <div className=\"h-8\" />\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <MarketTrends />\n\n        {/* Investment Deals Section */}\n        <div className=\"w-full bg-background py-8\">\n          <div className=\"max-w-[1200px] mx-auto px-4 sm:px-8\">\n            <h2 className=\"text-2xl font-bold mb-6\">Investment Deals</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {isLoadingDeals ? (\n                Array(3).fill(0).map((_, i) => (\n                  <div key={i} className=\"w-full h-[420px] bg-muted rounded-lg animate-pulse\" />\n                ))\n              ) : dealsData?.pages[0].map((deal) => (\n                <PropertyCard\n                  key={deal.id}\n                  id={deal.id}\n                  address={deal.location}\n                  price={deal.price}\n                  description={deal.description}\n                  propertyType={deal.property_type}\n                  createdAt={deal.created_at}\n                  images={[deal.image_url]}\n                  isDeal={true}\n                  roi_percentage={deal.roi_percentage}\n                  investment_term={deal.investment_term}\n                  deal_type={deal.deal_type}\n                  isPremium={true}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Trusted by Industry Leaders Section */}\n        <section className=\"w-full py-12 bg-background\">\n          <div className=\"container mx-auto text-center mb-8\">\n            <h2 className=\"text-3xl font-bold mb-4\">Trusted by Industry Leaders</h2>\n  \n          </div>\n          <div className=\"relative flex h-96 w-full flex-row items-center justify-center gap-4 overflow-hidden [perspective:300px]\">\n            <div\n              className=\"flex flex-row items-center gap-4\"\n              style={{\n                transform:\n                  \"translateX(-100px) translateY(0px) translateZ(-100px) rotateX(20deg) rotateY(-10deg) rotateZ(20deg)\",\n              }}\n            >\n              <Marquee pauseOnHover vertical className=\"[--duration:20s]\">\n                {firstRow.map((review) => (\n                  <ReviewCard key={review.username} {...review} />\n                ))}\n              </Marquee>\n              <Marquee reverse pauseOnHover className=\"[--duration:20s]\" vertical>\n                {secondRow.map((review) => (\n                  <ReviewCard key={review.username} {...review} />\n                ))}\n              </Marquee>\n              <Marquee reverse pauseOnHover className=\"[--duration:20s]\" vertical>\n                {thirdRow.map((review) => (\n                  <ReviewCard key={review.username} {...review} />\n                ))}\n              </Marquee>\n              <Marquee pauseOnHover className=\"[--duration:20s]\" vertical>\n                {fourthRow.map((review) => (\n                  <ReviewCard key={review.username} {...review} />\n                ))}\n              </Marquee>\n            </div>\n\n            <div className=\"pointer-events-none absolute inset-x-0 top-0 h-1/4 bg-gradient-to-b from-background\"></div>\n            <div className=\"pointer-events-none absolute inset-x-0 bottom-0 h-1/4 bg-gradient-to-t from-background\"></div>\n            <div className=\"pointer-events-none absolute inset-y-0 left-0 w-1/4 bg-gradient-to-r from-background\"></div>\n            <div className=\"pointer-events-none absolute inset-y-0 right-0 w-1/4 bg-gradient-to-l from-background\"></div>\n          </div>\n        </section>\n\n        <div className=\"w-full bg-background py-8\">\n          <div className=\"max-w-[1200px] mx-auto px-4 sm:px-8\">\n            <div className=\"mb-8\">\n              <LegalDisclaimer />\n            </div>\n          </div>\n        </div>\n\n        {(!profile || profile.subscription_tier === \"free\") && (\n          <div className=\"w-full bg-background py-16\">\n            <div className=\"max-w-[1200px] mx-auto px-4 sm:px-8\">\n              <div className=\"relative w-full rounded-3xl overflow-hidden\">\n                {/* LiquidChrome Background */}\n                <div className=\"absolute inset-0\">\n                  <LiquidChrome\n                    baseColor={[0.1, 0.1, 0.1]}\n                    speed={1}\n                    amplitude={0.6}\n                    interactive={true}\n                  />\n                </div>\n                \n                {/* Background Overlay with Blur */}\n                <div className=\"absolute inset-0 bg-black/40 backdrop-blur-[8px]\" />\n                \n                {/* Content */}\n                <div className=\"relative z-10 text-center py-12 px-8\">\n                  <h2 className=\"text-3xl font-bold mb-4 text-white\">\n                    Unlock Premium Property Insights\n                  </h2>\n                  <p className=\"text-lg text-gray-300 mb-8 max-w-2xl mx-auto\">\n                    Get access to detailed property analysis, market comparisons, and investment metrics to make informed decisions.\n                  </p>\n                  <button\n                    onClick={() => setIsSubscriptionModalOpen(true)}\n                    className=\"px-8 py-3 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors\"\n                  >\n                    Upgrade Now\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n      </main>\n\n      <Footer />\n\n      <AuthModal\n        isOpen={isAuthModalOpen}\n        onClose={() => setIsAuthModalOpen(false)}\n        defaultMode={authMode as AuthMode}\n      />\n\n      <SubscriptionModal\n        isOpen={isSubscriptionModalOpen}\n        onClose={() => setIsSubscriptionModalOpen(false)}\n      />\n\n      <MessagesModal\n        isOpen={isMessagesModalOpen}\n        onClose={() => setIsMessagesModalOpen(false)}\n        receiverId={selectedReceiverId}\n      />\n\n      <PropertyModal\n        isOpen={isPropertyModalOpen}\n        onClose={() => setIsPropertyModalOpen(false)}\n        property={selectedProperty}\n      />\n    </div>\n  );\n};\n\nexport default Home;\n","import React from \"react\";\nimport { Footer } from \"./Footer\";\nimport Header from \"./Header\";\nimport { AuthModal } from \"./AuthModal\";\nimport { useAuth } from \"../lib/auth\";\n\ninterface LayoutProps {\n  children: React.ReactNode;\n}\n\nexport function Layout({ children }: LayoutProps) {\n  const { user, profile } = useAuth();\n  const [isAuthModalOpen, setIsAuthModalOpen] = React.useState(false);\n  const [authMode, setAuthMode] = React.useState<\"signin\" | \"signup\">(\"signin\");\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header isAuthenticated={!!user} userProfile={profile || undefined} />\n\n      <div className=\"flex-1\">\n        {children}\n      </div>\n\n      <Footer />\n\n      <AuthModal\n        isOpen={isAuthModalOpen}\n        onClose={() => setIsAuthModalOpen(false)}\n        defaultMode={authMode}\n      />\n    </div>\n  );\n}\n","import { useState, useEffect } from \"react\";\n\nexport function useBitcoinPrice() {\n  const [btcPrice, setBtcPrice] = useState<number | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchPrice = async () => {\n      try {\n        const response = await fetch(\n          `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${import.meta.env.VITE_GEMINI_API_KEY}`,\n          {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n              contents: [\n                {\n                  parts: [\n                    {\n                      text: \"What is the current Bitcoin price in GBP? Return ONLY the number, no text or currency symbols.\",\n                    },\n                  ],\n                },\n              ],\n            }),\n          },\n        );\n\n        const data = await response.json();\n        const priceText = data.candidates[0].content.parts[0].text;\n        const price = parseFloat(priceText.replace(/[^0-9.]/g, \"\"));\n\n        if (!isNaN(price)) {\n          setBtcPrice(price);\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error(\"Error fetching Bitcoin price:\", error);\n      }\n    };\n\n    fetchPrice();\n    const interval = setInterval(fetchPrice, 60000); // Update every minute\n\n    return () => clearInterval(interval);\n  }, []);\n\n  const convertGBPtoBTC = (gbpAmount: number) => {\n    if (!btcPrice) return null;\n    return gbpAmount / btcPrice;\n  };\n\n  return { btcPrice, loading, convertGBPtoBTC };\n}\n","import React from \"react\";\nimport { useBitcoinPrice } from \"../lib/hooks/useBitcoinPrice\";\nimport { Bitcoin } from \"lucide-react\";\n\ninterface BitcoinPriceProps {\n  amount: number;\n}\n\nexport function BitcoinPrice({ amount }: BitcoinPriceProps) {\n  const { btcPrice, loading, convertGBPtoBTC } = useBitcoinPrice();\n  const btcAmount = convertGBPtoBTC(amount);\n\n  if (loading) return <span className=\"text-muted-foreground\">Loading...</span>;\n  if (!btcAmount) return null;\n\n  return (\n    <span className=\"inline-flex items-center gap-1\">\n      <Bitcoin className=\"h-4 w-4 text-[#F7931A]\" />\n      {btcAmount.toFixed(2)}\n    </span>\n  );\n}\n","import { supabase } from './supabase';\n\nexport async function updateUserProfile(\n  userId: string,\n  updates: {\n    role?: 'user' | 'moderator' | 'admin';\n    subscription_tier?: 'free' | 'basic' | 'pro' | 'premium';\n    subscription_status?: 'active' | 'inactive' | 'cancelled';\n  }\n) {\n  try {\n    console.log('Starting profile update for user:', userId);\n    console.log('Updates to apply:', updates);\n\n    // Check if current user is admin\n    const { data: adminProfiles, error: adminCheckError } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', (await supabase.auth.getUser()).data.user?.id);\n\n    if (adminCheckError) {\n      console.error('Admin check error:', adminCheckError);\n      throw adminCheckError;\n    }\n\n    if (!adminProfiles?.length || adminProfiles[0].role !== 'admin') {\n      throw new Error('Unauthorized: Only admins can update user profiles');\n    }\n\n    // First verify the user exists\n    const { data: existingUsers, error: existingError } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('id', userId);\n\n    if (existingError) {\n      console.error('User verification error:', existingError);\n      throw existingError;\n    }\n\n    if (!existingUsers?.length) {\n      throw new Error('User not found');\n    }\n\n    console.log('Existing user:', existingUsers[0]);\n\n    // Prepare update data\n    const updateData = {\n      ...updates,\n      updated_at: new Date().toISOString()\n    };\n\n    console.log('Applying updates:', updateData);\n\n    // Update profile\n    const { data, error: updateError } = await supabase\n      .from('profiles')\n      .update(updateData)\n      .eq('id', userId)\n      .select();\n\n    if (updateError) {\n      console.error('Profile update error:', updateError);\n      throw updateError;\n    }\n\n    if (!data?.length) {\n      console.error('No data returned from update');\n      throw new Error('Update failed - no data returned');\n    }\n\n    console.log('Profile updated successfully:', data[0]);\n\n    // Only update role in auth metadata if role is being changed\n    if (updates.role) {\n      try {\n        await supabase.auth.admin.updateUserById(userId, {\n          user_metadata: {\n            role: updates.role\n          }\n        });\n        console.log('Auth metadata updated for role change');\n      } catch (error) {\n        console.warn('Failed to update auth metadata (non-critical):', error);\n      }\n    }\n\n    return data[0];\n  } catch (error) {\n    console.error('Error in updateUserProfile:', error);\n    throw error;\n  }\n}\n\nexport async function getAllUsers() {\n  try {\n    // Get all profiles with their subscription data\n    const { data: profiles, error: profilesError } = await supabase\n      .from('profiles')\n      .select(`\n        *,\n        subscription_tier,\n        subscription_status,\n        role\n      `)\n      .order('created_at', { ascending: false });\n\n    if (profilesError) {\n      console.error('Profiles fetch error:', profilesError);\n      throw profilesError;\n    }\n\n    if (!profiles) return [];\n\n    return profiles.map(profile => ({\n      ...profile,\n      role: profile.role || 'user',\n      subscription_tier: profile.subscription_tier || 'free',\n      subscription_status: profile.subscription_status || 'active'\n    }));\n  } catch (error) {\n    console.error('Error fetching users:', error);\n    throw error;\n  }\n} ","import * as React from \"react\";\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\";\nimport { CheckIcon } from \"@radix-ui/react-icons\";\n\nimport { cn } from \"../../lib/utils\";\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className,\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <CheckIcon className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n));\nCheckbox.displayName = CheckboxPrimitive.Root.displayName;\n\nexport { Checkbox };\n","import { supabase } from './supabase';\n\nexport interface ScrapedProperty {\n  id: string;\n  title: string;\n  price: number;\n  description: string;\n  location: string;\n  bedrooms: number;\n  bathrooms: number;\n  sqft: number;\n  image_url: string;\n  property_type: string;\n  source_url: string;\n  added_by_user_id: string;\n  is_featured: boolean;\n}\n\nexport interface SearchResults {\n  properties: ScrapedProperty[];\n  totalResults: number;\n  currentPage: number;\n  totalPages: number;\n}\n\n// Use production URL in production, fallback to localhost for development\nconst API_URL = import.meta.env.PROD \n  ? 'https://api.myvge.com'  // Production API URL\n  : 'http://localhost:3001';  // Development URL\n\nexport async function searchProperties(location: string, page = 1): Promise<SearchResults> {\n  try {\n    console.log('Searching properties:', { location, page, apiUrl: API_URL });\n    const response = await fetch(`${API_URL}/api/scrape-properties`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Origin': 'https://myvge.com'\n      },\n      body: JSON.stringify({ location, page }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      console.error('Server error:', error);\n      throw new Error(error.message || 'Failed to fetch properties');\n    }\n\n    const data = await response.json();\n    console.log('Search results:', data);\n    return data;\n  } catch (error) {\n    console.error('Error searching properties:', error);\n    throw error;\n  }\n}\n\nexport async function importProperties(properties: ScrapedProperty[], userId: string) {\n  try {\n    console.log('Importing properties:', { count: properties.length, userId });\n    const { data, error } = await supabase\n      .from('properties')\n      .insert(\n        properties.map(property => ({\n          ...property,\n          added_by_user_id: userId,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n        }))\n      );\n\n    if (error) {\n      console.error('Supabase error:', error);\n      throw error;\n    }\n    \n    console.log('Import successful:', data);\n    return data;\n  } catch (error) {\n    console.error('Error importing properties:', error);\n    throw error;\n  }\n} ","import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n        success: \"bg-green-500/10 text-green-500 hover:bg-green-500/20\",\n        warning: \"bg-yellow-500/10 text-yellow-500 hover:bg-yellow-500/20\",\n        premium: \"bg-gradient-to-r from-amber-500 to-amber-600 text-white hover:from-amber-600 hover:to-amber-700\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants };\n","import React, { useState, useEffect } from 'react';\nimport { Button } from './ui/button';\nimport { Input } from './ui/input';\nimport { Card } from './ui/card';\nimport { Checkbox } from './ui/checkbox';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from './ui/dialog';\nimport { LoadingSpinner } from './ui/loading-spinner';\nimport { useToast } from './ui/use-toast';\nimport { ScrapedProperty, searchProperties, importProperties } from '../lib/propertyScraperService';\nimport { useAuth } from '../lib/auth';\nimport { Badge } from './ui/badge';\nimport { Bed, Bath, Home, MapPin } from 'lucide-react';\n\nexport function PropertyImporter() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useState('');\n  const [isSearching, setIsSearching] = useState(false);\n  const [isImporting, setIsImporting] = useState(false);\n  const [searchResults, setSearchResults] = useState<ScrapedProperty[]>([]);\n  const [selectedProperties, setSelectedProperties] = useState<Set<string>>(new Set());\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalResults, setTotalResults] = useState(0);\n  \n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  // Reset state when modal closes\n  useEffect(() => {\n    if (!isOpen) {\n      setSearchResults([]);\n      setSelectedProperties(new Set());\n      setCurrentPage(1);\n      setTotalPages(1);\n      setTotalResults(0);\n      setLocation('');\n    }\n  }, [isOpen]);\n\n  const handleSearch = async () => {\n    if (!location.trim()) return;\n\n    try {\n      setIsSearching(true);\n      const results = await searchProperties(location, currentPage);\n      setSearchResults(results.properties);\n      setTotalPages(results.totalPages);\n      setTotalResults(results.totalResults);\n      toast({\n        title: \"Properties Found\",\n        description: `Found ${results.totalResults.toLocaleString()} properties in ${location}`,\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to search properties. Please try again.\",\n      });\n    } finally {\n      setIsSearching(false);\n    }\n  };\n\n  const handleImport = async () => {\n    if (!user?.id || selectedProperties.size === 0) return;\n\n    try {\n      setIsImporting(true);\n      const propertiesToImport = searchResults.filter(p => selectedProperties.has(p.id));\n      await importProperties(propertiesToImport, user.id);\n      \n      toast({\n        title: \"Success\",\n        description: `Imported ${selectedProperties.size} properties successfully`,\n      });\n      setIsOpen(false);\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to import properties. Please try again.\",\n      });\n    } finally {\n      setIsImporting(false);\n    }\n  };\n\n  const toggleProperty = (propertyId: string) => {\n    const newSelected = new Set(selectedProperties);\n    if (newSelected.has(propertyId)) {\n      newSelected.delete(propertyId);\n    } else {\n      newSelected.add(propertyId);\n    }\n    setSelectedProperties(newSelected);\n  };\n\n  const handlePageChange = async (newPage: number) => {\n    setCurrentPage(newPage);\n    await handleSearch();\n  };\n\n  return (\n    <>\n      <Button \n        onClick={() => setIsOpen(true)}\n        className=\"bg-gradient-to-r from-emerald-400 to-cyan-400 text-white hover:from-emerald-500 hover:to-cyan-500\"\n      >\n        Import Properties\n      </Button>\n\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Import Properties</DialogTitle>\n            <DialogDescription>\n              Search for properties by location and select the ones you want to import.\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"flex gap-2 my-4\">\n            <Input\n              placeholder=\"Enter city or postcode (e.g., London or SW1A 1AA)\"\n              value={location}\n              onChange={(e) => setLocation(e.target.value)}\n              onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n              className=\"flex-1\"\n            />\n            <Button onClick={handleSearch} disabled={isSearching}>\n              {isSearching ? <LoadingSpinner /> : 'Search'}\n            </Button>\n          </div>\n\n          {totalResults > 0 && (\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Found {totalResults.toLocaleString()} properties in {location}\n            </p>\n          )}\n\n          <div className=\"flex-1 overflow-auto min-h-[400px]\">\n            {isSearching ? (\n              <div className=\"flex justify-center items-center h-40\">\n                <LoadingSpinner />\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {searchResults.map((property) => (\n                  <Card key={property.id} className=\"overflow-hidden\">\n                    <div className=\"aspect-video relative\">\n                      <img\n                        src={property.image_url}\n                        alt={property.title}\n                        className=\"w-full h-full object-cover\"\n                      />\n                      <div className=\"absolute top-2 right-2\">\n                        <Checkbox\n                          checked={selectedProperties.has(property.id)}\n                          onCheckedChange={() => toggleProperty(property.id)}\n                          className=\"h-6 w-6 bg-white/90\"\n                        />\n                      </div>\n                      <Badge \n                        className=\"absolute bottom-2 left-2 bg-white/90 text-black\"\n                        variant=\"secondary\"\n                      >\n                        {property.property_type}\n                      </Badge>\n                    </div>\n                    <div className=\"p-4\">\n                      <h3 className=\"font-medium line-clamp-2 mb-2\">{property.title}</h3>\n                      <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\n                        <MapPin className=\"h-4 w-4\" />\n                        <span className=\"text-sm line-clamp-1\">{property.location}</span>\n                      </div>\n                      <p className=\"text-lg font-semibold mb-3\">\n                        {property.price.toLocaleString()}\n                      </p>\n                      <div className=\"flex gap-4 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center gap-1\">\n                          <Bed className=\"h-4 w-4\" />\n                          <span>{property.bedrooms}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Bath className=\"h-4 w-4\" />\n                          <span>{property.bathrooms}</span>\n                        </div>\n                        {property.sqft > 0 && (\n                          <div className=\"flex items-center gap-1\">\n                            <Home className=\"h-4 w-4\" />\n                            <span>{property.sqft} sq ft</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {searchResults.length > 0 && (\n            <div className=\"flex justify-between items-center mt-4 pt-4 border-t\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    disabled={currentPage === 1 || isSearching}\n                    onClick={() => handlePageChange(currentPage - 1)}\n                  >\n                    Previous\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    disabled={currentPage === totalPages || isSearching}\n                    onClick={() => handlePageChange(currentPage + 1)}\n                  >\n                    Next\n                  </Button>\n                </div>\n                <span className=\"text-sm text-muted-foreground\">\n                  Page {currentPage} of {totalPages}\n                </span>\n              </div>\n              <Button\n                disabled={selectedProperties.size === 0 || isImporting}\n                onClick={handleImport}\n                className=\"bg-gradient-to-r from-emerald-400 to-cyan-400 text-white hover:from-emerald-500 hover:to-cyan-500\"\n              >\n                {isImporting ? (\n                  <LoadingSpinner />\n                ) : (\n                  `Import ${selectedProperties.size} Properties`\n                )}\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n} ","import React from \"react\";\nimport { useAuth } from \"../lib/auth\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Button } from \"./ui/button\";\nimport { Card, CardContent } from \"./ui/card\";\nimport {\n  Building2,\n  Star,\n  TrendingUp,\n  PoundSterling,\n  Users,\n  Bitcoin,\n} from \"lucide-react\";\nimport { getSavedProperties } from \"../lib/properties\";\nimport PropertyCard from \"./PropertyCard\";\nimport { supabase } from \"../lib/supabase\";\nimport { Layout } from \"./Layout\";\nimport { BitcoinPrice } from \"./BitcoinPrice\";\nimport { updateUserProfile, getAllUsers } from '../lib/users';\nimport { PropertyImporter } from './PropertyImporter';\n\nexport default function Dashboard() {\n  const { user, profile } = useAuth();\n  const navigate = useNavigate();\n  const [savedProperties, setSavedProperties] = React.useState<any[]>([]);\n  const [addedProperties, setAddedProperties] = React.useState<any[]>([]);\n  const [users, setUsers] = React.useState<any[]>([]);\n  const [portfolioStats, setPortfolioStats] = React.useState({\n    totalProperties: 0,\n    totalValue: 0,\n    averagePrice: 0,\n    totalProfit: 0,\n    monthlyIncome: 0,\n  });\n  const [isLoading, setIsLoading] = React.useState(true);\n  const [error, setError] = React.useState<string | null>(null);\n\n  const loadUsers = React.useCallback(async () => {\n    if (!user || profile?.role !== \"admin\") return;\n    try {\n      const data = await getAllUsers();\n      setUsers(data);\n    } catch (error) {\n      console.error('Error loading users:', error);\n      setError('Failed to load users');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [user, profile]);\n\n  const handleUserUpdate = async (userId: string, updates: any) => {\n    try {\n      setIsLoading(true);\n      console.log('Attempting to update user:', userId);\n      console.log('Updates:', updates);\n\n      const updatedProfile = await updateUserProfile(userId, updates);\n      console.log('Update successful:', updatedProfile);\n\n      // Refresh the users list\n      const updatedUsers = await getAllUsers();\n      setUsers(updatedUsers);\n      \n      alert('User updated successfully');\n    } catch (error: any) {\n      console.error('Error updating user:', error);\n      alert(error.message || 'Failed to update user. Please check console for details.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadProperties = React.useCallback(async () => {\n    if (!user) return;\n    try {\n      const [saved, { data: added }] = await Promise.all([\n        getSavedProperties(user.id),\n        supabase\n          .from(\"properties\")\n          .select(\n            `*,\n            assigned_user:profiles!properties_assigned_user_id_fkey(full_name, email),\n            author:profiles!properties_created_by_fkey(full_name, email)`,\n          )\n          .eq(\"created_by\", user.id),\n      ]);\n\n      setAddedProperties(added || []);\n      setSavedProperties(saved);\n\n      // Calculate portfolio stats\n      const totalProperties = (added || []).length + saved.length;\n      const totalValue = [...(added || []), ...saved].reduce(\n        (sum, prop) => sum + (prop.price || 0),\n        0,\n      );\n      const averagePrice = totalValue / (totalProperties || 1);\n      const totalProfit = [...(added || []), ...saved].reduce(\n        (sum, prop) => sum + (prop.potential_profit || 0),\n        0,\n      );\n      const monthlyIncome = [...(added || []), ...saved].reduce(\n        (sum, prop) => sum + (prop.monthly_income || 0),\n        0,\n      );\n\n      setPortfolioStats({\n        totalProperties,\n        totalValue,\n        averagePrice,\n        totalProfit,\n        monthlyIncome,\n      });\n    } catch (error) {\n      console.error(\"Error loading properties:\", error);\n    }\n  }, [user]);\n\n  React.useEffect(() => {\n    if (!user) {\n      navigate(\"/\");\n      return;\n    }\n    loadProperties();\n    loadUsers();\n  }, [user, navigate, loadProperties, loadUsers]);\n\n  if (!user) {\n    navigate(\"/\");\n    return null;\n  }\n\n  return (\n    <Layout>\n      <main className=\"container mx-auto px-4 py-8 pt-24\">\n        <div className=\"max-w-7xl mx-auto space-y-8\">\n          <div className=\"flex items-center justify-between\">\n            <h1 className=\"text-3xl font-bold\">Dashboard</h1>\n            <PropertyImporter />\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-lg font-semibold\">Portfolio Value</h3>\n                  <PoundSterling className=\"w-5 h-5 text-primary\" />\n                </div>\n                <p className=\"text-3xl font-bold\">\n                  {portfolioStats.totalValue.toLocaleString()}\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  {portfolioStats.totalProperties} properties\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-lg font-semibold\">Average Price</h3>\n                  <Building2 className=\"w-5 h-5 text-primary\" />\n                </div>\n                <p className=\"text-3xl font-bold\">\n                  {portfolioStats.averagePrice.toLocaleString()}\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Per property\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-lg font-semibold\">Total Profit</h3>\n                  <TrendingUp className=\"w-5 h-5 text-primary\" />\n                </div>\n                <p className=\"text-3xl font-bold\">\n                  {portfolioStats.totalProfit.toLocaleString()}\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Estimated profit\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-lg font-semibold\">BTC Value</h3>\n                  <Bitcoin className=\"w-5 h-5 text-[#F7931A]\" />\n                </div>\n                <BitcoinPrice amount={portfolioStats.totalValue} />\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Portfolio in BTC\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          {profile?.role === 'admin' && (\n            <div className=\"space-y-6\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h2 className=\"text-2xl font-semibold flex items-center gap-2\">\n                  <Users className=\"w-5 h-5\" /> User Management\n                </h2>\n              </div>\n              {error && <div className=\"text-red-500 mb-4\">{error}</div>}\n              {isLoading ? (\n                <div>Loading...</div>\n              ) : (\n                <div className=\"grid gap-4\">\n                  {users.map((user) => (\n                    <div key={user.id} className=\"border p-4 rounded-lg\">\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <p className=\"font-semibold\">{user.full_name}</p>\n                          <p className=\"text-sm text-gray-600\">{user.email}</p>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          <select\n                            value={user.role}\n                            onChange={(e) => handleUserUpdate(user.id, { role: e.target.value })}\n                            className=\"border rounded p-1\"\n                          >\n                            <option value=\"user\">User</option>\n                            <option value=\"moderator\">Moderator</option>\n                            <option value=\"admin\">Admin</option>\n                          </select>\n                          <select\n                            value={user.subscription_tier}\n                            onChange={(e) => handleUserUpdate(user.id, { subscription_tier: e.target.value })}\n                            className=\"border rounded p-1\"\n                          >\n                            <option value=\"free\">Free</option>\n                            <option value=\"basic\">Basic</option>\n                            <option value=\"pro\">Pro</option>\n                            <option value=\"premium\">Premium</option>\n                          </select>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <div className=\"space-y-6\">\n              <h2 className=\"text-2xl font-semibold flex items-center gap-2\">\n                <Star className=\"w-5 h-5\" /> Saved Properties\n              </h2>\n              <div className=\"space-y-4\">\n                {savedProperties.map((saved: any) => (\n                  <PropertyCard\n                    key={saved.property.id}\n                    {...saved.property}\n                    isSubscriber={profile?.subscription_tier !== 'free'}\n                  />\n                ))}\n              </div>\n            </div>\n\n            <div className=\"space-y-6\">\n              <h2 className=\"text-2xl font-semibold flex items-center gap-2\">\n                <Building2 className=\"w-5 h-5\" /> Added Properties\n              </h2>\n              <div className=\"space-y-4\">\n                {addedProperties.map((property: any) => (\n                  <PropertyCard\n                    key={property.id}\n                    {...property}\n                    isSubscriber={profile?.subscription_tier !== 'free'}\n                  />\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n    </Layout>\n  );\n}\n","import React from \"react\";\nimport Header from \"./Header\";\nimport HeroSection from \"./HeroSection\";\nimport { SubscriptionPlans } from \"./SubscriptionPlans\";\nimport { createCheckoutSession } from \"../lib/stripe\";\nimport { useAuth } from \"../lib/auth\";\nimport { useToast } from \"./ui/use-toast\";\nimport { LegalDisclaimer } from \"./LegalDisclaimer\";\nimport { Footer } from \"./Footer\";\nimport { AuthModal } from \"./AuthModal\";\n\nexport default function PricingPage() {\n  const { user, profile, signOut } = useAuth();\n  const { toast } = useToast();\n  const [isAuthModalOpen, setIsAuthModalOpen] = React.useState(false);\n  const [authMode, setAuthMode] = React.useState<\"signin\" | \"signup\">(\"signin\");\n\n  const handleSubscribe = async (priceId: string) => {\n    if (!user) {\n      // Store the selected price ID in localStorage\n      localStorage.setItem(\"pending_subscription_price_id\", priceId);\n\n      // Trigger sign up modal\n      setAuthMode(\"signup\");\n      setIsAuthModalOpen(true);\n      return;\n    }\n\n    try {\n      await createCheckoutSession(priceId, user.id);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to start subscription process. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header\n        isAuthenticated={!!user}\n        userProfile={profile || undefined}\n        onSignIn={() => {\n          setAuthMode(\"signin\");\n          setIsAuthModalOpen(true);\n        }}\n        onSignUp={() => {\n          setAuthMode(\"signup\");\n          setIsAuthModalOpen(true);\n        }}\n        onSignOut={async () => {\n          try {\n            await signOut();\n            window.location.href = \"/\";\n          } catch (error) {\n            console.error(\"Error signing out:\", error);\n          }\n        }}\n      />\n      <HeroSection\n        title=\"Choose Your Perfect Plan\"\n        subtitle=\"Select the perfect subscription plan to unlock premium features and detailed property insights\"\n        backgroundImage=\"https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-4.0.3\"\n        showSearch={false}\n        showStats={false}\n        height=\"h-[400px]\"\n      />\n      <main>\n        <SubscriptionPlans onSubscribe={handleSubscribe} />\n        <div className=\"container mx-auto px-4 py-12\">\n          <div className=\"max-w-4xl mx-auto prose dark:prose-invert mb-16\">\n            <h2 className=\"text-3xl font-bold mb-6\">\n              Investment Plans for Every Property Investor\n            </h2>\n            <p>\n              Choose from our range of subscription plans designed to meet the\n              needs of property investors at every level. From market analysis\n              to detailed property insights, our plans provide the tools you\n              need to make informed investment decisions.\n            </p>\n\n            <h3 className=\"text-2xl font-semibold mt-8 mb-4\">Plan Benefits</h3>\n            <ul>\n              <li>\n                Access to comprehensive property market data and analytics\n              </li>\n              <li>Real-time market insights and trend analysis</li>\n              <li>Advanced property search and filtering capabilities</li>\n              <li>Investment calculators and ROI projections</li>\n              <li>Portfolio tracking and management tools</li>\n            </ul>\n\n            <h3 className=\"text-2xl font-semibold mt-8 mb-4\">Why Subscribe?</h3>\n            <p>\n              Our subscription plans give you access to premium features and\n              insights that help you stay ahead in the property market. From\n              basic market analysis to advanced AI-powered predictions, we\n              provide the tools you need to make successful property\n              investments.\n            </p>\n\n            <h3 className=\"text-2xl font-semibold mt-8 mb-4\">\n              Money-Back Guarantee\n            </h3>\n            <p>\n              We're confident in the value our platform provides. If you're not\n              satisfied with your subscription within the first 30 days, we'll\n              provide a full refund, no questions asked.\n            </p>\n          </div>\n          <LegalDisclaimer />\n        </div>\n      </main>\n      <Footer />\n\n      <AuthModal\n        isOpen={isAuthModalOpen}\n        onClose={() => setIsAuthModalOpen(false)}\n        defaultMode={authMode}\n      />\n    </div>\n  );\n}\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\";\nimport { Button } from \"./ui/button\";\nimport { Input } from \"./ui/input\";\nimport { Label } from \"./ui/label\";\nimport { useToast } from \"./ui/use-toast\";\nimport { supabase } from \"../lib/supabase\";\nimport { useAuth } from \"../lib/auth\";\n\nexport function OnboardingModal(props) {\n  const [step, setStep] = React.useState(0);\n  const [loading, setLoading] = React.useState(false);\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [formData, setFormData] = React.useState({\n    profileImage: \"\",\n    bannerImage: \"\",\n    selectedWidgets: [],\n  });\n\n  const handleComplete = async () => {\n    if (!user) return;\n    setLoading(true);\n\n    try {\n      const { error } = await supabase\n        .from(\"profiles\")\n        .update({\n          avatar_url:\n            formData.profileImage ||\n            `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.email}`,\n          banner_url:\n            formData.bannerImage ||\n            \"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab\",\n          dashboard_widgets: formData.selectedWidgets,\n          onboarding_completed: true,\n        })\n        .eq(\"id\", user.id);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Setup Complete!\",\n        description: \"Your profile has been updated successfully.\",\n      });\n      props.onClose();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const steps = [\n    {\n      title: \"Profile Image\",\n      description: \"Add a profile image to personalize your account\",\n      component: (\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label>Profile Image URL</Label>\n            <Input\n              placeholder=\"Enter image URL or leave blank for default avatar\"\n              value={formData.profileImage}\n              onChange={(e) =>\n                setFormData((prev) => ({\n                  ...prev,\n                  profileImage: e.target.value,\n                }))\n              }\n            />\n          </div>\n          {formData.profileImage && (\n            <img\n              src={formData.profileImage}\n              alt=\"Profile Preview\"\n              className=\"w-24 h-24 rounded-full object-cover mx-auto\"\n            />\n          )}\n        </div>\n      ),\n    },\n    {\n      title: \"Dashboard Banner\",\n      description: \"Choose a banner image for your dashboard\",\n      component: (\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label>Banner Image URL</Label>\n            <Input\n              placeholder=\"Enter banner image URL or leave blank for default\"\n              value={formData.bannerImage}\n              onChange={(e) =>\n                setFormData((prev) => ({\n                  ...prev,\n                  bannerImage: e.target.value,\n                }))\n              }\n            />\n          </div>\n          {formData.bannerImage && (\n            <img\n              src={formData.bannerImage}\n              alt=\"Banner Preview\"\n              className=\"w-full h-32 object-cover rounded-md\"\n            />\n          )}\n        </div>\n      ),\n    },\n    {\n      title: \"Dashboard Widgets\",\n      description: \"Select the widgets you want to see on your dashboard\",\n      component: (\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            {[\n              \"market_trends\",\n              \"property_news\",\n              \"saved_properties\",\n              \"price_alerts\",\n              \"market_insights\",\n              \"investment_calculator\",\n            ].map((widget) => (\n              <Button\n                key={widget}\n                variant={\n                  formData.selectedWidgets.includes(widget)\n                    ? \"default\"\n                    : \"outline\"\n                }\n                onClick={() =>\n                  setFormData((prev) => ({\n                    ...prev,\n                    selectedWidgets: prev.selectedWidgets.includes(widget)\n                      ? prev.selectedWidgets.filter((w) => w !== widget)\n                      : [...prev.selectedWidgets, widget],\n                  }))\n                }\n                className=\"h-auto py-4 px-6 text-left flex flex-col items-start space-y-2\"\n              >\n                <span className=\"font-medium capitalize\">\n                  {widget.replace(\"_\", \" \")}\n                </span>\n              </Button>\n            ))}\n          </div>\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <Dialog open={props.isOpen} onOpenChange={props.onClose}>\n      <DialogContent className=\"sm:max-w-[600px]\">\n        <DialogHeader>\n          <DialogTitle>{steps[step].title}</DialogTitle>\n          <DialogDescription>{steps[step].description}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"py-6\">{steps[step].component}</div>\n\n        <div className=\"flex justify-between\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setStep((s) => Math.max(0, s - 1))}\n            disabled={step === 0}\n          >\n            Previous\n          </Button>\n          <Button\n            onClick={() => {\n              if (step === steps.length - 1) {\n                handleComplete();\n              } else {\n                setStep((s) => Math.min(steps.length - 1, s + 1));\n              }\n            }}\n            disabled={loading}\n          >\n            {step === steps.length - 1 ? \"Complete Setup\" : \"Next\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { useEffect, useState } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { useToast } from \"./ui/use-toast\";\nimport { useAuth } from \"../lib/auth\";\nimport { OnboardingModal } from \"./OnboardingModal\";\n\nexport default function SubscriptionSuccess() {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [showOnboarding, setShowOnboarding] = useState(true);\n\n  useEffect(() => {\n    const sessionId = searchParams.get(\"session_id\");\n    if (sessionId) {\n      toast({\n        title: \"Subscription Successful!\",\n        description:\n          \"Thank you for subscribing. Your premium features are now available.\",\n      });\n    }\n\n    // Only redirect if onboarding is skipped or completed\n    if (!showOnboarding) {\n      navigate(\"/dashboard\");\n    }\n  }, [showOnboarding, navigate, searchParams, toast]);\n\n  return (\n    <>\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"max-w-md w-full mx-auto p-8\">\n          <div className=\"bg-white shadow-lg rounded-lg p-6 text-center\">\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <svg\n                className=\"w-8 h-8 text-green-500\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M5 13l4 4L19 7\"\n                />\n              </svg>\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n              Subscription Successful!\n            </h2>\n            <p className=\"text-gray-600 mb-4\">\n              Thank you for subscribing. Your premium features are now\n              available.\n            </p>\n            <p className=\"text-sm text-gray-500\">\n              Setting up your preferences...\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <OnboardingModal\n        isOpen={showOnboarding}\n        onClose={() => {\n          setShowOnboarding(false);\n          navigate(\"/dashboard\");\n        }}\n      />\n    </>\n  );\n}\n","import { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useToast } from \"./ui/use-toast\";\n\nexport default function SubscriptionCancel() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    toast({\n      title: \"Subscription Cancelled\",\n      description:\n        \"Your subscription process was cancelled. Please try again if this was a mistake.\",\n      variant: \"destructive\",\n    });\n\n    // Redirect to home after a short delay\n    const timer = setTimeout(() => {\n      navigate(\"/\");\n    }, 3000);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n      <div className=\"max-w-md w-full mx-auto p-8\">\n        <div className=\"bg-white shadow-lg rounded-lg p-6 text-center\">\n          <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <svg\n              className=\"w-8 h-8 text-red-500\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n            Subscription Cancelled\n          </h2>\n          <p className=\"text-gray-600 mb-4\">\n            Your subscription process was cancelled. Please try again if this\n            was a mistake.\n          </p>\n          <p className=\"text-sm text-gray-500\">\n            Redirecting you to the homepage...\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { Button } from './ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from './ui/avatar';\nimport { useToast } from './ui/use-toast';\n\ninterface AvatarUploadProps {\n  currentAvatarUrl?: string;\n  onUpload: (file: File) => Promise<void>;\n  userInitials: string;\n}\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\nconst ALLOWED_FILE_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\n\nexport function AvatarUpload({ currentAvatarUrl, onUpload, userInitials }: AvatarUploadProps) {\n  const [isUploading, setIsUploading] = useState(false);\n  const { toast } = useToast();\n  const fileInputRef = React.useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n      toast({\n        title: \"File too large\",\n        description: \"Please select an image under 5MB\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Validate file type\n    if (!ALLOWED_FILE_TYPES.includes(file.type)) {\n      toast({\n        title: \"Invalid file type\",\n        description: \"Please select a JPEG, PNG or WebP image\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    try {\n      setIsUploading(true);\n      await onUpload(file);\n      toast({\n        title: \"Success\",\n        description: \"Profile picture updated successfully\"\n      });\n    } catch (error) {\n      console.error('Error uploading avatar:', error);\n      toast({\n        title: \"Upload failed\",\n        description: \"Failed to update profile picture. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col items-center gap-4\">\n      <Avatar className=\"h-24 w-24\">\n        <AvatarImage src={currentAvatarUrl} />\n        <AvatarFallback>{userInitials}</AvatarFallback>\n      </Avatar>\n      <input\n        type=\"file\"\n        ref={fileInputRef}\n        className=\"hidden\"\n        accept={ALLOWED_FILE_TYPES.join(',')}\n        onChange={handleFileSelect}\n      />\n      <Button \n        variant=\"outline\" \n        onClick={() => fileInputRef.current?.click()}\n        disabled={isUploading}\n      >\n        {isUploading ? 'Uploading...' : 'Change Profile Picture'}\n      </Button>\n      <p className=\"text-sm text-muted-foreground\">\n        Maximum file size: 5MB. Supported formats: JPEG, PNG, WebP\n      </p>\n    </div>\n  );\n} ","import React, { useState } from 'react';\nimport { useAuth } from '../lib/auth';\nimport { Layout } from './Layout';\nimport { Button } from './ui/button';\nimport { Input } from './ui/input';\nimport { Label } from './ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from './ui/card';\nimport { AvatarUpload } from './AvatarUpload';\nimport { supabase } from '../lib/supabase';\nimport { useToast } from './ui/use-toast';\n\nexport default function AccountSettings() {\n  const { user, profile } = useAuth();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    fullName: profile?.full_name || '',\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: '',\n  });\n\n  const handleAvatarUpload = async (file: File) => {\n    if (!user) return;\n\n    try {\n      // Create a unique file name\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${user.id}-${Date.now()}.${fileExt}`;\n      const filePath = `${user.id}/${fileName}`;\n\n      // Upload the file to Supabase storage\n      const { error: uploadError, data } = await supabase.storage\n        .from('avatars')\n        .upload(filePath, file, {\n          cacheControl: '3600',\n          upsert: true\n        });\n\n      if (uploadError) {\n        console.error('Upload error:', uploadError);\n        throw uploadError;\n      }\n\n      // Get the public URL\n      const {\n        data: { publicUrl },\n      } = supabase.storage\n        .from('avatars')\n        .getPublicUrl(filePath);\n\n      console.log('File uploaded, public URL:', publicUrl);\n\n      // Update the user's profile with the new avatar URL\n      const { error: updateError } = await supabase\n        .from('profiles')\n        .update({\n          avatar_url: publicUrl,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', user.id);\n\n      if (updateError) {\n        console.error('Profile update error:', updateError);\n        throw updateError;\n      }\n\n      // Verify the update\n      const { data: updatedProfile, error: verifyError } = await supabase\n        .from('profiles')\n        .select('avatar_url')\n        .eq('id', user.id)\n        .single();\n\n      if (verifyError) {\n        console.error('Verification error:', verifyError);\n        throw verifyError;\n      }\n\n      console.log('Profile updated with new avatar:', updatedProfile);\n\n      // Force a page refresh to show the new avatar\n      window.location.reload();\n\n    } catch (error) {\n      console.error('Error in handleAvatarUpload:', error);\n      throw error;\n    }\n  };\n\n  const handleUpdateProfile = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n\n    try {\n      setIsLoading(true);\n\n      // Update full name\n      if (formData.fullName !== profile?.full_name) {\n        const { error: updateError } = await supabase\n          .from('profiles')\n          .update({ full_name: formData.fullName })\n          .eq('id', user.id);\n\n        if (updateError) throw updateError;\n      }\n\n      // Update password if provided\n      if (formData.newPassword) {\n        if (formData.newPassword !== formData.confirmPassword) {\n          throw new Error('New passwords do not match');\n        }\n\n        const { error: passwordError } = await supabase.auth.updateUser({\n          password: formData.newPassword\n        });\n\n        if (passwordError) throw passwordError;\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Profile updated successfully\"\n      });\n\n      // Clear password fields\n      setFormData(prev => ({\n        ...prev,\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      }));\n    } catch (error: any) {\n      console.error('Error updating profile:', error);\n      toast({\n        title: \"Update failed\",\n        description: error.message || \"Failed to update profile\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const userInitials = profile?.full_name\n    ?.split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase() || '??';\n\n  return (\n    <Layout>\n      <div className=\"container mx-auto px-4 py-8 pt-24\">\n        <div className=\"max-w-2xl mx-auto space-y-8\">\n          <h1 className=\"text-3xl font-bold\">Account Settings</h1>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Profile Picture</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <AvatarUpload\n                currentAvatarUrl={profile?.avatar_url}\n                onUpload={handleAvatarUpload}\n                userInitials={userInitials}\n              />\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Profile Information</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleUpdateProfile} className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"fullName\">Full Name</Label>\n                  <Input\n                    id=\"fullName\"\n                    value={formData.fullName}\n                    onChange={e => setFormData(prev => ({ ...prev, fullName: e.target.value }))}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    value={user?.email || ''}\n                    disabled\n                  />\n                </div>\n\n                <div className=\"pt-4\">\n                  <h3 className=\"text-lg font-semibold mb-4\">Change Password</h3>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"currentPassword\">Current Password</Label>\n                      <Input\n                        id=\"currentPassword\"\n                        type=\"password\"\n                        value={formData.currentPassword}\n                        onChange={e => setFormData(prev => ({ ...prev, currentPassword: e.target.value }))}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"newPassword\">New Password</Label>\n                      <Input\n                        id=\"newPassword\"\n                        type=\"password\"\n                        value={formData.newPassword}\n                        onChange={e => setFormData(prev => ({ ...prev, newPassword: e.target.value }))}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"confirmPassword\">Confirm New Password</Label>\n                      <Input\n                        id=\"confirmPassword\"\n                        type=\"password\"\n                        value={formData.confirmPassword}\n                        onChange={e => setFormData(prev => ({ ...prev, confirmPassword: e.target.value }))}\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Button type=\"submit\" disabled={isLoading}>\n                  {isLoading ? 'Saving...' : 'Save Changes'}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </Layout>\n  );\n}\n","import { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../lib/auth\";\n\nexport function RequireAuth({ children }: { children: React.ReactNode }) {\n  const { user, profile, isLoading, fetchProfile } = useAuth();\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      if (!isLoading && !user) {\n        navigate(\"/\");\n        return;\n      }\n\n      if (user && !profile) {\n        // Fetch profile if user is authenticated but profile is missing\n        await fetchProfile(user.id);\n      }\n    };\n\n    checkAuth();\n  }, [user, profile, isLoading, navigate, fetchProfile]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        Loading...\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n","import { motion } from \"framer-motion\";\nimport React from \"react\";\n\ninterface PageTransitionProps {\n  children: React.ReactNode;\n}\n\nexport function PageTransition({ children }: PageTransitionProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: 20 }}\n      transition={{ duration: 0.3 }}\n    >\n      {children}\n    </motion.div>\n  );\n}\n","import { supabase } from \"./supabase\";\n\nexport async function fetchPropertyNews() {\n  return [\n    {\n      title: \"UK Housing Market Shows Signs of Recovery\",\n      description:\n        \"Recent data indicates a steady increase in property transactions...\",\n      url: \"#\",\n      publishedAt: new Date().toISOString(),\n    },\n    {\n      title: \"Interest Rates Impact on Property Market\",\n      description:\n        \"Bank of England's latest decision affects mortgage rates...\",\n      url: \"#\",\n      publishedAt: new Date().toISOString(),\n    },\n    {\n      title: \"Regional Property Markets Outperform London\",\n      description: \"Northern cities show strong growth in property values...\",\n      url: \"#\",\n      publishedAt: new Date().toISOString(),\n    },\n  ];\n}\n\nexport async function generateMarketInsights(prompt: string) {\n  try {\n    const formattedPrompt = `${prompt}\n\nProvide a detailed analysis using EXACTLY this format (do not include numbers or asterisks at the start of sections):\n\n## Latest Tax Law Changes\n- The current stamp duty rates and thresholds\n- Recent changes to capital gains tax\n- Upcoming tax proposals\n\n## Landlord Regulations\n- Latest HMO licensing requirements\n- Recent changes to tenant rights\n- Current safety regulations\n\n## Government Policies\n- New housing policies\n- Regional development initiatives\n- Planning permission changes\n\n## Market Impact Analysis\n- Effect on property values\n- Changes to rental yields\n- Investment recommendations\n\nUse ONLY ## for section headers and - for bullet points. Do not use any other formatting, numbers, or special characters. Each bullet point should be a complete sentence with specific dates and numbers where possible.`;\n\n    const response = await fetch(\n      `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${import.meta.env.VITE_GEMINI_API_KEY}`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          contents: [\n            {\n              parts: [\n                {\n                  text: formattedPrompt,\n                },\n              ],\n            },\n          ],\n        }),\n      },\n    );\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    if (!data.candidates?.[0]?.content?.parts?.[0]?.text) {\n      throw new Error(\"Invalid response format from Gemini API\");\n    }\n\n    // Clean up the response to ensure proper formatting\n    let insights = data.candidates[0].content.parts[0].text;\n    insights = insights\n      .replace(/\\*\\*/g, \"\") // Remove any asterisks\n      .replace(/\\*\\s/g, \"- \") // Replace any remaining asterisk bullets with dashes\n      .replace(/\\d+\\.\\s/g, \"- \") // Replace numbered lists with bullet points\n      .replace(/^[0-9]\\./gm, \"-\") // Replace numbers at start of lines with dashes\n      .replace(/\\n\\n+/g, \"\\n\\n\") // Normalize line spacing\n      .replace(/\\n\\s*\\n/g, \"\\n\\n\") // Fix multiple blank lines\n      .trim();\n\n    return insights;\n  } catch (error) {\n    console.error(\"Error generating insights:\", error);\n    throw error;\n  }\n}\n\nexport async function storeMarketInsights(insights: string) {\n  const { error } = await supabase.from(\"market_insights\").insert([\n    {\n      content: insights,\n      generated_at: new Date().toISOString(),\n    },\n  ]);\n\n  if (error) throw error;\n}\n\nexport async function getLatestMarketInsights() {\n  try {\n    const { data, error } = await supabase\n      .from(\"market_insights\")\n      .select(\"*\")\n      .order(\"generated_at\", { ascending: false })\n      .limit(1)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data;\n  } catch (error) {\n    console.error(\"Error fetching market insights:\", error);\n    return null;\n  }\n}\n\nexport async function getRiskAssessment() {\n  try {\n    const response = await fetch(\n      `https://your-api-endpoint.com/risk-assessment?key=${import.meta.env.VITE_GEMINI_API_KEY}`\n    );\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const data = await response.json();\n    return data; // Ensure this returns a string or the expected format\n  } catch (error) {\n    console.error(\"Error fetching risk assessment:\", error);\n    return \"No risk assessment data available.\"; // Return a default message or value\n  }\n}\n\nexport async function getPersonalizedOpportunities() {\n  try {\n    const response = await fetch(\n      `https://your-api-endpoint.com/personalized-opportunities?key=${import.meta.env.VITE_GEMINI_API_KEY}`\n    );\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const data = await response.json();\n    return data; // Ensure this returns an array of opportunities\n  } catch (error) {\n    console.error(\"Error fetching personalized opportunities:\", error);\n    return []; // Return an empty array as a fallback\n  }\n}\n\nexport async function getPredictiveAnalytics() {\n  try {\n    const response = await fetch(\n      `https://your-api-endpoint.com/predictive-analytics?key=${import.meta.env.VITE_GEMINI_API_KEY}`\n    );\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const data = await response.json();\n    return data; // Ensure this returns the expected format\n  } catch (error) {\n    console.error(\"Error fetching predictive analytics:\", error);\n    return {}; // Return an empty object or default value\n  }\n}\n","import React from \"react\";\nimport HeroSection from \"./HeroSection\";\nimport { useAuth } from \"../lib/auth\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport {\n  Newspaper,\n  LineChart,\n  Building2,\n  Globe2,\n  AlertTriangle,\n} from \"lucide-react\";\nimport { Layout } from \"./Layout\";\nimport { PageTransition } from \"./ui/page-transition\";\nimport {\n  fetchPropertyNews,\n  generateMarketInsights,\n  getLatestMarketInsights,\n  storeMarketInsights,\n} from \"../lib/market-insights\";\n\nexport default function MarketInsightsPage() {\n  const { user: _, profile: __ } = useAuth();\n  const [news, setNews] = React.useState<any[]>([]);\n  const [insights, setInsights] = React.useState<string>(\"\");\n  const [loading, setLoading] = React.useState(true);\n  const [error, setError] = React.useState<string | null>(null);\n\n  React.useEffect(() => {\n    const loadData = async () => {\n      try {\n        const prompt = `Analyze the current UK property regulatory landscape and provide insights on:\n\n1. Latest Tax Law Changes\n- Recent changes to property-related taxes\n- Impact on investors and landlords\n- Upcoming tax proposals\n\n2. Landlord Regulations\n- Current licensing requirements\n- Tenant rights updates\n- Property safety regulations\n\n3. Government Policies\n- Recent policy changes affecting property\n- Proposed legislation\n- Regional variations\n\n4. Market Impact Analysis\n- How these changes affect property values\n- Impact on rental yields\n- Investment strategy adjustments\n\nProvide specific dates, numbers, and practical implications where possible.`;\n\n        const [newsData, latestInsights] = await Promise.all([\n          fetchPropertyNews(),\n          getLatestMarketInsights(),\n        ]);\n\n        setNews(newsData.slice(0, 8));\n\n        try {\n          if (\n            latestInsights &&\n            new Date(latestInsights.generated_at).getTime() >\n              Date.now() - 24 * 60 * 60 * 1000\n          ) {\n            setInsights(latestInsights.content);\n          } else {\n            const newInsights = await generateMarketInsights(prompt);\n            setInsights(newInsights);\n            await storeMarketInsights(newInsights);\n          }\n        } catch (error) {\n          console.error(\"Error generating market insights:\", error);\n          setInsights(\n            \"Unable to load market insights at this time. Please try again later.\",\n          );\n        }\n      } catch (error) {\n        console.error(\"Error loading market data:\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadData();\n  }, []);\n\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"Regulatory Updates & Market Insights\"\n          subtitle=\"Stay informed about the latest property regulations and policy changes\"\n          backgroundImage=\"https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3\"\n          showSearch={false}\n          showStats={false}\n          height=\"h-[400px]\"\n        />\n        <main className=\"container mx-auto px-4 py-8\">\n          <div className=\"max-w-7xl mx-auto space-y-8\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              <div className=\"lg:col-span-2\">\n                <Card>\n                  <CardHeader className=\"flex flex-row items-center gap-2\">\n                    <AlertTriangle className=\"w-5 h-5 text-red-500\" />\n                    <div className=\"flex items-center gap-2\">\n                      <h2 className=\"text-2xl font-semibold\">\n                        Regulatory Updates\n                      </h2>\n                      <span className=\"relative flex h-3 w-3\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-3 w-3 bg-red-500\"></span>\n                      </span>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    {loading ? (\n                      <div className=\"animate-pulse space-y-4\">\n                        <div className=\"h-4 bg-muted rounded w-3/4\" />\n                        <div className=\"h-4 bg-muted rounded w-1/2\" />\n                        <div className=\"h-4 bg-muted rounded w-5/6\" />\n                      </div>\n                    ) : (\n                      <div className=\"prose dark:prose-invert max-w-none\">\n                        {insights.split(\"\\n\").map((line, index) => {\n                          if (line.startsWith(\"## \")) {\n                            return (\n                              <h2\n                                key={index}\n                                className=\"text-xl font-semibold mt-6 mb-3\"\n                              >\n                                {line.replace(\"## \", \"\")}\n                              </h2>\n                            );\n                          } else if (line.startsWith(\"### \")) {\n                            return (\n                              <h3\n                                key={index}\n                                className=\"text-lg font-medium mt-4 mb-2\"\n                              >\n                                {line.replace(\"### \", \"\")}\n                              </h3>\n                            );\n                          } else if (line.startsWith(\"- \")) {\n                            return (\n                              <li key={index} className=\"ml-4\">\n                                {line.replace(\"- \", \"\")}\n                              </li>\n                            );\n                          } else if (line.trim() !== \"\") {\n                            return (\n                              <p key={index} className=\"mb-3\">\n                                {line}\n                              </p>\n                            );\n                          }\n                          return null;\n                        })}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"space-y-6\">\n                <Card>\n                  <CardHeader className=\"flex flex-row items-center gap-2\">\n                    <Newspaper className=\"w-5 h-5\" />\n                    <h2 className=\"text-xl font-semibold\">Latest Updates</h2>\n                  </CardHeader>\n                  <CardContent>\n                    {loading ? (\n                      <div className=\"animate-pulse space-y-4\">\n                        {[1, 2, 3].map((i) => (\n                          <div key={i} className=\"space-y-2\">\n                            <div className=\"h-4 bg-muted rounded w-3/4\" />\n                            <div className=\"h-3 bg-muted rounded w-1/2\" />\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"space-y-6\">\n                        {news.map((article, index) => (\n                          <div\n                            key={index}\n                            className=\"border-b last:border-0 pb-4 last:pb-0\"\n                          >\n                            <h3 className=\"font-medium mb-1 line-clamp-2\">\n                              {article.title}\n                            </h3>\n                            <p className=\"text-sm text-muted-foreground mb-2\">\n                              {article.description}\n                            </p>\n                            <div className=\"flex justify-between items-center text-xs text-muted-foreground\">\n                              <span>\n                                {new Date(\n                                  article.publishedAt,\n                                ).toLocaleDateString()}\n                              </span>\n                              <Button\n                                variant=\"ghost\"\n                                className=\"group hover:text-primary\"\n                              >\n                                Read More\n                              </Button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n          </div>\n        </main>\n      </Layout>\n    </PageTransition>\n  );\n}\n","import React from \"react\";\nimport HeroSection from \"./HeroSection\";\nimport { useAuth } from \"../lib/auth\";\nimport MarketTrends from \"./MarketTrends\";\nimport { Layout } from \"./Layout\";\nimport { PageTransition } from \"./ui/page-transition\";\n\nexport default function MarketTrendsPage() {\n  const { user: _, profile: __ } = useAuth();\n  const [loading, setLoading] = React.useState(true);\n\n  const trends = [\n    {\n      title: \"Average Home Price\",\n      value: \"450,000\",\n      change: \"+5.2%\",\n      isPositive: true,\n    },\n    {\n      title: \"Days on Market\",\n      value: \"28\",\n      change: \"-12%\",\n      isPositive: true,\n    },\n    {\n      title: \"Available Listings\",\n      value: \"1,234\",\n      change: \"-3.1%\",\n      isPositive: false,\n    },\n    {\n      title: \"Mortgage Rates\",\n      value: \"4.5%\",\n      change: \"+0.25%\",\n      isPositive: false,\n    },\n    {\n      title: \"Price per Sq Ft\",\n      value: \"375\",\n      change: \"+2.8%\",\n      isPositive: true,\n    },\n    {\n      title: \"New Listings\",\n      value: \"458\",\n      change: \"+15%\",\n      isPositive: true,\n    },\n  ];\n\n  const articles = [\n    {\n      title: \"Understanding the Current Real Estate Market\",\n      excerpt:\n        \"Get insights into the latest trends and what they mean for buyers and sellers.\",\n      date: \"2024-03-15\",\n    },\n    {\n      title: \"Top 5 Investment Opportunities in Real Estate\",\n      excerpt:\n        \"Discover the most promising areas for property investment in the current market.\",\n      date: \"2024-03-10\",\n    },\n    {\n      title: \"Real Estate Market Forecast 2024\",\n      excerpt:\n        \"Expert predictions and analysis for the upcoming year in real estate.\",\n      date: \"2024-03-05\",\n    },\n  ];\n\n  React.useEffect(() => {\n    // Simulate loading\n    setTimeout(() => setLoading(false), 1000);\n  }, []);\n\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"Market Trends & Statistics\"\n          subtitle=\"Track key market indicators and stay ahead of property market movements\"\n          backgroundImage=\"https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3\"\n          showSearch={false}\n          showStats={false}\n          height=\"h-[400px]\"\n        />\n        <MarketTrends />\n      </Layout>\n    </PageTransition>\n  );\n}\n","import React from \"react\";\nimport Header from \"./Header\";\nimport { useAuth } from \"../lib/auth\";\nimport { Card, CardContent } from \"./ui/card\";\nimport { Calendar, Clock } from \"lucide-react\";\n\ninterface ArticlePageProps {\n  title: string;\n  content: string;\n  date: string;\n  readTime?: string;\n}\n\nexport function ArticlePage({\n  title = \"Understanding the Current Real Estate Market\",\n  content = \"Default content\",\n  date = new Date().toISOString(),\n  readTime = \"5 min read\",\n}: ArticlePageProps) {\n  const { user, profile } = useAuth();\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header isAuthenticated={!!user} userProfile={profile || undefined} />\n      <main className=\"container mx-auto px-4 py-8 pt-24\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Card>\n            <CardContent className=\"p-8\">\n              <h1 className=\"text-3xl font-bold mb-4\">{title}</h1>\n\n              <div className=\"flex items-center gap-4 text-muted-foreground mb-8\">\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-4 h-4\" />\n                  <span>{new Date(date).toLocaleDateString()}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"w-4 h-4\" />\n                  <span>{readTime}</span>\n                </div>\n              </div>\n\n              <div className=\"prose dark:prose-invert max-w-none\">\n                {content.split(\"\\n\\n\").map((paragraph, index) => (\n                  <p key={index} className=\"mb-4\">\n                    {paragraph}\n                  </p>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport { ArrowRight, FileText, TrendingUp, BarChart, Lock } from \"lucide-react\";\n\ninterface ResearchReportsProps {\n  isPro?: boolean;\n}\n\nexport function ResearchReports({ isPro = false }: ResearchReportsProps) {\n  const articles = [\n    {\n      title: \"UK Property Market Analysis Q1 2024\",\n      excerpt:\n        \"Comprehensive analysis of the UK property market performance in Q1 2024, including price trends, regional variations, and future projections.\",\n      category: \"Market Analysis\",\n      date: \"2024-03-20\",\n      readTime: \"10 min read\",\n    },\n    {\n      title: \"Investment Opportunities in Northern Cities\",\n      excerpt:\n        \"Detailed research on emerging property investment opportunities in northern UK cities, with focus on yield potential and growth areas.\",\n      category: \"Investment Research\",\n      date: \"2024-03-18\",\n      readTime: \"8 min read\",\n    },\n    {\n      title: \"Impact of Interest Rates on Property Market\",\n      excerpt:\n        \"Analysis of how recent interest rate changes are affecting the property market, mortgage rates, and buyer behavior.\",\n      category: \"Economic Analysis\",\n      date: \"2024-03-15\",\n      readTime: \"12 min read\",\n    },\n    {\n      title: \"Rental Market Trends 2024\",\n      excerpt:\n        \"Latest trends in the UK rental market, including demand patterns, yield analysis, and regulatory changes.\",\n      category: \"Market Analysis\",\n      date: \"2024-03-12\",\n      readTime: \"7 min read\",\n    },\n    {\n      title: \"Sustainable Property Investment Guide\",\n      excerpt:\n        \"Comprehensive guide to sustainable property investment, including EPC regulations, green mortgages, and future-proofing investments.\",\n      category: \"Investment Research\",\n      date: \"2024-03-10\",\n      readTime: \"15 min read\",\n    },\n    {\n      title: \"Regional Property Price Forecast\",\n      excerpt:\n        \"Detailed forecast of property prices across UK regions, with analysis of key growth drivers and market indicators.\",\n      category: \"Market Analysis\",\n      date: \"2024-03-08\",\n      readTime: \"9 min read\",\n    },\n  ];\n\n  return (\n    <div className=\"py-8\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {articles.map((article, index) => (\n          <Card\n            key={index}\n            className=\"hover:shadow-lg transition-shadow relative overflow-hidden\"\n          >\n            <CardHeader className=\"flex flex-row items-center gap-2 pb-2\">\n              {article.category === \"Market Analysis\" ? (\n                <TrendingUp className=\"w-5 h-5 text-blue-500\" />\n              ) : article.category === \"Investment Research\" ? (\n                <BarChart className=\"w-5 h-5 text-green-500\" />\n              ) : (\n                <FileText className=\"w-5 h-5 text-purple-500\" />\n              )}\n              <span className=\"text-sm text-muted-foreground\">\n                {article.category}\n              </span>\n            </CardHeader>\n            <CardContent className=\"relative\">\n              <div className={!isPro ? \"blur-sm\" : \"\"}>\n                <h3 className=\"text-xl font-semibold mb-2\">{article.title}</h3>\n                <p className=\"text-muted-foreground mb-4\">{article.excerpt}</p>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"text-sm text-muted-foreground\">\n                    {new Date(article.date).toLocaleDateString()} {\" \"}\n                    {article.readTime}\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    className=\"group hover:text-primary\"\n                    onClick={() => {\n                      window.location.href = `/article/${encodeURIComponent(article.title)}`;\n                    }}\n                  >\n                    Read More\n                    <ArrowRight className=\"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform\" />\n                  </Button>\n                </div>\n              </div>\n              {!isPro && (\n                <div className=\"absolute inset-0 flex items-center justify-center bg-background/50 backdrop-blur-[2px]\">\n                  <div className=\"text-center p-6\">\n                    <Lock className=\"w-8 h-8 text-muted-foreground mx-auto mb-2\" />\n                    <p className=\"text-sm text-muted-foreground\">\n                      Upgrade to Pro to access research reports\n                    </p>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}\n","import { supabase } from \"./supabaseClient\";\n\nexport interface Deal {\n  id: string;\n  title: string;\n  description: string;\n  location: string;\n  price: number;\n  roi_percentage: number;\n  investment_term: string;\n  property_type: string;\n  deal_type: string;\n  image_url: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport const getDeals = async (page = 1, limit = 6) => {\n  try {\n    const start = (page - 1) * limit;\n    \n    console.log('Fetching deals with params:', { page, limit, start });\n    \n    const { data, error } = await supabase\n      .from('deals')\n      .select(`\n        id,\n        title,\n        description,\n        location,\n        price,\n        roi_percentage,\n        investment_term,\n        property_type,\n        deal_type,\n        image_url,\n        created_at,\n        updated_at\n      `)\n      .range(start, start + limit - 1)\n      .order('created_at', { ascending: false });\n\n    console.log('Raw Supabase response:', { data, error });\n\n    if (error) {\n      console.error('Supabase query error:', error.message, error);\n      throw new Error(`Failed to fetch deals: ${error.message}`);\n    }\n\n    if (!data || data.length === 0) {\n      console.log('No deals found in database');\n      return [];\n    }\n\n    // Transform the data to match our Deal interface\n    const transformedData = data.map(deal => ({\n      id: deal.id,\n      title: deal.title,\n      description: deal.description,\n      location: deal.location,\n      price: Number(deal.price),\n      roi_percentage: Number(deal.roi_percentage),\n      investment_term: deal.investment_term,\n      property_type: deal.property_type,\n      deal_type: deal.deal_type,\n      image_url: deal.image_url,\n      created_at: deal.created_at,\n      updated_at: deal.updated_at\n    }));\n\n    console.log('Transformed deals:', transformedData);\n    return transformedData;\n  } catch (error) {\n    console.error('Error in getDeals:', error instanceof Error ? error.message : error);\n    throw error;\n  }\n};\n\nexport const searchDeals = async (searchTerm: string): Promise<Deal[]> => {\n  console.log('Searching deals with term:', searchTerm);\n  const term = searchTerm.toLowerCase().trim();\n\n  const { data, error } = await supabase\n    .from('deals')\n    .select(`\n      id,\n      title,\n      description,\n      location,\n      price,\n      roi_percentage,\n      investment_term,\n      property_type,\n      deal_type,\n      image_url,\n      created_at,\n      updated_at\n    `)\n    .or(\n      `title.ilike.%${term}%,` +\n      `description.ilike.%${term}%,` +\n      `location.ilike.%${term}%,` +\n      `property_type.ilike.%${term}%,` +\n      `deal_type.ilike.%${term}%`\n    )\n    .order('created_at', { ascending: false });\n\n    console.log('Search response:', { data, error });\n\n    if (error) {\n      console.error('Error searching deals:', error);\n      return [];\n    }\n\n    return data.map(deal => ({\n      id: deal.id,\n      title: deal.title,\n      description: deal.description,\n      location: deal.location,\n      price: Number(deal.price),\n      roi_percentage: Number(deal.roi_percentage),\n      investment_term: deal.investment_term,\n      property_type: deal.property_type,\n      deal_type: deal.deal_type,\n      image_url: deal.image_url,\n      created_at: deal.created_at,\n      updated_at: deal.updated_at\n    }));\n};\n\nexport const getDeal = async (id: string): Promise<Deal | null> => {\n  try {\n    // First verify the user is authenticated\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      throw new Error('Not authenticated');\n    }\n\n    console.log('Fetching deal:', id);\n\n    const { data: deal, error } = await supabase\n      .from('deals')\n      .select(`\n        *,\n        author:profiles!deals_created_by_fkey(full_name)\n      `)\n      .eq('id', id)\n      .single();\n\n    console.log('Deal fetch result:', { deal, error });\n\n    if (error) {\n      console.error('Error fetching deal:', error);\n      return null;\n    }\n\n    if (!deal) return null;\n\n    // Transform the data\n    return {\n      ...deal,\n      images: Array.isArray(deal.images) ? deal.images : [deal.images].filter(Boolean),\n      location: typeof deal.location === 'string' ? JSON.parse(deal.location) : (deal.location || {}),\n      key_features: Array.isArray(deal.key_features) ? deal.key_features : [],\n      sensitive_info: deal.sensitive_info\n    };\n  } catch (error) {\n    console.error('Error fetching deal:', error);\n    return null;\n  }\n}; ","import { cn } from \"../../lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport function PropertyCardSkeleton() {\n  return (\n    <div className=\"overflow-hidden rounded-lg border bg-card\">\n      <Skeleton className=\"aspect-video w-full\" />\n      <div className=\"p-6 space-y-4\">\n        <Skeleton className=\"h-6 w-3/4\" />\n        <Skeleton className=\"h-4 w-1/2\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-full\" />\n          <Skeleton className=\"h-4 w-5/6\" />\n        </div>\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <Skeleton className=\"h-4 w-20 mb-1\" />\n            <Skeleton className=\"h-6 w-24\" />\n          </div>\n          <div>\n            <Skeleton className=\"h-4 w-20 mb-1\" />\n            <Skeleton className=\"h-6 w-24\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport { Skeleton }\n","import React, { useState } from \"react\";\nimport { Deal } from \"../lib/deals\";\nimport { formatCurrency } from \"../lib/utils\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Badge } from \"./ui/badge\";\nimport { MapPin, MessageCircle } from \"lucide-react\";\nimport { useAuth } from \"../lib/auth\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Button } from \"./ui/button\";\nimport { MessagesModal } from \"./MessagesModal\";\nimport { PropertyCardSkeleton } from \"./ui/skeleton\";\n\ninterface DealCardProps {\n  deal: Deal;\n  isSubscriber: boolean;\n  onClick?: () => void;\n  isLoading?: boolean;\n}\n\nexport function DealCard({ deal, isSubscriber, onClick, isLoading }: DealCardProps) {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [isMessageModalOpen, setIsMessageModalOpen] = useState(false);\n  \n  if (isLoading) {\n    return <PropertyCardSkeleton />;\n  }\n\n  const handleMessageClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!user) {\n      navigate('/login');\n      return;\n    }\n    setIsMessageModalOpen(true);\n  };\n\n  return (\n    <>\n      <Card \n        className=\"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer\"\n        onClick={user ? onClick : () => navigate('/login')}\n      >\n        <div className=\"relative aspect-video overflow-hidden bg-muted\">\n          <img\n            src={deal.image_url}\n            alt={deal.title}\n            className=\"object-cover w-full h-full\"\n            loading=\"lazy\"\n          />\n          {!user && (\n            <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\n              <Badge variant=\"secondary\">Sign in to View</Badge>\n            </div>\n          )}\n          <div className=\"absolute top-2 right-2 flex gap-2\">\n            <Badge variant=\"secondary\" className=\"bg-white/90 text-black hover:bg-white/75\">\n              {deal.property_type}\n            </Badge>\n            <Badge variant=\"secondary\" className=\"bg-primary/90 text-white hover:bg-primary/75\">\n              {deal.deal_type}\n            </Badge>\n          </div>\n        </div>\n\n        <CardHeader>\n          <div>\n            <h3 className=\"text-lg font-semibold line-clamp-2 mb-2\">{deal.title}</h3>\n            <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n              <MapPin className=\"h-4 w-4\" />\n              <span className=\"line-clamp-1\">{deal.location}</span>\n            </div>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-muted-foreground line-clamp-2\">\n              {deal.description}\n            </p>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-muted-foreground\">Price</p>\n                <p className=\"text-lg font-semibold\">{formatCurrency(deal.price)}</p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-muted-foreground\">ROI</p>\n                <p className=\"text-lg font-semibold text-emerald-500\">\n                  {deal.roi_percentage}%\n                </p>\n              </div>\n            </div>\n            \n            <div className=\"pt-2 border-t\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Investment Term</p>\n                  <p className=\"font-medium\">{deal.investment_term}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">Expected Returns</p>\n                  <p className=\"font-medium text-emerald-500\">High Yield</p>\n                </div>\n              </div>\n            </div>\n\n            {user && (\n              <Button\n                variant=\"outline\"\n                className=\"w-full\"\n                onClick={handleMessageClick}\n              >\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\n                Enquire About This Deal\n              </Button>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      <MessagesModal\n        isOpen={isMessageModalOpen}\n        onClose={() => setIsMessageModalOpen(false)}\n        receiverId=\"admin\"\n        dealId={deal.id}\n        deal={deal}\n      />\n    </>\n  );\n} ","import React, { useEffect, useState } from \"react\";\nimport HeroSection from \"./HeroSection\";\nimport { useAuth } from \"../lib/auth\";\nimport { ResearchReports } from \"./ResearchReports\";\nimport { PageTransition } from \"./ui/page-transition\";\nimport { Button } from \"./ui/button\";\nimport { SubscriptionModal } from \"./SubscriptionModal\";\nimport { getDeals } from '../lib/deals';\nimport { DealCard } from './DealCard';\nimport { useNavigate } from 'react-router-dom';\nimport type { Deal } from '../lib/deals';\nimport { Layout } from \"./Layout\";\n\nexport default function ResearchPage() {\n  const { user, profile, isLoading } = useAuth();\n  const navigate = useNavigate();\n  const [deals, setDeals] = useState<Deal[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isSubscriptionModalOpen, setIsSubscriptionModalOpen] =\n    React.useState(false);\n\n  // Remove the subscription check for now\n  const isPro = true; // Temporarily allow access to all users\n\n  useEffect(() => {\n    let mounted = true;\n\n    async function loadDeals() {\n      try {\n        const dealsData = await getDeals();\n        if (mounted) {\n          setDeals(dealsData);\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error('Error loading deals:', error);\n        if (mounted) {\n          setLoading(false);\n        }\n      }\n    }\n\n    // Only load deals if we have a user and they're not in a loading state\n    if (user && !isLoading) {\n      loadDeals();\n    } else if (!isLoading && !user) {\n      navigate('/login');\n    }\n\n    return () => {\n      mounted = false;\n    };\n  }, [user, isLoading, navigate]);\n\n  // Show loading state while checking auth\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div>Loading...</div>\n      </div>\n    );\n  }\n\n  // If no user, don't render anything (navigation will handle redirect)\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <Layout>\n      <PageTransition>\n        <div className=\"min-h-screen bg-neutral\">\n          <HeroSection\n            title=\"Research & Analysis\"\n            subtitle=\"Discover in-depth market insights and property analysis\"\n            showSearch={false}\n            showStats={false}\n            height=\"h-[400px]\"\n            image=\"/research-hero.jpg\"\n          />\n          <main className=\"container mx-auto px-4 py-8\">\n            <div className=\"max-w-7xl mx-auto space-y-8\">\n              <div className=\"text-center mb-12\">\n                <h1 className=\"text-4xl font-bold mb-4 text-primary\">Latest Research</h1>\n                <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n                  Stay informed with our comprehensive research reports and expert\n                  analysis\n                </p>\n              </div>\n              {isPro ? (\n                <ResearchReports isPro={isPro} />\n              ) : (\n                <div className=\"text-center py-12\">\n                  <h2 className=\"text-2xl font-semibold mb-4 text-accent\">\n                    Pro Plan Required\n                  </h2>\n                  <p className=\"text-muted-foreground mb-6\">\n                    Access to research reports is available exclusively to Pro and\n                    Premium subscribers.\n                  </p>\n                  <Button onClick={() => setIsSubscriptionModalOpen(true)} className=\"bg-primary text-white\">\n                    Upgrade to Pro\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {loading ? (\n              <div className=\"text-center py-8\">Loading deals...</div>\n            ) : (\n              <div className=\"mt-12\">\n                <h2 className=\"text-2xl font-bold mb-6\">Latest Deals</h2>\n                <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n                  {deals.map((deal) => (\n                    <DealCard \n                      key={deal.id} \n                      deal={deal}\n                      isSubscriber={profile?.subscription_tier !== 'free'}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </main>\n\n          <SubscriptionModal\n            isOpen={isSubscriptionModalOpen}\n            onClose={() => setIsSubscriptionModalOpen(false)}\n          />\n        </div>\n      </PageTransition>\n    </Layout>\n  );\n}\n","import React from \"react\";\nimport { Layout } from \"./Layout\";\nimport HeroSection from \"./HeroSection\";\nimport { useAuth } from \"../lib/auth\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport { ArrowRight, Calendar, Clock, Tag } from \"lucide-react\";\nimport { PageTransition } from \"./ui/page-transition\";\n\nexport default function BlogPage() {\n  const { user: _, profile: __ } = useAuth();\n\n  const blogPosts = [\n    {\n      title: \"Understanding Property Market Cycles\",\n      excerpt:\n        \"A comprehensive guide to property market cycles and how to identify market phases for optimal investment timing.\",\n      category: \"Market Analysis\",\n      date: \"2024-03-20\",\n      readTime: \"8 min read\",\n      image:\n        \"https://images.unsplash.com/photo-1460472178825-e5240623afd5?ixlib=rb-4.0.3\",\n    },\n    {\n      title: \"Buy-to-Let Investment Strategy Guide\",\n      excerpt:\n        \"Expert insights into creating a successful buy-to-let investment strategy in today's market conditions.\",\n      category: \"Investment\",\n      date: \"2024-03-18\",\n      readTime: \"10 min read\",\n      image:\n        \"https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3\",\n    },\n    {\n      title: \"Property Tax Changes in 2024\",\n      excerpt:\n        \"Stay updated with the latest property tax regulations and how they affect property investors and homeowners.\",\n      category: \"Legal\",\n      date: \"2024-03-15\",\n      readTime: \"6 min read\",\n      image:\n        \"https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3\",\n    },\n  ];\n\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"Property Investment Blog\"\n          subtitle=\"Expert insights and analysis on the UK property market\"\n          backgroundImage=\"https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3\"\n          showSearch={false}\n          showStats={false}\n          height=\"h-[400px]\"\n        />\n        <main className=\"container mx-auto px-4 py-8 pt-24 sm:pt-8\">\n          <div className=\"max-w-7xl mx-auto space-y-8\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {blogPosts.map((post, index) => (\n                <Card\n                  key={index}\n                  className=\"flex flex-col h-full hover:shadow-lg transition-shadow\"\n                >\n                  <div className=\"relative h-48 w-full overflow-hidden rounded-t-lg\">\n                    <img\n                      src={post.image}\n                      alt={post.title}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  </div>\n                  <CardHeader className=\"flex flex-row items-center gap-2\">\n                    <Tag className=\"w-4 h-4\" />\n                    <span className=\"text-sm text-muted-foreground\">\n                      {post.category}\n                    </span>\n                  </CardHeader>\n                  <CardContent className=\"flex-1 flex flex-col\">\n                    <h3 className=\"text-xl font-semibold mb-2\">{post.title}</h3>\n                    <p className=\"text-muted-foreground mb-4 flex-1\">\n                      {post.excerpt}\n                    </p>\n                    <div className=\"flex items-center justify-between mt-4\">\n                      <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          <span>\n                            {new Date(post.date).toLocaleDateString()}\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Clock className=\"w-4 h-4\" />\n                          <span>{post.readTime}</span>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        className=\"group hover:text-primary\"\n                        onClick={() => {\n                          window.location.href = `/blog/${post.title.toLowerCase().replace(/ /g, \"-\")}`;\n                        }}\n                      >\n                        Read More\n                        <ArrowRight className=\"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform\" />\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </main>\n      </Layout>\n    </PageTransition>\n  );\n}\n","import React from \"react\";\nimport Header from \"./Header\";\nimport HeroSection from \"./HeroSection\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Input } from \"./ui/input\";\nimport { Label } from \"./ui/label\";\nimport { Button } from \"./ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"./ui/tabs\";\nimport { Calculator, Home, Building, Percent, TrendingUp } from \"lucide-react\";\nimport { useAuth } from \"../lib/auth\";\nimport { Footer } from \"./Footer\";\n\nexport default function InvestmentCalculator() {\n  const { user, profile } = useAuth();\n  const [mortgageResult, setMortgageResult] = React.useState<number | null>(\n    null,\n  );\n  const [buyToLetResult, setBuyToLetResult] = React.useState<number | null>(\n    null,\n  );\n  const [developmentResult, setDevelopmentResult] = React.useState<\n    number | null\n  >(null);\n  const [rentalYieldResult, setRentalYieldResult] = React.useState<\n    number | null\n  >(null);\n  const [roiResult, setRoiResult] = React.useState<number | null>(null);\n\n  const [mortgageData, setMortgageData] = React.useState({\n    propertyPrice: \"\",\n    deposit: \"\",\n    interestRate: \"\",\n    term: \"\",\n  });\n\n  const [buyToLetData, setBuyToLetData] = React.useState({\n    propertyPrice: \"\",\n    deposit: \"\",\n    interestRate: \"\",\n    rentalIncome: \"\",\n  });\n\n  const [developmentData, setDevelopmentData] = React.useState({\n    purchasePrice: \"\",\n    renovationCost: \"\",\n    expectedSalePrice: \"\",\n    otherCosts: \"\",\n  });\n\n  const [rentalYieldData, setRentalYieldData] = React.useState({\n    propertyPrice: \"\",\n    annualRent: \"\",\n  });\n\n  const [roiData, setRoiData] = React.useState({\n    totalInvestment: \"\",\n    annualReturn: \"\",\n  });\n\n  const calculateMortgage = () => {\n    const P =\n      parseFloat(mortgageData.propertyPrice) - parseFloat(mortgageData.deposit);\n    const r = parseFloat(mortgageData.interestRate) / 100 / 12;\n    const n = parseFloat(mortgageData.term) * 12;\n    const monthlyPayment =\n      (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);\n    setMortgageResult(monthlyPayment);\n  };\n\n  const calculateBuyToLet = () => {\n    const loanAmount =\n      parseFloat(buyToLetData.propertyPrice) - parseFloat(buyToLetData.deposit);\n    const monthlyInterest =\n      (loanAmount * (parseFloat(buyToLetData.interestRate) / 100)) / 12;\n    const monthlyRental = parseFloat(buyToLetData.rentalIncome);\n    const monthlyCashflow = monthlyRental - monthlyInterest;\n    setBuyToLetResult(monthlyCashflow);\n  };\n\n  const calculateDevelopment = () => {\n    const totalCosts =\n      parseFloat(developmentData.purchasePrice) +\n      parseFloat(developmentData.renovationCost) +\n      parseFloat(developmentData.otherCosts);\n    const profit = parseFloat(developmentData.expectedSalePrice) - totalCosts;\n    setDevelopmentResult(profit);\n  };\n\n  const calculateRentalYield = () => {\n    const yield_ =\n      (parseFloat(rentalYieldData.annualRent) /\n        parseFloat(rentalYieldData.propertyPrice)) *\n      100;\n    setRentalYieldResult(yield_);\n  };\n\n  const calculateROI = () => {\n    const roi =\n      (parseFloat(roiData.annualReturn) / parseFloat(roiData.totalInvestment)) *\n      100;\n    setRoiResult(roi);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header isAuthenticated={!!user} userProfile={profile || undefined} />\n      <HeroSection\n        title=\"Property Investment Calculators\"\n        subtitle=\"Make informed decisions with our comprehensive suite of property investment calculators\"\n        backgroundImage=\"https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3\"\n        showSearch={false}\n        showStats={false}\n        height=\"h-[400px]\"\n      />\n      <main className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto space-y-8\">\n          <div className=\"text-center\">\n            <h1 className=\"text-3xl font-bold mb-2\">Investment Calculators</h1>\n            <p className=\"text-muted-foreground\">\n              Calculate different aspects of your property investment\n            </p>\n          </div>\n\n          <Tabs defaultValue=\"mortgage\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-5\">\n              <TabsTrigger value=\"mortgage\" className=\"flex items-center gap-2\">\n                <Home className=\"w-4 h-4\" /> Mortgage\n              </TabsTrigger>\n              <TabsTrigger value=\"buytolet\" className=\"flex items-center gap-2\">\n                <Building className=\"w-4 h-4\" /> Buy to Let\n              </TabsTrigger>\n              <TabsTrigger\n                value=\"development\"\n                className=\"flex items-center gap-2\"\n              >\n                <Calculator className=\"w-4 h-4\" /> Development\n              </TabsTrigger>\n              <TabsTrigger\n                value=\"rentalyield\"\n                className=\"flex items-center gap-2\"\n              >\n                <Percent className=\"w-4 h-4\" /> Rental Yield\n              </TabsTrigger>\n              <TabsTrigger value=\"roi\" className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-4 h-4\" /> ROI\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"mortgage\">\n              <Card>\n                <CardHeader>\n                  <h2 className=\"text-2xl font-semibold\">\n                    Mortgage Calculator\n                  </h2>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Property Price ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={mortgageData.propertyPrice}\n                        onChange={(e) =>\n                          setMortgageData({\n                            ...mortgageData,\n                            propertyPrice: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Deposit ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={mortgageData.deposit}\n                        onChange={(e) =>\n                          setMortgageData({\n                            ...mortgageData,\n                            deposit: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Interest Rate (%)</Label>\n                      <Input\n                        type=\"number\"\n                        value={mortgageData.interestRate}\n                        onChange={(e) =>\n                          setMortgageData({\n                            ...mortgageData,\n                            interestRate: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Term (Years)</Label>\n                      <Input\n                        type=\"number\"\n                        value={mortgageData.term}\n                        onChange={(e) =>\n                          setMortgageData({\n                            ...mortgageData,\n                            term: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                  </div>\n                  <Button onClick={calculateMortgage} className=\"w-full\">\n                    Calculate\n                  </Button>\n                  {mortgageResult !== null && (\n                    <div className=\"mt-4 p-4 bg-primary/10 rounded-lg\">\n                      <p className=\"text-lg font-semibold\">\n                        Monthly Payment: {mortgageResult.toFixed(2)}\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"buytolet\">\n              <Card>\n                <CardHeader>\n                  <h2 className=\"text-2xl font-semibold\">\n                    Buy to Let Calculator\n                  </h2>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Property Price ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={buyToLetData.propertyPrice}\n                        onChange={(e) =>\n                          setBuyToLetData({\n                            ...buyToLetData,\n                            propertyPrice: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Deposit ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={buyToLetData.deposit}\n                        onChange={(e) =>\n                          setBuyToLetData({\n                            ...buyToLetData,\n                            deposit: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Interest Rate (%)</Label>\n                      <Input\n                        type=\"number\"\n                        value={buyToLetData.interestRate}\n                        onChange={(e) =>\n                          setBuyToLetData({\n                            ...buyToLetData,\n                            interestRate: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Monthly Rental Income ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={buyToLetData.rentalIncome}\n                        onChange={(e) =>\n                          setBuyToLetData({\n                            ...buyToLetData,\n                            rentalIncome: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                  </div>\n                  <Button onClick={calculateBuyToLet} className=\"w-full\">\n                    Calculate\n                  </Button>\n                  {buyToLetResult !== null && (\n                    <div className=\"mt-4 p-4 bg-primary/10 rounded-lg\">\n                      <p className=\"text-lg font-semibold\">\n                        Monthly Cashflow: {buyToLetResult.toFixed(2)}\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"development\">\n              <Card>\n                <CardHeader>\n                  <h2 className=\"text-2xl font-semibold\">\n                    Development Calculator\n                  </h2>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Purchase Price ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={developmentData.purchasePrice}\n                        onChange={(e) =>\n                          setDevelopmentData({\n                            ...developmentData,\n                            purchasePrice: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Renovation Cost ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={developmentData.renovationCost}\n                        onChange={(e) =>\n                          setDevelopmentData({\n                            ...developmentData,\n                            renovationCost: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Expected Sale Price ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={developmentData.expectedSalePrice}\n                        onChange={(e) =>\n                          setDevelopmentData({\n                            ...developmentData,\n                            expectedSalePrice: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Other Costs ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={developmentData.otherCosts}\n                        onChange={(e) =>\n                          setDevelopmentData({\n                            ...developmentData,\n                            otherCosts: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                  </div>\n                  <Button onClick={calculateDevelopment} className=\"w-full\">\n                    Calculate\n                  </Button>\n                  {developmentResult !== null && (\n                    <div className=\"mt-4 p-4 bg-primary/10 rounded-lg\">\n                      <p className=\"text-lg font-semibold\">\n                        Expected Profit: {developmentResult.toFixed(2)}\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"rentalyield\">\n              <Card>\n                <CardHeader>\n                  <h2 className=\"text-2xl font-semibold\">\n                    Rental Yield Calculator\n                  </h2>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Property Price ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={rentalYieldData.propertyPrice}\n                        onChange={(e) =>\n                          setRentalYieldData({\n                            ...rentalYieldData,\n                            propertyPrice: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Annual Rental Income ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={rentalYieldData.annualRent}\n                        onChange={(e) =>\n                          setRentalYieldData({\n                            ...rentalYieldData,\n                            annualRent: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                  </div>\n                  <Button onClick={calculateRentalYield} className=\"w-full\">\n                    Calculate\n                  </Button>\n                  {rentalYieldResult !== null && (\n                    <div className=\"mt-4 p-4 bg-primary/10 rounded-lg\">\n                      <p className=\"text-lg font-semibold\">\n                        Rental Yield: {rentalYieldResult.toFixed(2)}%\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"roi\">\n              <Card>\n                <CardHeader>\n                  <h2 className=\"text-2xl font-semibold\">ROI Calculator</h2>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Total Investment ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={roiData.totalInvestment}\n                        onChange={(e) =>\n                          setRoiData({\n                            ...roiData,\n                            totalInvestment: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>Annual Return ()</Label>\n                      <Input\n                        type=\"number\"\n                        value={roiData.annualReturn}\n                        onChange={(e) =>\n                          setRoiData({\n                            ...roiData,\n                            annualReturn: e.target.value,\n                          })\n                        }\n                      />\n                    </div>\n                  </div>\n                  <Button onClick={calculateROI} className=\"w-full\">\n                    Calculate\n                  </Button>\n                  {roiResult !== null && (\n                    <div className=\"mt-4 p-4 bg-primary/10 rounded-lg\">\n                      <p className=\"text-lg font-semibold\">\n                        ROI: {roiResult.toFixed(2)}%\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","import React from \"react\";\nimport { Card, CardContent, CardHeader } from \"./ui/card\";\nimport { Button } from \"./ui/button\";\nimport { Input } from \"./ui/input\";\nimport { Label } from \"./ui/label\";\nimport { Textarea } from \"./ui/textarea\";\nimport {\n  Mail,\n  Phone,\n  MessageCircle,\n  FileText,\n  HelpCircle,\n  Book,\n} from \"lucide-react\";\nimport { Layout } from \"./Layout\";\nimport HeroSection from \"./HeroSection\";\nimport { PageTransition } from \"./ui/page-transition\";\n\nexport default function HelpSupportPage() {\n  const supportCategories = [\n    {\n      title: \"Getting Started\",\n      icon: <Book className=\"w-5 h-5\" />,\n      description: \"Learn the basics of using our platform\",\n      content: [\n        \"How to search for properties\",\n        \"Understanding market insights\",\n        \"Setting up your account\",\n        \"Subscription plans overview\",\n      ],\n    },\n    {\n      title: \"Account & Billing\",\n      icon: <FileText className=\"w-5 h-5\" />,\n      description: \"Manage your account and subscription\",\n      content: [\n        \"Updating account details\",\n        \"Subscription management\",\n        \"Billing history\",\n        \"Payment methods\",\n      ],\n    },\n    {\n      title: \"Technical Support\",\n      icon: <HelpCircle className=\"w-5 h-5\" />,\n      description: \"Get help with technical issues\",\n      content: [\n        \"Troubleshooting guide\",\n        \"System requirements\",\n        \"Known issues\",\n        \"Browser compatibility\",\n      ],\n    },\n  ];\n\n  const contactMethods = [\n    {\n      icon: <Mail className=\"w-5 h-5\" />,\n      title: \"Email Support\",\n      description: \"Get help via email\",\n      action: \"support@myvge.co.uk\",\n      buttonText: \"Send Email\",\n      onClick: () => (window.location.href = \"mailto:support@myvge.co.uk\"),\n    },\n    {\n      icon: <Phone className=\"w-5 h-5\" />,\n      title: \"Phone Support\",\n      description: \"Speak to our team\",\n      action: \"0800 123 4567\",\n      buttonText: \"Call Now\",\n      onClick: () => (window.location.href = \"tel:08001234567\"),\n    },\n    {\n      icon: <MessageCircle className=\"w-5 h-5\" />,\n      title: \"Live Chat\",\n      description: \"Chat with our support team\",\n      action: \"Available 24/7\",\n      buttonText: \"Start Chat\",\n      onClick: () => {\n        const event = new CustomEvent(\"open-messages\", {\n          detail: { receiverId: \"support\" },\n        });\n        window.dispatchEvent(event);\n      },\n    },\n  ];\n\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"Help & Support Center\"\n          subtitle=\"Get the assistance you need with our comprehensive support resources\"\n          backgroundImage=\"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-4.0.3\"\n          showSearch={false}\n          showStats={false}\n          height=\"h-[400px]\"\n        />\n        <main className=\"container mx-auto px-4 py-8\">\n          <div className=\"max-w-7xl mx-auto space-y-12\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              {supportCategories.map((category, index) => (\n                <Card key={index} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader className=\"flex flex-row items-center gap-2\">\n                    {category.icon}\n                    <div>\n                      <h3 className=\"font-semibold\">{category.title}</h3>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {category.description}\n                      </p>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <ul className=\"space-y-2\">\n                      {category.content.map((item, i) => (\n                        <li key={i} className=\"text-sm\">\n                           {item}\n                        </li>\n                      ))}\n                    </ul>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n            <div className=\"bg-card shadow rounded-lg p-8\">\n              <div className=\"text-center mb-8\">\n                <h2 className=\"text-2xl font-bold mb-2\">Contact Support</h2>\n                <p className=\"text-muted-foreground\">\n                  Choose your preferred method of contact\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                {contactMethods.map((method, index) => (\n                  <Card\n                    key={index}\n                    className=\"hover:shadow-lg transition-shadow\"\n                  >\n                    <CardContent className=\"p-6 text-center\">\n                      <div className=\"mb-4 flex justify-center\">\n                        {method.icon}\n                      </div>\n                      <h3 className=\"font-semibold mb-2\">{method.title}</h3>\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        {method.description}\n                      </p>\n                      <p className=\"text-sm font-medium mb-4\">\n                        {method.action}\n                      </p>\n                      <Button onClick={method.onClick} className=\"w-full\">\n                        {method.buttonText}\n                      </Button>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          </div>\n        </main>\n      </Layout>\n    </PageTransition>\n  );\n}\n","import React from \"react\";\nimport { Button } from \"./ui/button\";\nimport { Input } from \"./ui/input\";\nimport { Tabs, TabsContent } from \"./ui/tabs\";\nimport {\n  MessageCircle,\n  Send,\n  X,\n  Users,\n} from \"lucide-react\";\nimport { popularQuestions } from \"../lib/chat\";\nimport { useAuth } from \"../lib/auth\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"./ui/avatar\";\nimport { supabase } from \"../lib/supabase\";\nimport { useNavigate } from \"react-router-dom\";\n\ninterface Message {\n  text: string;\n  isUser: boolean;\n  sender?: {\n    full_name: string;\n    email: string;\n  };\n  timestamp?: string;\n}\n\ninterface Contact {\n  id: string;\n  full_name: string;\n  email: string;\n  last_message?: string;\n  unread_count?: number;\n}\n\nconst formatMessage = (text: string) => {\n  // Replace **bold** with styled spans\n  let formattedText = text.replace(\n    /\\*\\*(.*?)\\*\\*/g,\n    '<span class=\"font-bold\">$1</span>'\n  );\n  \n  // Replace *italic* with styled spans\n  formattedText = formattedText.replace(\n    /\\*(.*?)\\*/g,\n    '<span class=\"italic\">$1</span>'\n  );\n  \n  // Replace bullet points\n  formattedText = formattedText.replace(\n    /^- (.+)$/gm,\n    '<span class=\"block ml-2\"> $1</span>'\n  );\n  \n  // Replace numbered lists\n  formattedText = formattedText.replace(\n    /^\\d+\\. (.+)$/gm,\n    '<span class=\"block ml-2\">$&</span>'\n  );\n\n  // Split by newlines and wrap in spans\n  return formattedText.split('\\n').map((line) => (\n    line ? `<span class=\"block\">${line}</span>` : '<span class=\"block h-2\"></span>'\n  )).join('');\n};\n\nconst GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;\nconst GEMINI_API_URL = \"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\";\n\nexport function ChatBot() {\n  const { user, profile } = useAuth();\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [activeTab, setActiveTab] = React.useState(\"ai\");\n  const [aiMessages, setAiMessages] = React.useState<Message[]>([]);\n  const [supportMessages, setSupportMessages] = React.useState<Message[]>([]);\n  const [directMessages, setDirectMessages] = React.useState<Message[]>([]);\n  const [input, setInput] = React.useState(\"\");\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [contacts, setContacts] = React.useState<Contact[]>([]);\n  const [selectedContact, setSelectedContact] = React.useState<Contact | null>(\n    null,\n  );\n  const scrollRef = React.useRef<HTMLDivElement>(null);\n  const navigate = useNavigate();\n\n  // Load contacts for direct messaging\n  React.useEffect(() => {\n    if (user) {\n      loadContacts();\n\n      // Listen for open-messages event\n      const handleOpenMessages = (e: CustomEvent) => {\n        setIsOpen(true);\n        setActiveTab(\"messages\");\n        const receiverId = e.detail.receiverId;\n        const contact = contacts.find((c) => c.id === receiverId);\n        if (contact) {\n          setSelectedContact(contact);\n        }\n      };\n\n      window.addEventListener(\n        \"open-messages\",\n        handleOpenMessages as EventListener,\n      );\n      return () =>\n        window.removeEventListener(\n          \"open-messages\",\n          handleOpenMessages as EventListener,\n        );\n    }\n  }, [user, contacts]);\n\n  const loadContacts = async () => {\n    try {\n      const { data: messages } = await supabase\n        .from(\"messages\")\n        .select(\n          `\n          *,\n          sender:profiles!messages_sender_id_fkey(id, full_name, email),\n          receiver:profiles!messages_receiver_id_fkey(id, full_name, email)\n        `,\n        )\n        .or(`sender_id.eq.${user?.id},receiver_id.eq.${user?.id}`)\n        .order(\"created_at\", { ascending: false });\n\n      if (!messages) return;\n\n      // Create unique contacts list\n      const uniqueContacts = new Map<string, Contact>();\n      messages.forEach((msg) => {\n        const contact = msg.sender.id === user?.id ? msg.receiver : msg.sender;\n        if (!uniqueContacts.has(contact.id)) {\n          uniqueContacts.set(contact.id, {\n            id: contact.id,\n            full_name: contact.full_name,\n            email: contact.email,\n            last_message: msg.content,\n            unread_count: msg.receiver_id === user?.id && !msg.is_read ? 1 : 0,\n          });\n        }\n      });\n\n      setContacts(Array.from(uniqueContacts.values()));\n    } catch (error) {\n      console.error(\"Error loading contacts:\", error);\n    }\n  };\n\n  const handleSend = async (text: string) => {\n    if (!text.trim()) return;\n\n    if (activeTab === \"ai\") {\n      // AI chat allowed without sign in\n      setAiMessages((prev) => [...prev, { text, isUser: true }]);\n      setInput(\"\");\n      setIsLoading(true);\n\n      try {\n        // Get AI response without storing in database\n        const aiResponse = await fetch(\n          `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,\n          {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n              contents: [{\n                parts: [{\n                  text: text\n                }]\n              }]\n            }),\n          }\n        );\n\n        if (!aiResponse.ok) {\n          throw new Error(`AI API error: ${aiResponse.status}`);\n        }\n\n        const aiData = await aiResponse.json();\n        const response = aiData.candidates[0].content.parts[0].text;\n\n        // Only store messages if user is signed in\n        if (user) {\n          const conversationId = `ai_${user.id}_${Date.now()}`;\n          \n          await supabase.from(\"messages\").insert([\n            {\n              sender_id: user.id,\n              receiver_id: user.id,\n              content: text,\n              is_support: false,\n              conversation_id: conversationId\n            },\n            {\n              sender_id: null,\n              receiver_id: user.id,\n              content: response,\n              is_support: true,\n              conversation_id: conversationId\n            }\n          ]);\n        }\n\n        setAiMessages((prev) => [...prev, { text: response, isUser: false }]);\n      } catch (error) {\n        console.error(\"Error in AI chat:\", error);\n        setAiMessages((prev) => [\n          ...prev,\n          { text: \"Sorry, I encountered an error. Please try again.\", isUser: false }\n        ]);\n      } finally {\n        setIsLoading(false);\n      }\n    } else if (!user) {\n      // Require sign in for support and direct messages\n      setAiMessages((prev) => [\n        ...prev,\n        { text: \"Please sign in to use support and direct messaging features.\", isUser: false }\n      ]);\n      return;\n    } else if (activeTab === \"support\") {\n      // Handle support messages\n      setSupportMessages((prev) => [...prev, { text, isUser: true }]);\n      setInput(\"\");\n\n      try {\n        const supportConversationId = `support_${user.id}_${Date.now()}`;\n\n        // Insert user's support message\n        const { error: userMsgError } = await supabase.from(\"messages\").insert({\n          sender_id: user.id,\n          receiver_id: 'support',\n          content: text,\n          is_support: true,\n          conversation_id: supportConversationId\n        });\n\n        if (userMsgError) throw userMsgError;\n\n        // Insert automated support response\n        const autoResponse = \"Thank you for your message. Our support team will get back to you soon.\";\n        const { error: supportError } = await supabase.from(\"messages\").insert({\n          sender_id: null,\n          receiver_id: user.id,\n          content: autoResponse,\n          is_support: true,\n          conversation_id: supportConversationId\n        });\n\n        if (supportError) throw supportError;\n\n        setSupportMessages((prev) => [\n          ...prev,\n          { text: autoResponse, isUser: false }\n        ]);\n      } catch (error) {\n        console.error(\"Error handling support message:\", error);\n        setSupportMessages((prev) => [\n          ...prev,\n          { text: \"Sorry, there was an error sending your message. Please try again.\", isUser: false }\n        ]);\n      }\n    } else {\n      // Direct Message or Support\n      if (!user || !selectedContact) return;\n\n      try {\n        console.log(\"Sending message to Supabase:\", { // Add this line\n          sender_id: user.id,\n          receiver_id: selectedContact.id,\n          content: text,\n          is_support: activeTab === \"support\",\n        });\n        const { data, error } = await supabase.from(\"messages\").insert([\n          {\n            sender_id: user.id,\n            receiver_id: selectedContact.id,\n            content: text,\n            is_support: activeTab === \"support\",\n          },\n        ]);\n\n        if (error) {\n          console.error(\"Supabase insert error:\", error); // Add this line\n          throw error;\n        }\n\n        console.log(\"Supabase insert success:\", data); // Add this line\n\n        setDirectMessages((prev) => [\n          ...prev,\n          {\n            text,\n            isUser: true,\n            sender: {\n              full_name: profile?.full_name || \"\",\n              email: profile?.email || \"\",\n            },\n            timestamp: new Date().toISOString(),\n          },\n        ]);\n        setInput(\"\");\n      } catch (error) {\n        console.error(\"Error sending message:\", error);\n      }\n    }\n  };\n\n  const scrollToBottom = () => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  };\n\n  React.useEffect(() => {\n    scrollToBottom();\n  }, [aiMessages, supportMessages, directMessages]);\n\n  React.useEffect(() => {\n    scrollToBottom();\n  }, [isLoading]);\n\n  // Subscribe to new messages\n  React.useEffect(() => {\n    if (!user || !selectedContact) return;\n\n    const subscription = supabase\n      .channel(`messages:${user.id}:${selectedContact.id}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"INSERT\",\n          schema: \"public\",\n          table: \"messages\",\n          filter: `or(and(sender_id.eq.${user.id},receiver_id.eq.${selectedContact.id}),and(sender_id.eq.${selectedContact.id},receiver_id.eq.${user.id}))`,\n        },\n        (payload) => {\n          console.log(\"Realtime message received:\", payload); // Add this line\n          const newMessage = payload.new;\n          if (newMessage.sender_id !== user.id) {\n            setDirectMessages((prev) => [\n              ...prev,\n              {\n                text: newMessage.content,\n                isUser: false,\n                sender: selectedContact,\n                timestamp: newMessage.created_at,\n              },\n            ]);\n          }\n        },\n      )\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [user, selectedContact]);\n\n  return (\n    <>\n      <div className={`fixed bottom-4 right-4 z-50 ${isOpen ? 'w-96' : 'w-auto'}`}>\n        {isOpen ? (\n          <div className=\"bg-background border rounded-lg shadow-lg\">\n            <div className=\"p-4 border-b flex justify-between items-center\">\n              <h2 className=\"font-semibold\">AI Assistant</h2>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => navigate('/messages')}\n                  title=\"Chat with Users\"\n                >\n                  <Users className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => setIsOpen(false)}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            <Tabs defaultValue={activeTab} onValueChange={setActiveTab}>\n              <TabsContent value=\"ai\" className=\"m-0 bg-white\">\n                <div\n                  ref={scrollRef}\n                  className=\"h-96 p-4 space-y-4 overflow-y-auto\"\n                >\n                  {aiMessages.length === 0 ? (\n                    <div className=\"space-y-4\">\n                      <p className=\"text-sm text-muted-foreground\">\n                        Hello! I'm your property assistant. Ask me anything\n                        about property investment, or try one of these popular\n                        questions:\n                      </p>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {popularQuestions.map((question, index) => (\n                          <Button\n                            key={index}\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"text-xs\"\n                            onClick={() => handleSend(question)}\n                          >\n                            {question}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n                  ) : (\n                    aiMessages.map((message, index) => (\n                      <div\n                        key={index}\n                        className={`flex ${message.isUser ? \"justify-end\" : \"justify-start\"}`}\n                      >\n                        <div\n                          className={`max-w-[80%] rounded-lg p-3 ${\n                            message.isUser\n                              ? \"bg-primary text-primary-foreground\"\n                              : \"bg-muted\"\n                          }`}\n                        >\n                          <p \n                            className=\"text-sm whitespace-pre-wrap\"\n                            dangerouslySetInnerHTML={{\n                              __html: message.isUser ? message.text : formatMessage(message.text)\n                            }}\n                          />\n                        </div>\n                      </div>\n                    ))\n                  )}\n                  {isLoading && (\n                    <div className=\"flex justify-start\">\n                      <div className=\"max-w-[80%] rounded-lg p-3 bg-muted\">\n                        <p className=\"text-sm\">Typing...</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                <div className=\"p-4 border-t\">\n                  <div className=\"flex gap-2\">\n                    <Input\n                      value={input}\n                      onChange={(e) => setInput(e.target.value)}\n                      placeholder=\"Ask me anything about property...\"\n                      onKeyPress={(e) => {\n                        if (e.key === \"Enter\") {\n                          handleSend(input);\n                        }\n                      }}\n                    />\n                    <Button\n                      onClick={() => handleSend(input)}\n                      disabled={!input.trim()}\n                    >\n                      <Send className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"messages\" className=\"m-0 bg-white\">\n                <div\n                  ref={scrollRef}\n                  className=\"h-96 p-4 space-y-4 overflow-y-auto\"\n                >\n                  {!user ? (\n                    <div className=\"text-center p-4\">\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        Please sign in to view messages\n                      </p>\n                    </div>\n                  ) : !selectedContact ? (\n                    <div className=\"space-y-4\">\n                      {contacts.map((contact) => (\n                        <div\n                          key={contact.id}\n                          className=\"flex items-center justify-between p-2 hover:bg-muted rounded-lg cursor-pointer\"\n                          onClick={() => setSelectedContact(contact)}\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarImage\n                                src={`https://ui-avatars.com/api/?name=${encodeURIComponent(contact.full_name)}&background=random`}\n                                alt={contact.full_name}\n                              />\n                              <AvatarFallback>\n                                {contact.full_name\n                                  ?.split(\" \")\n                                  .map((n) => n[0])\n                                  .join(\"\")}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"font-medium\">\n                                {contact.full_name}\n                              </p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                {contact.last_message}\n                              </p>\n                            </div>\n                          </div>\n                          {contact.unread_count && contact.unread_count > 0 && (\n                            <span className=\"bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full\">\n                              {contact.unread_count}\n                            </span>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"space-y-4\">\n                      {directMessages.map((message, index) => (\n                        <div\n                          key={index}\n                          className={`flex ${message.isUser ? \"justify-end\" : \"justify-start\"}`}\n                        >\n                          <div\n                            className={`max-w-[80%] rounded-lg p-3 ${message.isUser ? \"bg-primary text-primary-foreground\" : \"bg-muted\"}`}\n                          >\n                            <p className=\"text-sm\">{message.text}</p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n\n                {selectedContact && (\n                  <div className=\"p-4 border-t\">\n                    <div className=\"flex gap-2\">\n                      <Input\n                        value={input}\n                        onChange={(e) => setInput(e.target.value)}\n                        placeholder=\"Type a message...\"\n                        onKeyPress={(e) => {\n                          if (e.key === \"Enter\") {\n                            handleSend(input);\n                          }\n                        }}\n                      />\n                      <Button\n                        onClick={() => handleSend(input)}\n                        disabled={!input.trim()}\n                      >\n                        <Send className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"support\" className=\"m-0 bg-white\">\n                <div\n                  ref={scrollRef}\n                  className=\"h-96 p-4 space-y-4 overflow-y-auto\"\n                >\n                  {supportMessages.length === 0 ? (\n                    <div className=\"space-y-4\">\n                      <p className=\"text-sm text-muted-foreground\">\n                        Welcome to support! How can we help you today?\n                      </p>\n                    </div>\n                  ) : (\n                    supportMessages.map((message, index) => (\n                      <div\n                        key={index}\n                        className={`flex ${message.isUser ? \"justify-end\" : \"justify-start\"}`}\n                      >\n                        <div\n                          className={`max-w-[80%] rounded-lg p-3 ${message.isUser ? \"bg-primary text-primary-foreground\" : \"bg-muted\"}`}\n                        >\n                          <p className=\"text-sm\">{message.text}</p>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </div>\n\n                <div className=\"p-4 border-t\">\n                  <div className=\"flex gap-2\">\n                    <Input\n                      value={input}\n                      onChange={(e) => setInput(e.target.value)}\n                      placeholder=\"Type your support question...\"\n                      onKeyPress={(e) => {\n                        if (e.key === \"Enter\") {\n                          handleSend(input);\n                        }\n                      }}\n                    />\n                    <Button\n                      onClick={() => handleSend(input)}\n                      disabled={!input.trim()}\n                    >\n                      <Send className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </TabsContent>\n            </Tabs>\n          </div>\n        ) : (\n          <Button\n            onClick={() => setIsOpen(true)}\n            className=\"rounded-full h-12 w-12 flex items-center justify-center\"\n          >\n            <MessageCircle className=\"h-6 w-6\" />\n          </Button>\n        )}\n      </div>\n    </>\n  );\n}\n","import { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"../lib/supabase\";\n\nexport default function AuthCallback() {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    supabase.auth.onAuthStateChange((event, session) => {\n      console.log(\"Auth state change:\", event, session); // Add this line\n      if (event === \"SIGNED_IN\") {\n        navigate(\"/dashboard\");\n      }\n    });\n\n    // Handle the initial session\n    const handleInitialSession = async () => {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession();\n      console.log(\"Initial session:\", session); // Add this line\n      if (session) {\n        navigate(\"/dashboard\");\n      } else {\n        navigate(\"/\");\n      }\n    };\n\n    handleInitialSession();\n  }, [navigate]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center\">\n      <div className=\"text-center\">\n        <h2 className=\"text-2xl font-semibold mb-2\">Authenticating...</h2>\n        <p className=\"text-muted-foreground\">\n          Please wait while we verify your credentials.\n        </p>\n      </div>\n    </div>\n  );\n}\n","import HeroSection from \"./HeroSection\";\nimport { Layout } from \"./Layout\";\nimport { PageTransition } from \"./ui/page-transition\";\nimport { Button } from \"./ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./ui/card\";\nimport { Badge } from \"./ui/badge\";\nimport { Brain, Building2, BarChart3, Home, MessageSquare, Shield } from \"lucide-react\";\n\nconst aiFeatures = [\n  {\n    title: \"AI Property Analysis\",\n    description: \"Advanced AI algorithms analyze market trends, rental rates, and property conditions to optimize your investment returns.\",\n    icon: Brain,\n    badge: \"AI-Powered\"\n  },\n  {\n    title: \"Smart Tenant Matching\",\n    description: \"AI-driven tenant screening and matching system to find the perfect tenants for your properties.\",\n    icon: Home,\n    badge: \"Smart Match\"\n  },\n  {\n    title: \"Predictive Maintenance\",\n    description: \"AI predicts maintenance needs before they become issues, saving you time and money.\",\n    icon: Building2,\n    badge: \"Predictive\"\n  },\n  {\n    title: \"Automated Reporting\",\n    description: \"AI-generated insights and reports on property performance, maintenance history, and financial metrics.\",\n    icon: BarChart3,\n    badge: \"Automated\"\n  },\n  {\n    title: \"AI Chat Support\",\n    description: \"24/7 AI-powered chat support for tenants and property owners.\",\n    icon: MessageSquare,\n    badge: \"24/7 Support\"\n  },\n  {\n    title: \"Smart Security\",\n    description: \"AI-enhanced security monitoring and access control systems.\",\n    icon: Shield,\n    badge: \"Enhanced\"\n  }\n];\n\nconst managementServices = [\n  {\n    title: \"Tenant Screening\",\n    description: \"Comprehensive tenant screening with AI-powered background checks and risk assessment.\",\n  },\n  {\n    title: \"Rent Collection\",\n    description: \"Smart rent collection with predictive payment analysis and automated reminders.\",\n  },\n  {\n    title: \"Property Maintenance\",\n    description: \"AI-driven maintenance scheduling and vendor management.\",\n  },\n  {\n    title: \"Financial Reporting\",\n    description: \"Advanced financial analytics with AI-powered forecasting and recommendations.\",\n  },\n];\n\nexport default function PropertyManagementPage() {\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"AI-Powered Property Management\"\n          subtitle=\"Experience the future of property management with our advanced AI solutions.\"\n          backgroundImage=\"https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3\"\n          showSearch={false}\n          showStats={false}\n          height=\"h-[400px]\"\n        />\n        <main className=\"container mx-auto px-4 py-8 pt-24\">\n          <div className=\"max-w-6xl mx-auto space-y-16\">\n            <div className=\"text-center\">\n              <h1 className=\"text-3xl font-bold mb-2\">\n                Next-Generation Property Management\n              </h1>\n              <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n                Leveraging artificial intelligence to revolutionize property management and maximize your investment returns.\n              </p>\n            </div>\n\n            {/* AI Features Grid */}\n            <section className=\"space-y-8\">\n              <h2 className=\"text-2xl font-semibold text-center\">AI-Powered Features</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {aiFeatures.map((feature, index) => (\n                  <Card key={index} className=\"hover:shadow-lg transition-shadow\">\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <feature.icon className=\"h-6 w-6 text-primary\" />\n                        <Badge variant=\"secondary\">{feature.badge}</Badge>\n                      </div>\n                      <CardTitle className=\"text-xl\">{feature.title}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{feature.description}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </section>\n\n            {/* Traditional Services with AI Enhancement */}\n            <section className=\"space-y-8\">\n              <h2 className=\"text-2xl font-semibold text-center\">Core Services Enhanced by AI</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {managementServices.map((service, index) => (\n                  <Card key={index} className=\"hover:shadow-lg transition-shadow\">\n                    <CardHeader>\n                      <CardTitle>{service.title}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{service.description}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </section>\n\n            <section className=\"space-y-8 bg-muted p-8 rounded-lg\">\n              <h2 className=\"text-2xl font-semibold text-center\">Why Choose Our AI-Powered Management?</h2>\n              <div className=\"prose prose-lg max-w-none\">\n                <ul className=\"list-disc pl-6 space-y-2\">\n                  <li>Reduce operational costs by up to 30% with AI automation</li>\n                  <li>Minimize vacancy rates with smart tenant matching</li>\n                  <li>Prevent maintenance issues before they occur</li>\n                  <li>Get real-time insights and predictive analytics</li>\n                  <li>24/7 automated support for tenants</li>\n                  <li>Enhanced security and risk management</li>\n                </ul>\n              </div>\n            </section>\n\n            <section className=\"text-center space-y-6\">\n              <h2 className=\"text-2xl font-semibold\">Ready to Transform Your Property Management?</h2>\n              <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n                Experience the power of AI-driven property management. Contact us to learn how we can help optimize your property portfolio.\n              </p>\n              <Button size=\"lg\" className=\"px-8\">\n                Schedule a Demo\n              </Button>\n            </section>\n          </div>\n        </main>\n      </Layout>\n    </PageTransition>\n  );\n}\n","\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","// Import type only to avoid build issues\nimport type { GoogleGenerativeAI } from \"@google/generative-ai\";\n\nlet genAI: GoogleGenerativeAI;\n\nasync function initializeAI() {\n  if (!genAI) {\n    const { GoogleGenerativeAI } = await import(\"@google/generative-ai\");\n    genAI = new GoogleGenerativeAI(import.meta.env.VITE_GEMINI_API_KEY);\n  }\n  return genAI;\n}\n\nfunction sanitizeJsonString(str: string): string {\n  // Find the first { and last } to extract just the JSON object\n  const start = str.indexOf('{');\n  const end = str.lastIndexOf('}') + 1;\n  if (start === -1 || end === 0) throw new Error(\"Invalid JSON response\");\n  return str.slice(start, end);\n}\n\nexport async function getInvestmentAnalysis(propertyType: string, budget: number) {\n  const ai = await initializeAI();\n  const model = ai.getGenerativeModel({ model: \"gemini-pro\" });\n\n  const prompt = `\n    You are a UK property investment expert. Analyze investment opportunities for ${propertyType} properties with a budget of ${budget}.\n    Respond with a JSON object containing ONLY these exact fields:\n    {\n      \"analysis\": \"Brief overview of the investment opportunity\",\n      \"roi_range\": \"Expected ROI range as a percentage\",\n      \"risks\": [\"Risk 1\", \"Risk 2\", \"Risk 3\"],\n      \"opportunities\": [\"Opportunity 1\", \"Opportunity 2\", \"Opportunity 3\"],\n      \"market_trends\": [\"Trend 1\", \"Trend 2\", \"Trend 3\"]\n    }\n    Ensure each array has exactly 3 items and all fields are present.\n  `;\n\n  try {\n    const result = await model.generateContent(prompt);\n    const response = await result.response;\n    const text = sanitizeJsonString(response.text().trim());\n    console.log('Raw Analysis Response:', text);\n    \n    const parsedData = JSON.parse(text);\n    \n    // Validate the response structure\n    if (!parsedData.analysis || !parsedData.roi_range || \n        !Array.isArray(parsedData.risks) || !Array.isArray(parsedData.opportunities) || \n        !Array.isArray(parsedData.market_trends)) {\n      throw new Error('Invalid response format');\n    }\n\n    return {\n      analysis: parsedData.analysis,\n      roi_range: parsedData.roi_range,\n      risks: parsedData.risks.slice(0, 3),\n      opportunities: parsedData.opportunities.slice(0, 3),\n      market_trends: parsedData.market_trends.slice(0, 3)\n    };\n  } catch (error) {\n    console.error(\"Error in getInvestmentAnalysis:\", error);\n    return {\n      analysis: `Analysis for ${propertyType} properties with ${budget} budget is currently unavailable`,\n      roi_range: \"8-12%\",\n      risks: [\n        \"Market volatility\",\n        \"Economic uncertainty\",\n        \"Property condition risks\"\n      ],\n      opportunities: [\n        \"Value appreciation potential\",\n        \"Rental income opportunities\",\n        \"Development possibilities\"\n      ],\n      market_trends: [\n        \"Rising demand in key areas\",\n        \"Stable price growth\",\n        \"Infrastructure development\"\n      ]\n    };\n  }\n}\n\nexport async function getMarketPredictions(location: string) {\n  const ai = await initializeAI();\n  const model = ai.getGenerativeModel({ model: \"gemini-pro\" });\n\n  const prompt = `\n    You are a UK property market expert. Predict property market trends for ${location} in the next 12 months.\n    Respond ONLY with a JSON object in this exact format:\n    {\n      \"price_prediction\": \"2-3 sentence prediction of price movements\",\n      \"demand_factors\": [\"3 specific demand factors\"],\n      \"recommendations\": [\"3 specific investment recommendations\"]\n    }\n  `;\n\n  try {\n    const result = await model.generateContent(prompt);\n    const response = await result.response;\n    const text = sanitizeJsonString(response.text().trim());\n    console.log('Raw Predictions Response:', text);\n    return JSON.parse(text);\n  } catch (error) {\n    console.error(\"Error in getMarketPredictions:\", error);\n    return {\n      price_prediction: \"Market prediction currently unavailable\",\n      demand_factors: [\"Population growth\", \"Economic development\", \"Infrastructure improvements\"],\n      recommendations: [\"Research thoroughly\", \"Consider long-term potential\", \"Evaluate local amenities\"]\n    };\n  }\n}\n\nexport async function getInvestmentStrategy(investorProfile: any) {\n  const ai = await initializeAI();\n  const model = ai.getGenerativeModel({ model: \"gemini-pro\" });\n\n  const prompt = `\n    You are a UK property investment advisor. Create a strategy for a ${investorProfile.experience} investor with ${investorProfile.budget} budget and ${investorProfile.riskTolerance} risk tolerance.\n    Respond ONLY with a JSON object in this exact format:\n    {\n      \"strategy\": \"2-3 sentence overview of recommended strategy\",\n      \"portfolio_allocation\": \"Suggested portfolio breakdown percentages\",\n      \"timeline\": \"Recommended investment timeline\",\n      \"expected_returns\": \"Projected returns overview\"\n    }\n  `;\n\n  try {\n    const result = await model.generateContent(prompt);\n    const response = await result.response;\n    const text = sanitizeJsonString(response.text().trim());\n    console.log('Raw Strategy Response:', text);\n    return JSON.parse(text);\n  } catch (error) {\n    console.error(\"Error in getInvestmentStrategy:\", error);\n    return {\n      strategy: \"Investment strategy currently unavailable\",\n      portfolio_allocation: \"Residential: 60%, Commercial: 30%, Cash: 10%\",\n      timeline: \"5-10 years recommended holding period\",\n      expected_returns: \"8-12% annual return potential\"\n    };\n  }\n}\n\nexport async function getPropertyAnalysis(property: any) {\n  const ai = await initializeAI();\n  const model = ai.getGenerativeModel({ model: \"gemini-pro\" });\n\n  const prompt = `\n    As a UK property expert, analyze this property:\n    Property Type: ${property.property_type}\n    Details: ${property.bedroom} bedrooms, ${property.bathroom} bathrooms\n    Size: ${property.square_footage} sq ft\n    Location: ${property.city}\n    Price: ${property.price}\n\n    Respond with a JSON object in exactly this format:\n    {\n      \"market_value_analysis\": \"Brief analysis of the property's market value\",\n      \"investment_potential\": \"Analysis of investment potential\",\n      \"key_advantages\": [\"Advantage 1\", \"Advantage 2\", \"Advantage 3\"],\n      \"considerations\": [\"Consideration 1\", \"Consideration 2\", \"Consideration 3\"],\n      \"recommendation\": \"Brief recommendation\"\n    }\n    Keep the response strictly in this JSON format with no additional text.\n  `;\n\n  try {\n    console.log('Sending prompt to Gemini:', prompt);\n    const result = await model.generateContent(prompt);\n    const response = await result.response;\n    const text = response.text().trim();\n    console.log('Raw Gemini response:', text);\n    \n    // Clean and parse the response\n    const cleanedText = sanitizeJsonString(text);\n    console.log('Cleaned response:', cleanedText);\n    \n    const parsedData = JSON.parse(cleanedText);\n    \n    // Validate the response structure\n    if (!parsedData.market_value_analysis || \n        !parsedData.investment_potential || \n        !Array.isArray(parsedData.key_advantages) || \n        !Array.isArray(parsedData.considerations) || \n        !parsedData.recommendation) {\n      console.error('Invalid response structure:', parsedData);\n      throw new Error('Invalid response structure from AI');\n    }\n\n    return {\n      market_value_analysis: parsedData.market_value_analysis,\n      investment_potential: parsedData.investment_potential,\n      key_advantages: parsedData.key_advantages.slice(0, 3),\n      considerations: parsedData.considerations.slice(0, 3),\n      recommendation: parsedData.recommendation\n    };\n  } catch (error) {\n    console.error(\"Error in getPropertyAnalysis:\", error);\n    console.error(\"Property data:\", property);\n    \n    // More specific fallback data based on the property\n    return {\n      market_value_analysis: `This ${property.property_type} property in ${property.city} requires detailed market analysis.`,\n      investment_potential: `${property.bedroom} bedroom property with potential for rental or resale value appreciation.`,\n      key_advantages: [\n        `${property.bedroom} bedrooms suitable for the local market`,\n        `${property.square_footage} sq ft offering good space`,\n        `Located in ${property.city}`\n      ],\n      considerations: [\n        \"Current market conditions\",\n        \"Property condition assessment needed\",\n        \"Local area development plans\"\n      ],\n      recommendation: `Consider viewing this ${property.property_type} property for a detailed assessment.`\n    };\n  }\n} ","import React from \"react\";\nimport { Layout } from \"./Layout\";\nimport { PageTransition } from \"./ui/page-transition\";\nimport HeroSection from \"./HeroSection\";\nimport { Button } from \"./ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./ui/card\";\nimport { Input } from \"./ui/input\";\nimport { \n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"./ui/select\";\nimport { Slider } from \"./ui/slider\";\nimport { \n  getInvestmentAnalysis, \n  getMarketPredictions, \n  getInvestmentStrategy \n} from \"../lib/ai-utils\";\nimport { Loader2, TrendingUp, Brain, BarChart3 } from \"lucide-react\";\n\ntype PropertyType = \"residential\" | \"commercial\" | \"industrial\";\n\nexport default function InvestmentOpportunitiesPage() {\n  const [loading, setLoading] = React.useState(false);\n  const [error, setError] = React.useState<string | null>(null);\n  const [propertyType, setPropertyType] = React.useState<PropertyType>(\"residential\");\n  const [budget, setBudget] = React.useState(250000);\n  const [location, setLocation] = React.useState(\"London\");\n  const [analysis, setAnalysis] = React.useState<any>(null);\n  const [predictions, setPredictions] = React.useState<any>(null);\n  const [strategy, setStrategy] = React.useState<any>(null);\n\n  const investorProfile = {\n    experience: \"intermediate\",\n    budget: budget,\n    riskTolerance: \"moderate\"\n  };\n\n  const handleAnalyze = async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      // Execute each API call separately for better error handling\n      const analysisData = await getInvestmentAnalysis(propertyType, budget);\n      if (!analysisData || typeof analysisData !== 'object') {\n        throw new Error('Invalid analysis data received');\n      }\n      setAnalysis(analysisData);\n\n      const predictionsData = await getMarketPredictions(location);\n      if (!predictionsData || typeof predictionsData !== 'object') {\n        throw new Error('Invalid predictions data received');\n      }\n      setPredictions(predictionsData);\n\n      const strategyData = await getInvestmentStrategy(investorProfile);\n      if (!strategyData || typeof strategyData !== 'object') {\n        throw new Error('Invalid strategy data received');\n      }\n      setStrategy(strategyData);\n\n    } catch (error) {\n      console.error(\"Error in analysis:\", error);\n      setError(error instanceof Error ? error.message : \"Failed to generate analysis. Please try again.\");\n      // Clear any partial results\n      setAnalysis(null);\n      setPredictions(null);\n      setStrategy(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"AI-Powered Investment Analysis\"\n          subtitle=\"Make data-driven investment decisions with our advanced AI analytics\"\n          showSearch={false}\n          height=\"h-[400px]\"\n          onSearch={() => {}}\n        />\n        \n        <main className=\"container mx-auto px-4 py-8 pt-24\">\n          <div className=\"max-w-7xl mx-auto space-y-12\">\n            {/* Analysis Controls */}\n            <section className=\"bg-card p-6 rounded-lg shadow-lg\">\n              <h2 className=\"text-2xl font-bold mb-6\">Investment Analysis</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Property Type</label>\n                  <Select \n                    defaultValue={propertyType}\n                    onValueChange={(value: PropertyType) => setPropertyType(value)}\n                  >\n                    <SelectTrigger className=\"w-full\">\n                      <SelectValue placeholder=\"Select property type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"residential\">Residential</SelectItem>\n                      <SelectItem value=\"commercial\">Commercial</SelectItem>\n                      <SelectItem value=\"industrial\">Industrial</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Location</label>\n                  <Input\n                    type=\"text\"\n                    value={location}\n                    onChange={(e) => setLocation(e.target.value)}\n                    placeholder=\"Enter location\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Budget: {budget.toLocaleString()}</label>\n                  <Slider\n                    value={[budget]}\n                    onValueChange={(value) => setBudget(value[0])}\n                    min={100000}\n                    max={1000000}\n                    step={50000}\n                  />\n                </div>\n              </div>\n              \n              <Button\n                onClick={handleAnalyze}\n                disabled={loading}\n                className=\"mt-6\"\n                size=\"lg\"\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Analyzing...\n                  </>\n                ) : (\n                  'Analyze Investment Opportunity'\n                )}\n              </Button>\n            </section>\n\n            {/* Analysis Results */}\n            {error && (\n              <div className=\"bg-destructive/10 text-destructive p-4 rounded-lg\">\n                {error}\n              </div>\n            )}\n            \n            {analysis && predictions && strategy && !error && (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                {/* Market Analysis */}\n                <Card>\n                  <CardHeader>\n                    <TrendingUp className=\"h-6 w-6 text-primary mb-2\" />\n                    <CardTitle>Market Analysis</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div>\n                      <h4 className=\"font-semibold\">Analysis</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {analysis.analysis || \"Analysis not available\"}\n                      </p>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">ROI Range</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {analysis.roi_range || \"ROI range not available\"}\n                      </p>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">Risks</h4>\n                      <ul className=\"list-disc pl-4 text-sm text-muted-foreground\">\n                        {Array.isArray(analysis.risks) ? (\n                          analysis.risks.map((risk: string, i: number) => (\n                            <li key={i}>{risk}</li>\n                          ))\n                        ) : (\n                          <li>Risks data not available</li>\n                        )}\n                      </ul>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">Market Trends</h4>\n                      <ul className=\"list-disc pl-4 text-sm text-muted-foreground\">\n                        {Array.isArray(analysis.market_trends) ? (\n                          analysis.market_trends.map((trend: string, i: number) => (\n                            <li key={i}>{trend}</li>\n                          ))\n                        ) : (\n                          <li>Market trends not available</li>\n                        )}\n                      </ul>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Market Predictions */}\n                <Card>\n                  <CardHeader>\n                    <Brain className=\"h-6 w-6 text-primary mb-2\" />\n                    <CardTitle>AI Predictions</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <div>\n                      <h4 className=\"font-semibold\">Price Trend</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {predictions.price_prediction || \"Price prediction not available\"}\n                      </p>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">Demand Factors</h4>\n                      <ul className=\"list-disc pl-4 text-sm text-muted-foreground\">\n                        {Array.isArray(predictions.demand_factors) ? (\n                          predictions.demand_factors.map((factor: string, i: number) => (\n                            <li key={i}>{factor}</li>\n                          ))\n                        ) : (\n                          <li>Demand factors not available</li>\n                        )}\n                      </ul>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Investment Strategy */}\n                <Card>\n                  <CardHeader>\n                    <BarChart3 className=\"h-6 w-6 text-primary mb-2\" />\n                    <CardTitle>Recommended Strategy</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <div>\n                      <h4 className=\"font-semibold\">Portfolio Allocation</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {strategy.portfolio_allocation || \"Portfolio allocation not available\"}\n                      </p>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">Expected Returns</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {strategy.expected_returns || \"Expected returns not available\"}\n                      </p>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">Timeline</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {strategy.timeline || \"Timeline not available\"}\n                      </p>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n          </div>\n        </main>\n      </Layout>\n    </PageTransition>\n  );\n}\n","import React from \"react\";\nimport Header from \"./Header\";\nimport HeroSection from \"./HeroSection\";\nimport { Layout } from \"./Layout\";\nimport { PageTransition } from \"./ui/page-transition\";\nimport { Button } from \"./ui/button\";\n\nexport default function AboutUsPage() {\n  return (\n    <PageTransition>\n      <Layout>\n        <HeroSection\n          title=\"About MyVGE\"\n          subtitle=\"Learn more about our mission and our team\"\n          backgroundImage=\"https://images.unsplash.com/photo-1507585495646-50c2b6dbd483?ixlib=rb-4.0.3\"\n          showSearch={false}\n          showStats={false}\n          height=\"h-[400px]\"\n        />\n        <main className=\"container mx-auto px-4 py-8 pt-24\">\n          <div className=\"max-w-4xl mx-auto space-y-8\">\n            <div className=\"text-center\">\n              <h1 className=\"text-3xl font-bold mb-2\">Our Story</h1>\n              <p className=\"text-muted-foreground\">\n                MyVGE is dedicated to providing property investors with the\n                tools and insights they need to succeed.\n              </p>\n            </div>\n\n            <section className=\"space-y-4\">\n              <h2 className=\"text-2xl font-semibold\">Our Mission</h2>\n              <p>\n                To empower property investors with comprehensive data, expert\n                analysis, and innovative tools to make informed decisions and\n                achieve their financial goals. We are committed to ethical\n                practices, diversity, and transparency in all our operations.\n              </p>\n            </section>\n\n            <section className=\"space-y-4\">\n              <h2 className=\"text-2xl font-semibold\">Our Values</h2>\n              <ul className=\"list-disc list-inside\">\n                <li>\n                  **Ethical Practices:** We adhere to the highest ethical\n                  standards in all our dealings, ensuring fairness and\n                  integrity.\n                </li>\n                <li>\n                  **Diversity:** We embrace diversity and inclusion, fostering\n                  a welcoming environment for all.\n                </li>\n                <li>\n                  **Transparency:** We are committed to open and honest\n                  communication, providing clear and accurate information to our\n                  users.\n                </li>\n              </ul>\n            </section>\n\n            <section className=\"space-y-4\">\n              <h2 className=\"text-2xl font-semibold\">Our Team</h2>\n              <p>\n                Our team consists of experienced property professionals, data\n                scientists, and technology experts who are passionate about\n                helping investors navigate the complexities of the real estate\n                market. We are a diverse group of individuals with a shared\n                commitment to excellence.\n              </p>\n            </section>\n\n            <section className=\"space-y-4\">\n              <h2 className=\"text-2xl font-semibold\">Contact Us</h2>\n              <p>\n                We'd love to hear from you! Contact us to learn more about our\n                services or to discuss your investment needs.\n              </p>\n              <Button>Contact Us</Button>\n            </section>\n          </div>\n        </main>\n      </Layout>\n    </PageTransition>\n  );\n}\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\";\nimport { Deal } from \"../lib/deals\";\nimport { Badge } from \"./ui/badge\";\nimport { formatCurrency } from \"../lib/utils\";\nimport { MapPin } from \"lucide-react\";\n\ninterface DealModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  deal: Deal | null;\n  isSubscriber: boolean;\n}\n\nexport const DealModal: React.FC<DealModalProps> = ({ isOpen, onClose, deal, isSubscriber }) => {\n  if (!deal) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-start justify-between gap-4\">\n            <span className=\"text-xl font-bold\">{deal.title}</span>\n            <div className=\"flex gap-2\">\n              <Badge>{deal.property_type}</Badge>\n              <Badge variant=\"secondary\">{deal.deal_type}</Badge>\n            </div>\n          </DialogTitle>\n        </DialogHeader>\n\n        {/* Image */}\n        <div className=\"relative aspect-video mb-4 overflow-hidden rounded-lg\">\n          <img\n            src={deal.image_url}\n            alt={deal.title}\n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n\n        {/* Location */}\n        <div className=\"flex items-center gap-2 mb-4 text-muted-foreground\">\n          <MapPin className=\"h-4 w-4\" />\n          <span>{deal.location}</span>\n        </div>\n\n        {/* Description */}\n        <div className=\"mb-6\">\n          <h3 className=\"font-semibold mb-2\">Description</h3>\n          <p className=\"text-muted-foreground\">{deal.description}</p>\n        </div>\n\n        {/* Financial Details */}\n        <div className=\"grid grid-cols-2 gap-4 mb-6\">\n          <div>\n            <h3 className=\"font-semibold mb-2\">Price</h3>\n            <p className=\"text-lg\">{formatCurrency(deal.price)}</p>\n          </div>\n          <div>\n            <h3 className=\"font-semibold mb-2\">ROI</h3>\n            <p className=\"text-lg text-emerald-500\">{deal.roi_percentage}%</p>\n          </div>\n          <div>\n            <h3 className=\"font-semibold mb-2\">Investment Term</h3>\n            <p className=\"text-lg\">{deal.investment_term}</p>\n          </div>\n          <div>\n            <h3 className=\"font-semibold mb-2\">Property Type</h3>\n            <p className=\"text-lg\">{deal.property_type}</p>\n          </div>\n        </div>\n\n        {/* Additional Details */}\n        <div className=\"space-y-4\">\n          <div>\n            <h3 className=\"font-semibold mb-2\">Deal Type</h3>\n            <Badge variant=\"outline\">{deal.deal_type}</Badge>\n          </div>\n          <div>\n            <h3 className=\"font-semibold mb-2\">Location</h3>\n            <p className=\"text-muted-foreground\">{deal.location}</p>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}; ","import { useEffect, useState } from \"react\";\nimport { useAuth } from \"../lib/auth\";\nimport { getDeals } from \"../lib/deals\";\nimport type { Deal } from \"../lib/deals\";\nimport { DealCard } from \"./DealCard\";\nimport { DealModal } from \"./DealModal\";\nimport { Layout } from \"./Layout\";\nimport { PageTransition } from \"./ui/page-transition\";\nimport HeroSection from \"./HeroSection\";\nimport { Button } from \"./ui/button\";\nimport { Card } from \"./ui/card\";\nimport { LogIn, UserPlus } from \"lucide-react\";\n\ninterface DealsPageProps {\n  onSignIn?: () => void;\n  onSignUp?: () => void;\n}\n\nexport default function DealsPage({ onSignIn, onSignUp }: DealsPageProps) {\n  const { user, profile, isLoading } = useAuth();\n  const [deals, setDeals] = useState<Deal[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedDeal, setSelectedDeal] = useState<Deal | null>(null);\n\n  useEffect(() => {\n    let mounted = true;\n\n    async function loadDeals() {\n      try {\n        const dealsData = await getDeals();\n        if (mounted) {\n          setDeals(dealsData);\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error('Error loading deals:', error);\n        if (mounted) {\n          setLoading(false);\n        }\n      }\n    }\n\n    loadDeals(); // Load deals regardless of auth state\n\n    return () => {\n      mounted = false;\n    };\n  }, []); // Remove user and isLoading from dependencies\n\n  // Show loading state\n  if (isLoading) {\n    return (\n      <Layout>\n        <div className=\"min-h-screen flex items-center justify-center\">\n          <div>Loading...</div>\n        </div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <PageTransition>\n        <div className=\"min-h-screen bg-neutral\">\n          <HeroSection\n            title=\"Property Deals\"\n            subtitle=\"Discover exclusive property investment opportunities\"\n            showSearch={true}\n            showStats={false}\n            height=\"h-[400px]\"\n            image=\"/deals-hero.jpg\"\n          />\n\n          <main className=\"container mx-auto px-4 py-8\">\n            {loading ? (\n              <div className=\"text-center py-8\">Loading deals...</div>\n            ) : !user ? (\n              // Paywall for non-authenticated users\n              <div className=\"max-w-4xl mx-auto\">\n                <Card className=\"p-8 text-center mb-8\">\n                  <h2 className=\"text-2xl font-bold mb-4\">Sign in to View Full Deal Details</h2>\n                  <p className=\"text-muted-foreground mb-8\">\n                    Get access to exclusive property deals and investment opportunities. \n                    Create an account or sign in to view all available deals.\n                  </p>\n                  <div className=\"flex justify-center gap-4\">\n                    <Button \n                      onClick={onSignIn}\n                      className=\"flex items-center gap-2\"\n                    >\n                      <LogIn className=\"w-4 w-4\" />\n                      Sign In\n                    </Button>\n                    <Button \n                      variant=\"outline\"\n                      onClick={onSignUp}\n                      className=\"flex items-center gap-2\"\n                    >\n                      <UserPlus className=\"w-4 w-4\" />\n                      Create Account\n                    </Button>\n                  </div>\n                </Card>\n\n                {/* Show preview of deals */}\n                <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n                  {deals.map((deal) => (\n                    <DealCard \n                      key={deal.id} \n                      deal={deal}\n                      isSubscriber={false}\n                      onClick={onSignIn}\n                    />\n                  ))}\n                </div>\n              </div>\n            ) : (\n              // Full access for authenticated users\n              <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n                {deals.map((deal) => (\n                  <DealCard \n                    key={deal.id} \n                    deal={deal}\n                    isSubscriber={profile?.subscription_tier !== 'free'}\n                    onClick={() => setSelectedDeal(deal)}\n                  />\n                ))}\n              </div>\n            )}\n          </main>\n\n          <DealModal\n            isOpen={!!selectedDeal}\n            onClose={() => setSelectedDeal(null)}\n            deal={selectedDeal}\n            isSubscriber={profile?.subscription_tier !== 'free'}\n          />\n        </div>\n      </PageTransition>\n    </Layout>\n  );\n} ","import React, { useEffect, useState, useRef } from 'react';\nimport { useAuth } from '../lib/auth';\nimport { Layout } from './Layout';\nimport { supabase } from '../lib/supabase';\nimport { Card, CardContent, CardHeader, CardTitle } from './ui/card';\nimport { Input } from './ui/input';\nimport { Button } from './ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from './ui/avatar';\nimport { ScrollArea } from './ui/scroll-area';\nimport { useToast } from './ui/use-toast';\nimport { Search, Plus, Send } from 'lucide-react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from './ui/dialog';\n\ninterface UserProfile {\n  id: string;\n  full_name: string;\n  avatar_url?: string;\n  email: string;\n}\n\ninterface Message {\n  id: string;\n  content: string;\n  sender_id: string;\n  created_at: string;\n  conversation_id: string;\n  sender?: {\n    full_name: string;\n    avatar_url: string;\n  };\n}\n\ninterface Profile {\n  full_name: string;\n  avatar_url: string | null;\n}\n\ninterface ConversationParticipant {\n  user_id: string;\n  profile: Profile;\n}\n\ninterface SupabaseProfile {\n  full_name: string;\n  avatar_url: string | null;\n}\n\ninterface DatabaseParticipant {\n  user_id: string;\n  profile: {\n    full_name: string;\n    avatar_url: string | null;\n  };\n}\n\ninterface SupabaseParticipant {\n  user_id: string;\n  profile: SupabaseProfile;\n}\n\ninterface Conversation {\n  id: string;\n  participants: ConversationParticipant[];\n  last_message?: {\n    id: string;\n    content: string;\n    sender_id: string;\n    created_at: string;\n  };\n}\n\nfunction isValidParticipant(participant: any): participant is DatabaseParticipant {\n  return (\n    participant &&\n    typeof participant.user_id === 'string' &&\n    participant.profile &&\n    typeof participant.profile.full_name === 'string' &&\n    (participant.profile.avatar_url === null || typeof participant.profile.avatar_url === 'string')\n  );\n}\n\nconst transformParticipants = (participants: any[]): ConversationParticipant[] => {\n  return participants\n    .filter(isValidParticipant)\n    .map(p => ({\n      user_id: p.user_id,\n      profile: {\n        full_name: p.profile.full_name,\n        avatar_url: p.profile.avatar_url\n      }\n    }));\n};\n\nexport default function Messages() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const [, setIsLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [searchResults, setSearchResults] = useState<UserProfile[]>([]);\n  const [isSearching, setIsSearching] = useState(false);\n  const [isNewChatOpen, setIsNewChatOpen] = useState(false);\n\n  useEffect(() => {\n    if (!user) return;\n\n    // Fetch conversations\n    const fetchConversations = async () => {\n      try {\n        console.log('Fetching conversations for user:', user?.id);\n\n        // First get all conversations for the user\n        const { data: participants, error: participantsError } = await supabase\n          .from('conversation_participants')\n          .select('conversation_id')\n          .eq('user_id', user?.id);\n\n        if (participantsError) {\n          console.error('Error fetching participants:', participantsError);\n          throw participantsError;\n        }\n\n        console.log('Found participant records:', participants);\n\n        if (!participants?.length) {\n          console.log('No conversations found');\n          setConversations([]);\n          setIsLoading(false);\n          return;\n        }\n\n        const conversationIds = participants.map(p => p.conversation_id);\n        console.log('Conversation IDs:', conversationIds);\n\n        // Then get the conversation details\n        const { data: conversations, error: conversationsError } = await supabase\n          .from('conversations')\n          .select(`\n            id,\n            created_at,\n            participants:conversation_participants!inner (\n              user_id,\n              profile:profiles!inner (\n                full_name,\n                avatar_url\n              )\n            ),\n            messages (\n              id,\n              content,\n              sender_id,\n              created_at\n            )\n          `)\n          .in('id', conversationIds)\n          .order('created_at', { ascending: false });\n\n        if (conversationsError) {\n          console.error('Error fetching conversations:', conversationsError);\n          throw conversationsError;\n        }\n\n        console.log('Raw conversations data:', conversations);\n\n        const transformedData: Conversation[] = (conversations || []).map(conv => {\n          // Get the last message if any exist\n          const lastMessage = conv.messages && conv.messages.length > 0 \n            ? conv.messages[conv.messages.length - 1] \n            : undefined;\n\n          return {\n            id: conv.id,\n            participants: transformParticipants(conv.participants),\n            last_message: lastMessage\n          };\n        });\n\n        console.log('Transformed conversations:', transformedData);\n        setConversations(transformedData);\n      } catch (error) {\n        console.error('Error in fetchConversations:', error);\n        toast({\n          title: \"Error\",\n          description: error instanceof Error ? error.message : \"Failed to load conversations\",\n          variant: \"destructive\"\n        });\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchConversations();\n\n    // Subscribe to new messages\n    const subscription = supabase\n      .channel('messages')\n      .on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'messages',\n      }, payload => {\n        const newMessage = payload.new as Message;\n        if (selectedConversation?.id === newMessage.conversation_id) {\n          setMessages(prev => [...prev, newMessage]);\n        }\n      })\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [user, selectedConversation?.id]);\n\n  useEffect(() => {\n    if (selectedConversation) {\n      fetchMessages(selectedConversation.id);\n    }\n  }, [selectedConversation]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const fetchMessages = async (conversationId: string) => {\n    const { data, error } = await supabase\n      .from('messages')\n      .select(`\n        *,\n        sender:profiles!sender_id(\n          full_name,\n          avatar_url\n        )\n      `)\n      .eq('conversation_id', conversationId)\n      .order('created_at', { ascending: true });\n\n    if (error) {\n      console.error('Error fetching messages:', error);\n      return;\n    }\n\n    setMessages(data || []);\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedConversation || !newMessage.trim()) return;\n\n    try {\n      const { error } = await supabase\n        .from('messages')\n        .insert({\n          conversation_id: selectedConversation.id,\n          sender_id: user?.id,\n          content: newMessage.trim()\n        });\n\n      if (error) throw error;\n\n      setNewMessage('');\n    } catch (error) {\n      console.error('Error sending message:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to send message\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const searchUsers = async (term: string) => {\n    if (!term.trim()) {\n      setSearchResults([]);\n      return;\n    }\n\n    setIsSearching(true);\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('id, full_name, avatar_url, email')\n        .neq('id', user?.id)\n        .or(`full_name.ilike.%${term}%,email.ilike.%${term}%`)\n        .limit(5);\n\n      if (error) throw error;\n      setSearchResults(data || []);\n    } catch (error) {\n      console.error('Error searching users:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to search users\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSearching(false);\n    }\n  };\n\n  const startConversation = async (otherUser: UserProfile) => {\n    try {\n      // Check for existing conversation more efficiently\n      const { data: existingParticipations, error: checkError } = await supabase\n        .from('conversation_participants')\n        .select('conversation_id')\n        .eq('user_id', user?.id);\n\n      if (checkError) throw checkError;\n\n      if (existingParticipations?.length) {\n        const { data: existingConvo, error: existingError } = await supabase\n          .from('conversation_participants')\n          .select('conversation_id')\n          .in('conversation_id', existingParticipations.map(p => p.conversation_id))\n          .eq('user_id', otherUser.id)\n          .single();\n\n        if (existingError && existingError.code !== 'PGRST116') { // Ignore \"no rows returned\" error\n          throw existingError;\n        }\n\n        if (existingConvo) {\n          // Fetch full conversation details\n          const { data: fullConvo, error: fetchError } = await supabase\n            .from('conversations')\n            .select(`\n              id,\n              participants:conversation_participants(\n                user_id,\n                profile:profiles(\n                  full_name,\n                  avatar_url\n                )\n              )\n            `)\n            .eq('id', existingConvo.conversation_id)\n            .single();\n\n          if (fetchError) throw fetchError;\n\n          if (fullConvo) {\n            const transformedConvo: Conversation = {\n              id: fullConvo.id,\n              participants: transformParticipants(fullConvo.participants)\n            };\n            setSelectedConversation(transformedConvo);\n            setIsNewChatOpen(false);\n            return;\n          }\n        }\n      }\n\n      // Create new conversation\n      const { data: newConvo, error: convoError } = await supabase\n        .from('conversations')\n        .insert({\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        })\n        .select()\n        .single();\n\n      if (convoError) throw convoError;\n\n      // Add participants\n      const { error: participantsError } = await supabase\n        .from('conversation_participants')\n        .insert([\n          {\n            conversation_id: newConvo.id,\n            user_id: user?.id,\n            created_at: new Date().toISOString()\n          },\n          {\n            conversation_id: newConvo.id,\n            user_id: otherUser.id,\n            created_at: new Date().toISOString()\n          }\n        ]);\n\n      if (participantsError) throw participantsError;\n\n      // Fetch the complete conversation\n      const { data: updatedConvo, error: fetchError } = await supabase\n        .from('conversations')\n        .select(`\n          id,\n          participants:conversation_participants(\n            user_id,\n            profile:profiles(\n              full_name,\n              avatar_url\n            )\n          )\n        `)\n        .eq('id', newConvo.id)\n        .single();\n\n      if (fetchError) throw fetchError;\n\n      if (updatedConvo) {\n        const transformedConvo: Conversation = {\n          id: updatedConvo.id,\n          participants: transformParticipants(updatedConvo.participants)\n        };\n\n        setConversations(prev => [transformedConvo, ...prev]);\n        setSelectedConversation(transformedConvo);\n        setIsNewChatOpen(false);\n        \n        toast({\n          title: \"Success\",\n          description: \"New conversation started\"\n        });\n      }\n    } catch (error: any) {\n      console.error('Error starting conversation:', error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to start conversation. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <Layout>\n      <div className=\"container mx-auto px-4 py-8 pt-24\">\n        <div className=\"grid grid-cols-12 gap-6 max-w-6xl mx-auto\">\n          {/* Conversations List */}\n          <Card className=\"col-span-4\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-4\">\n              <CardTitle>Messages</CardTitle>\n              <Dialog open={isNewChatOpen} onOpenChange={setIsNewChatOpen}>\n                <DialogTrigger asChild>\n                  <Button size=\"icon\" variant=\"ghost\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>New Conversation</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex gap-2\">\n                      <Input\n                        placeholder=\"Search users...\"\n                        value={searchTerm}\n                        onChange={(e) => {\n                          setSearchTerm(e.target.value);\n                          searchUsers(e.target.value);\n                        }}\n                      />\n                      <Button size=\"icon\" variant=\"ghost\" disabled={isSearching}>\n                        <Search className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    <ScrollArea className=\"h-[300px]\">\n                      {searchResults.map(result => (\n                        <div\n                          key={result.id}\n                          className=\"flex items-center gap-3 p-2 hover:bg-accent rounded-lg cursor-pointer\"\n                          onClick={() => startConversation(result)}\n                        >\n                          <Avatar>\n                            <AvatarImage src={result.avatar_url || undefined} />\n                            <AvatarFallback>\n                              {result.full_name.charAt(0)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <p className=\"font-medium\">{result.full_name}</p>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {result.email}\n                            </p>\n                          </div>\n                        </div>\n                      ))}\n                      {searchTerm && !isSearching && searchResults.length === 0 && (\n                        <p className=\"text-center text-muted-foreground p-4\">\n                          No users found\n                        </p>\n                      )}\n                    </ScrollArea>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className=\"h-[600px]\">\n                {conversations.map(conversation => (\n                  <div\n                    key={conversation.id}\n                    className={`p-4 cursor-pointer hover:bg-accent rounded-lg mb-2 ${\n                      selectedConversation?.id === conversation.id ? 'bg-accent' : ''\n                    }`}\n                    onClick={() => setSelectedConversation(conversation)}\n                  >\n                    {conversation.participants\n                      .filter(p => p.user_id !== user?.id)\n                      .map(participant => (\n                        <div key={participant.user_id} className=\"flex items-center gap-3\">\n                          <Avatar>\n                            <AvatarImage src={participant.profile.avatar_url || undefined} />\n                            <AvatarFallback>\n                              {participant.profile.full_name.charAt(0)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <p className=\"font-medium\">{participant.profile.full_name}</p>\n                            {conversation.last_message && (\n                              <p className=\"text-sm text-muted-foreground truncate\">\n                                {conversation.last_message.content}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                  </div>\n                ))}\n              </ScrollArea>\n            </CardContent>\n          </Card>\n\n          {/* Messages */}\n          <Card className=\"col-span-8\">\n            <CardContent className=\"p-0\">\n              {selectedConversation ? (\n                <div className=\"h-[600px] flex flex-col\">\n                  <ScrollArea className=\"flex-1 p-4\">\n                    {messages.map(message => (\n                      <div\n                        key={message.id}\n                        className={`flex mb-4 ${\n                          message.sender_id === user?.id ? 'justify-end' : 'justify-start'\n                        }`}\n                      >\n                        <div\n                          className={`max-w-[70%] ${\n                            message.sender_id === user?.id\n                              ? 'bg-primary text-primary-foreground'\n                              : 'bg-muted'\n                          } rounded-lg p-3`}\n                        >\n                          <p>{message.content}</p>\n                          <p className=\"text-xs mt-1 opacity-70\">\n                            {new Date(message.created_at).toLocaleTimeString()}\n                          </p>\n                        </div>\n                      </div>\n                    ))}\n                    <div ref={messagesEndRef} />\n                  </ScrollArea>\n\n                  <form onSubmit={handleSendMessage} className=\"p-4 border-t\">\n                    <div className=\"flex gap-2\">\n                      <Input\n                        value={newMessage}\n                        onChange={e => setNewMessage(e.target.value)}\n                        placeholder=\"Type a message...\"\n                      />\n                      <Button type=\"submit\" size=\"icon\">\n                        <Send className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </form>\n                </div>\n              ) : (\n                <div className=\"h-[600px] flex items-center justify-center text-muted-foreground\">\n                  Select a conversation or start a new one\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </Layout>\n  );\n} ","// Get the API key from environment variables\nexport const PATMA_API_KEY = import.meta.env.VITE_PATMA_API_KEY || '';\n\n// Add other configuration values here\nexport const DEFAULT_SEARCH_RADIUS = 1; // miles\nexport const DEFAULT_PAGE_SIZE = 12; ","import { PATMA_API_KEY } from '@/config';\n\nconst API_BASE_URL = 'https://app.patma.co.uk';\nconst API_PATH = '/api/prospector/v1';\n\n// Common types\nexport interface ApiResponse<T> {\n  status: 'success' | 'error';\n  response_time: number;\n  data: T;\n}\n\nexport interface PatmaProperty {\n  id: string;\n  title: string;\n  price: number;\n  description: string;\n  location: {\n    address: string;\n    postcode: string;\n    city: string;\n  };\n  features: {\n    bedrooms: number;\n    bathrooms: number;\n    receptionRooms: number;\n    propertyType: string;\n    tenure: string;\n  };\n  images: string[];\n  floorArea: {\n    size: number;\n    unit: string;\n  };\n  agent: {\n    name: string;\n    phone: string;\n    email: string;\n  };\n  listingUrl: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface SearchFilters {\n  location?: string;\n  minPrice?: number;\n  maxPrice?: number;\n  minBeds?: number;\n  maxBeds?: number;\n  propertyType?: string;\n  radius?: number;\n  page?: number;\n  limit?: number;\n}\n\nexport interface SearchResponse {\n  properties: PatmaProperty[];\n  total: number;\n  page: number;\n  totalPages: number;\n}\n\nexport interface AskingPriceResponse {\n  status: string;\n  response_time: number;\n  data: {\n    data_points: number;\n    radius: number;\n    mean: number;\n    median: number;\n  };\n  postcode: string;\n  lat: number;\n  long: number;\n  bedrooms: number;\n  property_type: string;\n}\n\nexport interface AskingPriceParams {\n  postcode: string;\n  lat?: number;\n  long?: number;\n  bedrooms?: number;\n  property_type?: 'flat' | 'terraced' | 'semi-detached' | 'detached';\n  min_data_points?: number;\n}\n\nexport interface SoldProperty {\n  id?: string;\n  address: string;\n  postcode: string;\n  price?: number;\n  sale_price?: number;\n  date_of_transfer: string;\n  property_type: string;\n  old_new?: string;\n  duration?: string;\n  bedrooms?: number;\n  floor_area?: number;\n  floor_area_units?: string;\n  latitude?: number;\n  longitude?: number;\n  distance_miles?: number;\n  tenure?: string;\n  new_build?: boolean;\n  indexation_adjusted_price?: number;\n  // Investment metrics\n  estimated_rent?: number;\n  rental_yield?: number;\n  roi?: number;\n  estimated_growth?: number;\n}\n\nexport interface ListedProperty {\n  id?: string;\n  address: string;\n  postcode: string;\n  price?: number;\n  asking_price?: number;\n  date_listed?: string;\n  property_type: string;\n  bedrooms?: number;\n  description?: string;\n  images?: string[];\n  image_url?: string;\n  agent?: {\n    name: string;\n    phone: string;\n  };\n  tenure?: string;\n  new_build?: boolean;\n  floor_area?: number;\n  floor_area_units?: string;\n  latitude?: number;\n  longitude?: number;\n  distance_miles?: number;\n  most_recent_sale_date?: string;\n  most_recent_sale_price?: number;\n  // Investment metrics\n  estimated_rent?: number;\n  rental_yield?: number;\n  roi?: number;\n  estimated_growth?: number;\n}\n\nexport interface PriceHistory {\n  property_id: string;\n  price_changes: Array<{\n    date: string;\n    price: number;\n    type: 'reduction' | 'increase' | 'initial';\n  }>;\n}\n\nexport interface SoldPricesParams {\n  postcode: string;\n  location?: string;\n  lat?: number;\n  long?: number;\n  property_type: 'flat' | 'terraced' | 'semi-detached' | 'detached' | 'bungalow';\n  tenure?: 'freehold' | 'leasehold';\n  new_build?: 'true' | 'false';\n  max_age_months?: number;\n  min_data_points?: number;\n  apply_indexation?: boolean;\n  page?: number;\n  page_size?: number;\n  radius?: number;\n}\n\nexport interface PriceHistoryParams {\n  postcode: string;\n  property_type?: 'flat' | 'terraced' | 'semi-detached' | 'detached';\n}\n\nexport interface ListPropertyParams {\n  postcode: string;\n  location?: string;\n  lat?: number;\n  long?: number;\n  radius?: number;\n  polygon?: {\n    coordinates: number[][][];\n    type: 'Polygon';\n  };\n  property_type?: 'flat' | 'terraced' | 'semi-detached' | 'detached';\n  bedrooms?: number;\n  require_sold_price?: boolean;\n  require_size?: boolean;\n  include_sold_history?: boolean;\n  include_indexation_based_value?: boolean;\n  sort_by?: 'most_recent_sale_date' | 'distance';\n  page?: number;\n  page_size?: number;\n  records_after?: string; // Format: DD/MM/YYYY\n}\n\nexport interface PriceHistoryResponse {\n  status: string;\n  response_time: number;\n  data: {\n    trend_percentage: number;\n    data_points: Array<{\n      date: string;\n      price: number;\n    }>;\n  };\n}\n\ninterface ApiError {\n  message: string;\n  status?: number;\n}\n\nconst handleApiError = (error: any): never => {\n  if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {\n    throw new Error('Unable to connect to the API. Please check your internet connection and try again.');\n  }\n  \n  const apiError: ApiError = {\n    message: error.message || 'An unexpected error occurred',\n    status: error.status\n  };\n\n  if (error.response) {\n    apiError.status = error.response.status;\n    apiError.message = error.response.data?.message || error.message;\n  }\n\n  throw apiError;\n};\n\nconst fetchApi = async (endpoint: string, options: RequestInit = {}) => {\n  try {\n    const url = `${API_BASE_URL}${endpoint}`;\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${PATMA_API_KEY}`,\n        ...options.headers,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ message: 'An error occurred' }));\n      throw { status: response.status, message: error.message };\n    }\n\n    return await response.json();\n  } catch (error) {\n    return handleApiError(error);\n  }\n};\n\n// API functions\nexport async function searchProperties(filters: SearchFilters): Promise<SearchResponse> {\n  try {\n    const queryParams = new URLSearchParams();\n    \n    // Add filters to query params\n    if (filters.location) queryParams.append('location', filters.location);\n    if (filters.minPrice) queryParams.append('minPrice', filters.minPrice.toString());\n    if (filters.maxPrice) queryParams.append('maxPrice', filters.maxPrice.toString());\n    if (filters.minBeds) queryParams.append('minBeds', filters.minBeds.toString());\n    if (filters.maxBeds) queryParams.append('maxBeds', filters.maxBeds.toString());\n    if (filters.propertyType) queryParams.append('propertyType', filters.propertyType);\n    if (filters.radius) queryParams.append('radius', filters.radius.toString());\n    if (filters.page) queryParams.append('page', filters.page.toString());\n    if (filters.limit) queryParams.append('limit', filters.limit.toString());\n\n    const response = await fetch(`${API_BASE_URL}/properties/search?${queryParams.toString()}`, {\n      headers: {\n        'Authorization': `Bearer ${PATMA_API_KEY}`,\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'Failed to fetch properties');\n    }\n\n    const data = await response.json();\n    return {\n      properties: data.properties,\n      total: data.total,\n      page: data.page,\n      totalPages: data.totalPages,\n    };\n  } catch (error) {\n    console.error('Error searching properties:', error);\n    throw error;\n  }\n}\n\nexport async function getPropertyDetails(propertyId: string): Promise<PatmaProperty> {\n  try {\n    const response = await fetch(`${API_BASE_URL}/properties/${propertyId}`, {\n      headers: {\n        'Authorization': `Bearer ${PATMA_API_KEY}`,\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'Failed to fetch property details');\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error fetching property details:', error);\n    throw error;\n  }\n}\n\nexport async function getAskingPrices(params: AskingPriceParams): Promise<AskingPriceResponse> {\n  try {\n    const queryParams = new URLSearchParams();\n    \n    // Add all parameters to query params\n    queryParams.append('postcode', params.postcode);\n    if (params.lat) queryParams.append('lat', params.lat.toString());\n    if (params.long) queryParams.append('long', params.long.toString());\n    if (params.bedrooms) queryParams.append('bedrooms', params.bedrooms.toString());\n    if (params.property_type) queryParams.append('property_type', params.property_type);\n    if (params.min_data_points) queryParams.append('min_data_points', params.min_data_points.toString());\n\n    const url = `${API_BASE_URL}${API_PATH}/asking-prices/?${queryParams.toString()}`;\n    console.log('Fetching asking prices from:', url);\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Token ${PATMA_API_KEY}`,\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'Failed to fetch asking prices');\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error fetching asking prices:', error);\n    throw error;\n  }\n}\n\n// Get sold properties in an area\nexport async function getSoldProperties(params: SoldPricesParams) {\n  try {\n    const queryParams = new URLSearchParams();\n    \n    // Add parameters according to API spec\n    queryParams.append('postcode', params.postcode);\n    if (params.location) queryParams.append('location', params.location);\n    if (params.lat) queryParams.append('lat', params.lat.toString());\n    if (params.long) queryParams.append('long', params.long.toString());\n    queryParams.append('property_type', params.property_type);\n    if (params.tenure) queryParams.append('tenure', params.tenure);\n    if (params.new_build) queryParams.append('new_build', params.new_build);\n    if (params.max_age_months) queryParams.append('max_age_months', params.max_age_months.toString());\n    if (params.min_data_points) queryParams.append('min_data_points', params.min_data_points.toString());\n    if (params.apply_indexation !== undefined) queryParams.append('apply_indexation', params.apply_indexation.toString());\n\n    const url = `${API_BASE_URL}${API_PATH}/sold-prices/?${queryParams.toString()}`;\n    console.log('Fetching sold properties from:', url);\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Token ${PATMA_API_KEY}`,\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({ errors: ['Unknown error occurred'] }));\n      throw new Error(errorData.errors?.[0] || `HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    console.log('Sold properties response:', data);\n    \n    // Check if the response contains errors\n    if (data.status === 'error' || data.errors) {\n      const errorMessage = Array.isArray(data.errors) \n        ? data.errors[0] \n        : data.message || 'Failed to fetch sold properties';\n      throw new Error(errorMessage);\n    }\n\n    // Check for the specific response structure we're seeing (same as listed properties)\n    if (data && data.data && Array.isArray(data.data.available_results)) {\n      return {\n        properties: data.data.available_results,\n        total: data.data.total_results_count || data.data.available_results.length,\n        totalPages: data.data.number_of_pages || Math.ceil(data.data.total_results_count / (params.page_size || 12))\n      };\n    }\n    \n    // Check if data exists and has the expected structure\n    if (data && data.data && Array.isArray(data.data.properties)) {\n      return {\n        properties: data.data.properties,\n        total: data.data.total || data.data.properties.length,\n        totalPages: data.data.total_pages || Math.ceil(data.data.properties.length / (params.page_size || 10))\n      };\n    }\n    \n    // Return empty result if no data\n    console.warn('Unexpected API response structure for sold properties:', data);\n    return { properties: [], total: 0, totalPages: 1 };\n  } catch (error) {\n    console.error('Error fetching sold properties:', error);\n    throw error;\n  }\n}\n\n// Get currently listed properties\nexport async function getListedProperties(params: ListPropertyParams) {\n  try {\n    const queryParams = new URLSearchParams();\n    \n    // Add all parameters according to API spec\n    queryParams.append('postcode', params.postcode);\n    if (params.location) queryParams.append('location', params.location);\n    if (params.lat) queryParams.append('lat', params.lat.toString());\n    if (params.long) queryParams.append('long', params.long.toString());\n    if (params.radius) queryParams.append('radius', params.radius.toString());\n    if (params.polygon) queryParams.append('polygon', JSON.stringify(params.polygon));\n    if (params.property_type) queryParams.append('property_type', params.property_type);\n    if (params.bedrooms) queryParams.append('bedrooms', params.bedrooms.toString());\n    if (params.require_sold_price !== undefined) queryParams.append('require_sold_price', params.require_sold_price.toString());\n    if (params.require_size !== undefined) queryParams.append('require_size', params.require_size.toString());\n    if (params.include_sold_history !== undefined) queryParams.append('include_sold_history', params.include_sold_history.toString());\n    if (params.include_indexation_based_value !== undefined) queryParams.append('include_indexation_based_value', params.include_indexation_based_value.toString());\n    if (params.sort_by) queryParams.append('sort_by', params.sort_by);\n    if (params.page) queryParams.append('page', params.page.toString());\n    if (params.page_size) queryParams.append('page_size', params.page_size.toString());\n    if (params.records_after) queryParams.append('records_after', params.records_after);\n\n    const url = `${API_BASE_URL}${API_PATH}/list-property/?${queryParams.toString()}`;\n    console.log('Fetching listed properties from:', url);\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Token ${PATMA_API_KEY}`,\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n    });\n\n    const data = await response.json();\n    console.log('Listed properties response:', data);\n\n    // Check if the response contains errors\n    if (data.status === 'error' || data.errors) {\n      const errorMessage = Array.isArray(data.errors) \n        ? data.errors[0] \n        : data.message || 'Failed to fetch listed properties';\n      throw new Error(errorMessage);\n    }\n\n    // Check for the specific response structure we're seeing\n    if (data && data.data && Array.isArray(data.data.available_results)) {\n      return {\n        properties: data.data.available_results,\n        total: data.data.total_results_count || data.data.available_results.length,\n        totalPages: data.data.number_of_pages || Math.ceil(data.data.total_results_count / (params.page_size || 12))\n      };\n    }\n\n    // Check if data exists and has the expected structure\n    if (data && data.properties) {\n      return {\n        properties: data.properties || [],\n        total: data.total || data.properties?.length || 0,\n        totalPages: data.total_pages || Math.ceil((data.properties?.length || 0) / (params.page_size || 10))\n      };\n    }\n\n    // If we have data but no properties array, check for nested data structure\n    if (data && data.data && data.data.properties) {\n      return {\n        properties: data.data.properties,\n        total: data.data.total || data.data.properties.length,\n        totalPages: data.data.total_pages || Math.ceil(data.data.properties.length / (params.page_size || 10))\n      };\n    }\n    \n    // Return empty result if no valid data structure found\n    console.warn('Unexpected API response structure:', data);\n    return { properties: [], total: 0, totalPages: 1 };\n  } catch (error) {\n    console.error('Error fetching listed properties:', error);\n    throw error;\n  }\n}\n\n// Get price history for a property\nexport async function getPriceHistory(params: PriceHistoryParams) {\n  try {\n    const queryParams = new URLSearchParams();\n    queryParams.append('postcode', params.postcode);\n    if (params.property_type) queryParams.append('property_type', params.property_type);\n\n    const url = `${API_BASE_URL}${API_PATH}/price-history/?${queryParams.toString()}`;\n    console.log('Fetching price history from:', url);\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Token ${PATMA_API_KEY}`,\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'Failed to fetch price history');\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching price history:', error);\n    throw error;\n  }\n} ","import React from 'react';\nimport { Layout } from '../components/Layout';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card } from '@/components/ui/card';\nimport { LoadingSpinner } from '@/components/ui/loading-spinner';\nimport { useToast } from '@/components/ui/use-toast';\nimport { Bed, Home, MapPin, Search, Calendar, PoundSterling, TrendingUp, X, ExternalLink, Maximize, AreaChart, ArrowUpRight, ArrowDownRight, Info, SquareIcon, Building, Key } from 'lucide-react';\nimport { formatCurrency } from '@/lib/utils';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { AskingPrices } from '@/components/AskingPrices';\nimport { \n  getListedProperties, \n  getSoldProperties,\n  getPriceHistory,\n  getAskingPrices\n} from '@/lib/patmaService';\nimport type { \n  ListedProperty, \n  SoldProperty, \n  PriceHistoryResponse,\n  AskingPricesResponse\n} from '@/lib/patmaService';\n\ninterface AskingPricesData {\n  postcode: string;\n  data?: {\n    mean: number;\n    median: number;\n  };\n}\n\ntype PropertyType = 'flat' | 'terraced' | 'semi-detached' | 'detached' | 'bungalow' | 'any';\ntype PropertyTenure = 'freehold' | 'leasehold' | 'any';\n\ninterface Filters {\n  propertyType: PropertyType;\n  tenure: PropertyTenure;\n  minBeds: string;\n  radius: number;\n  page: number;\n  limit: number;\n  newBuild: boolean;\n  maxAgeMonths: number;\n  sortBy: 'most_recent_sale_date' | 'distance';\n}\n\ninterface AreaInsights {\n  askingPrices?: AskingPricesResponse;\n  priceHistory?: PriceHistoryResponse;\n  planningApplications?: any;\n  neighborhoodData?: any;\n}\n\nexport default function Listings() {\n  const [searchTerm, setSearchTerm] = React.useState('');\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [listedProperties, setListedProperties] = React.useState<ListedProperty[]>([]);\n  const [soldProperties, setSoldProperties] = React.useState<SoldProperty[]>([]);\n  const [areaInsights, setAreaInsights] = React.useState<AreaInsights>({});\n  const [viewMode, setViewMode] = React.useState<'listed' | 'sold'>('listed');\n  const [totalResults, setTotalResults] = React.useState(0);\n  const [totalPages, setTotalPages] = React.useState(1);\n  const { toast } = useToast();\n\n  const [filters, setFilters] = React.useState<Filters>({\n    propertyType: 'any',\n    tenure: 'any',\n    minBeds: '0',\n    radius: 1,\n    page: 1,\n    limit: 12,\n    newBuild: false,\n    maxAgeMonths: 18,\n    sortBy: 'most_recent_sale_date'\n  });\n\n  const [showPricePerSqft, setShowPricePerSqft] = React.useState(true);\n  const [showStampDuty, setShowStampDuty] = React.useState(true);\n  const [showPlanningApplications, setShowPlanningApplications] = React.useState(false);\n\n  const [selectedProperty, setSelectedProperty] = React.useState<ListedProperty | SoldProperty | null>(null);\n  const [isModalOpen, setIsModalOpen] = React.useState(false);\n\n  const displayProperties = React.useMemo(() => {\n    return viewMode === 'listed' ? listedProperties : soldProperties;\n  }, [viewMode, listedProperties, soldProperties]);\n\n  const fetchAreaInsights = async (postcode: string) => {\n    try {\n      const [askingPrices, priceHistory] = await Promise.all([\n        getAskingPrices({\n          postcode,\n          property_type: filters.propertyType === 'any' ? undefined : filters.propertyType,\n          bedrooms: filters.minBeds === '0' ? undefined : parseInt(filters.minBeds),\n          radius: filters.radius\n        }),\n        getPriceHistory({\n          postcode,\n          property_type: filters.propertyType === 'any' ? undefined : filters.propertyType,\n          max_age_months: filters.maxAgeMonths\n        }),\n        // Add more API calls here when we have the corresponding functions in patmaService.ts\n        // For example:\n        // getPlanningApplications({ postcode, radius: filters.radius }),\n        // getNeighborhoodData({ postcode })\n      ]);\n\n      setAreaInsights({\n        askingPrices,\n        priceHistory,\n        // When we implement the additional API calls:\n        // planningApplications,\n        // neighborhoodData\n      });\n    } catch (error) {\n      console.error('Error fetching area insights:', error);\n    }\n  };\n\n  // Function to get a property image from various potential sources\n  const getPropertyImageUrl = (property: any): string | null => {\n    // Check if we already have a direct image URL from the API\n    if (property.image_url && typeof property.image_url === 'string' && property.image_url.trim() !== '') {\n      console.log('Using direct image URL from API');\n      return property.image_url;\n    }\n    \n    // Check for image URLs in common property fields\n    const possibleImageFields = [\n      'main_image', \n      'photo_url', \n      'thumbnail',\n      'image'\n    ];\n    \n    for (const field of possibleImageFields) {\n      if (property[field] && typeof property[field] === 'string' && property[field].trim() !== '') {\n        console.log(`Found image in property.${field}`);\n        return property[field];\n      }\n    }\n    \n    // Look for property-software.uk URLs in any string field\n    // This approach scans all string properties for PaTMa image URLs\n    for (const key in property) {\n      if (typeof property[key] === 'string' && \n          property[key].includes('property-software.uk') && \n          (property[key].endsWith('.jpg') || property[key].endsWith('.jpeg') || property[key].endsWith('.png'))) {\n        console.log(`Found PaTMa image URL in property.${key}`);\n        return property[key];\n      }\n    }\n    \n    // Check if we have images/photos arrays\n    if (property.images && Array.isArray(property.images) && property.images.length > 0) {\n      // Try to find a property-software.uk URL first\n      const patmaImage = property.images.find((img: any) => \n        typeof img === 'string' && img.includes('property-software.uk')\n      );\n      \n      if (patmaImage) {\n        console.log('Found PaTMa image URL in images array');\n        return patmaImage;\n      }\n      \n      // Fallback to the first image\n      if (typeof property.images[0] === 'string') {\n        console.log('Using first image from images array');\n        return property.images[0];\n      }\n      \n      // Check if images contain objects with URLs\n      if (property.images[0] && typeof property.images[0] === 'object' && property.images[0].url) {\n        console.log('Using URL from first image object in images array');\n        return property.images[0].url;\n      }\n    }\n    \n    // Same check for photos array\n    if (property.photos && Array.isArray(property.photos) && property.photos.length > 0) {\n      const patmaPhoto = property.photos.find((img: any) => \n        typeof img === 'string' && img.includes('property-software.uk')\n      );\n      \n      if (patmaPhoto) {\n        console.log('Found PaTMa image URL in photos array');\n        return patmaPhoto;\n      }\n      \n      if (typeof property.photos[0] === 'string') {\n        console.log('Using first image from photos array');\n        return property.photos[0];\n      }\n      \n      if (property.photos[0] && typeof property.photos[0] === 'object' && property.photos[0].url) {\n        console.log('Using URL from first image object in photos array');\n        return property.photos[0].url;\n      }\n    }\n    \n    // Check sold_history for images\n    if (property.sold_history && Array.isArray(property.sold_history) && property.sold_history.length > 0) {\n      for (const historyItem of property.sold_history) {\n        if (!historyItem) continue;\n        \n        // Check for direct image fields in history item\n        for (const field of possibleImageFields) {\n          if (historyItem[field] && typeof historyItem[field] === 'string' && historyItem[field].trim() !== '') {\n            console.log(`Found image in sold_history item.${field}`);\n            return historyItem[field];\n          }\n        }\n        \n        // Check for property-software.uk URLs in any string field\n        for (const key in historyItem) {\n          if (typeof historyItem[key] === 'string' && \n              historyItem[key].includes('property-software.uk') && \n              (historyItem[key].endsWith('.jpg') || historyItem[key].endsWith('.jpeg') || historyItem[key].endsWith('.png'))) {\n            console.log(`Found PaTMa image URL in sold_history item.${key}`);\n            return historyItem[key];\n          }\n        }\n        \n        // Check arrays in history item\n        if (historyItem.images && Array.isArray(historyItem.images) && historyItem.images.length > 0) {\n          const patmaImage = historyItem.images.find((img: any) => \n            typeof img === 'string' && img.includes('property-software.uk')\n          );\n          \n          if (patmaImage) {\n            console.log('Found PaTMa image URL in sold_history images array');\n            return patmaImage;\n          }\n          \n          if (typeof historyItem.images[0] === 'string') {\n            console.log('Using first image from sold_history images array');\n            return historyItem.images[0];\n          }\n        }\n      }\n    }\n    \n    // If no image was found, return null\n    console.log('No image found for property');\n    return null;\n  };\n\n  const handleSearch = async () => {\n    if (!searchTerm) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Please enter a location or postcode\",\n      });\n      return;\n    }\n\n    try {\n      setIsLoading(true);\n\n      // Check if the search term is a postcode (simple validation)\n      const isPostcode = /^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i.test(searchTerm.trim());\n      \n      // For area insights, we'll still try to use the search term as a postcode\n      // Fetch area insights in parallel with property search\n      fetchAreaInsights(searchTerm).catch(error => {\n        console.error('Error fetching area insights:', error);\n        toast({\n          variant: \"destructive\",\n          title: \"Warning\",\n          description: \"Could not fetch area insights. Some information may be missing.\",\n        });\n      });\n\n      if (viewMode === 'listed') {\n        try {\n          const listedResults = await getListedProperties({\n            postcode: searchTerm.trim(),\n            // If it doesn't look like a postcode, also pass it as a location\n            location: !isPostcode ? searchTerm.trim() : undefined,\n            radius: filters.radius,\n            property_type: filters.propertyType === 'any' ? undefined : filters.propertyType,\n            tenure: filters.tenure === 'any' ? undefined : filters.tenure,\n            bedrooms: filters.minBeds === '0' ? undefined : parseInt(filters.minBeds),\n            new_build: filters.newBuild || undefined,\n            page: filters.page,\n            page_size: filters.limit,\n            sort_by: filters.sortBy,\n            include_sold_history: true,\n            require_sold_price: true,\n            require_size: true\n          });\n          \n          // Print the ENTIRE API response structure - this is critical to find the images\n          console.log('COMPLETE API RESPONSE STRUCTURE:', JSON.stringify(listedResults, null, 2));\n          \n          const sampleProperty = listedResults.properties[0];\n          if (sampleProperty) {\n            console.log('COMPLETE SAMPLE PROPERTY STRUCTURE:', JSON.stringify(sampleProperty, null, 2));\n            \n            // Check for property URLs and IDs that might help find listings\n            console.log('KEY PROPERTY FIELDS FOR IMAGE LOOKUP:', {\n              listing_url: sampleProperty.listing_url,\n              property_url: sampleProperty.property_url,\n              url: sampleProperty.url,\n              id: sampleProperty.id,\n              rightmove_id: sampleProperty.rightmove_id,\n              zoopla_id: sampleProperty.zoopla_id,\n              uprn: sampleProperty.uprn,\n              listing_detail_url: sampleProperty.listing_detail_url\n            });\n          }\n          \n          // Process properties to extract and normalize data\n          const processedProperties = listedResults.properties.map((property: any, index: number) => {\n            // Deep copy to avoid mutation issues\n            let normalizedProperty = JSON.parse(JSON.stringify(property));\n            \n            // Ensure property ID is available in a consistent format\n            if (property.uprn) {\n              normalizedProperty.uprn = String(property.uprn);\n            }\n            \n            // PRICE HANDLING - use last_sold_price when available\n            if (property.last_sold_price) {\n              normalizedProperty.price = property.last_sold_price;\n            }\n            \n            // Find the best image URL for this property\n            normalizedProperty.image_url = getPropertyImageUrl(property);\n                        \n            // Ensure property_type is always set\n            if (!normalizedProperty.property_type && property.built_form) {\n              normalizedProperty.property_type = property.built_form;\n            } else if (!normalizedProperty.property_type) {\n              normalizedProperty.property_type = \"House\";\n            }\n            \n            return normalizedProperty;\n          });\n\n          // Add investment metrics if not provided by the API\n          const propertiesWithMetrics = processedProperties.map((property: any) => \n            addInvestmentMetrics(property)\n          );\n          \n          setListedProperties(propertiesWithMetrics);\n          setTotalResults(listedResults.total);\n          setTotalPages(listedResults.totalPages);\n          \n          if (listedResults.properties.length === 0) {\n            toast({\n              variant: \"default\",\n              title: \"No Results\",\n              description: \"No listed properties found for this search criteria. Try adjusting your filters.\",\n            });\n          }\n        } catch (error) {\n          console.error('Error fetching listed properties:', error);\n          toast({\n            variant: \"destructive\",\n            title: \"Error\",\n            description: error instanceof Error ? error.message : \"Could not fetch listed properties. Please check your search criteria and try again.\",\n          });\n          setListedProperties([]);\n          setTotalResults(0);\n          setTotalPages(1);\n        }\n      } else {\n        try {\n          const soldResults = await getSoldProperties({\n            postcode: searchTerm.trim(),\n            // If it doesn't look like a postcode, also pass it as a location\n            location: !isPostcode ? searchTerm.trim() : undefined,\n            radius: filters.radius,\n            property_type: filters.propertyType === 'any' ? 'flat' : filters.propertyType as any,\n            tenure: filters.tenure === 'any' ? undefined : filters.tenure,\n            max_age_months: filters.maxAgeMonths,\n            min_data_points: 20,\n            apply_indexation: true,\n            page: filters.page,\n            page_size: filters.limit\n          });\n          \n          // Log full response structure\n          console.log('Sold properties API response structure:', JSON.stringify(soldResults, null, 2).substring(0, 500) + '...');\n          if (soldResults.properties && soldResults.properties.length > 0) {\n            console.log('First sold property full object:', soldResults.properties[0]);\n          }\n          \n          // Process properties to normalize data structures and fix missing fields\n          const processedProperties = soldResults.properties.map((property: any) => {\n            // Create a deep copy to avoid mutation issues\n            let normalizedProperty = JSON.parse(JSON.stringify(property));\n            \n            // PRICE HANDLING\n            // Check all possible price field locations\n            if (!normalizedProperty.price && !normalizedProperty.sale_price) {\n              if (property.details?.price) {\n                normalizedProperty.price = property.details.price;\n              } else if (property.price_paid) {\n                normalizedProperty.sale_price = property.price_paid;\n              } else if (property.sale_price) {\n                normalizedProperty.sale_price = property.sale_price;\n              } else if (property.latest_sold_price) {\n                normalizedProperty.sale_price = property.latest_sold_price;\n              } else if (typeof property.price === 'string') {\n                // Sometimes price comes as a string with currency symbol\n                const priceMatch = property.price.match(/[\\d,]+/);\n                if (priceMatch) {\n                  normalizedProperty.price = parseInt(priceMatch[0].replace(/,/g, ''));\n                }\n              }\n            }\n            \n            // Ensure we have a numeric price\n            if (normalizedProperty.sale_price && typeof normalizedProperty.sale_price === 'string') {\n              const priceMatch = normalizedProperty.sale_price.match(/[\\d,]+/);\n              if (priceMatch) {\n                normalizedProperty.sale_price = parseInt(priceMatch[0].replace(/,/g, ''));\n              }\n            }\n\n            // IMAGE HANDLING - Use the same image getter for sold properties\n            normalizedProperty.image_url = getPropertyImageUrl(property);\n            \n            return normalizedProperty;\n          });\n          \n          // Add investment metrics if not provided by the API\n          const propertiesWithMetrics = processedProperties.map((property: any) => \n            addInvestmentMetrics(property)\n          );\n          \n          setSoldProperties(propertiesWithMetrics);\n          setTotalResults(soldResults.total);\n          setTotalPages(soldResults.totalPages);\n          \n          if (soldResults.properties.length === 0) {\n            toast({\n              variant: \"default\",\n              title: \"No Results\",\n              description: \"No sold properties found for this search criteria. Try adjusting your filters.\",\n            });\n          }\n        } catch (error) {\n          console.error('Error fetching sold properties:', error);\n          toast({\n            variant: \"destructive\",\n            title: \"Error\",\n            description: error instanceof Error ? error.message : \"Could not fetch sold properties. Please check your search criteria and try again.\",\n          });\n          setSoldProperties([]);\n          setTotalResults(0);\n          setTotalPages(1);\n        }\n      }\n\n    } catch (error) {\n      console.error('Search error:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"An unexpected error occurred. Please try again.\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Function to calculate investment metrics if they're not provided by the API\n  const addInvestmentMetrics = <T extends ListedProperty | SoldProperty>(property: T): T => {\n    const propertyWithMetrics = { ...property };\n    \n    // Determine the actual price from various possible fields\n    const price = \n      propertyWithMetrics.price || \n      propertyWithMetrics.asking_price || \n      propertyWithMetrics.sale_price || \n      (propertyWithMetrics as any).price_paid ||\n      (propertyWithMetrics as any).latest_price ||\n      0;\n    \n    if (price > 0) {\n      // Calculate stamp duty (assuming standard purchase)\n      if (!propertyWithMetrics.stamp_duty) {\n        propertyWithMetrics.stamp_duty = calculateStampDuty(price);\n      }\n      \n      // Calculate price per square foot if size data is available\n      if (propertyWithMetrics.size_sq_meters && !propertyWithMetrics.price_per_sqft) {\n        propertyWithMetrics.price_per_sqft = calculatePricePerSqft(price, propertyWithMetrics.size_sq_meters, true);\n      } else if (propertyWithMetrics.size_sq_feet && !propertyWithMetrics.price_per_sqft) {\n        propertyWithMetrics.price_per_sqft = calculatePricePerSqft(price, propertyWithMetrics.size_sq_feet, false);\n      }\n      \n      // Only calculate rent estimates if not already provided\n      if (!propertyWithMetrics.estimated_rent) {\n        // Basic rent calculation (very simplified)\n        // In reality, this would be based on location, property type, size, etc.\n        let monthlyRentEstimate = 0;\n        \n        // Rough estimate based on property type and UK averages\n        // Typically annual rent is 3-5% of property value\n        const rentYieldFactor = 0.04; // 4% annual yield\n        const annualRent = price * rentYieldFactor;\n        monthlyRentEstimate = annualRent / 12;\n        \n        // Adjust based on bedrooms if available\n        if (propertyWithMetrics.bedrooms) {\n          // Slight adjustment based on number of bedrooms\n          const bedroomFactor = 1 + (propertyWithMetrics.bedrooms - 2) * 0.1; // 10% per bedroom difference from 2\n          monthlyRentEstimate *= Math.max(0.8, Math.min(bedroomFactor, 1.5)); // Cap between 0.8x and 1.5x\n        }\n        \n        propertyWithMetrics.estimated_rent = Math.round(monthlyRentEstimate);\n        \n        // Calculate rental yield\n        if (!propertyWithMetrics.rental_yield) {\n          const annualRent = propertyWithMetrics.estimated_rent * 12;\n          propertyWithMetrics.rental_yield = (annualRent / price) * 100;\n        }\n        \n        // Calculate ROI (simplified)\n        if (!propertyWithMetrics.roi) {\n          // Assume 5-year holding period with 3% annual price appreciation\n          const annualAppreciation = 0.03;\n          const holdingYears = 5;\n          const futureValue = price * Math.pow(1 + annualAppreciation, holdingYears);\n          const totalRent = propertyWithMetrics.estimated_rent * 12 * holdingYears;\n          const totalReturn = (futureValue - price) + totalRent;\n          propertyWithMetrics.roi = (totalReturn / price) * 100;\n        }\n        \n        // Estimated annual growth\n        if (!propertyWithMetrics.estimated_growth) {\n          // Based on historical UK property price growth\n          propertyWithMetrics.estimated_growth = 3.5;\n        }\n      }\n    }\n    \n    return propertyWithMetrics;\n  };\n\n  // Function to get a fallback image based on property type\n  const getPropertyTypeImage = (propertyType: string): string => {\n    // Convert to lowercase and handle variations\n    const type = propertyType?.toLowerCase() || '';\n    \n    if (type.includes('flat') || type.includes('apartment')) {\n      return '/images/property-types/flat.jpg';\n    } else if (type.includes('terrace') || type.includes('terraced')) {\n      return '/images/property-types/terraced.jpg';\n    } else if (type.includes('semi') || type.includes('semi-detached')) {\n      return '/images/property-types/semi-detached.jpg';\n    } else if (type.includes('detached')) {\n      return '/images/property-types/detached.jpg';\n    } else if (type.includes('bungalow')) {\n      return '/images/property-types/bungalow.jpg';\n    } else if (type.includes('house')) {\n      return '/images/property-types/house.jpg';\n    }\n    \n    // Default fallback\n    return '/images/property-types/house.jpg';\n  };\n\n  // Add a function to calculate stamp duty\n  const calculateStampDuty = (price: number, isBuyToLet: boolean = false, isFirstTimeBuyer: boolean = false) => {\n    // UK Stamp Duty rates as of 2023\n    if (price <= 0) return 0;\n    \n    let stampDuty = 0;\n    \n    if (isFirstTimeBuyer) {\n      // First-time buyer rates\n      if (price <= 425000) {\n        stampDuty = 0;\n      } else if (price <= 625000) {\n        stampDuty = (price - 425000) * 0.05;\n      } else {\n        // First-time buyers purchasing property over 625,000 don't get relief\n        isFirstTimeBuyer = false;\n      }\n    }\n    \n    if (!isFirstTimeBuyer) {\n      // Standard rates\n      if (price <= 250000) {\n        stampDuty = 0;\n      } else if (price <= 925000) {\n        stampDuty = (price - 250000) * 0.05;\n      } else if (price <= 1500000) {\n        stampDuty = (price - 925000) * 0.1 + (925000 - 250000) * 0.05;\n      } else {\n        stampDuty = (price - 1500000) * 0.12 + (1500000 - 925000) * 0.1 + (925000 - 250000) * 0.05;\n      }\n    }\n    \n    // Additional rate for buy-to-let/second homes\n    if (isBuyToLet) {\n      stampDuty += price * 0.03;\n    }\n    \n    return Math.round(stampDuty);\n  };\n  \n  // Add a utility function to calculate price per square foot/meter\n  const calculatePricePerSqft = (price: number, size: number, isMetric: boolean = false) => {\n    if (!price || !size || size <= 0) return null;\n    \n    if (isMetric) {\n      // Price per square meter\n      return Math.round(price / size);\n    } else {\n      // Price per square foot (convert from square meters if necessary)\n      const sizeInSqft = isMetric ? size * 10.764 : size;\n      return Math.round(price / sizeInSqft);\n    }\n  };\n\n  React.useEffect(() => {\n    if (searchTerm) {\n      handleSearch();\n    }\n  }, [viewMode, filters.page]);\n\n  // Ensure we have a valid property type when switching to sold properties view\n  React.useEffect(() => {\n    if (viewMode === 'sold' && filters.propertyType === 'any') {\n      setFilters(prev => ({ ...prev, propertyType: 'flat' }));\n    }\n  }, [viewMode, filters.propertyType]);\n\n  // Filter handlers\n  const handlePropertyTypeChange = (value: PropertyType) => {\n    setFilters(prev => ({ ...prev, propertyType: value, page: 1 }));\n  };\n\n  const handleTenureChange = (value: PropertyTenure) => {\n    setFilters(prev => ({ ...prev, tenure: value, page: 1 }));\n  };\n\n  const handleBedroomsChange = (value: string) => {\n    setFilters(prev => ({ ...prev, minBeds: value, page: 1 }));\n  };\n\n  const handleRadiusChange = (value: string) => {\n    setFilters(prev => ({ ...prev, radius: parseFloat(value), page: 1 }));\n  };\n\n  const handleSortChange = (value: typeof filters.sortBy) => {\n    setFilters(prev => ({ ...prev, sortBy: value, page: 1 }));\n  };\n\n  // Function to open the property modal\n  const openPropertyModal = (property: ListedProperty | SoldProperty) => {\n    setSelectedProperty(property);\n    setIsModalOpen(true);\n  };\n\n  // Function to close the property modal\n  const closePropertyModal = () => {\n    setIsModalOpen(false);\n    // Keep the property data for a moment to avoid UI jumps during the closing animation\n    setTimeout(() => setSelectedProperty(null), 300);\n  };\n\n  // Add a property details modal component\n  const PropertyModal = () => {\n    if (!selectedProperty) return null;\n    \n    const price = \n      selectedProperty.price || \n      selectedProperty.asking_price || \n      selectedProperty.sale_price || \n      (selectedProperty as any).price_paid ||\n      (selectedProperty as any).latest_price || \n      0;\n      \n    const isSoldProperty = 'date_of_transfer' in selectedProperty;\n    const isListedProperty = !isSoldProperty;\n    \n    // Just use the image URL from the property, no fallbacks\n    const imageUrl = selectedProperty.image_url;\n    \n    // Format postcode with fallback\n    const displayPostcode = selectedProperty.postcode || \n                          (selectedProperty.address && selectedProperty.address.match(/[A-Z]{1,2}[0-9][0-9A-Z]?\\s?[0-9][A-Z]{2}/i)?.[0]) || \n                          \"Not Available\";\n    \n    // Extract sale history data for chart\n    const hasSaleHistory = selectedProperty.sold_history && selectedProperty.sold_history.length > 0;\n    const saleHistoryData = hasSaleHistory \n      ? selectedProperty.sold_history\n          .filter((sale: any) => sale && sale.date && !isNaN(new Date(sale.date).getTime()) && sale.price && !isNaN(parseFloat(String(sale.price))))\n          .sort((a: any, b: any) => new Date(a.date).getTime() - new Date(b.date).getTime())\n      : [];\n    \n    // Calculate price growth percentage if multiple sales\n    const priceGrowth = saleHistoryData.length >= 2 \n      ? ((saleHistoryData[saleHistoryData.length - 1].price - saleHistoryData[0].price) / saleHistoryData[0].price) * 100\n      : null;\n    \n    // Simple mortgage calculation (very basic)\n    const calculateMortgage = (propertyPrice: number, downPaymentPercent: number = 25, interestRate: number = 4.5, termYears: number = 25) => {\n      const downPayment = propertyPrice * (downPaymentPercent / 100);\n      const loanAmount = propertyPrice - downPayment;\n      const monthlyInterest = interestRate / 100 / 12;\n      const totalPayments = termYears * 12;\n      \n      const monthlyPayment = loanAmount * (\n        monthlyInterest * Math.pow(1 + monthlyInterest, totalPayments)\n      ) / (\n        Math.pow(1 + monthlyInterest, totalPayments) - 1\n      );\n      \n      return {\n        downPayment,\n        loanAmount,\n        monthlyPayment,\n        totalPayments,\n        totalRepayment: monthlyPayment * totalPayments\n      };\n    };\n    \n    // Only calculate if we have a valid price\n    const mortgageDetails = price > 0 ? calculateMortgage(price) : null;\n    \n    return (\n      <div className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isModalOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'} transition-opacity duration-300`}>\n        {/* Modal backdrop */}\n        <div className=\"absolute inset-0 bg-black/60\" onClick={closePropertyModal} />\n        \n        {/* Modal content */}\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n          {/* Close button */}\n          <button \n            onClick={closePropertyModal}\n            className=\"absolute top-4 right-4 z-10 bg-white/80 p-1 rounded-full hover:bg-white transition-colors\"\n          >\n            <X className=\"h-6 w-6\" />\n          </button>\n          \n          <div className=\"flex flex-col md:flex-row h-full overflow-hidden\">\n            {/* Property image(s) */}\n            <div className=\"w-full md:w-2/5 h-64 md:h-auto relative bg-gray-100\">\n              {imageUrl ? (\n                <img \n                  src={imageUrl}\n                  alt={selectedProperty.address || \"Property\"}\n                  className=\"w-full h-full object-cover\"\n                />\n              ) : (\n                <div className=\"w-full h-full flex items-center justify-center\">\n                  <Home className=\"h-16 w-16 text-gray-300\" />\n                  <p className=\"text-gray-400 text-sm mt-2\">No image available</p>\n                </div>\n              )}\n              \n              {/* Property type badge */}\n              <div className=\"absolute top-4 left-4\">\n                <span className=\"bg-white/90 text-black px-3 py-1 rounded-full text-sm font-medium\">\n                  {selectedProperty.property_type}\n                </span>\n              </div>\n              \n              {/* External link if available */}\n              {selectedProperty.listing_url && (\n                <a \n                  href={selectedProperty.listing_url} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"absolute bottom-4 left-4 bg-white/90 text-black px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1 hover:bg-white transition-colors\"\n                >\n                  <ExternalLink className=\"h-4 w-4\" />\n                  View Listing\n                </a>\n              )}\n            </div>\n            \n            {/* Property details */}\n            <div className=\"w-full md:w-3/5 p-6 overflow-y-auto\">\n              <h2 className=\"text-xl font-bold mb-2\">{selectedProperty.address}</h2>\n              <p className=\"text-3xl font-bold mb-4 text-emerald-600\">\n                {formatCurrency(price)}\n              </p>\n              \n              {/* Key property details */}\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6\">\n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm text-gray-500\">Property Type</span>\n                  <div className=\"flex items-center gap-1 mt-1\">\n                    <Building className=\"h-4 w-4 text-gray-600\" />\n                    <span className=\"font-medium\">{selectedProperty.property_type || 'N/A'}</span>\n                  </div>\n                </div>\n                \n                {selectedProperty.bedrooms && (\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm text-gray-500\">Bedrooms</span>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <Bed className=\"h-4 w-4 text-gray-600\" />\n                      <span className=\"font-medium\">{selectedProperty.bedrooms}</span>\n                    </div>\n                  </div>\n                )}\n                \n                {selectedProperty.bathrooms && (\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm text-gray-500\">Bathrooms</span>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <div className=\"h-4 w-4 text-gray-600 flex items-center justify-center\"></div>\n                      <span className=\"font-medium\">{selectedProperty.bathrooms}</span>\n                    </div>\n                  </div>\n                )}\n                \n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm text-gray-500\">Postcode</span>\n                  <div className=\"flex items-center gap-1 mt-1\">\n                    <MapPin className=\"h-4 w-4 text-gray-600\" />\n                    <span className=\"font-medium\">{displayPostcode}</span>\n                  </div>\n                </div>\n                \n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm text-gray-500\">Tenure</span>\n                  <div className=\"flex items-center gap-1 mt-1\">\n                    <Key className=\"h-4 w-4 text-gray-600\" />\n                    <span className=\"font-medium\">{selectedProperty.tenure || 'N/A'}</span>\n                  </div>\n                </div>\n                \n                {isSoldProperty && (\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm text-gray-500\">Sold Date</span>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <Calendar className=\"h-4 w-4 text-gray-600\" />\n                      <span className=\"font-medium\">\n                        {new Date((selectedProperty as SoldProperty).date_of_transfer).toLocaleDateString()}\n                      </span>\n                    </div>\n                  </div>\n                )}\n                \n                {(selectedProperty.size_sq_feet || selectedProperty.size_sq_meters) && (\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm text-gray-500\">Size</span>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <SquareIcon className=\"h-4 w-4 text-gray-600\" />\n                      <span className=\"font-medium\">\n                        {selectedProperty.size_sq_feet ? `${selectedProperty.size_sq_feet} sq.ft` : ''}\n                        {selectedProperty.size_sq_meters ? `${selectedProperty.size_sq_meters} m` : ''}\n                      </span>\n                    </div>\n                  </div>\n                )}\n                \n                {selectedProperty.price_per_sqft && (\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm text-gray-500\">Price per sq.ft</span>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <PoundSterling className=\"h-4 w-4 text-gray-600\" />\n                      <span className=\"font-medium\">{formatCurrency(selectedProperty.price_per_sqft)}</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n              \n              {/* Investment dashboard section */}\n              <div className=\"mb-6 bg-gray-50 p-4 rounded-lg border border-gray-100\">\n                <h3 className=\"text-lg font-semibold mb-3 flex items-center\">\n                  <TrendingUp className=\"h-5 w-5 mr-2 text-emerald-600\" />\n                  Investment Dashboard\n                </h3>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {/* ROI and Yield Section */}\n                  <div className=\"space-y-4\">\n                    {selectedProperty.estimated_rent && (\n                      <div className=\"bg-blue-50 p-3 rounded\">\n                        <p className=\"text-blue-800 text-sm font-medium\">Estimated Monthly Rent</p>\n                        <p className=\"text-blue-600 text-lg font-bold mt-1\">\n                          {formatCurrency(selectedProperty.estimated_rent)}/month\n                        </p>\n                        {selectedProperty.rental_yield && (\n                          <p className=\"text-blue-600 text-sm mt-1\">\n                            {selectedProperty.rental_yield.toFixed(1)}% yield\n                          </p>\n                        )}\n                      </div>\n                    )}\n                    \n                    {selectedProperty.roi && (\n                      <div className=\"bg-purple-50 p-3 rounded\">\n                        <p className=\"text-purple-800 text-sm font-medium\">5-Year ROI Estimate</p>\n                        <p className=\"text-purple-600 text-lg font-bold mt-1\">\n                          {selectedProperty.roi.toFixed(1)}%\n                        </p>\n                        {selectedProperty.estimated_growth && (\n                          <p className=\"text-purple-600 text-sm mt-1\">\n                            {selectedProperty.estimated_growth.toFixed(1)}% annual growth\n                          </p>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                  \n                  {/* Mortgage Calculator Section */}\n                  {mortgageDetails && (\n                    <div className=\"bg-emerald-50 p-3 rounded\">\n                      <p className=\"text-emerald-800 text-sm font-medium\">Mortgage Estimate (25% deposit)</p>\n                      <p className=\"text-emerald-600 text-lg font-bold mt-1\">\n                        {formatCurrency(mortgageDetails.monthlyPayment)}/month\n                      </p>\n                      <div className=\"mt-2 text-sm text-emerald-700 space-y-1\">\n                        <div className=\"flex justify-between\">\n                          <span>Deposit (25%):</span>\n                          <span>{formatCurrency(mortgageDetails.downPayment)}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Loan amount:</span>\n                          <span>{formatCurrency(mortgageDetails.loanAmount)}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Term:</span>\n                          <span>25 years at 4.5%</span>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                {/* Cash Flow Analysis */}\n                {selectedProperty.estimated_rent && mortgageDetails && (\n                  <div className=\"mt-4 bg-white p-3 rounded border border-gray-100\">\n                    <p className=\"text-gray-800 text-sm font-medium\">Monthly Cash Flow Analysis</p>\n                    <div className=\"mt-2 space-y-1 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span>Rental Income:</span>\n                        <span className=\"text-emerald-600\">+{formatCurrency(selectedProperty.estimated_rent)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Mortgage Payment:</span>\n                        <span className=\"text-red-600\">-{formatCurrency(mortgageDetails.monthlyPayment)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Management (10%):</span>\n                        <span className=\"text-red-600\">-{formatCurrency(selectedProperty.estimated_rent * 0.1)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Maintenance (5%):</span>\n                        <span className=\"text-red-600\">-{formatCurrency(selectedProperty.estimated_rent * 0.05)}</span>\n                      </div>\n                      <div className=\"flex justify-between font-bold pt-2 border-t border-gray-100 mt-2\">\n                        <span>Net Cash Flow:</span>\n                        <span className={`${selectedProperty.estimated_rent - mortgageDetails.monthlyPayment - selectedProperty.estimated_rent * 0.15 > 0 ? 'text-emerald-600' : 'text-red-600'}`}>\n                          {formatCurrency(selectedProperty.estimated_rent - mortgageDetails.monthlyPayment - selectedProperty.estimated_rent * 0.15)}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n              \n              {/* Purchase costs breakdown */}\n              {selectedProperty.stamp_duty !== undefined && (\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-3\">Purchase Costs</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-amber-50 p-3 rounded\">\n                      <p className=\"text-amber-800 text-sm font-medium\">Stamp Duty</p>\n                      <p className=\"text-amber-600 text-lg font-bold mt-1\">\n                        {formatCurrency(selectedProperty.stamp_duty)}\n                      </p>\n                      <p className=\"text-amber-700 text-xs mt-2\">\n                        First-time buyer? You may qualify for lower rates.\n                      </p>\n                    </div>\n                    \n                    <div className=\"bg-emerald-50 p-3 rounded\">\n                      <p className=\"text-emerald-800 text-sm font-medium\">Total Purchase Cost</p>\n                      <p className=\"text-emerald-600 text-lg font-bold mt-1\">\n                        {formatCurrency(price + (selectedProperty.stamp_duty || 0))}\n                      </p>\n                      <div className=\"mt-2 text-sm text-emerald-700 space-y-1\">\n                        <div className=\"flex justify-between\">\n                          <span>Property price:</span>\n                          <span>{formatCurrency(price)}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Stamp duty:</span>\n                          <span>{formatCurrency(selectedProperty.stamp_duty || 0)}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Legal fees (est.):</span>\n                          <span>{formatCurrency(1500)}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n              \n              {/* Area insights with visualization */}\n              {areaInsights.priceHistory?.data?.trend_percentage !== undefined && (\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-3 flex items-center\">\n                    <AreaChart className=\"h-5 w-5 mr-2 text-blue-600\" />\n                    Area Insights\n                  </h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-cyan-50 p-3 rounded\">\n                      <p className=\"text-cyan-800 text-sm font-medium\">Area Price Trend</p>\n                      <div className=\"flex items-center gap-1 mt-1\">\n                        {areaInsights.priceHistory.data.trend_percentage > 0 ? (\n                          <ArrowUpRight className=\"h-5 w-5 text-emerald-600\" />\n                        ) : (\n                          <ArrowDownRight className=\"h-5 w-5 text-red-600\" />\n                        )}\n                        <p className={`text-lg font-bold ${areaInsights.priceHistory.data.trend_percentage > 0 ? 'text-emerald-600' : 'text-red-600'}`}>\n                          {areaInsights.priceHistory.data.trend_percentage.toFixed(1)}%\n                        </p>\n                      </div>\n                      <p className=\"text-cyan-600 text-sm mt-1\">Last 12 months</p>\n                      \n                      {/* Add simple visual trend indicator */}\n                      <div className=\"mt-3 h-10 bg-white rounded overflow-hidden\">\n                        <div \n                          className={`h-full ${areaInsights.priceHistory.data.trend_percentage > 0 ? 'bg-emerald-500' : 'bg-red-500'}`}\n                          style={{ width: `${Math.min(Math.abs(areaInsights.priceHistory.data.trend_percentage) * 3, 100)}%` }}\n                        ></div>\n                      </div>\n                    </div>\n                    \n                    {areaInsights.askingPrices?.data?.mean && (\n                      <div className=\"bg-teal-50 p-3 rounded\">\n                        <p className=\"text-teal-800 text-sm font-medium\">Average Area Price</p>\n                        <p className=\"text-teal-600 text-lg font-bold mt-1\">\n                          {formatCurrency(areaInsights.askingPrices.data.mean)}\n                        </p>\n                        {price > 0 && (\n                          <div>\n                            <p className=\"text-teal-600 text-sm mt-1\">\n                              This property is <strong>{price < areaInsights.askingPrices.data.mean ? 'below' : 'above'}</strong> average\n                            </p>\n                            \n                            {/* Add visual price comparison */}\n                            <div className=\"mt-3 relative h-10 bg-gray-100 rounded overflow-hidden\">\n                              <div className=\"absolute inset-0 flex\">\n                                <div className=\"h-full bg-teal-200\" style={{ width: '50%' }}></div>\n                                <div className=\"h-full bg-teal-300\" style={{ width: '50%' }}></div>\n                              </div>\n                              <div \n                                className=\"absolute top-0 h-full w-1 bg-black\"\n                                style={{ \n                                  left: '50%',\n                                  transform: 'translateX(-50%)'\n                                }}\n                              ></div>\n                              <div \n                                className=\"absolute top-0 h-full w-2 bg-emerald-600 rounded\"\n                                style={{ \n                                  left: `${Math.min(Math.max((price / areaInsights.askingPrices.data.mean) * 50, 10), 90)}%`,\n                                  transform: 'translateX(-50%)'\n                                }}\n                              ></div>\n                            </div>\n                            <div className=\"flex justify-between text-xs mt-1 text-gray-600\">\n                              <span>-50%</span>\n                              <span>Average</span>\n                              <span>+50%</span>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n              \n              {/* Additional property details if available */}\n              {selectedProperty.description && (\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-2\">Description</h3>\n                  <p className=\"text-gray-600\">{selectedProperty.description}</p>\n                </div>\n              )}\n              \n              {/* If there are sold history records, show them with visualization */}\n              {hasSaleHistory && saleHistoryData.length > 0 && (\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-3 flex items-center\">\n                    <TrendingUp className=\"h-5 w-5 mr-2 text-amber-600\" />\n                    Sale History\n                  </h3>\n                  \n                  {/* Add price growth indicator if we have multiple sales */}\n                  {priceGrowth !== null && (\n                    <div className=\"mb-3 p-3 rounded bg-amber-50\">\n                      <div className=\"flex items-center\">\n                        <span className=\"text-amber-800 text-sm mr-2\">Total Price Growth:</span>\n                        <span className={`font-bold ${priceGrowth >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>\n                          {priceGrowth >= 0 ? '+' : ''}{priceGrowth.toFixed(1)}%\n                        </span>\n                      </div>\n                      \n                      {/* Add time period */}\n                      {saleHistoryData.length >= 2 && (\n                        <div className=\"text-xs text-amber-700 mt-1\">\n                          Over {Math.round((new Date(saleHistoryData[saleHistoryData.length - 1].date).getTime() - \n                                          new Date(saleHistoryData[0].date).getTime()) / \n                                          (1000 * 60 * 60 * 24 * 365))} years \n                          ({new Date(saleHistoryData[0].date).getFullYear()} to {new Date(saleHistoryData[saleHistoryData.length - 1].date).getFullYear()})\n                        </div>\n                      )}\n                    </div>\n                  )}\n                  \n                  {/* Price history visualization */}\n                  {saleHistoryData.length >= 2 && (\n                    <div className=\"mb-4 bg-white p-3 rounded border border-gray-100\">\n                      <div className=\"h-32 relative\">\n                        {/* Simple chart visualization */}\n                        <div className=\"absolute bottom-0 left-0 right-0 flex items-end h-full\">\n                          {saleHistoryData.map((sale: any, idx: number) => {\n                            const maxPrice = Math.max(...saleHistoryData.map((s: any) => s.price));\n                            const height = (sale.price / maxPrice) * 100;\n                            const width = `${100 / saleHistoryData.length}%`;\n                            const margin = idx > 0 ? '0 0 0 1px' : '0';\n                            return (\n                              <div \n                                key={idx}\n                                className=\"bg-emerald-500 hover:bg-emerald-600 transition-colors relative group\"\n                                style={{ \n                                  height: `${height}%`,\n                                  width,\n                                  margin\n                                }}\n                              >\n                                {/* Tooltip on hover */}\n                                <div className=\"hidden group-hover:block absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-black text-white text-xs rounded px-2 py-1 whitespace-nowrap\">\n                                  <div>{formatCurrency(sale.price)}</div>\n                                  <div>{new Date(sale.date).toLocaleDateString()}</div>\n                                </div>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                      <div className=\"flex justify-between text-xs text-gray-500 mt-2\">\n                        {saleHistoryData.map((sale: any, idx: number) => (\n                          <div key={idx}>\n                            {new Date(sale.date).getFullYear()}\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  \n                  {/* Detailed sale history table */}\n                  <div className=\"space-y-2\">\n                    {saleHistoryData.map((sale: any, idx: number) => (\n                      <div key={idx} className=\"flex justify-between border-b border-gray-100 pb-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-gray-600\" />\n                          <span>{new Date(sale.date).toLocaleDateString()}</span>\n                        </div>\n                        <span className=\"font-medium\">\n                          {typeof sale.price === 'number' && !isNaN(sale.price) \n                            ? formatCurrency(sale.price) \n                            : 'Price not available'}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Display nearby amenities if available */}\n              {selectedProperty.nearby_stations && selectedProperty.nearby_stations.length > 0 && (\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-3\">Nearby Transport</h3>\n                  <div className=\"space-y-2\">\n                    {selectedProperty.nearby_stations.map((station: any, idx: number) => (\n                      <div key={idx} className=\"flex justify-between border-b border-gray-100 pb-2\">\n                        <span>{station.name}</span>\n                        <span className=\"text-gray-600\">{station.distance} miles</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Display nearby schools if available */}\n              {selectedProperty.nearby_schools && selectedProperty.nearby_schools.length > 0 && (\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-3\">Nearby Schools</h3>\n                  <div className=\"space-y-2\">\n                    {selectedProperty.nearby_schools.map((school: any, idx: number) => (\n                      <div key={idx} className=\"flex justify-between border-b border-gray-100 pb-2\">\n                        <span>{school.name}</span>\n                        <span className=\"text-gray-600\">{school.distance} miles</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <Layout>\n      {/* Hero Section - Matching Deals page design */}\n      <div className=\"bg-background\">\n        <div className=\"relative\">\n          <div className=\"absolute inset-0\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-emerald-500 to-cyan-500 mix-blend-multiply\" />\n          </div>\n          <div className=\"relative px-4 py-24 sm:px-6 sm:py-32 lg:py-40 lg:px-8\">\n            <h1 className=\"text-center text-4xl font-extrabold tracking-tight text-white sm:text-5xl lg:text-6xl\">\n              Property Search\n            </h1>\n            <p className=\"mx-auto mt-6 max-w-lg text-center text-xl text-white sm:max-w-3xl\">\n              Search through thousands of properties, compare market prices, and make informed decisions with our comprehensive property data.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        {/* Combined Search and Filters Section */}\n        <div className=\"bg-white rounded-xl shadow-md p-6 mb-8 -mt-16 relative z-10\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n            <h2 className=\"text-2xl font-bold\">Find Properties</h2>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={viewMode === 'listed' ? 'default' : 'outline'}\n                onClick={() => setViewMode('listed')}\n                className=\"min-w-[120px]\"\n              >\n                Listed Properties\n              </Button>\n              <Button\n                variant={viewMode === 'sold' ? 'default' : 'outline'}\n                onClick={() => setViewMode('sold')}\n                className=\"min-w-[120px]\"\n              >\n                Sold Properties\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"space-y-6\">\n            {/* Filters Grid */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <Select\n                value={filters.propertyType}\n                onValueChange={handlePropertyTypeChange}\n              >\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\"Property Type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {/* Only show \"Any Type\" for listed properties */}\n                  {viewMode === 'listed' && (\n                    <SelectItem value=\"any\">Any Type</SelectItem>\n                  )}\n                  <SelectItem value=\"flat\">Flat</SelectItem>\n                  <SelectItem value=\"terraced\">Terraced</SelectItem>\n                  <SelectItem value=\"semi-detached\">Semi-Detached</SelectItem>\n                  <SelectItem value=\"detached\">Detached</SelectItem>\n                  <SelectItem value=\"bungalow\">Bungalow</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Select\n                value={filters.tenure}\n                onValueChange={handleTenureChange}\n              >\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\"Tenure\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"any\">Any Tenure</SelectItem>\n                  <SelectItem value=\"freehold\">Freehold</SelectItem>\n                  <SelectItem value=\"leasehold\">Leasehold</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Select\n                value={filters.minBeds}\n                onValueChange={handleBedroomsChange}\n              >\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\"Min Bedrooms\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"0\">Any</SelectItem>\n                  {[1, 2, 3, 4, 5].map((num) => (\n                    <SelectItem key={num} value={num.toString()}>{num}+ beds</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              <Select\n                value={filters.radius.toString()}\n                onValueChange={handleRadiusChange}\n              >\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\"Search Radius\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {[0.25, 0.5, 1, 2, 5, 10].map((num) => (\n                    <SelectItem key={num} value={num.toString()}>{num} miles</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              {viewMode === 'listed' && (\n                <Select\n                  value={filters.sortBy}\n                  onValueChange={handleSortChange}\n                >\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Sort By\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"most_recent_sale_date\">Most Recent Sale</SelectItem>\n                    <SelectItem value=\"distance\">Distance</SelectItem>\n                  </SelectContent>\n                </Select>\n              )}\n            </div>\n\n            {/* Search Bar */}\n            <div className=\"flex gap-4 mt-6\">\n              <Input\n                type=\"text\"\n                placeholder=\"Enter location (postcode, city, street, etc.)\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"flex-1 h-12\"\n              />\n              <Button\n                onClick={handleSearch}\n                className=\"h-12 px-8 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white hover:from-emerald-600 hover:to-cyan-600\"\n                disabled={isLoading}\n              >\n                {isLoading ? <LoadingSpinner size=\"sm\" /> : 'Search'}\n              </Button>\n            </div>\n\n            {/* Add advanced options toggles */}\n            <div className=\"mt-4 flex flex-wrap gap-4\">\n              <label className=\"flex items-center gap-2 text-sm\">\n                <input \n                  type=\"checkbox\" \n                  checked={showPricePerSqft} \n                  onChange={(e) => setShowPricePerSqft(e.target.checked)}\n                  className=\"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500\"\n                />\n                Show price per sq.ft\n              </label>\n              <label className=\"flex items-center gap-2 text-sm\">\n                <input \n                  type=\"checkbox\" \n                  checked={showStampDuty} \n                  onChange={(e) => setShowStampDuty(e.target.checked)}\n                  className=\"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500\"\n                />\n                Show stamp duty\n              </label>\n              <label className=\"flex items-center gap-2 text-sm\">\n                <input \n                  type=\"checkbox\" \n                  checked={showPlanningApplications} \n                  onChange={(e) => setShowPlanningApplications(e.target.checked)}\n                  className=\"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500\"\n                />\n                Show planning applications\n              </label>\n            </div>\n          </div>\n        </div>\n\n        {/* Results Section */}\n        {isLoading ? (\n          <div className=\"flex justify-center items-center h-64\">\n            <LoadingSpinner size=\"lg\" />\n          </div>\n        ) : displayProperties.length > 0 ? (\n          <>\n            {/* Area insights summary - show average prices, trends, etc. */}\n            {areaInsights.askingPrices?.data && (\n              <div className=\"mb-8 bg-white rounded-lg shadow p-6\">\n                <h3 className=\"text-lg font-semibold mb-4\">Area Insights for {searchTerm}</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div className=\"bg-emerald-50 rounded-lg p-4\">\n                    <h4 className=\"text-emerald-800 text-sm font-medium mb-2\">Average Asking Price</h4>\n                    <p className=\"text-2xl font-bold text-emerald-700\">\n                      {formatCurrency(areaInsights.askingPrices.data.mean || 0)}\n                    </p>\n                  </div>\n                  \n                  <div className=\"bg-blue-50 rounded-lg p-4\">\n                    <h4 className=\"text-blue-800 text-sm font-medium mb-2\">Median Asking Price</h4>\n                    <p className=\"text-2xl font-bold text-blue-700\">\n                      {formatCurrency(areaInsights.askingPrices.data.median || 0)}\n                    </p>\n                  </div>\n                  \n                  {areaInsights.priceHistory?.data?.trend_percentage !== undefined && (\n                    <div className=\"bg-purple-50 rounded-lg p-4\">\n                      <h4 className=\"text-purple-800 text-sm font-medium mb-2\">Price Trend (12 months)</h4>\n                      <p className=\"text-2xl font-bold text-purple-700\">\n                        {areaInsights.priceHistory.data.trend_percentage.toFixed(1)}%\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n            \n            {/* Properties grid */}\n            <div className=\"mb-6\">\n              <h3 className=\"text-lg text-gray-600\">\n                Found {totalResults} {viewMode === 'listed' ? 'listed' : 'sold'} properties\n              </h3>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {displayProperties.map((property, index) => (\n                <Card \n                  key={`${property.address}-${index}`} \n                  className=\"overflow-hidden hover:shadow-lg transition-shadow duration-200 cursor-pointer\"\n                  onClick={() => openPropertyModal(property)}\n                >\n                  {viewMode === 'listed' ? (\n                    <>\n                      <div className=\"aspect-video relative bg-gray-100\">\n                        {property.image_url ? (\n                          <img\n                            src={property.image_url}\n                            alt={property.address || \"Property\"}\n                            className=\"w-full h-full object-cover\"\n                            loading=\"lazy\"\n                          />\n                        ) : (\n                          <div className=\"w-full h-full flex flex-col items-center justify-center\">\n                            <Home className=\"h-12 w-12 text-gray-300\" />\n                            <p className=\"text-gray-400 text-sm mt-2\">No image available</p>\n                          </div>\n                        )}\n                        <div className=\"absolute top-2 right-2 flex gap-2\">\n                          <span className=\"bg-white/90 text-black px-3 py-1 rounded-full text-sm font-medium\">\n                            {property.property_type}\n                          </span>\n                          {property.new_build && (\n                            <span className=\"bg-emerald-500/90 text-white px-3 py-1 rounded-full text-sm font-medium\">\n                              New Build\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"p-4\">\n                        <h3 className=\"font-semibold text-lg line-clamp-2 mb-2\">\n                          {property.address}\n                        </h3>\n                        <p className=\"text-2xl font-bold mb-3 text-emerald-600\">\n                          {formatCurrency(\n                            property.price || \n                            property.asking_price || \n                            property.last_sold_price ||\n                            (property as any).price_paid ||\n                            (property as any).latest_price || \n                            0\n                          )}\n                        </p>\n                        \n                        {/* Show price per sq ft if available and enabled */}\n                        {showPricePerSqft && property.price_per_sqft && (\n                          <p className=\"text-sm text-gray-600 mb-3\">\n                            {formatCurrency(property.price_per_sqft)}/sq.ft\n                            {property.size_sq_feet && `  ${property.size_sq_feet} sq.ft`}\n                            {property.size_sq_meters && `  ${property.size_sq_meters} m`}\n                          </p>\n                        )}\n                        \n                        <div className=\"flex flex-wrap gap-4 text-sm text-gray-600 mb-3\">\n                          <div className=\"flex items-center gap-1\">\n                            <Bed className=\"h-4 w-4\" />\n                            <span>{property.bedrooms || 'N/A'}</span>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <MapPin className=\"h-4 w-4\" />\n                            <span>{property.postcode}</span>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <Home className=\"h-4 w-4\" />\n                            <span>{property.tenure || 'N/A'}</span>\n                          </div>\n                        </div>\n                        \n                        {/* Stamp Duty section */}\n                        {showStampDuty && property.stamp_duty !== undefined && (\n                          <div className=\"mt-2 mb-3\">\n                            <div className=\"flex justify-between items-center\">\n                              <span className=\"text-sm text-gray-600\">Stamp Duty:</span>\n                              <span className=\"font-medium\">{formatCurrency(property.stamp_duty)}</span>\n                            </div>\n                          </div>\n                        )}\n                        \n                        {/* Enhanced Investment Metrics */}\n                        {(property.estimated_rent || property.rental_yield || property.roi || property.estimated_growth) && (\n                          <div className=\"mt-3 pt-3 border-t border-gray-100\">\n                            <h4 className=\"text-sm font-semibold text-gray-700 mb-2\">Investment Potential</h4>\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs\">\n                              {property.estimated_rent && (\n                                <div className=\"bg-blue-50 p-2 rounded\">\n                                  <p className=\"text-blue-800 font-medium\">Est. Rent</p>\n                                  <p className=\"text-blue-600 font-bold\">{formatCurrency(property.estimated_rent)}/mo</p>\n                                </div>\n                              )}\n                              {property.rental_yield && (\n                                <div className=\"bg-emerald-50 p-2 rounded\">\n                                  <p className=\"text-emerald-800 font-medium\">Yield</p>\n                                  <p className=\"text-emerald-600 font-bold\">{property.rental_yield.toFixed(1)}%</p>\n                                </div>\n                              )}\n                              {property.roi && (\n                                <div className=\"bg-purple-50 p-2 rounded\">\n                                  <p className=\"text-purple-800 font-medium\">5yr ROI</p>\n                                  <p className=\"text-purple-600 font-bold\">{property.roi.toFixed(1)}%</p>\n                                </div>\n                              )}\n                              {property.estimated_growth && (\n                                <div className=\"bg-amber-50 p-2 rounded\">\n                                  <p className=\"text-amber-800 font-medium\">Growth</p>\n                                  <p className=\"text-amber-600 font-bold\">{property.estimated_growth.toFixed(1)}%</p>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </>\n                  ) : (\n                    <div className=\"p-4\">\n                      <h3 className=\"font-semibold text-lg line-clamp-2 mb-2\">\n                        {property.address}\n                      </h3>\n                      <p className=\"text-2xl font-bold mb-3 text-emerald-600\">\n                        {formatCurrency(\n                          property.sale_price || \n                          property.price || \n                          (property as any).price_paid || \n                          0\n                        )}\n                      </p>\n                      <div className=\"flex flex-wrap gap-4 text-sm text-gray-600 mb-3\">\n                        <div className=\"flex items-center gap-1\">\n                          <MapPin className=\"h-4 w-4\" />\n                          <span>{property.postcode}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Home className=\"h-4 w-4\" />\n                          <span>{property.property_type}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-4 w-4\" />\n                          <span>Sold: {new Date(property.date_of_transfer).toLocaleDateString()}</span>\n                        </div>\n                        {property.bedrooms && (\n                          <div className=\"flex items-center gap-1\">\n                            <Bed className=\"h-4 w-4\" />\n                            <span>{property.bedrooms} beds</span>\n                          </div>\n                        )}\n                      </div>\n                      \n                      {/* Stamp Duty section */}\n                      {showStampDuty && property.stamp_duty !== undefined && (\n                        <div className=\"mt-2 mb-3\">\n                          <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm text-gray-600\">Stamp Duty:</span>\n                            <span className=\"font-medium\">{formatCurrency(property.stamp_duty)}</span>\n                          </div>\n                        </div>\n                      )}\n                      \n                      {/* Enhanced Investment Metrics */}\n                      {(property.estimated_rent || property.rental_yield || property.roi || property.estimated_growth) && (\n                        <div className=\"mt-3 pt-3 border-t border-gray-100\">\n                          <h4 className=\"text-sm font-semibold text-gray-700 mb-2\">Investment Potential</h4>\n                          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs\">\n                            {property.estimated_rent && (\n                              <div className=\"bg-blue-50 p-2 rounded\">\n                                <p className=\"text-blue-800 font-medium\">Est. Rent</p>\n                                <p className=\"text-blue-600 font-bold\">{formatCurrency(property.estimated_rent)}/mo</p>\n                              </div>\n                            )}\n                            {property.rental_yield && (\n                              <div className=\"bg-emerald-50 p-2 rounded\">\n                                <p className=\"text-emerald-800 font-medium\">Yield</p>\n                                <p className=\"text-emerald-600 font-bold\">{property.rental_yield.toFixed(1)}%</p>\n                              </div>\n                            )}\n                            {property.roi && (\n                              <div className=\"bg-purple-50 p-2 rounded\">\n                                <p className=\"text-purple-800 font-medium\">5yr ROI</p>\n                                <p className=\"text-purple-600 font-bold\">{property.roi.toFixed(1)}%</p>\n                              </div>\n                            )}\n                            {property.estimated_growth && (\n                              <div className=\"bg-amber-50 p-2 rounded\">\n                                <p className=\"text-amber-800 font-medium\">Growth</p>\n                                <p className=\"text-amber-600 font-bold\">{property.estimated_growth.toFixed(1)}%</p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </Card>\n              ))}\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"mt-8 flex justify-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setFilters(f => ({ ...f, page: Math.max(1, f.page - 1) }))}\n                  disabled={filters.page === 1}\n                >\n                  Previous\n                </Button>\n                <span className=\"flex items-center px-4\">\n                  Page {filters.page} of {totalPages}\n                </span>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setFilters(f => ({ ...f, page: Math.min(totalPages, f.page + 1) }))}\n                  disabled={filters.page === totalPages}\n                >\n                  Next\n                </Button>\n              </div>\n            )}\n          </>\n        ) : (\n          <div className=\"text-center py-12\">\n            <p className=\"text-gray-600\">\n              No {viewMode} properties found. Try adjusting your search criteria.\n            </p>\n          </div>\n        )}\n      </main>\n      \n      {/* Render the modal component */}\n      <PropertyModal />\n    </Layout>\n  );\n} ","import React, { Suspense, useEffect, useState } from \"react\";\nimport { PasswordProtect } from \"./components/PasswordProtect\";\nimport { Loading } from \"./components/ui/loading\";\nimport { AnimatePresence, motion } from \"framer-motion\";\nimport {\n  useLocation,\n  useNavigate,\n  useRoutes,\n  Routes,\n  Route,\n  BrowserRouter,\n} from \"react-router-dom\";\nimport { ProgressBar } from \"./components/ui/progress-bar\";\nimport { AuthProvider } from \"./lib/auth\";\nimport { Toaster } from \"./components/ui/toaster\";\nimport Home from \"./components/home\";\nimport Dashboard from \"./components/Dashboard\";\nimport PricingPage from \"./components/PricingPage\";\nimport SubscriptionSuccess from \"./components/SubscriptionSuccess\";\nimport SubscriptionCancel from \"./components/SubscriptionCancel\";\nimport AccountSettings from \"./components/AccountSettings\";\nimport { RequireAuth } from \"./components/RequireAuth\";\nimport routes from \"./tempo-routes\";\nimport FeaturedProperties from \"./components/SearchResults\";\nimport MarketInsightsPage from \"./components/MarketInsightsPage\";\nimport MarketTrendsPage from \"./components/MarketTrendsPage\";\nimport { ArticlePage } from \"./components/ArticlePage\";\nimport ResearchPage from \"./components/ResearchPage\";\nimport BlogPage from \"./components/BlogPage\";\nimport InvestmentCalculator from \"./components/InvestmentCalculator\";\nimport HelpSupportPage from \"./components/HelpSupportPage\";\nimport { ChatBot } from \"./components/ChatBot\";\nimport AuthCallback from \"./components/AuthCallback\";\nimport PropertyManagementPage from \"./components/PropertyManagementPage\";\nimport InvestmentOpportunitiesPage from \"./components/InvestmentOpportunitiesPage\";\nimport AboutUsPage from \"./components/AboutUsPage\";\nimport DealsPage from \"./components/DealsPage\";\nimport Messages from \"./components/Messages\";\nimport Listings from './pages/Listings';\n\nfunction AppContent() {\n  const [isLoading, setIsLoading] = useState(true);\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  useEffect(() => {\n    const handleStart = () => setIsLoading(true);\n    const handleStop = () => setIsLoading(false);\n\n    handleStart();\n    const timer = setTimeout(handleStop, 100);\n\n    return () => clearTimeout(timer);\n  }, [location.pathname]);\n\n  useEffect(() => {\n    document.documentElement.classList.remove(\"dark\");\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {isLoading && <ProgressBar />}\n      <motion.div\n        key={location.pathname}\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        transition={{ duration: 0.2 }}\n      >\n        <Suspense fallback={<Loading />}>\n          <Routes location={location}>\n            <Route path=\"/\" element={<Home />} />\n            <Route path=\"/deals\" element={<DealsPage />} />\n            <Route\n              path=\"/dashboard\"\n              element={\n                <RequireAuth>\n                  <Dashboard />\n                </RequireAuth>\n              }\n            />\n            <Route path=\"/pricing\" element={<PricingPage />} />\n            <Route\n              path=\"/subscription/success\"\n              element={<SubscriptionSuccess />}\n            />\n            <Route\n              path=\"/subscription/cancel\"\n              element={<SubscriptionCancel />}\n            />\n            <Route\n              path=\"/account\"\n              element={\n                <RequireAuth>\n                  <AccountSettings />\n                </RequireAuth>\n              }\n            />\n            <Route path=\"/insights\" element={<MarketInsightsPage />} />\n            <Route\n              path=\"/trends\"\n              element={<MarketTrendsPage />}\n            />\n            <Route path=\"/research\" element={<ResearchPage />} />\n            <Route path=\"/blog\" element={<BlogPage />} />\n            <Route path=\"/article/:title\" element={<ArticlePage />} />\n            <Route path=\"/blog/:slug\" element={<ArticlePage />} />\n            <Route path=\"/calculators\" element={<InvestmentCalculator />} />\n            <Route path=\"/help\" element={<HelpSupportPage />} />\n            <Route path=\"/auth/callback\" element={<AuthCallback />} />\n            <Route path=\"/property-management\" element={<PropertyManagementPage />} />\n            <Route path=\"/investment-opportunities\" element={<InvestmentOpportunitiesPage />} />\n            <Route path=\"/about-us\" element={<AboutUsPage />} />\n            <Route\n              path=\"/messages\"\n              element={\n                <RequireAuth>\n                  <Messages />\n                </RequireAuth>\n              }\n            />\n            <Route path=\"/listings\" element={<Listings />} />\n            {import.meta.env.VITE_TEMPO === \"true\" && (\n              <Route path=\"/tempobook/*\" />\n            )}\n          </Routes>\n        </Suspense>\n      </motion.div>\n      {import.meta.env.VITE_TEMPO === \"true\" && useRoutes(routes)}\n      <Toaster />\n      <ChatBot />\n    </div>\n  );\n}\n\nexport default function App() {\n  const [isAuthenticated, setIsAuthenticated] = React.useState(() => {\n    return localStorage.getItem(\"password-protected\") === \"true\";\n  });\n\n  if (!isAuthenticated) {\n    return <PasswordProtect onSuccess={() => setIsAuthenticated(true)} />;\n  }\n\n  return (\n    <AuthProvider>\n      <AppContent />\n    </AuthProvider>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport App from \"./App.tsx\";\nimport \"./index.css\";\nimport { BrowserRouter } from \"react-router-dom\";\n\nimport { TempoDevtools } from \"tempo-devtools\";\nimport { AuthProvider } from \"./lib/auth\";\nimport posthog from 'posthog-js'\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\n\nTempoDevtools.init();\n\nposthog.init('phc_Pg1VGdZoazG7KyDNxnUXNZZz6zPVrGNSRtFlDnlZCcA',\n    {\n        api_host: 'https://eu.i.posthog.com',\n        person_profiles: 'identified_only' // or 'always' to create profiles for anonymous users as well\n    }\n)\n\nconst queryClient = new QueryClient();\n\nReactDOM.createRoot(document.getElementById(\"root\")!).render(\n  <React.StrictMode>\n    <QueryClientProvider client={queryClient}>\n      <BrowserRouter>\n        <AuthProvider>\n          <App />\n        </AuthProvider>\n      </BrowserRouter>\n    </QueryClientProvider>\n  </React.StrictMode>,\n);\n"],"file":"assets/index-Bj7jclH4.js"}