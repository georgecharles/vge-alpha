import{t as In,c as An,r as l,j as e,V as ga,R as fa,a as is,A as ja,C as va,b as ya,T as ba,D as Na,P as Pn,d as wa,e as N,S as Sa,f as ka,g as _n,h as Rn,i as Ca,k as En,l as Tn,m as ut,X as Ia,n as Aa,L as Pa,o as _a,p as St,q as Ra,s as Ea,I as Ta,u as Mn,v as Dn,w as Ma,x as Da,F as Fa,y as La,z as Fn,B as Oa,E as Ln,G as $a,H as Ua,J as za,K as Ba,M as Ga,N as qa,O as On,Q as Va,U as Ha,W as $n,Y as Un,Z as Wa,_ as zn,$ as Ya,a0 as Bn,a1 as Ka,a2 as Ja,a3 as Gn,a4 as qn,a5 as Za,a6 as be,a7 as Xa,a8 as ht,a9 as ps,aa as Wt,ab as Yt,ac as bs,ad as ve,ae as Kt,af as Vn,ag as Hn,ah as Wn,ai as Qa,aj as er,ak as Jt,al as sr,am as tr,an as ar,ao as Yn,ap as Kn,aq as Jn,ar as rr,as as nr,at as ir,au as Zn,av as xe,aw as gs,ax as ms,ay as Xn,az as Js,aA as Qn,aB as ei,aC as si,aD as ti,aE as lr,aF as Zs,aG as ye,aH as Zt,aI as ai,aJ as He,aK as We,aL as or,aM as Ts,aN as cr,aO as ri,aP as kt,aQ as xt,aR as Ns,aS as Ct,aT as ni,aU as ii,aV as li,aW as Xs,aX as Us,aY as pt,aZ as zs,a_ as Bs,a$ as Gs,b0 as qs,b1 as Vs,b2 as oi,b3 as ci,b4 as di,b5 as Ms,b6 as rs,b7 as mi,b8 as It,b9 as ui,ba as dr,bb as hi,bc as mr,bd as xi,be as ur,bf as pi,bg as hr,bh as gi,bi as xr,bj as pr,bk as fi,bl as ji,bm as gr,bn as vi,bo as yi,bp as Xt,bq as Hs,br as bi,bs as Ni,bt as wi,bu as fr,bv as Si,bw as jr,bx as vr,by as ds,bz as ki,bA as yr,bB as Ci,bC as Ii,bD as Ai,bE as Pi,bF as fs,bG as _i,bH as Ri,bI as br,bJ as Nr,bK as Ei,bL as wr,bM as Ti,bN as Mi,bO as Sr,bP as kr,bQ as Cr,bR as Di,bS as Fi,bT as Li,bU as us,bV as Ir,bW as Oi,bX as $i,bY as Ar,bZ as Pr,b_ as Ui,b$ as _r,c0 as Rr,c1 as Er,c2 as Tr,c3 as Mr,c4 as zi,c5 as Bi,c6 as Gi,c7 as qi,c8 as Vi,c9 as Hi,ca as Wi,cb as Dr,cc as Yi,cd as se,ce as Qt,cf as Ki,cg as Ji,ch as Zi,ci as Xi,cj as Qi,ck as el}from"./vendor-B1tE1in9.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function k(...s){return In(An(s))}function ue(s){return s==null||isNaN(s)?"Â£0":new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function ts(s){return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"long",year:"numeric"}).format(new Date(s))}function Fr(s){return new Intl.NumberFormat("en-GB").format(s)}const sl=Pn,Lr=l.forwardRef(({className:s,...a},t)=>e.jsx(ga,{ref:t,className:k("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));Lr.displayName=ga.displayName;const tl=is("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Or=l.forwardRef(({className:s,variant:a,...t},r)=>e.jsx(fa,{ref:r,className:k(tl({variant:a}),s),...t}));Or.displayName=fa.displayName;const al=l.forwardRef(({className:s,...a},t)=>e.jsx(ja,{ref:t,className:k("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));al.displayName=ja.displayName;const $r=l.forwardRef(({className:s,...a},t)=>e.jsx(va,{ref:t,className:k("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(ya,{className:"h-4 w-4"})}));$r.displayName=va.displayName;const Ur=l.forwardRef(({className:s,...a},t)=>e.jsx(ba,{ref:t,className:k("text-sm font-semibold [&+div]:text-xs",s),...a}));Ur.displayName=ba.displayName;const zr=l.forwardRef(({className:s,...a},t)=>e.jsx(Na,{ref:t,className:k("text-sm opacity-90",s),...a}));zr.displayName=Na.displayName;const rl=1,nl=1e6;let nt=0;function il(){return nt=(nt+1)%Number.MAX_SAFE_INTEGER,nt.toString()}const it=new Map,ea=s=>{if(it.has(s))return;const a=setTimeout(()=>{it.delete(s),hs({type:"REMOVE_TOAST",toastId:s})},nl);it.set(s,a)},ll=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,rl)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?ea(t):s.toasts.forEach(r=>{ea(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},Ds=[];let Fs={toasts:[]};function hs(s){Fs=ll(Fs,s),Ds.forEach(a=>{a(Fs)})}function oe({...s}){const a=il(),t=n=>hs({type:"UPDATE_TOAST",toast:{...n,id:a}}),r=()=>hs({type:"DISMISS_TOAST",toastId:a});return hs({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:n=>{n||r()}}}),{id:a,dismiss:r,update:t}}function _e(){const[s,a]=l.useState(Fs);return l.useEffect(()=>(Ds.push(a),()=>{const t=Ds.indexOf(a);t>-1&&Ds.splice(t,1)}),[s]),{...s,toast:oe,dismiss:t=>hs({type:"DISMISS_TOAST",toastId:t})}}function ol(){const{toasts:s}=_e();return e.jsxs(sl,{children:[s.map(function({id:a,title:t,description:r,action:n,...o}){return e.jsxs(Or,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(Ur,{children:t}),r&&e.jsx(zr,{children:r})]}),n,e.jsx($r,{})]},a)}),e.jsx(Lr,{})]})}const cl="https://zcuapuvvygahkzljuhyg.supabase.co",dl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjdWFwdXZ2eWdhaGt6bGp1aHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MTQwMzcsImV4cCI6MjA1MzQ5MDAzN30.GIhphzkznmDXgrUApGW479uHHluqDWqy_9cfG5sU5Xc",we=wa(cl,dl),Br=l.createContext({user:null,session:null,profile:null,isLoading:!0,signOut:async()=>{},refreshSession:async()=>{}}),lt=async s=>{try{const{data:a,error:t}=await we.from("profiles").select("*").eq("id",s).single();return t?(console.error("Error fetching profile:",t),null):(console.log("Fetched profile data:",a),a)}catch(a){return console.error("Error in fetchProfile:",a),null}},Gr=({children:s})=>{const[a,t]=l.useState(null),[r,n]=l.useState(null),[o,i]=l.useState(null),[p,c]=l.useState(!0),g=async()=>{var m,y;try{c(!0),console.log("Refreshing session...");const{data:x,error:S}=await we.auth.getSession();if(S)throw S;if(console.log("Session data:",x),n(x.session),t(((m=x.session)==null?void 0:m.user)||null),(y=x.session)!=null&&y.user){const v=await lt(x.session.user.id);i(v)}else i(null)}catch(x){console.error("Error refreshing session:",x),t(null),i(null),n(null)}finally{c(!1)}},h=async()=>{try{c(!0);const{error:m}=await we.auth.signOut();if(m)throw m;t(null),i(null),n(null)}catch(m){console.error("Error signing out:",m)}finally{c(!1)}};l.useEffect(()=>{const y=(async()=>{var S,v;c(!0),console.log("Initializing auth...");try{const{data:j,error:u}=await we.auth.getSession();if(u)throw u;if(console.log("Initial session data:",j),n(j.session),t(((S=j.session)==null?void 0:S.user)||null),(v=j.session)!=null&&v.user){const b=await lt(j.session.user.id);i(b)}}catch(j){console.error("Error initializing auth:",j)}finally{c(!1)}const{data:x}=we.auth.onAuthStateChange(async(j,u)=>{if(console.log("Auth state changed:",j,u),n(u),t((u==null?void 0:u.user)||null),u!=null&&u.user){const b=await lt(u.user.id);i(b)}else i(null)});return()=>{x.subscription.unsubscribe()}})();return()=>{y.then(x=>x&&x())}},[]);const d={user:a,session:r,profile:o,isLoading:p,signOut:h,refreshSession:g};return N.createElement(Br.Provider,{value:d},s)};function ee(){return l.useContext(Br)}function qr({className:s}){return e.jsx("div",{className:k("flex items-center justify-center",s),children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"})})}function ml({isAnimating:s}){const[a,t]=l.useState(0);return l.useEffect(()=>{if(!s){t(0);return}t(10);const r=setTimeout(()=>t(30),100),n=setTimeout(()=>t(60),500),o=setTimeout(()=>t(80),800),i=setTimeout(()=>t(100),1e3);return()=>{clearTimeout(r),clearTimeout(n),clearTimeout(o),clearTimeout(i)}},[s]),!s&&a===0?null:e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50",children:e.jsx("div",{className:"h-1 bg-primary transition-all duration-300 ease-in-out",style:{width:`${a}%`,opacity:a===100?0:1}})})}const At=is("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),w=l.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...n},o)=>{const i=r?Sa:"button";return e.jsx(i,{className:k(At({variant:a,size:t,className:s})),ref:o,...n})});w.displayName="Button";const as=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(ka,{ref:r,className:k("relative overflow-hidden",s),...t,children:[e.jsx(_n,{className:"h-full w-full rounded-[inherit]",children:a}),e.jsx(Vr,{}),e.jsx(Rn,{})]}));as.displayName=ka.displayName;const Vr=l.forwardRef(({className:s,orientation:a="vertical",...t},r)=>e.jsx(Ca,{ref:r,orientation:a,className:k("flex touch-none select-none transition-colors",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(En,{className:"relative flex-1 rounded-full bg-border"})}));Vr.displayName=Ca.displayName;function ul({isOpen:s,onClose:a,children:t}){return e.jsx(Tn,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(ut.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm lg:hidden",onClick:a,style:{width:"100vw"}}),e.jsxs(ut.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:20,stiffness:300},className:k("fixed inset-y-0 right-0 z-50 w-full max-w-xs bg-white shadow-2xl lg:hidden","flex flex-col"),children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsx("a",{href:"/",className:"hover:opacity-80 transition-opacity",children:e.jsx("img",{src:"https://i.postimg.cc/GpdY6N74/my-1920-x-1080-px-1.png",alt:"MyVGE",className:"h-8"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full hover:bg-muted",onClick:r=>{r.stopPropagation(),a()},children:e.jsx(Ia,{className:"h-5 w-5"})})]}),e.jsx(as,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col p-6 pb-16",children:[e.jsx("div",{className:"flex-1",children:t}),e.jsx("div",{className:"mt-auto pt-6",children:e.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:["Â© ",new Date().getFullYear()," MyVGE. All rights reserved."]})})]})})]})]})})}const Hr=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Aa,{ref:r,className:k("relative z-10 flex max-w-max flex-1 items-center justify-center",s),...t,children:[a,e.jsx(Yr,{})]}));Hr.displayName=Aa.displayName;const Wr=l.forwardRef(({className:s,...a},t)=>e.jsx(Pa,{ref:t,className:k("group flex flex-1 list-none items-center justify-center space-x-1",s),...a}));Wr.displayName=Pa.displayName;const cs=Dn,hl=is("group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),gt=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(_a,{ref:r,className:k(hl(),"group",s),...t,children:[a," ",e.jsx(St,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));gt.displayName=_a.displayName;const ft=l.forwardRef(({className:s,...a},t)=>e.jsx(Ra,{ref:t,className:k("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",s),...a}));ft.displayName=Ra.displayName;const Ps=Mn,Yr=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:k("absolute left-0 top-full flex justify-center"),children:e.jsx(Ea,{className:k("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",s),ref:t,...a})}));Yr.displayName=Ea.displayName;const xl=l.forwardRef(({className:s,...a},t)=>e.jsx(Ta,{ref:t,className:k("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",s),...a,children:e.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));xl.displayName=Ta.displayName;const $e=l.forwardRef(({className:s,...a},t)=>e.jsx(Ma,{ref:t,className:k("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));$e.displayName=Ma.displayName;const Ue=l.forwardRef(({className:s,...a},t)=>e.jsx(Da,{ref:t,className:k("aspect-square h-full w-full",s),...a}));Ue.displayName=Da.displayName;const ze=l.forwardRef(({className:s,...a},t)=>e.jsx(Fa,{ref:t,className:k("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));ze.displayName=Fa.displayName;const pl=$n,gl=Un,fl=l.forwardRef(({className:s,inset:a,children:t,...r},n)=>e.jsxs(La,{ref:n,className:k("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",s),...r,children:[t,e.jsx(Fn,{className:"ml-auto h-4 w-4"})]}));fl.displayName=La.displayName;const jl=l.forwardRef(({className:s,...a},t)=>e.jsx(Oa,{ref:t,className:k("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));jl.displayName=Oa.displayName;const Kr=l.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(Ln,{children:e.jsx($a,{ref:r,sideOffset:a,className:k("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));Kr.displayName=$a.displayName;const Ve=l.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(Ua,{ref:r,className:k("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...t}));Ve.displayName=Ua.displayName;const vl=l.forwardRef(({className:s,children:a,checked:t,...r},n)=>e.jsxs(za,{ref:n,className:k("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ba,{children:e.jsx(Ga,{className:"h-4 w-4"})})}),a]}));vl.displayName=za.displayName;const yl=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(qa,{ref:r,className:k("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ba,{children:e.jsx(On,{className:"h-4 w-4 fill-current"})})}),a]}));yl.displayName=qa.displayName;const bl=l.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(Va,{ref:r,className:k("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));bl.displayName=Va.displayName;const Jr=l.forwardRef(({className:s,...a},t)=>e.jsx(Ha,{ref:t,className:k("-mx-1 my-1 h-px bg-muted",s),...a}));Jr.displayName=Ha.displayName;const Ee=Gn,Zr=qn,Nl=zn,Xr=l.forwardRef(({className:s,...a},t)=>e.jsx(Wa,{ref:t,className:k("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));Xr.displayName=Wa.displayName;const Ie=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Nl,{children:[e.jsx(Xr,{}),e.jsxs(Ya,{ref:r,className:k("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[a,e.jsxs(Bn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ya,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ie.displayName=Ya.displayName;const Ae=({className:s,...a})=>e.jsx("div",{className:k("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});Ae.displayName="DialogHeader";const ns=({className:s,...a})=>e.jsx("div",{className:k("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});ns.displayName="DialogFooter";const Pe=l.forwardRef(({className:s,...a},t)=>e.jsx(Ka,{ref:t,className:k("text-lg font-semibold leading-none tracking-tight",s),...a}));Pe.displayName=Ka.displayName;const Ge=l.forwardRef(({className:s,...a},t)=>e.jsx(Ja,{ref:t,className:k("text-sm text-muted-foreground",s),...a}));Ge.displayName=Ja.displayName;const G=l.forwardRef(({className:s,type:a,...t},r)=>e.jsx("input",{type:a,className:k("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...t}));G.displayName="Input";const wl=is("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),q=l.forwardRef(({className:s,...a},t)=>e.jsx(Za,{ref:t,className:k(wl(),s),...a}));q.displayName=Za.displayName;function Sl({isOpen:s,onClose:a,onSuccess:t}){const[r,n]=l.useState(""),[o,i]=l.useState(""),[p,c]=l.useState(!1),{toast:g}=_e(),h=async d=>{d.preventDefault(),c(!0);try{console.log("Attempting login with:",r);const{data:m,error:y}=await we.auth.signInWithPassword({email:r,password:o});if(y)throw console.error("Supabase auth error:",y),y;console.log("Login successful:",m),g({title:"Success",description:"You have successfully logged in."}),a(),setTimeout(()=>{t&&t(),window.location.href=window.location.pathname},300)}catch(m){console.error("Login error:",m),g({variant:"destructive",title:"Login failed",description:m.message||"Please check your credentials and try again."})}finally{c(!1)}};return e.jsx(Ee,{open:s,onOpenChange:a,children:e.jsxs(Ie,{className:"sm:max-w-[425px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"Login"}),e.jsx(Ge,{children:"Enter your credentials to access your account."})]}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:r,onChange:d=>n(d.target.value),placeholder:"your.email@example.com",autoComplete:"email",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",value:o,onChange:d=>i(d.target.value),autoComplete:"current-password",required:!0})]})]}),e.jsx(ns,{children:e.jsx(w,{type:"submit",disabled:p,children:p?"Logging in...":"Login"})})]})]})})}const kl=[{title:"Investment Deals",href:"/deals",icon:"ðŸ’¼",requiresAuth:!0},{title:"Listings",href:"/listings",icon:"ðŸ ",requiresAuth:!1},{title:"Market",items:[{title:"Market Trends",href:"/trends",description:"Stay updated with the latest real estate market trends",requiresAuth:!0},{title:"Market Insights",href:"/insights",description:"Deep dive into property market analytics",requiresAuth:!0},{title:"Research & Reports",href:"/research",description:"Access expert analysis and reports",requiresAuth:!1}],icon:"ðŸ“Š"},{title:"Services",items:[{title:"Property Management",href:"/property-management",description:"Let us take care of your property",requiresAuth:!0},{title:"Investment Opportunities",href:"/investment-opportunities",description:"Discover tailored investment strategies",requiresAuth:!0},{title:"Calculators",href:"/calculators",description:"Calculate your property investment",requiresAuth:!1}],icon:"ðŸ "},{title:"Messages",href:"/messages",icon:"ðŸ’¬",requiresAuth:!0},{title:"Pricing",href:"/pricing",icon:"ðŸ’Ž",requiresAuth:!1},{title:"Support",href:"/help",icon:"â“",requiresAuth:!1},{title:"About Us",href:"/about-us",icon:"â„¹ï¸",requiresAuth:!1}];function ws({isAuthenticated:s=!1,onSignIn:a,onSignUp:t,userProfile:r={},onSignOut:n}){var A,L;const[o,i]=N.useState(!1),[p,c]=N.useState(!1),[g,h]=N.useState(!1),d=be(),m=ee(),y=s||!!m.user,x=r&&Object.keys(r).length>0?r:m.profile,S=n||m.signOut;N.useEffect(()=>{const P=()=>{c(window.scrollY>20)};return window.addEventListener("scroll",P),()=>window.removeEventListener("scroll",P)},[]);const v=P=>{P.preventDefault(),h(!0)},j=async()=>{console.log("Sign out button clicked");try{await S(),window.location.href="/"}catch(P){console.error("Error signing out:",P)}},u=(P,T,O)=>{T&&!y&&(P.preventDefault(),h(!0)),i(!1)},b=N.forwardRef(({className:P,title:T,children:O,...C},_)=>e.jsx("li",{children:e.jsx(Ps,{asChild:!0,children:e.jsxs("a",{ref:_,className:k("block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",P??""),...C,children:[e.jsx("div",{className:"text-sm font-medium leading-none",children:T}),e.jsx("p",{className:"line-clamp-2 text-sm leading-snug text-muted-foreground",children:O})]})})}));return b.displayName="ListItem",e.jsxs(e.Fragment,{children:[e.jsx("header",{className:k("fixed top-0 left-0 right-0 z-50 transition-all duration-300",p?"py-2":"py-4"),children:e.jsx("div",{className:"px-4 mx-auto max-w-7xl",children:e.jsx("div",{className:k("rounded-full bg-white border transition-all duration-300",p?"shadow-md border-gray-200/50 backdrop-blur-md bg-white/90":"shadow-sm border-transparent"),children:e.jsxs("div",{className:"h-16 px-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("a",{href:"/",className:"hover:opacity-80 transition-opacity",children:e.jsx("img",{src:"https://i.postimg.cc/GpdY6N74/my-1920-x-1080-px-1.png",alt:"MyVGE",className:"h-8"})}),e.jsx(Hr,{className:"hidden lg:flex",children:e.jsxs(Wr,{className:"gap-2",children:[e.jsxs(cs,{children:[e.jsx(gt,{className:k("text-sm font-medium rounded-full px-4","bg-transparent hover:bg-gray-100 transition-colors","data-[state=open]:bg-gray-100"),children:"Market"}),e.jsx(ft,{children:e.jsxs("ul",{className:"w-[400px] gap-3 p-4 rounded-2xl",children:[y?e.jsxs(e.Fragment,{children:[e.jsx(b,{href:"/trends",title:"Market Trends",children:"Stay updated with the latest real estate market trends."}),e.jsx(b,{href:"/insights",title:"Market Insights",children:"Deep dive into property market analytics and forecasts."})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{href:"#",onClick:v,title:"Market Trends",children:"Sign in to access market trends."}),e.jsx(b,{href:"#",onClick:v,title:"Market Insights",children:"Sign in to access market insights."})]}),e.jsx(b,{href:"/research",title:"Research & Reports",children:"Access expert analysis and reports."})]})})]}),e.jsx(cs,{children:e.jsx(Ps,{className:k("text-sm font-medium rounded-full px-4 py-2","hover:bg-gray-100 transition-colors"),href:"/deals",children:"Deals"})}),e.jsx(cs,{children:e.jsx(Ps,{className:k("text-sm font-medium rounded-full px-4 py-2","hover:bg-gray-100 transition-colors"),href:"/listings",children:"Listings"})}),e.jsxs(cs,{children:[e.jsx(gt,{className:k("text-sm font-medium rounded-full px-4","bg-transparent hover:bg-gray-100 transition-colors","data-[state=open]:bg-gray-100"),children:"Services"}),e.jsx(ft,{children:e.jsxs("ul",{className:"w-[400px] gap-3 p-4 rounded-2xl",children:[e.jsx(b,{href:"/property-management",title:"Property Management",children:"Let us take care of your property."}),e.jsx(b,{href:"/investment-opportunities",title:"Investment Opportunities",children:"Discover tailored investment strategies."}),e.jsx(b,{href:"/calculators",title:"Calculators",children:"Calculate different aspects of your property investment."})]})})]}),e.jsx(cs,{children:e.jsx(Ps,{className:k("text-sm font-medium rounded-full px-4 py-2","hover:bg-gray-100 transition-colors"),href:"/pricing",children:"Pricing"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("nav",{className:"hidden lg:flex items-center gap-2",children:[e.jsx("a",{href:"/help",className:k("text-sm font-medium rounded-full px-4 py-2","hover:bg-gray-100 transition-colors"),children:"Support"}),e.jsx("a",{href:"/about-us",className:k("text-sm font-medium rounded-full px-4 py-2","hover:bg-gray-100 transition-colors"),children:"About Us"})]}),e.jsxs(w,{variant:"ghost",className:"hidden md:flex bg-gradient-to-r from-emerald-400 to-cyan-400 text-white hover:from-emerald-500 hover:to-cyan-500 rounded-full border border-emerald-500/20 shadow-lg hover:shadow-emerald-500/20 transition-all duration-300",onClick:()=>d("/pricing"),children:[e.jsx(Xa,{className:"mr-2 h-4 w-4"}),"Upgrade"]}),e.jsxs("div",{className:"flex items-center",children:[y?e.jsxs(pl,{children:[e.jsx(gl,{asChild:!0,children:e.jsx(w,{variant:"ghost",className:"relative h-10 w-10 rounded-full",children:e.jsxs($e,{className:"h-10 w-10",children:[e.jsx(Ue,{src:`https://ui-avatars.com/api/?name=${encodeURIComponent((x==null?void 0:x.full_name)||"")}&background=random`,alt:(x==null?void 0:x.full_name)||"User avatar"}),e.jsx(ze,{className:"bg-primary/10",children:((A=x==null?void 0:x.full_name)==null?void 0:A.split(" ").filter(Boolean).map(P=>P[0]).slice(0,2).join("").toUpperCase())||"U"})]})})}),e.jsxs(Kr,{className:"w-56 mt-2 bg-white border border-gray-200 rounded-2xl shadow-lg",align:"end",forceMount:!0,children:[e.jsxs(Ve,{className:"flex-col items-start",children:[e.jsx("div",{className:"font-medium",children:x==null?void 0:x.full_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:x==null?void 0:x.email})]}),e.jsxs(Ve,{onClick:()=>d("/dashboard"),children:[e.jsx(Wt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(Ve,{onClick:()=>d("/account"),children:[e.jsx(Yt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Account Settings"})]}),e.jsxs(Ve,{onClick:()=>d("/messages"),children:[e.jsx(bs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Messages"})]}),e.jsxs(Ve,{onClick:()=>d("/research-reports"),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Research & Reports"})]}),(r==null?void 0:r.role)==="admin"&&e.jsxs(Ve,{onClick:()=>d("/admin/reports"),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Admin Reports"})]}),e.jsx(Jr,{}),e.jsxs(Ve,{className:"text-red-500 focus:text-red-500",onClick:j,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log Out"})]})]})]}):e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(w,{variant:"ghost",onClick:v,className:"rounded-full hover:bg-gray-100",children:[e.jsx(ht,{className:"mr-2 h-4 w-4"}),"Sign In"]}),e.jsxs(w,{onClick:()=>t==null?void 0:t(),className:"rounded-full bg-black text-white hover:bg-gray-800",children:[e.jsx(ps,{className:"mr-2 h-4 w-4"}),"Sign Up"]})]}),e.jsx(w,{variant:"ghost",className:"lg:hidden p-2 ml-2",onClick:()=>i(!0),children:e.jsx(Vn,{className:"h-6 w-6"})})]})]})]})})})}),e.jsx(ul,{isOpen:o,onClose:()=>i(!1),children:e.jsxs("nav",{className:"space-y-6",children:[y&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-2",children:[e.jsxs($e,{className:"h-10 w-10",children:[e.jsx(Ue,{src:`https://ui-avatars.com/api/?name=${encodeURIComponent((x==null?void 0:x.full_name)||"")}&background=random`,alt:(x==null?void 0:x.full_name)||"User avatar"}),e.jsx(ze,{className:"bg-primary/10",children:((L=x==null?void 0:x.full_name)==null?void 0:L.split(" ").filter(Boolean).map(P=>P[0]).slice(0,2).join("").toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"text-sm font-medium leading-none truncate",children:x==null?void 0:x.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:x==null?void 0:x.email})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(w,{variant:"outline",className:"justify-center rounded-full",onClick:()=>{d("/dashboard"),i(!1)},children:[e.jsx(Wt,{className:"mr-2 h-4 w-4"}),"Dashboard"]}),e.jsxs(w,{variant:"outline",className:"justify-center rounded-full",onClick:()=>{d("/account"),i(!1)},children:[e.jsx(Yt,{className:"mr-2 h-4 w-4"}),"Account"]})]}),e.jsx("div",{className:"border-b border-border"})]}),kl.map((P,T)=>{var O;return e.jsx("div",{className:"space-y-3",children:P.href?e.jsxs("a",{href:P.href,className:k("flex items-center space-x-3 text-lg font-medium transition-colors",!P.requiresAuth||y?"hover:text-primary":"text-muted-foreground hover:text-primary/70"),onClick:C=>u(C,P.requiresAuth,P.href),children:[e.jsx("span",{className:"text-xl",children:P.icon}),e.jsx("span",{children:P.title}),P.requiresAuth&&!y&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Sign in required)"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3 text-lg font-medium",children:[e.jsx("span",{className:"text-xl",children:P.icon}),e.jsx("span",{children:P.title})]}),e.jsx("div",{className:"space-y-3 pl-9",children:(O=P.items)==null?void 0:O.map((C,_)=>e.jsxs("a",{href:C.href,className:k("block text-base transition-colors",!C.requiresAuth||y?"text-muted-foreground hover:text-primary":"text-muted-foreground/70 hover:text-primary/70"),onClick:R=>u(R,C.requiresAuth,C.href),children:[C.title,C.requiresAuth&&!y&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Sign in required)"})]},_))})]})},T)}),y?e.jsx("div",{className:"pt-6",children:e.jsxs(w,{variant:"outline",className:"w-full justify-center rounded-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:j,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"}),"Log Out"]})}):e.jsxs("div",{className:"space-y-4 pt-6",children:[e.jsxs(w,{variant:"outline",className:"w-full justify-center rounded-full",onClick:v,children:[e.jsx(ht,{className:"mr-2 h-4 w-4"}),"Sign In"]}),e.jsxs(w,{className:"w-full justify-center rounded-full bg-gradient-to-r from-emerald-400 to-cyan-400 text-white hover:from-emerald-500 hover:to-cyan-500",onClick:()=>{t==null||t(),i(!1)},children:[e.jsx(ps,{className:"mr-2 h-4 w-4"}),"Sign Up"]})]})]})}),e.jsx(Sl,{isOpen:g,onClose:()=>h(!1),onSuccess:()=>{h(!1),window.location.reload()}})]})}const Cl=({text:s="",className:a="",delay:t=100,animationFrom:r={opacity:0,transform:"translate3d(0,40px,0)"},animationTo:n={opacity:1,transform:"translate3d(0,0,0)"},easing:o=h=>h,threshold:i=.1,rootMargin:p="-100px",textAlign:c="center",onLetterAnimationComplete:g})=>{const h=s.split(" ").map(j=>j.split("")),d=h.flat(),[m,y]=l.useState(!1),x=l.useRef(null),S=l.useRef(0);l.useEffect(()=>{const j=new IntersectionObserver(([u])=>{u.isIntersecting&&(y(!0),x.current&&j.unobserve(x.current))},{threshold:i,rootMargin:p});return x.current&&j.observe(x.current),()=>j.disconnect()},[i,p]);const v=Hn(d.length,d.map((j,u)=>({from:r,to:m?async b=>{await b(n),S.current+=1,S.current===d.length&&g&&g()}:r,delay:u*t,config:{easing:o}})));return e.jsx("p",{ref:x,className:`split-parent overflow-hidden inline ${a}`,style:{textAlign:c,whiteSpace:"normal",wordWrap:"break-word"},children:h.map((j,u)=>e.jsxs("span",{style:{display:"inline-block",whiteSpace:"nowrap"},children:[j.map((b,A)=>{const L=h.slice(0,u).reduce((P,T)=>P+T.length,0)+A;return e.jsx(Wn.span,{style:v[L],className:"inline-block transform transition-opacity will-change-transform",children:b},L)}),e.jsx("span",{style:{display:"inline-block",width:"0.3em"},children:"Â "})]},u))})},Il=`#version 300 es
in vec2 position;
void main() {
  gl_Position = vec4(position, 0.0, 1.0);
}
`,Al=`#version 300 es
precision highp float;

uniform float uTime;
uniform float uAmplitude;
uniform vec3 uColorStops[3];
uniform vec2 uResolution;
uniform float uBlend;

out vec4 fragColor;

vec3 permute(vec3 x) {
  return mod(((x * 34.0) + 1.0) * x, 289.0);
}

float snoise(vec2 v){
  const vec4 C = vec4(
      0.211324865405187, 0.366025403784439,
      -0.577350269189626, 0.024390243902439
  );
  vec2 i  = floor(v + dot(v, C.yy));
  vec2 x0 = v - i + dot(i, C.xx);
  vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;
  i = mod(i, 289.0);

  vec3 p = permute(
      permute(i.y + vec3(0.0, i1.y, 1.0))
    + i.x + vec3(0.0, i1.x, 1.0)
  );

  vec3 m = max(
      0.5 - vec3(
          dot(x0, x0),
          dot(x12.xy, x12.xy),
          dot(x12.zw, x12.zw)
      ), 
      0.0
  );
  m = m * m;
  m = m * m;

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;
  m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);

  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}

struct ColorStop {
  vec3 color;
  float position;
};

#define COLOR_RAMP(colors, factor, finalColor) {                int index = 0;                                              for (int i = 0; i < 2; i++) {                                    ColorStop currentColor = colors[i];                         bool isInBetween = currentColor.position <= factor;         index = int(mix(float(index), float(i), float(isInBetween)));   }                                                           ColorStop currentColor = colors[index];                     ColorStop nextColor = colors[index + 1];                    float range = nextColor.position - currentColor.position;   float lerpFactor = (factor - currentColor.position) / range;   finalColor = mix(currentColor.color, nextColor.color, lerpFactor); }

void main() {
  vec2 uv = gl_FragCoord.xy / uResolution;
  
  ColorStop colors[3];
  colors[0] = ColorStop(uColorStops[0], 0.0);
  colors[1] = ColorStop(uColorStops[1], 0.5);
  colors[2] = ColorStop(uColorStops[2], 1.0);
  
  vec3 rampColor;
  COLOR_RAMP(colors, uv.x, rampColor);
  
  float height = snoise(vec2(uv.x * 2.0 + uTime * 0.1, uTime * 0.25)) * 0.5 * uAmplitude;
  height = exp(height);
  height = (uv.y * 2.0 - height + 0.2);
  float intensity = 0.6 * height;
  
  float midPoint = 0.20;
  float auroraAlpha = smoothstep(midPoint - uBlend * 0.5, midPoint + uBlend * 0.5, intensity);
  
  vec3 auroraColor = intensity * rampColor;
  
  fragColor = vec4(auroraColor * auroraAlpha, auroraAlpha);
}
`,Pl=s=>{const{colorStops:a=["#00d8ff","#7cff67","#00d8ff"],amplitude:t=1,blend:r=.5}=s,n=l.useRef(s);n.current=s;const o=l.useRef(null);return l.useEffect(()=>{const i=o.current;if(!i)return;const p=new Qa({alpha:!0,premultipliedAlpha:!0,antialias:!0}),c=p.gl;c.clearColor(0,0,0,0),c.enable(c.BLEND),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.canvas.style.backgroundColor="transparent";let g;function h(){if(!i)return;const v=i.offsetWidth,j=i.offsetHeight;p.setSize(v,j),g&&(g.uniforms.uResolution.value=[v,j])}window.addEventListener("resize",h);const d=new er(c);d.attributes.uv&&delete d.attributes.uv;const m=a.map(v=>{const j=new Jt(v);return[j.r,j.g,j.b]});g=new sr(c,{vertex:Il,fragment:Al,uniforms:{uTime:{value:0},uAmplitude:{value:t},uColorStops:{value:m},uResolution:{value:[i.offsetWidth,i.offsetHeight]},uBlend:{value:r}}});const y=new tr(c,{geometry:d,program:g});i.appendChild(c.canvas);let x=0;const S=v=>{x=requestAnimationFrame(S);const{time:j=v*.01,speed:u=1}=n.current;if(g){g.uniforms.uTime.value=j*u*.1,g.uniforms.uAmplitude.value=n.current.amplitude??1,g.uniforms.uBlend.value=n.current.blend??r;const b=n.current.colorStops??a;g.uniforms.uColorStops.value=b.map(A=>{const L=new Jt(A);return[L.r,L.g,L.b]}),p.render({scene:y})}};return x=requestAnimationFrame(S),h(),()=>{var v;cancelAnimationFrame(x),window.removeEventListener("resize",h),i&&c.canvas.parentNode===i&&i.removeChild(c.canvas),(v=c.getExtension("WEBGL_lose_context"))==null||v.loseContext()}},[t]),e.jsx("div",{ref:o,className:"w-full h-full"})},Ce=({onSearch:s=()=>{},title:a="Find Your Next Investment Property",subtitle:t="Search through our curated selection of properties",showSearch:r=!0,showStats:n=!0,height:o="h-[500px]",image:i})=>{const[p,c]=N.useState(""),g=d=>{d.preventDefault(),s(p)},h=()=>{console.log("Hero text animation completed!")};return e.jsxs("div",{className:`relative w-full ${o} bg-gray-900 overflow-hidden`,children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx(Pl,{colorStops:["#004F39","#FEFACA","#151513"],blend:.6,amplitude:1.2,speed:.3}),e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-[2px]"})]}),e.jsxs("div",{className:"relative h-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center justify-center text-center py-16 pt-24 animate-fade-in-up",children:[e.jsx(Cl,{text:a,className:"text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4",delay:50,animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:d=>1-Math.pow(1-d,3),threshold:.2,rootMargin:"-50px",onLetterAnimationComplete:h}),e.jsx("p",{className:"text-lg sm:text-xl text-gray-200 mb-6 sm:mb-8 max-w-3xl mx-auto",children:t}),r&&e.jsx("form",{onSubmit:g,className:"w-full max-w-2xl animate-fade-in-up",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:"text",placeholder:"Enter an address, neighbourhood, city, or postcode",value:p,onChange:d=>c(d.target.value),className:"w-full h-12 sm:h-14 pl-5 pr-14 text-base sm:text-lg bg-white/90 backdrop-blur-sm text-black border-2 border-transparent focus:border-primary"}),e.jsx(w,{type:"submit",size:"sm",variant:"ghost",className:"absolute right-2 top-1/2 -translate-y-1/2 hover:bg-transparent",children:e.jsx(ar,{className:"w-6 h-6 text-gray-500 hover:text-primary transition-colors"})})]})})]})]})},E=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:k("rounded-xl border bg-card text-card-foreground shadow",s),...a}));E.displayName="Card";const z=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:k("flex flex-col space-y-1.5 p-6",s),...a}));z.displayName="CardHeader";const K=l.forwardRef(({className:s,...a},t)=>e.jsx("h3",{ref:t,className:k("font-semibold leading-none tracking-tight",s),...a}));K.displayName="CardTitle";const Ze=l.forwardRef(({className:s,...a},t)=>e.jsx("p",{ref:t,className:k("text-sm text-muted-foreground",s),...a}));Ze.displayName="CardDescription";const D=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:k("p-6 pt-0",s),...a}));D.displayName="CardContent";const Ss=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:k("flex items-center p-6 pt-0",s),...a}));Ss.displayName="CardFooter";const _l=is("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"bg-green-500/10 text-green-500 hover:bg-green-500/20",warning:"bg-yellow-500/10 text-yellow-500 hover:bg-yellow-500/20",premium:"bg-gradient-to-r from-amber-500 to-amber-600 text-white hover:from-amber-600 hover:to-amber-700"}},defaultVariants:{variant:"default"}});function te({className:s,variant:a,...t}){return e.jsx("div",{className:k(_l({variant:a}),s),...t})}function Ws({id:s,address:a,price:t,squareFootage:r,bedrooms:n,bathrooms:o,isPremium:i=!1,propertyType:p="residential",description:c,createdAt:g,author:h,original_price:d,roi_percentage:m,investment_term:y,deal_type:x,isSubscriber:S=!1,type:v="listing",isDeal:j=!1,images:u=[],onClick:b,onMessageAuthor:A,currentUser:L,userProfile:P}){const T=!!L,[O,C]=N.useState(!1),_=Z=>{Z.stopPropagation(),C(!O)},R=Z=>{Z.stopPropagation(),console.log("Share property:",s)},B=Z=>{Z.stopPropagation(),h&&A&&A(h.id)},Y=u&&u.length>0?u[0]:`https://source.unsplash.com/random/800x600?property,house&sig=${s}`;return e.jsxs(E,{className:"overflow-hidden hover:shadow-md transition-shadow cursor-pointer",onClick:b,children:[e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-muted",children:[e.jsx("img",{src:Y,alt:a,className:"object-cover w-full h-full",loading:"lazy"}),i&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(te,{variant:"secondary",className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Featured"})}),j&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(te,{variant:"secondary",className:"bg-emerald-500 text-white hover:bg-emerald-600",children:"Investment Deal"})}),m&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(te,{className:"bg-emerald-500 text-white",children:[m,"% ROI"]})})]}),e.jsxs(z,{className:"p-4 pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:ue(t)}),d&&e.jsx("div",{className:"text-sm text-muted-foreground line-through",children:ue(d)})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:a})]}),e.jsxs(D,{className:"p-4 pt-2",children:[(n||o||r)&&e.jsxs("div",{className:"flex justify-between mb-3 text-sm",children:[n!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:n})," ",e.jsx("span",{className:"text-muted-foreground",children:n===1?"Bed":"Beds"})]}),o!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:o})," ",e.jsx("span",{className:"text-muted-foreground",children:o===1?"Bath":"Baths"})]}),r!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:Fr(r)})," ",e.jsx("span",{className:"text-muted-foreground",children:"sq ft"})]})]}),y&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Investment Term: "}),e.jsx("span",{className:"text-sm font-medium",children:y})]}),x&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Deal Type: "}),e.jsx("span",{className:"text-sm font-medium",children:x})]}),c&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:c}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:ts(g)}),e.jsxs("div",{className:"flex space-x-1",children:[T&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:_,children:e.jsx(Yn,{className:`h-4 w-4 ${O?"fill-red-500 text-red-500":""}`})}),h&&e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:B,children:e.jsx(bs,{className:"h-4 w-4"})})]}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:R,children:e.jsx(Kn,{className:"h-4 w-4"})})]})]})]})]})}const Rl="https://zcuapuvvygahkzljuhyg.supabase.co",El="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjdWFwdXZ2eWdhaGt6bGp1aHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MTQwMzcsImV4cCI6MjA1MzQ5MDAzN30.GIhphzkznmDXgrUApGW479uHHluqDWqy_9cfG5sU5Xc";console.log("Supabase URL status:","âœ… URL defined");console.log("Supabase Key status:","âœ… Key defined");const U=wa(Rl,El,{auth:{persistSession:!0,storage:window.localStorage,storageKey:"supabase.auth.token",autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"x-client-info":"vge-property-app"}},db:{schema:"public"}});console.log("Supabase client initialized");const Tl=async()=>{var s,a;try{console.log("Testing Supabase connection...");const{data:t,error:r}=await U.auth.getSession();if(r)return console.error("Session error:",r),{success:!1,message:"Failed to get user session",details:r};const n=!!t.session;console.log("Authentication status:",n?"Authenticated":"Not authenticated");const{data:o,error:i}=await U.rpc("version");i?console.warn("Version check failed:",i):console.log("Supabase version:",o);const{data:p,error:c}=await U.from("information_schema.tables").select("table_name").eq("table_schema","public").limit(10);c?console.warn("Failed to get table list:",c):console.log("Available tables:",p);let g=!1;try{const{data:h,error:d}=await U.from("scraper_cache").select("count(*)").limit(1).single();d?d.code==="42P01"?console.log("scraper_cache table does not exist"):console.warn("Error checking scraper_cache:",d):(console.log("scraper_cache table exists!"),g=!0)}catch(h){console.error("Exception checking scraper_cache:",h)}return{success:!0,message:"Supabase connection diagnostic completed",details:{isAuthenticated:n,sessionExists:!!t.session,user:((a=(s=t.session)==null?void 0:s.user)==null?void 0:a.email)||"Not authenticated",cacheTableExists:g}}}catch(t){return console.error("Unexpected error testing Supabase connection:",t),{success:!1,message:"Unexpected error testing Supabase connection",details:t}}},Ml={BASIC:{name:"Basic",price:"Â£9.99",priceId:"price_1QnikACOhalwhG2QDocCWbQj",features:["Basic property search","Save up to 5 properties","Basic market trends","Email support"]},PRO:{name:"Pro",price:"Â£19.99",priceId:"price_1QnikPCOhalwhG2QVYfxwG5D",features:["Advanced property search","Save unlimited properties","Detailed market analysis","Premium property insights","Priority support"]},PREMIUM:{name:"Premium",price:"Â£49.99",priceId:"price_1QnikjCOhalwhG2QUgRtMAco",features:["All Pro features","AI-powered market predictions","Portfolio analytics","Investment ROI calculator","Dedicated account manager","24/7 phone support"]}};async function Qr(s,a){try{const t=await fetch("https://clever-chaplygin6-vbfae.dev.tempolabs.ai/.netlify/functions/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:s,userId:a})}),{sessionId:r}=await t.json(),n=await Jn(void 0);n&&await n.redirectToCheckout({sessionId:r})}catch(t){throw console.error("Error creating checkout session:",t),t}}function Pt({isOpen:s,onClose:a,defaultMode:t="signin"}){const[r,n]=N.useState(t);N.useEffect(()=>{n(t)},[t]);const[o,i]=N.useState(!1),[p,c]=N.useState(!1),{signIn:g,signUp:h,signInWithGoogle:d}=ee(),{toast:m}=_e(),[y,x]=N.useState({email:"",password:"",firstName:"",lastName:""}),S=async v=>{v.preventDefault(),i(!0);try{if(r==="signin")await g(y.email,y.password)&&(m({title:"Welcome back!",description:"You have successfully signed in."}),setTimeout(()=>a(),500));else{const j=await h(y.email,y.password,y.firstName,y.lastName),u=localStorage.getItem("pending_subscription_price_id");u&&j&&"id"in j?(localStorage.removeItem("pending_subscription_price_id"),await Qr(u,j.id)):(c(!0),m({title:"Welcome to MyVGE Alpha!",description:"Thank you for joining us during our alpha testing phase."}))}}catch(j){m({title:"Error",description:j.message||"An error occurred",variant:"destructive"})}finally{i(!1)}};return p?e.jsx(Ee,{open:s,onOpenChange:a,children:e.jsxs(Ie,{className:"sm:max-w-[425px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"Welcome to MyVGE Alpha!"}),e.jsxs(Ge,{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-primary",children:"Thank you for joining MyVGE during our alpha testing phase!"}),e.jsx("p",{children:"We've sent a confirmation email to your inbox. Please click the verification link to activate your account and start exploring MyVGE."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Note: You must confirm your email before signing in. Please check your spam folder if you don't see the email."}),e.jsx("div",{className:"mt-4 p-4 bg-primary/10 rounded-lg",children:e.jsx("p",{className:"text-sm font-medium",children:"As an alpha tester, your feedback is invaluable to us. We're excited to have you on board and look forward to your insights as we continue to improve the platform."})})]})]}),e.jsx("div",{className:"flex flex-col space-y-4 pt-4",children:e.jsx(w,{onClick:()=>{c(!1),a()},children:"Close"})})]})}):e.jsx(Ee,{open:s,onOpenChange:a,children:e.jsxs(Ie,{className:"sm:max-w-[425px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:r==="signin"?"Sign In":"Create Account"}),e.jsx(Ge,{children:r==="signin"?"Welcome back! Please sign in to continue.":"Join MyVGE and start exploring properties."})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4 pt-4",children:[r==="signup"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"firstName",children:"First Name"}),e.jsx(G,{id:"firstName",value:y.firstName,onChange:v=>x(j=>({...j,firstName:v.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"lastName",children:"Last Name"}),e.jsx(G,{id:"lastName",value:y.lastName,onChange:v=>x(j=>({...j,lastName:v.target.value})),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:y.email,onChange:v=>x(j=>({...j,email:v.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",value:y.password,onChange:v=>x(j=>({...j,password:v.target.value})),required:!0})]}),e.jsxs("div",{className:"flex flex-col space-y-4 pt-4",children:[e.jsx(w,{type:"submit",disabled:o,children:o?"Loading...":r==="signin"?"Sign In":"Create Account"}),e.jsx(w,{type:"button",variant:"link",onClick:()=>d(),disabled:o,children:"Sign In with Google"}),e.jsx(w,{type:"button",variant:"link",onClick:()=>n(r==="signin"?"signup":"signin"),children:r==="signin"?"Don't have an account? Sign up":"Already have an account? Sign in"})]})]})]})})}const es=Zn,ss=l.forwardRef(({className:s,...a},t)=>e.jsx(rr,{ref:t,className:k("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...a}));ss.displayName=rr.displayName;const ge=l.forwardRef(({className:s,...a},t)=>e.jsx(nr,{ref:t,className:k("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...a}));ge.displayName=nr.displayName;const de=l.forwardRef(({className:s,...a},t)=>e.jsx(ir,{ref:t,className:k("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));de.displayName=ir.displayName;function Qs({isOpen:s,onClose:a,currentUser:t,userProfile:r}){const n=be(),o=i=>{console.log(`Subscribing to ${i} tier`),n(`/checkout?tier=${i}`),a()};return e.jsx(Ee,{open:s,onOpenChange:a,children:e.jsxs(Ie,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(Pe,{className:"text-2xl",children:"Upgrade Your Experience"})}),e.jsxs(es,{defaultValue:"monthly",className:"mt-4",children:[e.jsxs(ss,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(ge,{value:"monthly",children:"Monthly"}),e.jsxs(ge,{value:"yearly",children:["Yearly ",e.jsx("span",{className:"ml-2 text-emerald-500",children:"Save 20%"})]})]}),e.jsx(de,{value:"monthly",children:e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2 mt-4",children:[e.jsxs("div",{className:"border rounded-lg p-6 space-y-4 relative overflow-hidden",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Basic"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Essential property insights for casual investors."}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:"Â£9.99"}),e.jsx("span",{className:"text-muted-foreground",children:"/month"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Basic property data"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"5 saved properties"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Limited market insights"})]})]}),e.jsx(w,{className:"w-full",onClick:()=>o("basic"),children:(r==null?void 0:r.subscription_tier)==="basic"?"Current Plan":"Subscribe"})]}),e.jsxs("div",{className:"border rounded-lg p-6 space-y-4 relative overflow-hidden bg-gradient-to-b from-blue-50 to-white dark:from-blue-950 dark:to-background",children:[e.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white px-3 py-1 text-xs font-medium rounded-bl-lg",children:"POPULAR"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Pro"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Advanced tools for serious property investors."}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:"Â£29.99"}),e.jsx("span",{className:"text-muted-foreground",children:"/month"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:e.jsx("span",{className:"font-medium",children:"Everything in Basic"})})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Detailed investment metrics"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"50 saved properties"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Full market insights access"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Priority customer support"})]})]}),e.jsx(w,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>o("pro"),children:(r==null?void 0:r.subscription_tier)==="pro"?"Current Plan":"Subscribe"})]})]})}),e.jsx(de,{value:"yearly",children:e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2 mt-4",children:[e.jsxs("div",{className:"border rounded-lg p-6 space-y-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute -top-1 -right-1 bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100 px-3 py-1 text-xs font-medium transform rotate-12",children:"SAVE 20%"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Basic Annual"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Essential property insights for casual investors."}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:"Â£95.90"}),e.jsx("span",{className:"text-muted-foreground",children:"/year"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Equivalent to Â£7.99/month"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Basic property data"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"5 saved properties"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Limited market insights"})]})]}),e.jsx(w,{className:"w-full",onClick:()=>o("basic-annual"),children:(r==null?void 0:r.subscription_tier)==="basic"&&(r==null?void 0:r.subscription_status)==="yearly"?"Current Plan":"Subscribe"})]}),e.jsxs("div",{className:"border rounded-lg p-6 space-y-4 relative overflow-hidden bg-gradient-to-b from-blue-50 to-white dark:from-blue-950 dark:to-background",children:[e.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white px-3 py-1 text-xs font-medium rounded-bl-lg",children:"BEST VALUE"}),e.jsx("div",{className:"absolute -top-1 -right-12 bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100 px-3 py-1 text-xs font-medium transform rotate-12",children:"SAVE 20%"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Pro Annual"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Advanced tools for serious property investors."}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:"Â£287.90"}),e.jsx("span",{className:"text-muted-foreground",children:"/year"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Equivalent to Â£23.99/month"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:e.jsx("span",{className:"font-medium",children:"Everything in Basic"})})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Detailed investment metrics"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"50 saved properties"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Full market insights access"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-emerald-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Priority customer support"})]})]}),e.jsx(w,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>o("pro-annual"),children:(r==null?void 0:r.subscription_tier)==="pro"&&(r==null?void 0:r.subscription_status)==="yearly"?"Current Plan":"Subscribe"})]})]})})]}),e.jsx(ns,{className:"mt-6",children:e.jsx(w,{variant:"outline",onClick:a,children:"Cancel"})})]})})}const Dl=["badword1","badword2"];function Fl(s){let a=s.toLowerCase();return Dl.forEach(t=>{const r=new RegExp(t,"gi");a=a.replace(r,"*".repeat(t.length))}),a}async function en(s,a,t){try{const{data:r,error:n}=await U.auth.getUser();if(n||!r.user)throw console.error("Authentication error:",n),new Error("User not authenticated");console.log("Sending message:",{sender_id:r.user.id,receiver_id:s,deal_id:t,content:a.substring(0,20)+"..."});const{data:o,error:i}=await U.from("messages").insert({sender_id:r.user.id,receiver_id:s,content:Fl(a),deal_id:t,is_read:!1}).select(`
        *,
        sender:profiles!sender_id(id, full_name, avatar_url),
        receiver:profiles!receiver_id(id, full_name, avatar_url),
        deal:deals(*)
      `).single();if(i)throw console.error("Database error:",i),i;if(!o)throw console.error("No data returned from insert"),new Error("Failed to send message");return console.log("Message sent successfully:",{messageId:o.id}),o}catch(r){return console.error("Error sending message:",r),null}}async function Ll(){try{const{data:{session:s},error:a}=await U.auth.getSession();if(a)return console.error("Session error in getConversations:",a),[];if(!s){console.log("No active session found in getConversations - trying getUser fallback");const{data:r,error:n}=await U.auth.getUser();if(n||!(r!=null&&r.user))return console.error("User not authenticated in getConversations:",n||"No user data"),[];const o=r.user.id;return console.log(`Found user via getUser: ${o}`),await sa(o)}const t=s.user.id;return console.log(`Using session user for conversations: ${t}`),await sa(t)}catch(s){return console.error("Error getting conversations:",s),[]}}async function sa(s){const{data:a,error:t}=await U.from("messages").select(`
      *,
      sender:profiles!sender_id(id, full_name, avatar_url),
      receiver:profiles!receiver_id(id, full_name, avatar_url),
      deal:deals(*)
    `).filter("sender_id","eq",s).filter("receiver_id","eq",s,{foreignTable:"or"}).order("created_at",{ascending:!1});if(t)return console.error("Error fetching conversations:",t),[];const r=new Map;return a==null||a.forEach(n=>{const o=n.sender_id===s?n.receiver:n.sender,i=o.id;if(!r.has(i))r.set(i,{user:o,lastMessage:n,unreadCount:n.receiver_id===s&&!n.is_read?1:0});else if(n.receiver_id===s&&!n.is_read){const p=r.get(i);p.unreadCount++}}),Array.from(r.values())}async function sn(s){try{const{data:a,error:t}=await U.auth.getUser();if(t||!a.user)throw console.error("Authentication error:",t),new Error("User not authenticated");console.log("Fetching messages with user:",s);const{data:r,error:n}=await U.from("messages").select(`
        *,
        sender:profiles!sender_id(id, full_name, avatar_url),
        receiver:profiles!receiver_id(id, full_name, avatar_url),
        deal:deals(*)
      `).or(`and(sender_id.eq.${a.user.id},receiver_id.eq.${s}),and(sender_id.eq.${s},receiver_id.eq.${a.user.id})`).order("created_at",{ascending:!0});if(n)throw console.error("Database error:",n),n;console.log(`Found ${(r==null?void 0:r.length)||0} messages`);const o=(r==null?void 0:r.filter(i=>i.receiver_id===a.user.id&&!i.is_read))||[];if(o.length>0){console.log(`Marking ${o.length} messages as read`);const{error:i}=await U.from("messages").update({is_read:!0}).in("id",o.map(p=>p.id));i&&console.error("Error marking messages as read:",i)}return r||[]}catch(a){return console.error("Error getting messages:",a),[]}}function Ol(s){try{return U.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async t=>{const{data:r,error:n}=await U.from("messages").select(`
              *,
              sender:profiles!sender_id(id, full_name, avatar_url),
              receiver:profiles!receiver_id(id, full_name, avatar_url),
              deal:deals(*)
            `).eq("id",t.new.id).single();!n&&r&&s(r)}).subscribe()}catch(a){return console.error("Error subscribing to messages:",a),null}}async function $l(s){try{let a;const{data:{session:t}}=await U.auth.getSession();if(t)a=t.user.id,console.log(`Using session user for search: ${a}`);else{const{data:i,error:p}=await U.auth.getUser();if(p||!(i!=null&&i.user))throw console.error("Failed to get authenticated user:",p),new Error("Authentication required to search users");a=i.user.id,console.log(`Using getUser result for search: ${a}`)}let r=U.from("profiles").select("id, full_name, email, avatar_url").neq("id",a);if(s&&s.trim()){const i=`%${s.trim()}%`;r=r.or(`full_name.ilike.${i},email.ilike.${i}`)}const{data:n,error:o}=await r;return o?(console.error("Database error in searchUsers:",o),[]):(console.log(`Search found ${(n==null?void 0:n.length)||0} users`),n||[])}catch(a){return console.error("Error in searchUsers:",a),[]}}const Fe=({size:s="md",className:a})=>{const t={xs:"h-3 w-3 border-[1.5px]",sm:"h-4 w-4 border-2",md:"h-6 w-6 border-2",lg:"h-8 w-8 border-[3px]",xl:"h-12 w-12 border-4"};return e.jsx("div",{className:k("animate-spin rounded-full border-transparent border-b-current text-current",t[s],a)})},tn=({isOpen:s,onClose:a,receiverId:t,dealId:r})=>{const{user:n}=ee(),[o,i]=l.useState([]),[p,c]=l.useState(""),[g,h]=l.useState(!1),[d,m]=l.useState(null),y=l.useRef(null);l.useEffect(()=>{s&&t?x():(i([]),c(""))},[s,t]),l.useEffect(()=>{v()},[o]);const x=async()=>{if(t)try{h(!0);const j=await sn(t);if(i(j),j.length>0){const u=j[0],b=u.sender_id===(n==null?void 0:n.id)?u.receiver:u.sender;m(b)}}catch(j){console.error("Error loading messages:",j)}finally{h(!1)}},S=async j=>{if(j.preventDefault(),!(!t||!p.trim()))try{const u=await en(t,p.trim(),r);u&&(i(b=>[...b,u]),c(""))}catch(u){console.error("Error sending message:",u)}},v=()=>{var j;(j=y.current)==null||j.scrollIntoView({behavior:"smooth"})};return e.jsx(Ee,{open:s,onOpenChange:j=>!j&&a(),children:e.jsxs(Ie,{className:"max-w-screen-md w-full",children:[e.jsx(Ae,{children:e.jsx(Pe,{children:d?`Messages with ${d.full_name}`:"Messages"})}),e.jsxs("div",{className:"h-[400px] flex flex-col",children:[g?e.jsx("div",{className:"flex-1 flex justify-center items-center",children:e.jsx(Fe,{})}):e.jsxs(as,{className:"flex-1 pr-4 mb-4",children:[o.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"No messages yet. Send a message to start the conversation."}):o.map(j=>e.jsxs("div",{className:`flex mb-4 ${j.sender_id===(n==null?void 0:n.id)?"justify-end":"justify-start"}`,children:[j.sender_id!==(n==null?void 0:n.id)&&e.jsxs($e,{className:"mr-2 mt-1",children:[e.jsx(Ue,{src:j.sender.avatar_url}),e.jsx(ze,{children:j.sender.full_name.charAt(0)})]}),e.jsxs("div",{className:`max-w-[70%] ${j.sender_id===(n==null?void 0:n.id)?"bg-primary text-primary-foreground":"bg-muted"} rounded-lg p-3`,children:[e.jsx("p",{children:j.content}),e.jsx("p",{className:"text-xs mt-1 opacity-70",children:gs(new Date(j.created_at),{addSuffix:!0})})]})]},j.id)),e.jsx("div",{ref:y})]}),e.jsxs("form",{onSubmit:S,className:"flex gap-2",children:[e.jsx(G,{value:p,onChange:j=>c(j.target.value),placeholder:"Type a message...",autoFocus:!0}),e.jsx(w,{type:"submit",size:"icon",children:e.jsx(ms,{className:"h-4 w-4"})})]})]})]})})};function Ul(){const[s,a]=N.useState("");return N.useEffect(()=>{fetch("https://uselessfacts.jsph.pl/api/v2/facts/random?language=en").then(t=>t.json()).then(t=>a(t.text)).catch(t=>console.error("Error fetching random fact:",t))},[]),s?e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[e.jsx(Xn,{className:"w-4 h-4"}),e.jsx("p",{children:s})]}):null}function _t(){return e.jsx("footer",{className:"bg-gray-900 text-white py-8 sm:py-12",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"About Us"}),e.jsx("p",{className:"text-gray-400",children:"Your trusted source for property search and market analysis."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Legal"}),e.jsxs("ul",{className:"space-y-2 text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"/terms",className:"hover:text-white",children:"Terms of Service"})}),e.jsx("li",{children:e.jsx("a",{href:"/privacy",className:"hover:text-white",children:"Privacy Policy"})}),e.jsx("li",{children:e.jsx("a",{href:"/disclaimer",className:"hover:text-white",children:"Legal Disclaimer"})}),e.jsx("li",{children:e.jsx("a",{href:"/gdpr",className:"hover:text-white",children:"GDPR Compliance"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Contact"}),e.jsxs("ul",{className:"space-y-2 text-gray-400",children:[e.jsx("li",{children:"info@myvge.com"}),e.jsx("li",{children:"Lytchett House, 13 Freeland Park, Poole, Dorset, England, BH16 6FA"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Compliance"}),e.jsx("ul",{className:"space-y-2 text-gray-400",children:e.jsx("li",{children:"Company No: 15271126"})})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-800 space-y-4",children:[e.jsx(Ul,{}),e.jsxs("div",{className:"text-center text-gray-400 space-y-2",children:[e.jsx("p",{className:"text-xs",children:"MyVGE is registered in England and Wales. Registered office: Lytchett House, 13 Freeland Park, Poole, Dorset, England, BH16 6FA. Company No: 15271126"}),e.jsx("p",{className:"text-xs",children:"The information on this website is for general information purposes only and does not constitute financial advice."}),e.jsxs("p",{children:["Â© ",new Date().getFullYear()," MyVGE. All rights reserved."]})]})]})]})})}const zl=is("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),js=l.forwardRef(({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:k(zl({variant:a}),s),...t}));js.displayName="Alert";const Rt=l.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:k("mb-1 font-medium leading-none tracking-tight",s),...a}));Rt.displayName="AlertTitle";const vs=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:k("text-sm [&_p]:leading-relaxed",s),...a}));vs.displayName="AlertDescription";function an(){return e.jsxs(js,{className:"bg-muted/50 border-muted-foreground/20",children:[e.jsx(Js,{className:"h-4 w-4"}),e.jsx(vs,{className:"text-xs text-muted-foreground",children:"The information provided on this website is for general informational purposes only and should not be considered as financial or investment advice. Property investments carry risks and values can go down as well as up. Always seek professional advice before making investment decisions."})]})}async function ta(s,a){try{const t=(s-1)*a;console.log("Production URL:","https://zcuapuvvygahkzljuhyg.supabase.co"),console.log("Fetching properties with params:",{page:s,perPage:a,start:t});const{data:r,error:n}=await we.from("properties").select(`
        id,
        title,
        description,
        location,
        price,
        beds,
        baths,
        sqft,
        image_url,
        is_featured,
        created_at,
        updated_at
      `).eq("is_featured",!0).range(t,t+a-1).order("created_at",{ascending:!1});if(console.log("Raw Supabase response:",{data:r,error:n}),n)throw console.error("Supabase error:",n),n;if(!r||r.length===0)return console.log("No properties found"),[];const o=r.map(i=>({id:i.id||"",title:i.title||"",description:i.description||"",location:i.location||"",price:Number(i.price)||0,beds:Number(i.beds)||0,baths:Number(i.baths)||0,sqft:Number(i.sqft)||0,image_url:i.image_url||"",is_featured:!!i.is_featured,created_at:i.created_at||new Date().toISOString(),updated_at:i.updated_at||new Date().toISOString()}));return console.log("Mapped properties:",o),o}catch(t){return console.error("Error in getFeaturedProperties:",t),[]}}async function Bl(s){try{const{data:a,error:t}=await we.from("properties").select(`
        id,
        title,
        location,
        price,
        sqft,
        beds,
        baths,
        description,
        image_url,
        is_featured,
        created_at,
        updated_at
      `).or(`
        location.ilike.%${s}%,
        description.ilike.%${s}%,
        title.ilike.%${s}%
      `).order("created_at",{ascending:!1});if(t)throw t;return a||[]}catch(a){return console.error("Error searching properties:",a),[]}}async function Gl(s){const{data:a,error:t}=await we.from("saved_properties").select(`
      *,
      property:properties(*)
    `).eq("user_id",s);if(t)throw t;return a}async function ql(s,a){try{const t=(s-1)*a;console.log("Fetching deals with params:",{page:s,perPage:a,start:t});const{data:r,error:n}=await we.from("deals").select(`
        id,
        title,
        description,
        location,
        price,
        roi_percentage,
        investment_term,
        property_type,
        deal_type,
        image_url,
        created_at,
        updated_at
      `).range(t,t+a-1).order("created_at",{ascending:!1});if(console.log("Raw Supabase deals response:",{data:r,error:n}),n)throw console.error("Supabase error:",n),n;if(!r||r.length===0)return console.log("No deals found"),[];const o=r.map(i=>({id:i.id||"",title:i.title||"",description:i.description||"",location:i.location||"",price:Number(i.price)||0,roi_percentage:Number(i.roi_percentage)||0,investment_term:i.investment_term||"",property_type:i.property_type||"",deal_type:i.deal_type||"",image_url:i.image_url||"",created_at:i.created_at||new Date().toISOString(),updated_at:i.updated_at||new Date().toISOString()}));return console.log("Mapped deals:",o),o}catch(t){return console.error("Error in getDeals:",t),[]}}const Vl=(s=6)=>Qn({queryKey:["deals"],queryFn:({pageParam:a=1})=>ql(a,s),getNextPageParam:(a,t)=>a.length===s?t.length+1:void 0,staleTime:5*60*1e3,cacheTime:30*60*1e3}),_s=({children:s,direction:a="left",pauseOnHover:t=!1,reverse:r=!1,fade:n=!1,className:o,vertical:i=!1})=>e.jsxs("div",{className:k("group flex gap-4 overflow-hidden",i?"flex-col":"flex-row",o),children:[e.jsx("div",{className:k("flex min-w-full shrink-0 animate-marquee items-center justify-around gap-4",i?"flex-col":"flex-row",t&&"group-hover:[animation-play-state:paused]",r&&"animate-marquee-reverse"),children:s}),e.jsx("div",{className:k("flex min-w-full shrink-0 animate-marquee items-center justify-around gap-4",i?"flex-col":"flex-row",t&&"group-hover:[animation-play-state:paused]",r&&"animate-marquee-reverse"),children:s})]}),Hl=({baseColor:s=[.1,.1,.1],speed:a=.2,amplitude:t=.5,frequencyX:r=3,frequencyY:n=2,interactive:o=!0,...i})=>{const p=l.useRef(null);return l.useEffect(()=>{if(!p.current)return;const c=p.current,g=new Qa({antialias:!0}),h=g.gl;h.clearColor(1,1,1,1);const d=`
      attribute vec2 position;
      attribute vec2 uv;
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `,m=`
      precision highp float;
      uniform float uTime;
      uniform vec3 uResolution;
      uniform vec3 uBaseColor;
      uniform float uAmplitude;
      uniform float uFrequencyX;
      uniform float uFrequencyY;
      uniform vec2 uMouse;
      varying vec2 vUv;

      vec4 renderImage(vec2 uvCoord) {
          vec2 fragCoord = uvCoord * uResolution.xy;
          vec2 uv = (2.0 * fragCoord - uResolution.xy) / min(uResolution.x, uResolution.y);

          for (float i = 1.0; i < 10.0; i++){
              uv.x += uAmplitude / i * cos(i * uFrequencyX * uv.y + uTime + uMouse.x * 3.14159);
              uv.y += uAmplitude / i * cos(i * uFrequencyY * uv.x + uTime + uMouse.y * 3.14159);
          }

          vec2 diff = (uvCoord - uMouse);
          float dist = length(diff);
          float falloff = exp(-dist * 20.0);
          float ripple = sin(10.0 * dist - uTime * 2.0) * 0.03;
          uv += (diff / (dist + 0.0001)) * ripple * falloff;

          vec3 color = uBaseColor / abs(sin(uTime - uv.y - uv.x));
          return vec4(color, 1.0);
      }

      void main() {
          vec4 col = vec4(0.0);
          int samples = 0;
          for (int i = -1; i <= 1; i++){
              for (int j = -1; j <= 1; j++){
                  vec2 offset = vec2(float(i), float(j)) * (1.0 / min(uResolution.x, uResolution.y));
                  col += renderImage(vUv + offset);
                  samples++;
              }
          }
          gl_FragColor = col / float(samples);
      }
    `,y=new er(h),x=new sr(h,{vertex:d,fragment:m,uniforms:{uTime:{value:0},uResolution:{value:new Float32Array([h.canvas.width,h.canvas.height,h.canvas.width/h.canvas.height])},uBaseColor:{value:new Float32Array(s)},uAmplitude:{value:t},uFrequencyX:{value:r},uFrequencyY:{value:n},uMouse:{value:new Float32Array([0,0])}}}),S=new tr(h,{geometry:y,program:x});function v(){g.setSize(c.offsetWidth*1,c.offsetHeight*1);const P=x.uniforms.uResolution.value;P[0]=h.canvas.width,P[1]=h.canvas.height,P[2]=h.canvas.width/h.canvas.height}window.addEventListener("resize",v),v();function j(L){const P=c.getBoundingClientRect(),T=(L.clientX-P.left)/P.width,O=1-(L.clientY-P.top)/P.height,C=x.uniforms.uMouse.value;C[0]=T,C[1]=O}function u(L){if(L.touches.length>0){const P=L.touches[0],T=c.getBoundingClientRect(),O=(P.clientX-T.left)/T.width,C=1-(P.clientY-T.top)/T.height,_=x.uniforms.uMouse.value;_[0]=O,_[1]=C}}o&&(c.addEventListener("mousemove",j),c.addEventListener("touchmove",u));let b;function A(L){b=requestAnimationFrame(A),x.uniforms.uTime.value=L*.001*a,g.render({scene:S})}return b=requestAnimationFrame(A),c.appendChild(h.canvas),()=>{var L;cancelAnimationFrame(b),window.removeEventListener("resize",v),o&&(c.removeEventListener("mousemove",j),c.removeEventListener("touchmove",u)),h.canvas.parentElement&&h.canvas.parentElement.removeChild(h.canvas),(L=h.getExtension("WEBGL_lose_context"))==null||L.loseContext()}},[s,a,t,r,n,o]),e.jsx("div",{ref:p,className:"w-full h-full",...i})};function Wl({isOpen:s,onClose:a,property:t,currentUser:r,userProfile:n}){var L,P;const o=!!r,i=(n==null?void 0:n.subscription_tier)==="pro";if(!t)return null;const p=t.price?ue(Number(t.price)):"Price on application";let c=t.location||t.address||"Address not available",g=t.postcode||((P=(L=t.location)==null?void 0:L.match(/[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}/i))==null?void 0:P[0])||"";const h=t.property_type||"Residential",d=t.beds||t.bedrooms||0,m=t.baths||t.bathrooms||0,y=t.square_footage||t.sqft||0,x=t.tenure||"Freehold",S=t.description||"No description available",j=(t.sale_history||[]).filter(T=>T&&T.sale_price&&!isNaN(Number(T.sale_price))).sort((T,O)=>new Date(O.sale_date).getTime()-new Date(T.sale_date).getTime());let u=0;if(j.length>1){const T=Number(j[0].sale_price),O=Number(j[j.length-1].sale_price);u=(T-O)/O*100}const A=((T,O,C,_)=>{const R=T*(1-O/100),B=C/100/12,Y=_*12,Z=R*B*Math.pow(1+B,Y)/(Math.pow(1+B,Y)-1);return{monthlyPayment:Z,totalInterest:Z*Y-R,totalCost:Z*Y}})(Number(t.price)||0,20,4.5,25);return e.jsx(Ee,{open:s,onOpenChange:a,children:e.jsxs(Ie,{className:"max-w-full sm:max-w-3xl md:max-w-4xl max-h-[90vh] overflow-y-auto p-0 w-[95vw] mx-auto",children:[e.jsxs("div",{className:"relative h-56 sm:h-64 md:h-72 overflow-hidden",children:[e.jsx("img",{src:t.image_url||`https://source.unsplash.com/random/1200x600?property,house&sig=${t.id}`,alt:c,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-4 left-4 flex gap-2",children:[e.jsx(te,{className:"bg-primary text-white",children:h}),t.status&&e.jsx(te,{variant:"secondary",children:t.status})]}),e.jsx("button",{className:"absolute top-4 right-4 bg-black/50 text-white rounded-full p-2",onClick:a,"aria-label":"Close",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs(Ae,{className:"mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2",children:[e.jsx(Pe,{className:"text-xl sm:text-2xl font-bold",children:p}),e.jsxs("div",{className:"flex items-center gap-1 self-end sm:self-auto",children:[e.jsx(w,{variant:"outline",size:"sm",className:"text-xs sm:text-sm h-8",onClick:T=>T.stopPropagation(),children:"Save"}),e.jsx(w,{variant:"outline",size:"sm",className:"text-xs sm:text-sm h-8",onClick:T=>T.stopPropagation(),children:"Share"})]})]}),e.jsx(Ge,{className:"text-sm sm:text-base font-medium text-foreground mt-1",children:c})]}),e.jsxs(es,{defaultValue:"details",className:"mt-4 sm:mt-6",children:[e.jsxs(ss,{className:"grid grid-cols-3 w-full mb-4 sm:mb-6 h-auto",children:[e.jsx(ge,{value:"details",className:"text-xs sm:text-sm py-1.5 px-1 sm:py-2 sm:px-4",children:"Property Details"}),e.jsx(ge,{value:"investment",className:"text-xs sm:text-sm py-1.5 px-1 sm:py-2 sm:px-4",children:"Investment Metrics"}),e.jsx(ge,{value:"history",className:"text-xs sm:text-sm py-1.5 px-1 sm:py-2 sm:px-4",children:"History & Area"})]}),e.jsxs(de,{value:"details",className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-2 sm:p-3 bg-muted rounded-lg",children:[e.jsx(ei,{className:"h-4 w-4 sm:h-5 sm:w-5 mb-1 text-muted-foreground"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[d," Beds"]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-2 sm:p-3 bg-muted rounded-lg",children:[e.jsx(si,{className:"h-4 w-4 sm:h-5 sm:w-5 mb-1 text-muted-foreground"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[m," Baths"]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-2 sm:p-3 bg-muted rounded-lg",children:[e.jsx(ti,{className:"h-4 w-4 sm:h-5 sm:w-5 mb-1 text-muted-foreground"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[Fr(y)," sq ft"]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-2 sm:p-3 bg-muted rounded-lg",children:[e.jsx(lr,{className:"h-4 w-4 sm:h-5 sm:w-5 mb-1 text-muted-foreground"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:x})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 flex items-center",children:[e.jsx(Zs,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Location"]}),e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:[e.jsxs("p",{className:"text-xs sm:text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",c]}),g&&e.jsxs("p",{className:"text-xs sm:text-sm",children:[e.jsx("span",{className:"font-medium",children:"Postcode:"})," ",g]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 flex items-center",children:[e.jsx(Js,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Description"]}),e.jsx("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:e.jsx("p",{className:"text-xs sm:text-sm whitespace-pre-line",children:S})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 flex items-center",children:[e.jsx(ve,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Property Documents"]}),e.jsx("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:e.jsx("p",{className:"text-xs sm:text-sm mb-2",children:o&&i?e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2 text-muted-foreground"}),e.jsx("span",{className:"text-primary underline cursor-pointer text-xs sm:text-sm",children:"Energy Performance Certificate (EPC)"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2 text-muted-foreground"}),e.jsx("span",{className:"text-primary underline cursor-pointer text-xs sm:text-sm",children:"Floor Plan"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2 text-muted-foreground"}),e.jsx("span",{className:"text-primary underline cursor-pointer text-xs sm:text-sm",children:"Property Brochure"})]})]}):e.jsxs("div",{className:"text-center py-2",children:[e.jsx("p",{className:"text-muted-foreground mb-2 text-xs sm:text-sm",children:"Upgrade to PRO to access property documents"}),e.jsx(w,{className:"text-xs sm:text-sm",size:"sm",children:"Upgrade Now"})]})})})]})]}),e.jsx(de,{value:"investment",className:"space-y-4 sm:space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center",children:[e.jsx(ye,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Investment Metrics"]}),e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Estimated Monthly Rent"}),e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:ue(t.estimated_rent||t.price*.004)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Rental Yield"}),e.jsxs("span",{className:"font-medium text-xs sm:text-sm",children:[t.rental_yield?t.rental_yield.toFixed(2):(t.price*.004*12/t.price*100).toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Estimated ROI (5yr)"}),e.jsxs("span",{className:"font-medium text-xs sm:text-sm",children:[t.roi?t.roi.toFixed(2):(t.price*.25/t.price*100).toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Price per sq ft"}),e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:y>0?ue(t.price/y):"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center",children:[e.jsx(Zt,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Area Insights"]}),e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Average Area Price"}),e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:ue(t.area_avg_price||t.price*1.1)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Price vs. Area Average"}),e.jsx("div",{className:"flex items-center",children:t.price<(t.area_avg_price||t.price*1.1)?e.jsxs(e.Fragment,{children:[e.jsx(ai,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-500 mr-1"}),e.jsxs("span",{className:"text-green-500 font-medium text-xs sm:text-sm",children:[(((t.area_avg_price||t.price*1.1)-t.price)/(t.area_avg_price||t.price*1.1)*100).toFixed(1),"% below"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-3 w-3 sm:h-4 sm:w-4 text-amber-500 mr-1"}),e.jsxs("span",{className:"text-amber-500 font-medium text-xs sm:text-sm",children:[((t.price-(t.area_avg_price||t.price*.9))/(t.area_avg_price||t.price*.9)*100).toFixed(1),"% above"]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"12-month Price Trend"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-500 font-medium text-xs sm:text-sm",children:"+4.2%"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center",children:[e.jsx(ye,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Mortgage Calculator"]}),e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-3 sm:mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm mb-1",children:"Property Price"}),e.jsx("p",{className:"text-sm sm:text-base font-medium",children:ue(Number(t.price)||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm mb-1",children:"Monthly Payment"}),e.jsx("p",{className:"text-sm sm:text-base font-medium",children:ue(A.monthlyPayment)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm mb-1",children:"Total Interest"}),e.jsx("p",{className:"text-sm sm:text-base font-medium",children:ue(A.totalInterest)})]})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground text-center mt-2",children:"Based on 20% down payment, 4.5% interest rate, 25-year term"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center",children:[e.jsx(ye,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Cash Flow Analysis"]}),e.jsx("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Monthly Rental Income"}),e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:ue(t.estimated_rent||t.price*.004)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Mortgage Payment"}),e.jsxs("span",{className:"font-medium text-red-500 text-xs sm:text-sm",children:["-",ue(A.monthlyPayment)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Est. Maintenance (10%)"}),e.jsxs("span",{className:"font-medium text-red-500 text-xs sm:text-sm",children:["-",ue((t.estimated_rent||t.price*.004)*.1)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Est. Management (5%)"}),e.jsxs("span",{className:"font-medium text-red-500 text-xs sm:text-sm",children:["-",ue((t.estimated_rent||t.price*.004)*.05)]})]}),e.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Monthly Cash Flow"}),e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:ue((t.estimated_rent||t.price*.004)-A.monthlyPayment-(t.estimated_rent||t.price*.004)*.15)})]})]})})]})]})}),e.jsxs(de,{value:"history",className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center",children:[e.jsx(We,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Sale History"]}),j.length>0?e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{className:"mb-3 sm:mb-4",children:[u!==0&&e.jsxs("div",{className:"mb-2 sm:mb-3 text-xs sm:text-sm",children:[e.jsx("span",{className:"font-medium",children:"Total price growth: "}),e.jsxs("span",{className:u>=0?"text-green-500":"text-red-500",children:[u>=0?"+":"",u.toFixed(2),"%"]})]}),e.jsx("div",{className:"relative h-16 sm:h-24 mt-4 sm:mt-6 mb-1 sm:mb-2",children:j.map((T,O)=>{const C=Math.max(...j.map(Y=>Number(Y.sale_price))),_=Number(T.sale_price)/C*100,R=100/j.length,B=O*R;return e.jsx("div",{className:"absolute bottom-0 bg-primary hover:bg-primary/80 rounded-t transition-all cursor-pointer group",style:{height:`${_}%`,width:`${R-5}%`,left:`${B}%`},title:`${ts(T.sale_date)}: ${ue(Number(T.sale_price))}`,children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-9 sm:-top-10 left-1/2 transform -translate-x-1/2 bg-background border p-1 sm:p-2 rounded text-[10px] sm:text-xs whitespace-nowrap z-10",children:[ts(T.sale_date),": ",ue(Number(T.sale_price))]})},O)})})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:j.map((T,O)=>e.jsxs("div",{className:"flex justify-between items-center py-0.5 sm:py-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(We,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2 text-muted-foreground"}),e.jsx("span",{className:"text-xs sm:text-sm",children:ts(T.sale_date)})]}),e.jsx("span",{className:"font-medium text-xs sm:text-sm",children:ue(Number(T.sale_price))})]},O))})]}):e.jsx("div",{className:"bg-muted rounded-lg p-3 sm:p-4 text-center",children:e.jsx("p",{className:"text-muted-foreground text-xs sm:text-sm",children:"No sale history available"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center",children:[e.jsx(Zt,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-muted-foreground"}),"Neighborhood Information"]}),o&&i?e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Local Schools"}),e.jsx(te,{variant:"outline",className:"text-xs",children:"Good"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Transport Links"}),e.jsx(te,{variant:"outline",className:"text-xs",children:"Excellent"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Local Amenities"}),e.jsx(te,{variant:"outline",className:"text-xs",children:"Good"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs sm:text-sm",children:"Crime Rate"}),e.jsx(te,{variant:"outline",className:"text-xs",children:"Low"})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"This property is located in a well-established residential area with good local schools and excellent transport links. The neighborhood has seen steady property value growth over the past 5 years."})})]}):e.jsxs("div",{className:"bg-muted rounded-lg p-3 sm:p-4 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-2 text-xs sm:text-sm",children:"Upgrade to PRO to access detailed neighborhood information"}),e.jsx(w,{className:"text-xs sm:text-sm",size:"sm",children:"Upgrade Now"})]})]})]})]})]})]})})}const Ye=[{name:"Savills",username:"@savills",body:"Leading the way in property investment and market analysis.",img:"https://avatar.vercel.sh/savills"},{name:"Knight Frank",username:"@knightfrank",body:"Exceptional platform for property investment insights.",img:"https://avatar.vercel.sh/knightfrank"},{name:"JLL",username:"@jll",body:"Revolutionary approach to property investment analytics.",img:"https://avatar.vercel.sh/jll"}],Yl=Ye.slice(0,Ye.length/2),Kl=Ye.slice(Ye.length/2),Jl=Ye.slice(0,Ye.length/2),Zl=Ye.slice(Ye.length/2),Rs=({img:s,name:a,username:t,body:r})=>e.jsxs("figure",{className:k("relative h-full w-36 cursor-pointer overflow-hidden rounded-xl border p-4","border-gray-950/[.1] bg-gray-950/[.01] hover:bg-gray-950/[.05]","dark:border-gray-50/[.1] dark:bg-gray-50/[.10] dark:hover:bg-gray-50/[.15]"),children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx("img",{className:"rounded-full",width:"32",height:"32",alt:"",src:s}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("figcaption",{className:"text-sm font-medium dark:text-white",children:a}),e.jsx("p",{className:"text-xs font-medium dark:text-white/40",children:t})]})]}),e.jsx("blockquote",{className:"mt-2 text-sm",children:r})]}),Xl=()=>{var F;const{user:s,profile:a,signOut:t}=ee(),[r,n]=N.useState(!0),[o,i]=N.useState([]),[p,c]=N.useState(!1),[g,h]=N.useState(!1),[d,m]=N.useState(!1),[y,x]=N.useState("signin"),[S,v]=N.useState(!1),[j]=N.useState(),[u,b]=N.useState(1),[A,L]=N.useState(!0),P=6,[T,O]=N.useState(!0),[C,_]=N.useState(!1),[R,B]=N.useState(null),[Y,Z]=N.useState(!1),$=N.useRef(null),Q=N.useRef(!1),{data:X,isLoading:W}=Vl(),he=async(f=1,M=!1)=>{if(!Q.current){Q.current=!0;try{M?_(!0):O(!0),console.log("Fetching page:",f);const H=await ta(f,P);console.log("Received properties:",H),i(f===1?H:re=>[...re,...H]),L(H.length===P),b(f),n(!1)}catch(H){console.error("Error loading properties:",H)}finally{O(!1),_(!1),Q.current=!1}}};N.useEffect(()=>{r&&he(1,!1)},[r]),N.useEffect(()=>{if(!$.current||r||p)return;const f=new IntersectionObserver(M=>{M[0].isIntersecting&&A&&!Q.current&&he(u+1,!0)},{rootMargin:"200px",threshold:.1});return f.observe($.current),()=>f.disconnect()},[A,u,r,p]);const me=async f=>{if(!f.trim()){i([]),c(!1),b(1),L(!0),O(!0);try{const M=await ta(1,P);i(M),L(M.length===P)}catch(M){console.error("Error loading properties:",M)}finally{O(!1)}return}c(!0),i([]);try{const H=(await Bl(f)).map(re=>({id:re.id,title:re.title,location:re.location,price:re.price,sqft:re.sqft,beds:re.beds,baths:re.baths,description:re.description,image_url:re.image_url,is_featured:re.is_featured,created_at:re.created_at,updated_at:re.updated_at}));i(H),L(!1),b(1)}catch(M){console.error("Error searching properties:",M),i([])}finally{c(!1)}},fe=T,pe=o&&o.length>0;return console.log("Render state:",{isLoading:T,searchResultsLength:o==null?void 0:o.length,showLoading:fe,showProperties:pe}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ws,{isAuthenticated:!!s,userProfile:a||void 0,onSignIn:()=>{x("signin"),h(!0)},onSignUp:()=>{x("signup"),h(!0)},onSignOut:async()=>{try{await t(),window.location.href="/"}catch(f){console.error("Error signing out:",f)}}}),e.jsxs("main",{children:[e.jsx(Ce,{onSearch:me}),e.jsx("div",{className:"w-full bg-background py-8",children:e.jsxs("div",{className:"max-w-[1200px] mx-auto px-4 sm:px-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:p?"Search Results":"Featured Properties"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:fe?Array(3).fill(0).map((f,M)=>e.jsx("div",{className:"w-full h-[420px] bg-muted rounded-lg animate-pulse"},M)):pe?o.map(f=>e.jsx("div",{onClick:()=>{B(f),Z(!0)},className:"cursor-pointer hover:opacity-90 transition-opacity",children:e.jsx(Ws,{id:f.id,address:f.location||"Location not available",price:Number(f.price)||0,squareFootage:Number(f.sqft)||0,bedrooms:Number(f.beds)||0,bathrooms:Number(f.baths)||0,isPremium:!!f.is_featured,propertyType:"residential",description:f.description||"",createdAt:f.created_at||new Date().toISOString(),images:f.image_url?[f.image_url]:[],currentUser:s,userProfile:a})},f.id||Math.random().toString())):e.jsx("div",{className:"col-span-3 text-center py-8 text-muted-foreground",children:"No properties found"})}),A&&!T&&!p&&e.jsx("div",{ref:$,className:"h-24 flex items-center justify-center my-8",children:C?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Fe,{}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading more properties..."})]}):e.jsx("div",{className:"h-8"})})]})}),e.jsx("div",{className:"w-full bg-background py-8",children:e.jsxs("div",{className:"max-w-[1200px] mx-auto px-4 sm:px-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Investment Deals"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:W?Array(3).fill(0).map((f,M)=>e.jsx("div",{className:"w-full h-[420px] bg-muted rounded-lg animate-pulse"},M)):(F=X==null?void 0:X.pages)!=null&&F[0]&&Array.isArray(X.pages[0])?X.pages[0].map(f=>e.jsx(Ws,{id:f.id,address:f.location,price:f.price,description:f.description,propertyType:f.property_type,createdAt:f.created_at,images:[f.image_url],isDeal:!0,roi_percentage:f.roi_percentage,investment_term:f.investment_term,deal_type:f.deal_type,isPremium:!0,currentUser:s,userProfile:a},f.id)):e.jsx("div",{className:"col-span-3 text-center py-8 text-muted-foreground",children:"No investment deals available"})})]})}),e.jsxs("section",{className:"w-full py-12 bg-background",children:[e.jsx("div",{className:"container mx-auto text-center mb-8",children:e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Trusted by Industry Leaders"})}),e.jsxs("div",{className:"relative flex h-96 w-full flex-row items-center justify-center gap-4 overflow-hidden [perspective:300px]",children:[e.jsxs("div",{className:"flex flex-row items-center gap-4",style:{transform:"translateX(-100px) translateY(0px) translateZ(-100px) rotateX(20deg) rotateY(-10deg) rotateZ(20deg)"},children:[e.jsx(_s,{pauseOnHover:!0,vertical:!0,className:"[--duration:20s]",children:Yl.map(f=>e.jsx(Rs,{...f},f.username))}),e.jsx(_s,{reverse:!0,pauseOnHover:!0,className:"[--duration:20s]",vertical:!0,children:Kl.map(f=>e.jsx(Rs,{...f},f.username))}),e.jsx(_s,{reverse:!0,pauseOnHover:!0,className:"[--duration:20s]",vertical:!0,children:Jl.map(f=>e.jsx(Rs,{...f},f.username))}),e.jsx(_s,{pauseOnHover:!0,className:"[--duration:20s]",vertical:!0,children:Zl.map(f=>e.jsx(Rs,{...f},f.username))})]}),e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-0 h-1/4 bg-gradient-to-b from-background"}),e.jsx("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 h-1/4 bg-gradient-to-t from-background"}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 w-1/4 bg-gradient-to-r from-background"}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 w-1/4 bg-gradient-to-l from-background"})]})]}),e.jsx("div",{className:"w-full bg-background py-8",children:e.jsx("div",{className:"max-w-[1200px] mx-auto px-4 sm:px-8",children:e.jsx("div",{className:"mb-8",children:e.jsx(an,{})})})}),(!a||a.subscription_tier==="free")&&e.jsx("div",{className:"w-full bg-background py-16",children:e.jsx("div",{className:"max-w-[1200px] mx-auto px-4 sm:px-8",children:e.jsxs("div",{className:"relative w-full rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx(Hl,{baseColor:[.1,.1,.1],speed:1,amplitude:.6,interactive:!0})}),e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[8px]"}),e.jsxs("div",{className:"relative z-10 text-center py-12 px-8",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 text-white",children:"Unlock Premium Property Insights"}),e.jsx("p",{className:"text-lg text-gray-300 mb-8 max-w-2xl mx-auto",children:"Get access to detailed property analysis, market comparisons, and investment metrics to make informed decisions."}),e.jsx("button",{onClick:()=>m(!0),className:"px-8 py-3 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:"Upgrade Now"})]})]})})})]}),e.jsx(_t,{}),e.jsx(Pt,{isOpen:g,onClose:()=>h(!1),defaultMode:y}),e.jsx(Qs,{isOpen:d,onClose:()=>m(!1),currentUser:s,userProfile:a}),e.jsx(tn,{isOpen:S,onClose:()=>v(!1),receiverId:j,currentUser:s,userProfile:a}),e.jsx(Wl,{isOpen:Y,onClose:()=>{Z(!1),setTimeout(()=>B(null),300)},property:R,currentUser:s,userProfile:a})]})};function ce({children:s}){const{user:a,profile:t,signOut:r,isLoading:n}=ee(),[o,i]=N.useState(!1),[p,c]=N.useState("signin");return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ws,{isAuthenticated:!!a,userProfile:t,onSignIn:()=>window.location.href="/login",onSignUp:()=>window.location.href="/signup",onSignOut:r}),e.jsx("main",{className:"flex-1",children:s}),e.jsx(_t,{}),e.jsx(Pt,{isOpen:o,onClose:()=>i(!1),defaultMode:p})]})}function Ql(){const[s,a]=l.useState(null),[t,r]=l.useState(!0);return l.useEffect(()=>{const o=async()=>{try{const g=(await(await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"What is the current Bitcoin price in GBP? Return ONLY the number, no text or currency symbols."}]}]})})).json()).candidates[0].content.parts[0].text,h=parseFloat(g.replace(/[^0-9.]/g,""));isNaN(h)||(a(h),r(!1))}catch(p){console.error("Error fetching Bitcoin price:",p)}};o();const i=setInterval(o,6e4);return()=>clearInterval(i)},[]),{btcPrice:s,loading:t,convertGBPtoBTC:o=>s?o/s:null}}function eo({amount:s}){const{loading:a,convertGBPtoBTC:t}=Ql(),r=t(s);return a?e.jsx("span",{className:"text-muted-foreground",children:"Loading..."}):r?e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(or,{className:"h-4 w-4 text-[#F7931A]"}),r.toFixed(2)]}):null}async function so(s,a){var t;try{console.log("Starting profile update for user:",s),console.log("Updates to apply:",a);const{data:r,error:n}=await U.from("profiles").select("role").eq("id",(t=(await U.auth.getUser()).data.user)==null?void 0:t.id);if(n)throw console.error("Admin check error:",n),n;if(!(r!=null&&r.length)||r[0].role!=="admin")throw new Error("Unauthorized: Only admins can update user profiles");const{data:o,error:i}=await U.from("profiles").select("*").eq("id",s);if(i)throw console.error("User verification error:",i),i;if(!(o!=null&&o.length))throw new Error("User not found");console.log("Existing user:",o[0]);const p={...a,updated_at:new Date().toISOString()};console.log("Applying updates:",p);const{data:c,error:g}=await U.from("profiles").update(p).eq("id",s).select();if(g)throw console.error("Profile update error:",g),g;if(!(c!=null&&c.length))throw console.error("No data returned from update"),new Error("Update failed - no data returned");if(console.log("Profile updated successfully:",c[0]),a.role)try{await U.auth.admin.updateUserById(s,{user_metadata:{role:a.role}}),console.log("Auth metadata updated for role change")}catch(h){console.warn("Failed to update auth metadata (non-critical):",h)}return c[0]}catch(r){throw console.error("Error in updateUserProfile:",r),r}}async function aa(){try{const{data:s,error:a}=await U.from("profiles").select(`
        *,
        subscription_tier,
        subscription_status,
        role
      `).order("created_at",{ascending:!1});if(a)throw console.error("Profiles fetch error:",a),a;return s?s.map(t=>({...t,role:t.role||"user",subscription_tier:t.subscription_tier||"free",subscription_status:t.subscription_status||"active"})):[]}catch(s){throw console.error("Error fetching users:",s),s}}async function to(s,a){try{console.log("Importing properties:",{count:s.length,userId:a});const{data:t,error:r}=await U.from("properties").insert(s.map(n=>({...n,added_by_user_id:a,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})));if(r)throw console.error("Supabase error:",r),r;return console.log("Import successful:",t),t}catch(t){throw console.error("Error importing properties:",t),t}}const ks=l.forwardRef(({className:s,...a},t)=>e.jsx("textarea",{className:k("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a}));ks.displayName="Textarea";function ao({children:s}){const[a,t]=l.useState(!1),[r,n]=l.useState(!0);l.useEffect(()=>{o()},[]);const o=()=>{n(!0);try{const i=ee();t(!0)}catch(i){console.error("Auth context not available:",i),t(!1)}finally{n(!1)}};return r?e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Checking authentication..."})]})}):a?e.jsx(e.Fragment,{children:s}):e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"text-center max-w-md p-6 border rounded-lg bg-muted/50",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Authentication Error"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to access authentication. This may be due to a temporary issue or your session has expired."}),e.jsxs(w,{variant:"outline",onClick:()=>{window.location.reload()},className:"inline-flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"})," Refresh Page"]})]})})}function ro(){const[s,a]=l.useState(!1),[t,r]=l.useState(""),[n,o]=l.useState(!1),[i,p]=l.useState(!1),[c,g]=l.useState([]),[h,d]=l.useState(new Set),[m,y]=l.useState(1),[x,S]=l.useState(1),[v,j]=l.useState(0),[u,b]=l.useState(null),[A,L]=l.useState(""),[P,T]=l.useState(!1),[O,C]=l.useState("idle"),[_,R]=l.useState(""),{user:B}=ee(),{toast:Y}=_e();l.useEffect(()=>{s||(g([]),d(new Set),y(1),S(1),j(0),r(""))},[s]);const Z=async()=>{if(!(!(B!=null&&B.id)||h.size===0))try{p(!0);const X=c.filter(W=>h.has(W.id));await to(X,B.id),Y({title:"Success",description:`Imported ${h.size} properties successfully`}),a(!1)}catch{Y({variant:"destructive",title:"Error",description:"Failed to import properties. Please try again."})}finally{p(!1)}},$=X=>{X.target.files&&X.target.files.length>0&&(b(X.target.files[0]),L(""))},Q=X=>{L(X.target.value),b(null)};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Property Importer"}),e.jsx("p",{className:"text-muted-foreground",children:"Import properties from external sources by uploading a JSON file or pasting JSON data."})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(K,{children:"Upload JSON File"}),e.jsx(Ze,{children:"Import properties from a JSON file"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center hover:bg-muted/50 transition-colors",children:[e.jsx(cr,{className:"h-10 w-10 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Drag and drop a JSON file here, or click to browse"}),e.jsx(G,{type:"file",accept:".json",onChange:$,className:"hidden",id:"file-upload"}),e.jsx(q,{htmlFor:"file-upload",className:"cursor-pointer",children:e.jsx(w,{variant:"outline",type:"button",children:"Browse Files"})})]}),u&&e.jsxs("div",{className:"bg-muted p-3 rounded text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Selected file:"}),e.jsxs("p",{className:"text-muted-foreground",children:[u.name," (",Math.round(u.size/1024)," KB)"]})]})]})})]}),e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(K,{children:"Paste JSON Data"}),e.jsx(Ze,{children:"Paste your JSON data directly"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ks,{placeholder:'{"properties": [{"address": "123 Main St", "price": 250000, ...}]}',rows:8,value:A,onChange:Q,className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"JSON must be properly formatted and contain property data."})]})})]})]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx(w,{onClick:Z,disabled:P||!u&&!A,className:"px-8",children:P?"Importing...":"Import Properties"})}),O!=="idle"&&e.jsxs(js,{variant:O==="success"?"default":"destructive",className:"mt-6",children:[O==="success"?e.jsx(ri,{className:"h-4 w-4"}):e.jsx(kt,{className:"h-4 w-4"}),e.jsx(Rt,{children:O==="success"?"Import Successful":"Import Failed"}),e.jsx(vs,{children:_})]}),e.jsxs(E,{className:"mt-8",children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"h-5 w-5"}),"Import Format Guidelines"]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your JSON data should follow this structure:"}),e.jsx("pre",{className:"bg-muted p-4 rounded-md text-xs overflow-auto",children:`{
  "properties": [
    {
      "address": "123 Main Street, London, E1 6AN",
      "price": 450000,
      "type": "flat",
      "bedrooms": 2,
      "bathrooms": 1,
      "size_sqft": 750,
      "description": "A spacious 2 bedroom flat...",
      "images": ["image1.jpg", "image2.jpg"]
    },
    {
      // Additional properties...
    }
  ]
}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can also import a simple array of property objects."})]})})]})]})}function no(){return e.jsx(ao,{children:e.jsx(ro,{})})}function io(){const{user:s,profile:a}=ee(),t=be(),[r,n]=N.useState([]),[o,i]=N.useState([]),[p,c]=N.useState([]),[g,h]=N.useState({totalProperties:0,totalValue:0,averagePrice:0,totalProfit:0,monthlyIncome:0}),[d,m]=N.useState(!0),[y,x]=N.useState(null),S=N.useCallback(async()=>{if(!(!s||(a==null?void 0:a.role)!=="admin"))try{const u=await aa();c(u)}catch(u){console.error("Error loading users:",u),x("Failed to load users")}finally{m(!1)}},[s,a]),v=async(u,b)=>{try{m(!0),console.log("Attempting to update user:",u),console.log("Updates:",b);const A=await so(u,b);console.log("Update successful:",A);const L=await aa();c(L),alert("User updated successfully")}catch(A){console.error("Error updating user:",A),alert(A.message||"Failed to update user. Please check console for details.")}finally{m(!1)}},j=N.useCallback(async()=>{if(s)try{const[u,{data:b}]=await Promise.all([Gl(s.id),U.from("properties").select(`*,
            assigned_user:profiles!properties_assigned_user_id_fkey(full_name, email),
            author:profiles!properties_created_by_fkey(full_name, email)`).eq("created_by",s.id)]);i(b||[]),n(u);const A=(b||[]).length+u.length,L=[...b||[],...u].reduce((C,_)=>C+(_.price||0),0),P=L/(A||1),T=[...b||[],...u].reduce((C,_)=>C+(_.potential_profit||0),0),O=[...b||[],...u].reduce((C,_)=>C+(_.monthly_income||0),0);h({totalProperties:A,totalValue:L,averagePrice:P,totalProfit:T,monthlyIncome:O})}catch(u){console.error("Error loading properties:",u)}},[s]);return N.useEffect(()=>{if(!s){t("/");return}j(),S()},[s,t,j,S]),s?e.jsx(ce,{children:e.jsx("main",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx(no,{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(E,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Portfolio Value"}),e.jsx(ye,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:["Â£",g.totalValue.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[g.totalProperties," properties"]})]})}),e.jsx(E,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Average Price"}),e.jsx(xt,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:["Â£",g.averagePrice.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Per property"})]})}),e.jsx(E,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Profit"}),e.jsx(Ns,{className:"w-5 h-5 text-primary"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:["Â£",g.totalProfit.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Estimated profit"})]})}),e.jsx(E,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"BTC Value"}),e.jsx(or,{className:"w-5 h-5 text-[#F7931A]"})]}),e.jsx(eo,{amount:g.totalValue}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Portfolio in BTC"})]})})]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-2xl font-semibold flex items-center gap-2",children:[e.jsx(Ct,{className:"w-5 h-5"})," User Management"]})}),y&&e.jsx("div",{className:"text-red-500 mb-4",children:y}),d?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:"grid gap-4",children:p.map(u=>e.jsx("div",{className:"border p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:u.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:u.email})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u.role,onChange:b=>v(u.id,{role:b.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsxs("select",{value:u.subscription_tier,onChange:b=>v(u.id,{subscription_tier:b.target.value}),className:"border rounded p-1",children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"premium",children:"Premium"})]})]})]})},u.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold flex items-center gap-2",children:[e.jsx(ni,{className:"w-5 h-5"})," Saved Properties"]}),e.jsx("div",{className:"space-y-4",children:r.map(u=>e.jsx(Ws,{...u.property,isSubscriber:(a==null?void 0:a.subscription_tier)!=="free"},u.property.id))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"})," Added Properties"]}),e.jsx("div",{className:"space-y-4",children:o.map(u=>e.jsx(Ws,{...u,isSubscriber:(a==null?void 0:a.subscription_tier)!=="free"},u.id))})]})]})]})})}):(t("/"),null)}function lo({onSubscribe:s}){const{profile:a}=ee(),t=(a==null?void 0:a.subscription_tier)||"free";return e.jsx("div",{className:"py-16 bg-background",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Select the perfect plan for your property investment journey"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-7xl mx-auto",children:Object.entries(Ml).map(([r,n])=>e.jsxs(E,{className:`relative ${r==="PRO"?"border-primary shadow-lg scale-105 bg-gradient-to-r from-emerald-400/10 to-cyan-400/10":""}`,children:[r==="PRO"&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-emerald-400 to-cyan-400 text-white px-4 py-1 rounded-full text-sm font-medium border border-emerald-500/20 shadow-lg",children:"Most Popular"}),e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold",children:n.name}),r==="PREMIUM"&&e.jsx(Xa,{className:"h-6 w-6 text-yellow-500"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-4xl font-bold",children:n.price}),e.jsx("span",{className:"text-gray-600 ml-2",children:"/month"})]})]}),e.jsx(D,{children:e.jsx("ul",{className:"space-y-3",children:n.features.map((o,i)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsx("span",{children:o})]},i))})}),e.jsx(Ss,{children:e.jsx(w,{className:"w-full",variant:r==="PRO"?"default":"outline",onClick:()=>s(n.priceId),disabled:t===r.toLowerCase(),children:t===r.toLowerCase()?"Current Plan":"Subscribe"})})]},r))})]})})}function oo(){const{user:s,profile:a,signOut:t}=ee(),{toast:r}=_e(),[n,o]=N.useState(!1),[i,p]=N.useState("signin"),c=async g=>{if(!s){localStorage.setItem("pending_subscription_price_id",g),p("signup"),o(!0);return}try{await Qr(g,s.id)}catch{r({title:"Error",description:"Failed to start subscription process. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ws,{isAuthenticated:!!s,userProfile:a||void 0,onSignIn:()=>{p("signin"),o(!0)},onSignUp:()=>{p("signup"),o(!0)},onSignOut:async()=>{try{await t(),window.location.href="/"}catch(g){console.error("Error signing out:",g)}}}),e.jsx(Ce,{title:"Choose Your Perfect Plan",subtitle:"Select the perfect subscription plan to unlock premium features and detailed property insights",backgroundImage:"https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-4.0.3",showSearch:!1,showStats:!1,height:"h-[400px]"}),e.jsxs("main",{children:[e.jsx(lo,{onSubscribe:c}),e.jsxs("div",{className:"container mx-auto px-4 py-12",children:[e.jsxs("div",{className:"max-w-4xl mx-auto prose dark:prose-invert mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Investment Plans for Every Property Investor"}),e.jsx("p",{children:"Choose from our range of subscription plans designed to meet the needs of property investors at every level. From market analysis to detailed property insights, our plans provide the tools you need to make informed investment decisions."}),e.jsx("h3",{className:"text-2xl font-semibold mt-8 mb-4",children:"Plan Benefits"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Access to comprehensive property market data and analytics"}),e.jsx("li",{children:"Real-time market insights and trend analysis"}),e.jsx("li",{children:"Advanced property search and filtering capabilities"}),e.jsx("li",{children:"Investment calculators and ROI projections"}),e.jsx("li",{children:"Portfolio tracking and management tools"})]}),e.jsx("h3",{className:"text-2xl font-semibold mt-8 mb-4",children:"Why Subscribe?"}),e.jsx("p",{children:"Our subscription plans give you access to premium features and insights that help you stay ahead in the property market. From basic market analysis to advanced AI-powered predictions, we provide the tools you need to make successful property investments."}),e.jsx("h3",{className:"text-2xl font-semibold mt-8 mb-4",children:"Money-Back Guarantee"}),e.jsx("p",{children:"We're confident in the value our platform provides. If you're not satisfied with your subscription within the first 30 days, we'll provide a full refund, no questions asked."})]}),e.jsx(an,{})]})]}),e.jsx(_t,{}),e.jsx(Pt,{isOpen:n,onClose:()=>o(!1),defaultMode:i})]})}function co(s){const[a,t]=N.useState(0),[r,n]=N.useState(!1),{user:o}=ee(),{toast:i}=_e(),[p,c]=N.useState({profileImage:"",bannerImage:"",selectedWidgets:[]}),g=async()=>{if(o){n(!0);try{const{error:d}=await U.from("profiles").update({avatar_url:p.profileImage||`https://api.dicebear.com/7.x/avataaars/svg?seed=${o.email}`,banner_url:p.bannerImage||"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab",dashboard_widgets:p.selectedWidgets,onboarding_completed:!0}).eq("id",o.id);if(d)throw d;i({title:"Setup Complete!",description:"Your profile has been updated successfully."}),s.onClose()}catch{i({title:"Error",description:"Failed to update profile. Please try again.",variant:"destructive"})}finally{n(!1)}}},h=[{title:"Profile Image",description:"Add a profile image to personalize your account",component:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Profile Image URL"}),e.jsx(G,{placeholder:"Enter image URL or leave blank for default avatar",value:p.profileImage,onChange:d=>c(m=>({...m,profileImage:d.target.value}))})]}),p.profileImage&&e.jsx("img",{src:p.profileImage,alt:"Profile Preview",className:"w-24 h-24 rounded-full object-cover mx-auto"})]})},{title:"Dashboard Banner",description:"Choose a banner image for your dashboard",component:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Banner Image URL"}),e.jsx(G,{placeholder:"Enter banner image URL or leave blank for default",value:p.bannerImage,onChange:d=>c(m=>({...m,bannerImage:d.target.value}))})]}),p.bannerImage&&e.jsx("img",{src:p.bannerImage,alt:"Banner Preview",className:"w-full h-32 object-cover rounded-md"})]})},{title:"Dashboard Widgets",description:"Select the widgets you want to see on your dashboard",component:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:["market_trends","property_news","saved_properties","price_alerts","market_insights","investment_calculator"].map(d=>e.jsx(w,{variant:p.selectedWidgets.includes(d)?"default":"outline",onClick:()=>c(m=>({...m,selectedWidgets:m.selectedWidgets.includes(d)?m.selectedWidgets.filter(y=>y!==d):[...m.selectedWidgets,d]})),className:"h-auto py-4 px-6 text-left flex flex-col items-start space-y-2",children:e.jsx("span",{className:"font-medium capitalize",children:d.replace("_"," ")})},d))})})}];return e.jsx(Ee,{open:s.isOpen,onOpenChange:s.onClose,children:e.jsxs(Ie,{className:"sm:max-w-[600px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:h[a].title}),e.jsx(Ge,{children:h[a].description})]}),e.jsx("div",{className:"py-6",children:h[a].component}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>t(d=>Math.max(0,d-1)),disabled:a===0,children:"Previous"}),e.jsx(w,{onClick:()=>{a===h.length-1?g():t(d=>Math.min(h.length-1,d+1))},disabled:r,children:a===h.length-1?"Complete Setup":"Next"})]})]})})}function mo(){const s=be(),[a]=ii(),{toast:t}=_e(),{user:r}=ee(),[n,o]=l.useState(!0);return l.useEffect(()=>{a.get("session_id")&&t({title:"Subscription Successful!",description:"Thank you for subscribing. Your premium features are now available."}),n||s("/dashboard")},[n,s,a,t]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md w-full mx-auto p-8",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Subscription Successful!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Thank you for subscribing. Your premium features are now available."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Setting up your preferences..."})]})})}),e.jsx(co,{isOpen:n,onClose:()=>{o(!1),s("/dashboard")}})]})}function uo(){const s=be(),{toast:a}=_e();return l.useEffect(()=>{a({title:"Subscription Cancelled",description:"Your subscription process was cancelled. Please try again if this was a mistake.",variant:"destructive"});const t=setTimeout(()=>{s("/")},3e3);return()=>clearTimeout(t)},[]),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md w-full mx-auto p-8",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Subscription Cancelled"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your subscription process was cancelled. Please try again if this was a mistake."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting you to the homepage..."})]})})})}const ho=5*1024*1024,ra=["image/jpeg","image/png","image/webp"];function xo({currentAvatarUrl:s,onUpload:a,userInitials:t}){const[r,n]=l.useState(!1),{toast:o}=_e(),i=N.useRef(null),p=async c=>{var h;const g=(h=c.target.files)==null?void 0:h[0];if(g){if(g.size>ho){o({title:"File too large",description:"Please select an image under 5MB",variant:"destructive"});return}if(!ra.includes(g.type)){o({title:"Invalid file type",description:"Please select a JPEG, PNG or WebP image",variant:"destructive"});return}try{n(!0),await a(g),o({title:"Success",description:"Profile picture updated successfully"})}catch(d){console.error("Error uploading avatar:",d),o({title:"Upload failed",description:"Failed to update profile picture. Please try again.",variant:"destructive"})}finally{n(!1)}}};return e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs($e,{className:"h-24 w-24",children:[e.jsx(Ue,{src:s}),e.jsx(ze,{children:t})]}),e.jsx("input",{type:"file",ref:i,className:"hidden",accept:ra.join(","),onChange:p}),e.jsx(w,{variant:"outline",onClick:()=>{var c;return(c=i.current)==null?void 0:c.click()},disabled:r,children:r?"Uploading...":"Change Profile Picture"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Maximum file size: 5MB. Supported formats: JPEG, PNG, WebP"})]})}function na(){var h;const{user:s,profile:a}=ee(),{toast:t}=_e(),[r,n]=l.useState(!1),[o,i]=l.useState({fullName:(a==null?void 0:a.full_name)||"",currentPassword:"",newPassword:"",confirmPassword:""}),p=async d=>{if(s)try{const m=d.name.split(".").pop(),y=`${s.id}-${Date.now()}.${m}`,x=`${s.id}/${y}`,{error:S,data:v}=await U.storage.from("avatars").upload(x,d,{cacheControl:"3600",upsert:!0});if(S)throw console.error("Upload error:",S),S;const{data:{publicUrl:j}}=U.storage.from("avatars").getPublicUrl(x);console.log("File uploaded, public URL:",j);const{error:u}=await U.from("profiles").update({avatar_url:j,updated_at:new Date().toISOString()}).eq("id",s.id);if(u)throw console.error("Profile update error:",u),u;const{data:b,error:A}=await U.from("profiles").select("avatar_url").eq("id",s.id).single();if(A)throw console.error("Verification error:",A),A;console.log("Profile updated with new avatar:",b),window.location.reload()}catch(m){throw console.error("Error in handleAvatarUpload:",m),m}},c=async d=>{if(d.preventDefault(),!!s)try{if(n(!0),o.fullName!==(a==null?void 0:a.full_name)){const{error:m}=await U.from("profiles").update({full_name:o.fullName}).eq("id",s.id);if(m)throw m}if(o.newPassword){if(o.newPassword!==o.confirmPassword)throw new Error("New passwords do not match");const{error:m}=await U.auth.updateUser({password:o.newPassword});if(m)throw m}t({title:"Success",description:"Profile updated successfully"}),i(m=>({...m,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(m){console.error("Error updating profile:",m),t({title:"Update failed",description:m.message||"Failed to update profile",variant:"destructive"})}finally{n(!1)}},g=((h=a==null?void 0:a.full_name)==null?void 0:h.split(" ").map(d=>d[0]).join("").toUpperCase())||"??";return e.jsx(ce,{children:e.jsx("div",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Account Settings"}),e.jsxs(E,{children:[e.jsx(z,{children:e.jsx(K,{children:"Profile Picture"})}),e.jsx(D,{children:e.jsx(xo,{currentAvatarUrl:a==null?void 0:a.avatar_url,onUpload:p,userInitials:g})})]}),e.jsxs(E,{children:[e.jsx(z,{children:e.jsx(K,{children:"Profile Information"})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"fullName",children:"Full Name"}),e.jsx(G,{id:"fullName",value:o.fullName,onChange:d=>i(m=>({...m,fullName:d.target.value}))})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",value:(s==null?void 0:s.email)||"",disabled:!0})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Change Password"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"currentPassword",children:"Current Password"}),e.jsx(G,{id:"currentPassword",type:"password",value:o.currentPassword,onChange:d=>i(m=>({...m,currentPassword:d.target.value}))})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"newPassword",children:"New Password"}),e.jsx(G,{id:"newPassword",type:"password",value:o.newPassword,onChange:d=>i(m=>({...m,newPassword:d.target.value}))})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(G,{id:"confirmPassword",type:"password",value:o.confirmPassword,onChange:d=>i(m=>({...m,confirmPassword:d.target.value}))})]})]})]}),e.jsx(w,{type:"submit",disabled:r,children:r?"Saving...":"Save Changes"})]})})]})]})})})}const po=()=>e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[80vh] px-4",children:e.jsxs("div",{className:"text-center space-y-6 max-w-2xl",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight sm:text-6xl text-primary",children:"404"}),e.jsx("h2",{className:"text-2xl font-semibold tracking-tight sm:text-3xl",children:"Page Not Found"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Sorry, we couldn't find the page you're looking for. The page might have been removed, renamed, or doesn't exist."}),e.jsx("div",{className:"flex justify-center gap-4 pt-4",children:e.jsx(w,{asChild:!0,children:e.jsxs(li,{to:"/",className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"h-4 w-4"}),"Back to Home"]})})})]})}),ia=[{title:"UK House Prices Show Resilience Despite Economic Pressures",source:"Property News UK",published_at:new Date().toISOString(),url:"#",excerpt:"The latest data shows UK house prices maintaining stability with regional variations in growth rates."},{title:"New Rental Reforms Set to Transform Landlord-Tenant Relationships",source:"Real Estate Times",published_at:new Date(Date.now()-864e5).toISOString(),url:"#",excerpt:"The government's proposed rental reforms aim to provide greater security for tenants while maintaining landlord rights."},{title:"Property Investment Shifts: Where Buyers Are Looking in 2024",source:"Investment Quarterly",published_at:new Date(Date.now()-1728e5).toISOString(),url:"#",excerpt:"Investor focus is moving toward emerging regional hotspots as work patterns continue to evolve post-pandemic."},{title:"Interest Rate Forecast and Impact on Mortgage Market",source:"Financial Property Review",published_at:new Date(Date.now()-2592e5).toISOString(),url:"#",excerpt:"Analysts predict stabilizing interest rates may provide relief for mortgage holders in the coming quarters."},{title:"Green Homes Grant: What Property Owners Need to Know",source:"Sustainable Housing",published_at:new Date(Date.now()-3456e5).toISOString(),url:"#",excerpt:"The latest initiatives for improving energy efficiency in UK homes and the financial incentives available."}],xs=`
# UK Property Market Insights: July 2024

## Latest Tax Law Changes

The UK property market continues to adapt to recent regulatory changes. In April 2024, the government implemented adjustments to Capital Gains Tax (CGT) rates for property investors, with the higher rate increasing from 28% to 30% for residential property disposals. Buy-to-let landlords face additional reporting requirements for rental income above Â£10,000 annually.

The Stamp Duty Land Tax (SDLT) thresholds remain unchanged from last year's autumn statement, with first-time buyers enjoying relief up to Â£425,000 (down from Â£625,000 in 2023).

## Landlord Regulations

Licensing requirements have expanded to include mandatory electrical safety certificates (EICR) renewals every five years, and the new Decent Homes Standard now applies to the private rental sector. Tenant rights have strengthened with the Renters Reform Bill provisions now in effect, limiting no-fault evictions and establishing stronger grounds for possession.

Property safety regulations now include stricter rules for carbon monoxide alarms, with mandatory installation in all rooms with fixed combustion appliances.

## Government Policies

The Housing Ministry has announced a target of 300,000 new homes annually by 2026, with planning reforms to streamline development in designated growth zones. The Help to Buy equity loan scheme has been replaced with the First Homes initiative, offering 30-50% discounts on market value for first-time buyers.

Regional variations exist in Scotland's Private Housing (Tenancies) Act and Wales' Renting Homes Act, creating a patchwork regulatory landscape.

## Market Impact Analysis

These regulatory changes are creating downward pressure on rental yields, with the average UK yield dropping from 5.8% to 5.2% over the past year. Property values in commuter belts have shown greater resilience (+3.2%) compared to city centers (+1.7%).

Investment strategy adjustments should focus on regions with strong infrastructure investment and employment growth, particularly the Midlands and Northern England which offer better yields despite regulatory pressures.
`,la=`
# Market Risk Assessment: UK Property Sector

## Current Risk Level: Moderate

### Interest Rate Risk
The Bank of England's current base rate of 4.25% represents a stabilization after the peak of 5.25% in late 2023. While further cuts are anticipated, they are expected to be gradual, maintaining moderate pressure on mortgage affordability.

### Regulatory Risk
The implementation phase of the Renters Reform Bill creates temporary uncertainty for landlords adapting to new requirements. Compliance costs have increased approximately 12% year-over-year.

### Market Liquidity Risk
Transaction volumes remain 15% below pre-pandemic levels, extending the average time to sell from 45 to 63 days. Regional variations are significant, with London experiencing greater liquidity constraints than the North East.

### Recommendation
Investors should focus on properties with strong fundamentals that can weather short-term market fluctuations, particularly those in areas with diverse economic bases and strong rental demand.
`,oa=[{area:"Manchester - Salford Quays",propertyType:"2-bedroom apartments",averagePrice:21e4,expectedYield:5.8,growthPotential:"High",keyFactors:["Tech industry expansion","Transport improvements","Regeneration projects"]},{area:"Birmingham - Jewellery Quarter",propertyType:"1-2 bedroom converted industrial",averagePrice:185e3,expectedYield:5.4,growthPotential:"Medium-High",keyFactors:["HS2 development impact","Growing young professional population","Cultural district revival"]},{area:"Leeds - South Bank",propertyType:"New build city apartments",averagePrice:195e3,expectedYield:5.9,growthPotential:"High",keyFactors:["Major regeneration area","Financial sector growth","University expansion"]}];async function go(){try{const{error:s}=await we.from("market_insights").select("id").limit(1);if(s&&s.code==="42P01"){console.log("Market insights table does not exist, attempting to create it...");const{error:a}=await we.rpc("create_market_insights_table");return a?(console.error("Failed to create market_insights table:",a),!1):(console.log("Market insights table created successfully"),!0)}return!0}catch(s){return console.error("Error checking/creating market_insights table:",s),!1}}async function fo(){try{const s=await fetch("https://newsapi.org/v2/everything?q=uk+property+market&sortBy=publishedAt&apiKey=YOUR_API_KEY&pageSize=10");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return a.articles&&a.articles.length>0?a.articles.map(t=>({title:t.title,source:t.source.name,published_at:t.publishedAt,url:t.url,excerpt:t.description})):(console.log("No articles found in API response, using mock data"),ia)}catch(s){return console.error("Error fetching property news:",s),ia}}async function jo(s){try{const a="AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo";if(!a||a.includes("YOUR_API_KEY"))return console.warn("Using mock data: No valid API key provided for Gemini"),xs;const t=`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${a}`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:s}]}],generationConfig:{temperature:.7,maxOutputTokens:1024}})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();let o="";return n.candidates&&n.candidates[0]&&n.candidates[0].content?o=n.candidates[0].content.parts.filter(p=>p.text).map(p=>p.text).join(`
`):n.text&&(o=n.text),o||(console.warn("Empty response from Gemini API, using mock data"),xs)}catch(a){return console.error("Error generating insights:",a),xs}}async function vo(){try{await go();const{data:s,error:a}=await we.from("market_insights").select("*").order("generated_at",{ascending:!1}).limit(1);return a?(console.error("Error fetching market insights:",a),{id:"mock-id",content:xs,generated_at:new Date().toISOString()}):s&&s.length>0?s[0]:null}catch(s){return console.error("Error in getLatestMarketInsights:",s),{id:"mock-id",content:xs,generated_at:new Date().toISOString()}}}async function yo(){try{return la}catch(s){return console.error("Error fetching risk assessment:",s),la}}async function bo(){try{return oa}catch(s){return console.error("Error fetching personalized opportunities:",s),oa}}async function No(s="UK"){try{return{region:s,currentAveragePrice:29e4,predictedGrowthRate:3.8,confidenceScore:82,timeframe:"12 months",factors:["Interest rate stabilization","Housing supply constraints","Regional economic development"]}}catch(a){return console.error("Error fetching predictive analytics:",a),{region:s,currentAveragePrice:29e4,predictedGrowthRate:3.2,confidenceScore:75,timeframe:"12 months",factors:["Mock data - API unavailable","Contact administrator for actual predictions"]}}}function wo({user:s,profile:a,className:t,showHero:r=!0}){const[n,o]=N.useState([]),[i,p]=N.useState(""),[c,g]=N.useState("No risk assessment data available."),[h,d]=N.useState([]),[m,y]=N.useState(!0),[x,S]=N.useState(null);N.useEffect(()=>{(async()=>{try{const b=await fo();o(b.slice(0,5));const A=await vo();if(A)p(A.content);else{const O=await jo("Provide a concise analysis of the current UK property market trends, focusing on interest rates, price movements, and market sentiment. Include key statistics and recommendations for investors.");p(O)}const L=await yo();g(L);const P=await bo();d(P);const T=await No()}catch(b){console.error("Error loading market data:",b),S("Failed to load market data.")}finally{y(!1)}})()},[]);const v=[{month:"Jan",price:32e4},{month:"Feb",price:325e3},{month:"Mar",price:329e3},{month:"Apr",price:335e3},{month:"May",price:34e4},{month:"Jun",price:345e3}],j=[{region:"London",price:5e5},{region:"Manchester",price:25e4},{region:"Birmingham",price:22e4},{region:"Leeds",price:2e5},{region:"Liverpool",price:18e4}];return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"w-full",children:e.jsx(Ce,{title:"Property Market Insights & Analysis",subtitle:"Expert analysis, regional comparisons, and investment recommendations to guide your property decisions",showSearch:!1,showStats:!1,height:"h-[400px]"})}),e.jsx("div",{className:k("w-full",t),children:e.jsxs("div",{className:"container mx-auto px-4 py-12",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12",children:[e.jsxs(E,{children:[e.jsx(z,{children:e.jsx("h2",{className:"text-xl font-semibold",children:"Price Trends"})}),e.jsx(D,{className:"h-80",children:e.jsx(Us,{width:"100%",height:"100%",children:e.jsxs(pt,{data:v,children:[e.jsx(zs,{strokeDasharray:"3 3"}),e.jsx(Bs,{dataKey:"month"}),e.jsx(Gs,{}),e.jsx(qs,{formatter:u=>[`Â£${u.toLocaleString()}`,"Average Price"]}),e.jsx(Vs,{type:"monotone",dataKey:"price",stroke:"hsl(var(--primary))",activeDot:{r:8}})]})})})]}),e.jsxs(E,{children:[e.jsx(z,{children:e.jsx("h2",{className:"text-xl font-semibold",children:"Regional Comparison"})}),e.jsx(D,{className:"h-80",children:e.jsx(Us,{width:"100%",height:"100%",children:e.jsxs(pt,{data:j,children:[e.jsx(zs,{strokeDasharray:"3 3"}),e.jsx(Bs,{dataKey:"region"}),e.jsx(Gs,{}),e.jsx(qs,{formatter:u=>[`Â£${u.toLocaleString()}`,"Average Price"]}),e.jsx(Vs,{type:"monotone",dataKey:"price",stroke:"hsl(var(--primary))",activeDot:{r:8}})]})})})]})]}),e.jsxs(E,{className:"mb-12",children:[e.jsx(z,{children:e.jsx("h2",{className:"text-xl font-semibold",children:"Market Analysis"})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"The UK property market continues to show resilience despite economic challenges. Regional variations are significant, with some areas experiencing rapid growth while others see more moderate changes."}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Key factors influencing the current market include:"}),e.jsxs("ul",{className:"list-disc pl-5 mb-4 text-muted-foreground",children:[e.jsx("li",{children:"Interest rate changes affecting mortgage affordability"}),e.jsx("li",{children:"Supply constraints in high-demand areas"}),e.jsx("li",{children:"Increasing preference for properties with outdoor space"}),e.jsx("li",{children:"Remote work influencing location decisions"})]}),e.jsx(w,{children:"Download Full Report"})]})]}),(a==null?void 0:a.subscription_tier)!=="free"&&e.jsxs(E,{className:"mb-12 border-primary/20 bg-gradient-to-r from-primary/5 to-background",children:[e.jsx(z,{children:e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:["Premium Market Insights",e.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full bg-primary/20 text-primary",children:"Premium"})]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Our exclusive analysis indicates emerging hotspots in the following areas:"}),e.jsxs("ul",{className:"list-disc pl-5 mb-4 text-muted-foreground",children:[e.jsx("li",{children:"Northwest Manchester - projected 8.3% growth over 12 months"}),e.jsx("li",{children:"East Birmingham suburbs - increasing demand from young professionals"}),e.jsx("li",{children:"Coastal towns in the Southwest - rising popularity for remote workers"})]}),e.jsx(w,{children:"View Detailed Forecast"})]})]})]})})]})}const So=[{id:"price_trends",name:"Price Trends",icon:e.jsx(Ns,{className:"h-4 w-4 mr-2"})},{id:"regional_comparison",name:"Regional Comparison",icon:e.jsx(Zs,{className:"h-4 w-4 mr-2"})},{id:"property_types",name:"Property Types",icon:e.jsx(Xs,{className:"h-4 w-4 mr-2"})},{id:"growth_forecast",name:"Growth Forecast",icon:e.jsx(He,{className:"h-4 w-4 mr-2"})},{id:"rental_yield",name:"Rental Yield Analysis",icon:e.jsx(ye,{className:"h-4 w-4 mr-2"})},{id:"market_activity",name:"Market Activity",icon:e.jsx(lr,{className:"h-4 w-4 mr-2"})}],ko=()=>e.jsxs("div",{className:"bg-muted rounded-lg p-4 relative aspect-[16/9]",children:[e.jsx("div",{className:"absolute inset-0 flex items-end p-6",children:e.jsx("div",{className:"w-full flex items-end h-4/5 space-x-1",children:Array.from({length:12}).map((s,a)=>{const t=30+a*1.5,r=Math.random()*15-7.5,n=t+r;return e.jsx("div",{className:"w-full bg-primary rounded-t-sm transition-all duration-300 hover:opacity-80",style:{height:`${n}%`},title:`Month ${a+1}: Â£${Math.round(28e4+a*1e3+r*1e3)}`},a)})})}),e.jsx("div",{className:"absolute top-2 left-2 text-xs font-medium text-foreground/70",children:"Price (Â£)"}),e.jsx("div",{className:"absolute bottom-2 right-2 text-xs font-medium text-foreground/70",children:"Last 12 Months"})]}),Co=()=>e.jsxs("div",{className:"bg-muted rounded-lg p-4 relative aspect-[16/9]",children:[e.jsx("div",{className:"absolute inset-0 flex items-end p-6",children:e.jsx("div",{className:"w-full flex items-end h-4/5 space-x-3",children:[{region:"NW",height:75,growth:4.8},{region:"NE",height:65,growth:4.1},{region:"YOR",height:70,growth:4.5},{region:"MID",height:60,growth:3.9},{region:"SE",height:45,growth:2.5},{region:"LON",height:35,growth:.2},{region:"SW",height:50,growth:3},{region:"WAL",height:55,growth:3.5},{region:"SCO",height:60,growth:3.8}].map((s,a)=>e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"w-full bg-primary rounded-t-sm transition-all duration-300 hover:opacity-80",style:{height:`${s.height}%`},title:`${s.region}: ${s.growth}% growth`}),e.jsx("span",{className:"text-xs mt-1 text-foreground/70",children:s.region})]},a))})}),e.jsx("div",{className:"absolute top-2 left-2 text-xs font-medium text-foreground/70",children:"Growth (%)"})]}),Io=()=>e.jsxs("div",{className:"bg-muted rounded-lg p-4 relative aspect-[16/9]",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"w-64 h-64 relative rounded-full bg-primary/5",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-blue-500",style:{clipPath:"polygon(50% 50%, 50% 0%, 100% 0%, 100% 100%, 50% 100%)"}}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-green-500",style:{clipPath:"polygon(50% 50%, 100% 100%, 50% 100%)"}}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-amber-500",style:{clipPath:"polygon(50% 50%, 50% 100%, 0% 100%, 0% 50%)"}}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-red-500",style:{clipPath:"polygon(50% 50%, 0% 50%, 0% 0%, 50% 0%)"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-background"})})]})}),e.jsxs("div",{className:"absolute bottom-4 left-4 flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm bg-blue-500 mr-2"}),e.jsx("span",{children:"Detached (40%)"})]}),e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm bg-green-500 mr-2"}),e.jsx("span",{children:"Semi-detached (25%)"})]}),e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm bg-amber-500 mr-2"}),e.jsx("span",{children:"Terraced (20%)"})]}),e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm bg-red-500 mr-2"}),e.jsx("span",{children:"Flats (15%)"})]})]})]}),Ao=()=>e.jsx("div",{className:"bg-muted rounded-lg p-4 relative aspect-[16/9]",children:e.jsx("div",{className:"absolute inset-0 flex items-end p-6",children:e.jsxs("div",{className:"w-full h-4/5 relative",children:[e.jsx("div",{className:"absolute left-1/3 bottom-0 h-full w-px bg-foreground/20 z-10"}),e.jsx("div",{className:"absolute left-1/3 bottom-0 w-3 h-3 rounded-full bg-primary transform -translate-x-1.5 z-20"}),e.jsx("div",{className:"absolute left-1/3 bottom-8 bg-background border rounded-md px-2 py-1 text-xs transform -translate-x-1/2 z-20",children:"Current"}),e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full h-px bg-primary/70"})}),e.jsx("div",{className:"absolute left-1/3 right-0 bottom-0 h-full bg-gradient-to-r from-blue-500/10 to-green-500/10 z-0 border-l border-dashed border-foreground/20"}),e.jsx("div",{className:"absolute left-1/3 bottom-1/2 right-0 h-px bg-green-500 transform rotate-[5deg] origin-left z-10"}),e.jsx("div",{className:"absolute left-1/3 bottom-1/2 right-0 h-px bg-green-500/30 transform rotate-[12deg] origin-left z-10 border-dashed"}),e.jsx("div",{className:"absolute left-1/3 bottom-1/2 right-0 h-px bg-green-500/30 transform rotate-[2deg] origin-left z-10 border-dashed"}),e.jsx("div",{className:"absolute top-2 left-2 text-xs font-medium text-foreground/70",children:"Price (Â£)"}),e.jsx("div",{className:"absolute bottom-2 right-2 text-xs font-medium text-foreground/70",children:"5 Year Forecast"}),e.jsxs("div",{className:"absolute right-8 top-1/4 bg-background border rounded-md px-2 py-1 text-xs z-20",children:[e.jsx("span",{className:"text-green-500 font-medium",children:"+18.5%"})," Forecast 5Y Growth"]})]})})}),Po=()=>e.jsxs("div",{className:"bg-muted rounded-lg p-4 relative aspect-[16/9]",children:[e.jsx("div",{className:"absolute inset-0 p-6 grid grid-cols-3 gap-4",children:[{city:"Liverpool",yield:7.2},{city:"Manchester",yield:6.7},{city:"Nottingham",yield:6.5},{city:"Leeds",yield:6.1},{city:"Sheffield",yield:5.8},{city:"Birmingham",yield:5.5},{city:"Edinburgh",yield:5.1},{city:"Bristol",yield:4.6},{city:"London",yield:3.9}].map((s,a)=>e.jsxs("div",{className:"flex flex-col items-center justify-end h-full",children:[e.jsx("div",{className:"w-full max-w-16 bg-gradient-to-t from-primary to-primary/70 rounded-t-sm relative overflow-hidden",style:{height:`${s.yield/8*100}%`},children:e.jsxs("div",{className:"absolute inset-x-0 bottom-0 text-center text-white text-xs font-semibold",children:[s.yield,"%"]})}),e.jsx("div",{className:"mt-1 text-xs text-center line-clamp-1",children:s.city})]},a))}),e.jsx("div",{className:"absolute top-2 left-2 text-xs font-medium text-foreground/70",children:"Rental Yield (%)"})]}),_o=()=>e.jsxs("div",{className:"bg-muted rounded-lg p-4 relative aspect-[16/9]",children:[e.jsx("div",{className:"absolute inset-0 flex items-end p-6",children:e.jsx("div",{className:"w-full flex items-end h-4/5 space-x-1",children:Array.from({length:24}).map((s,a)=>{const t=a%12;let r=40;t>=3&&t<=7&&(r+=30),(t>=9||t<=1)&&(r-=10);const n=Math.random()*15-7.5,o=r+n,i=a===23;return e.jsx("div",{className:`w-full rounded-t-sm transition-all duration-300 hover:opacity-80 ${i?"bg-primary":"bg-primary/60"}`,style:{height:`${o}%`},title:`Month ${a%12+1}: ${Math.round(o*100)} transactions`},a)})})}),e.jsx("div",{className:"absolute top-2 left-2 text-xs font-medium text-foreground/70",children:"Transaction Volume"}),e.jsx("div",{className:"absolute bottom-2 right-2 text-xs font-medium text-foreground/70",children:"Last 24 Months"})]});function Ro({user:s,profile:a}){const[t,r]=l.useState("price_trends"),[n,o]=l.useState(!1),i=(a==null?void 0:a.subscription_tier)==="premium"||(a==null?void 0:a.subscription_tier)==="pro",[p,c]=l.useState(!1);l.useEffect(()=>{c(!0);const h=setTimeout(()=>{c(!1)},500);return()=>clearTimeout(h)},[t]);const g=()=>{if(!i)return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 sm:p-12 text-center",children:[e.jsx(oi,{className:"h-12 w-12 sm:h-16 sm:w-16 mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2",children:"Premium Feature"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mb-6",children:"Advanced data visualizations are available with our Pro and Premium subscriptions."}),e.jsx(w,{onClick:()=>o(!0),children:"Upgrade Now"})]});if(p)return e.jsxs("div",{className:"p-8 sm:p-12 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary/30 border-t-primary rounded-full mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading visualization data..."})]});switch(t){case"price_trends":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"UK House Price Trends (Last 12 Months)"}),e.jsxs(te,{variant:"outline",className:"w-fit",children:[e.jsx(He,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-500 text-xs",children:"+2.3% YoY"})]})]}),e.jsx(ko,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Average Price"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:"Â£289,950"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+2.3% from last year"})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Monthly Change"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:"+0.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Compared to -0.1% last month"})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Annual Growth"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:"+2.3%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Steady increase since Q1"})]})]})]})]});case"regional_comparison":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Regional Price Comparison"}),e.jsx(Co,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Highest Growth Region"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"North West"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(He,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsx("span",{className:"text-xs text-green-500",children:"+4.8% annual growth"})]})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Lowest Growth Region"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"London"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(He,{className:"h-3 w-3 text-amber-500 mr-1"}),e.jsx("span",{className:"text-xs text-amber-500",children:"+0.2% annual growth"})]})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"UK Average"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"+2.3%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Annual price growth"})]})]})]})]});case"property_types":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Property Types Distribution"}),e.jsx(Io,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Fastest Growing Type"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"Detached Houses"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(He,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsx("span",{className:"text-xs text-green-500",children:"+3.5% annual growth"})]})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Best Rental Yield"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"Flats/Apartments"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(ye,{className:"h-3 w-3 text-primary mr-1"}),e.jsx("span",{className:"text-xs",children:"5.1% average yield"})]})]})]})]})]});case"growth_forecast":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"5-Year Growth Forecast"}),e.jsx(Ao,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Base Forecast"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"+18.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Over next 5 years"})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Upper Bound"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"+24.2%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optimistic scenario"})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Lower Bound"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"+12.8%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conservative scenario"})]})]})]})]});case"rental_yield":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Rental Yield Analysis"}),e.jsx(Po,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Top Performing City"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"Liverpool"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(ye,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsx("span",{className:"text-xs text-green-500",children:"7.2% average yield"})]})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"UK Average"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"5.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rental yield across UK"})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"London"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"3.9%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Lower yield, higher capital growth"})]})]})]})]});case"market_activity":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Market Activity (Transaction Volume)"}),e.jsx(_o,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Current Month"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"86,420"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(He,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsx("span",{className:"text-xs text-green-500",children:"+4.2% vs last month"})]})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Year-on-Year"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"+12.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Increase from last year"})]})]}),e.jsxs(E,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Forecast"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-xl font-bold",children:"Increasing"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Expected to rise over Q3"})]})]})]})]});default:return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Select a visualization type to view data"})})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Data Visualization"}),e.jsx("p",{className:"text-muted-foreground",children:"Explore market trends with interactive visualizations"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 md:gap-4",children:So.map(h=>e.jsx(w,{variant:t===h.id?"default":"outline",className:"w-full h-auto py-2 px-3 flex flex-col sm:flex-row items-center justify-center sm:justify-start text-xs sm:text-sm whitespace-normal sm:whitespace-nowrap",onClick:()=>r(h.id),children:e.jsxs("span",{className:"flex items-center justify-center sm:justify-start w-full",children:[e.jsx("span",{className:"sm:inline-block",children:h.icon}),e.jsx("span",{className:"text-center sm:text-left",children:h.name})]})},h.id))}),e.jsxs(E,{className:"mt-6",children:[e.jsx(D,{className:"pt-6",children:g()}),e.jsx(Ss,{className:"text-xs text-muted-foreground border-t pt-4 mt-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Js,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Data updated: June 13, 2024"})]})})]}),e.jsx(Qs,{isOpen:n,onClose:()=>o(!1),currentUser:s,userProfile:a})]})}function ke({children:s}){return e.jsx(ut.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},children:s})}const Eo=({children:s})=>{try{return ee(),e.jsx(e.Fragment,{children:s})}catch{return e.jsx(ce,{children:e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:e.jsxs(E,{className:"p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:"Authentication Error"}),e.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:"Unable to load authentication. Please refresh the page or try again later."}),e.jsx(w,{className:"w-full",onClick:()=>window.location.reload(),children:"Refresh Page"})]})})})}};function To(){const[s,a]=l.useState("insights"),{user:t,profile:r}=ee();return e.jsx(Eo,{children:e.jsx(ce,{children:e.jsx(ke,{children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(Ce,{title:"Property Market Insights & Analysis",subtitle:"Expert analysis, regional comparisons, and investment recommendations to guide your property decisions",showSearch:!1,showStats:!1,height:"h-[300px] sm:h-[350px] md:h-[400px]"}),e.jsx("div",{className:"container mx-auto px-4 py-4 sm:py-6",children:e.jsxs(es,{defaultValue:"insights",value:s,onValueChange:a,className:"w-full",children:[e.jsxs(ss,{className:"w-full mb-4 sm:mb-6 grid grid-cols-2",children:[e.jsx(ge,{value:"insights",className:"text-sm sm:text-base",children:"Market Insights"}),e.jsx(ge,{value:"visualization",className:"text-sm sm:text-base",children:"Data Visualization"})]}),e.jsx(de,{value:"insights",className:"mt-0",children:e.jsx(wo,{user:t,profile:r,className:"mt-0",showHero:!1})}),e.jsx(de,{value:"visualization",className:"mt-0",children:e.jsx(Ro,{user:t,profile:r})})]})})]})})})})}async function Mo(s){var a,t,r,n,o;try{return console.log("Calling chat API with prompt:",s),ca(s);const c=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:s}]}],generationConfig:{temperature:.7,maxOutputTokens:1024}})});if(!c.ok)throw console.error("API error:",c.status,await c.text()),new Error(`API error: ${c.status} - ${await c.text()}`);return((o=(n=(r=(t=(a=(await c.json()).candidates)==null?void 0:a[0])==null?void 0:t.content)==null?void 0:r.parts)==null?void 0:n[0])==null?void 0:o.text)||"Sorry, I couldn't generate a response at this time."}catch(i){return console.error("Error getting chat response:",i),ca(s)}}async function Do(s){var a,t,r,n,o;try{return console.log("Getting predictive analytics for location:",s),ot(s);const i="AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",p="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent",c=`Generate predictive analytics for property investment in ${s} for the next 5 years. Include price growth predictions, rental yield trends, and market dynamics. Format as JSON with the following structure: {
      "priceGrowthPrediction": { "year1": 2.5, "year2": 3.1, "year3": 3.5, "year4": 2.8, "year5": 3.0 },
      "rentalYieldTrend": { "year1": 5.2, "year2": 5.3, "year3": 5.4, "year4": 5.3, "year5": 5.2 },
      "marketSummary": "Brief summary of market dynamics",
      "keyFactors": ["Factor 1", "Factor 2", "Factor 3"]
    }`,g=await fetch(`${p}?key=${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:c}]}],generationConfig:{temperature:.2,maxOutputTokens:1024}})});if(!g.ok)throw new Error("API response was not ok");const d=((o=(n=(r=(t=(a=(await g.json()).candidates)==null?void 0:a[0])==null?void 0:t.content)==null?void 0:r.parts)==null?void 0:n[0])==null?void 0:o.text)||null;if(!d)throw new Error("No content returned from API");let m=d.match(/```json\n([\s\S]*?)\n```/)||d.match(/```([\s\S]*?)```/)||d.match(/(\{[\s\S]*\})/);if(m&&m[1])return JSON.parse(m[1].trim());try{return JSON.parse(d)}catch(y){return console.error("Error parsing predictive analytics:",y),ot(s)}}catch(i){return console.error("Error fetching predictive analytics:",i),ot(s)}}async function Fo(s){var a,t,r,n,o;try{return console.log("Getting investment hotspots for region:",s),ct(s);const i="AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",p="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent",c=`Generate a list of emerging property investment hotspots in ${s} with reasons why they are promising. Format as JSON with the following structure: 
    {
      "hotspots": [
        {
          "area": "Area name",
          "growthPotential": 4.2,
          "reasons": ["Reason 1", "Reason 2"],
          "estimatedROI": 5.8,
          "investmentType": "Buy-to-let"
        }
      ]
    }
    Include 3-5 different hotspots.`,g=await fetch(`${p}?key=${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:c}]}],generationConfig:{temperature:.3,maxOutputTokens:1024}})});if(!g.ok)throw new Error("API response was not ok");const d=((o=(n=(r=(t=(a=(await g.json()).candidates)==null?void 0:a[0])==null?void 0:t.content)==null?void 0:r.parts)==null?void 0:n[0])==null?void 0:o.text)||null;if(!d)throw new Error("No content returned from API");let m=d.match(/```json\n([\s\S]*?)\n```/)||d.match(/```([\s\S]*?)```/)||d.match(/(\{[\s\S]*\})/);if(m&&m[1])return JSON.parse(m[1].trim());try{return JSON.parse(d)}catch(y){return console.error("Failed to parse hotspots:",y),ct(s)}}catch(i){return console.error("Failed to fetch hotspots:",i),ct(s)}}function ca(s){return s.includes("market insights")?"Based on recent data, the property market in this area has shown strong growth over the past 12 months. Average prices have increased by approximately 7.3%, which is above the national average of 4.5%. Rental yields remain competitive at around 5.2% for typical properties. The local economy is benefiting from new infrastructure projects and employment opportunities, which should provide continued stability. Demand currently exceeds supply, especially for 2-3 bedroom properties, creating a seller's market. Analysts predict continued but more moderate growth over the next 24 months.":s.includes("investment advice")?`For property investors looking at this market, there are several strategies worth considering:

1. Buy-to-let opportunities are particularly strong in the north and east neighborhoods, where rental demand from young professionals is high.

2. Properties requiring renovation can offer significant value-add opportunities, with potential for 15-20% equity gains after improvements.

3. The local council has approved new development zones which may present off-plan purchase opportunities with favorable terms.

4. Houses with potential for extension or conversion to multiple units can maximize returns in areas with strict planning constraints.

5. Consider the strong local university market for HMO investments, which typically yield 2-3% higher than standard rentals.`:"The current property market shows mixed signals. While some areas continue to see price growth, others have stabilized. Factors influencing the market include interest rate changes, supply constraints, and evolving work patterns affecting location preferences. For specific investment advice, consider local economic indicators, infrastructure developments, and demographic trends particular to your target area."}function ot(s){return{priceGrowthPrediction:{year1:3.2,year2:3.5,year3:4.1,year4:3.8,year5:3.9},rentalYieldTrend:{year1:5.3,year2:5.4,year3:5.5,year4:5.4,year5:5.3},marketSummary:`The property market in ${s} shows promising growth potential over the next 5 years, supported by infrastructure development and increasing demand. While some volatility is expected in years 2-3, the overall trajectory remains positive.`,keyFactors:["New transportation links improving connectivity","Growing tech sector bringing high-income professionals to the area","Limited new housing supply in development pipeline","Strong rental demand from young professionals","Government stimulus for first-time buyers"]}}function ct(s){return{hotspots:[{area:`${s} - North District`,growthPotential:4.7,reasons:["New tech hub development creating employment","Improved transport links reducing commute times","Regeneration project transforming former industrial areas"],estimatedROI:6.2,investmentType:"Buy-to-let apartments"},{area:`${s} - Riverside`,growthPotential:5.1,reasons:["Waterfront development project nearing completion","Limited supply of premium properties","Growing demand from young professionals"],estimatedROI:5.8,investmentType:"Luxury apartments"},{area:`${s} - University Area`,growthPotential:3.9,reasons:["Consistent student housing demand","University expansion plans announced","Improving local amenities and nightlife"],estimatedROI:7.3,investmentType:"HMO for students"},{area:`${s} - Central Village`,growthPotential:4.5,reasons:["Character properties with renovation potential","Growing tourism supporting short-term rentals","New boutique retail and restaurant scene"],estimatedROI:6.5,investmentType:"Period conversions"}]}}const Lo=["Calculate stamp duty for a Â£400,000 property","What are typical legal fees for property purchase?","Explain all costs involved in buying a property","How much should I budget for property maintenance?","What surveys do I need when buying a property?","Calculate monthly mortgage payments for Â£300,000"],Oo=s=>{if(s.success)return`<span class="block text-red-500">${s.message}</span>`;let t=(typeof s=="string"?s:s.message).replace(/\*\*(.*?)\*\*/g,'<span class="font-bold">$1</span>');return t=t.replace(/\*(.*?)\*/g,'<span class="italic">$1</span>'),t=t.replace(/^- (.+)$/gm,'<span class="block ml-2">â€¢ $1</span>'),t=t.replace(/^\d+\. (.+)$/gm,'<span class="block ml-2">$&</span>'),t.split(`
`).map((r,n)=>r?`<span class="block">${r}</span>`:'<span class="block h-2"></span>').join("")},$o=({trends:s=[{title:"Average Home Price",value:"Â£450,000",change:"+5.2%",isPositive:!0},{title:"Days on Market",value:"28",change:"-12%",isPositive:!0},{title:"Available Listings",value:"1,234",change:"-3.1%",isPositive:!1}],articles:a=[{title:"Understanding the Current Real Estate Market",excerpt:"Get insights into the latest trends and what they mean for buyers and sellers.",date:"2024-03-15"},{title:"Top 5 Investment Opportunities in Real Estate",excerpt:"Discover the most promising areas for property investment in the current market.",date:"2024-03-10"},{title:"Real Estate Market Forecast 2024",excerpt:"Expert predictions and analysis for the upcoming year in real estate.",date:"2024-03-05"}],user:t,profile:r})=>{const n=[{month:"Jan",price:45e4},{month:"Feb",price:455e3},{month:"Mar",price:458e3},{month:"Apr",price:462e3},{month:"May",price:47e4},{month:"Jun",price:475e3}],o=[{region:"London",price:5e5,growth:5.2},{region:"Manchester",price:25e4,growth:7.8},{region:"Birmingham",price:22e4,growth:6.5},{region:"Leeds",price:2e5,growth:8.1},{region:"Liverpool",price:18e4,growth:9.2}],i=[{name:"London",priceGrowth:5.2,averagePrice:5e5,transactions:1200},{name:"South East",priceGrowth:4.8,averagePrice:375e3,transactions:950},{name:"South West",priceGrowth:4.5,averagePrice:31e4,transactions:780},{name:"East of England",priceGrowth:4.2,averagePrice:325e3,transactions:820},{name:"West Midlands",priceGrowth:6.1,averagePrice:24e4,transactions:680},{name:"East Midlands",priceGrowth:5.8,averagePrice:225e3,transactions:650},{name:"Yorkshire",priceGrowth:7.2,averagePrice:195e3,transactions:720},{name:"North West",priceGrowth:8.1,averagePrice:205e3,transactions:850},{name:"North East",priceGrowth:6.5,averagePrice:155e3,transactions:480},{name:"Wales",priceGrowth:5.9,averagePrice:185e3,transactions:520},{name:"Scotland",priceGrowth:5.4,averagePrice:175e3,transactions:680}],p=({data:F})=>e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:e.jsx("svg",{viewBox:"0 0 500 800",className:"w-full h-full max-h-[400px]",style:{maxWidth:"300px"},children:[{path:"M250,600 L300,550 L350,600 L300,650 Z",name:"London"},{path:"M200,500 L300,450 L350,500 L250,550 Z",name:"South East"},{path:"M150,450 L250,400 L300,450 L200,500 Z",name:"South West"},{path:"M300,450 L400,400 L450,450 L350,500 Z",name:"East of England"},{path:"M200,350 L300,300 L350,350 L250,400 Z",name:"West Midlands"},{path:"M300,350 L400,300 L450,350 L350,400 Z",name:"East Midlands"},{path:"M200,250 L300,200 L350,250 L250,300 Z",name:"Yorkshire"},{path:"M150,200 L250,150 L300,200 L200,250 Z",name:"North West"},{path:"M250,150 L350,100 L400,150 L300,200 Z",name:"North East"},{path:"M100,350 L200,300 L250,350 L150,400 Z",name:"Wales"},{path:"M150,100 L300,50 L350,100 L200,150 Z",name:"Scotland"}].map(f=>{const M=F.find(re=>re.name===f.name),H=(M==null?void 0:M.priceGrowth)||0;return e.jsxs("g",{children:[e.jsx("path",{d:f.path,fill:`hsl(${120*(H/10)}, 70%, 50%)`,stroke:"white",strokeWidth:"2",className:"transition-colors duration-300 hover:brightness-110 cursor-pointer"}),e.jsx("title",{children:`${f.name}: +${H}%`})]},f.name)})})}),[c,g]=l.useState(""),[h,d]=l.useState(!1),[m,y]=l.useState(!1),x=async F=>{d(!0);try{const f=await Mo(`Provide a concise market insight for property investment in ${F} with recent price trends, rental yields, and future outlook. Keep it under 200 words.`);g(f)}catch(f){console.error("Error fetching market insights:",f),g("We're currently experiencing some issues retrieving market insights. Please try again later or contact support if the problem persists.")}finally{d(!1)}},[S,v]=l.useState([]),[j,u]=l.useState([]),[b,A]=l.useState(!1),[L,P]=l.useState(!1),[T,O]=l.useState(!1),[C,_]=l.useState(!1),R=async F=>{var f;A(!0);try{const M=await Do(F);if(Array.isArray(M))v(M);else if(M.regions&&Array.isArray(M.regions))v(M.regions);else{const H=[{region:F||"United Kingdom",currentValue:35e4,predictedValue:35e4*(1+(((f=M.priceGrowthPrediction)==null?void 0:f.year1)||3.2)/100),confidence:85,growthFactors:M.keyFactors||["Data temporarily unavailable"]}];v(H)}}catch(M){console.error("Error fetching predictive analytics:",M),v([{region:F,currentValue:35e4,predictedValue:361200,confidence:75,growthFactors:["Data temporarily unavailable","Please try again later"]}])}finally{A(!1)}},B=async F=>{_(!0);try{const f=await Fo(F);if(Array.isArray(f)){const M=f.map(H=>({...H,factors:H.factors||[]}));u(M)}else if(f.hotspots&&Array.isArray(f.hotspots)){const M=f.hotspots.map(H=>({...H,factors:H.factors||[]}));u(M)}else console.warn("Hotspots data is not in expected format:",f),u([])}catch(f){console.error("Error fetching hotspots:",f),u([{area:`${F} - North District`,score:75,predictedGrowth:4.2,factors:["Data currently unavailable","Try again later"],investmentType:"Residential"},{area:`${F} - Central Area`,score:68,predictedGrowth:3.8,factors:["Data currently unavailable","Try again later"],investmentType:"Commercial"}])}finally{_(!1)}},Y=async()=>{y(!0),await x("United Kingdom"),y(!1)},Z=async()=>{P(!0),await R("United Kingdom"),P(!1)},$=async()=>{O(!0),await B("United Kingdom"),O(!1)},[Q,X]=l.useState(null),[W,he]=l.useState(null),[me,fe]=l.useState(!0),pe=async()=>{try{fe(!0);const F=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=gbp");if(!F.ok)throw new Error("Failed to fetch Bitcoin price");const f=await F.json();X(f.bitcoin.gbp),he(null)}catch(F){console.error("Error fetching Bitcoin price:",F),he("Failed to load Bitcoin price"),X(null)}finally{fe(!1)}};return l.useEffect(()=>{x("United Kingdom"),R("United Kingdom"),B("United Kingdom"),pe();const F=setInterval(()=>{pe()},6e4);return()=>clearInterval(F)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Property Market Trends & Insights",subtitle:"Discover the latest market data, price forecasts, and investment hotspots to make informed property decisions",showSearch:!1,showStats:!1,height:"h-[400px]"}),e.jsxs("section",{className:"w-full py-8 sm:py-16 bg-background relative overflow-hidden",children:[e.jsx("div",{className:"container mx-auto px-4 mb-16",children:e.jsxs(E,{className:"bg-card border-border",children:[e.jsx(z,{children:e.jsx("h2",{className:"text-2xl font-semibold",children:"Real Estate Trends Visualization"})}),e.jsx(D,{children:e.jsxs(es,{defaultValue:"overview",className:"w-full",children:[e.jsx(ss,{className:"w-full mb-8",children:e.jsxs("div",{className:"grid w-full grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx(ge,{value:"overview",className:"w-full",children:"Price Evolution"}),e.jsx(ge,{value:"regional",className:"w-full",children:"Regional Comparison"}),e.jsx(ge,{value:"heatmap",className:"w-full",children:"Growth Heatmap"})]})}),e.jsx(de,{value:"overview",className:"h-[400px]",children:e.jsx(Us,{width:"100%",height:"100%",children:e.jsxs(ci,{data:n,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPrice",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(zs,{strokeDasharray:"3 3"}),e.jsx(Bs,{dataKey:"month"}),e.jsx(Gs,{}),e.jsx(qs,{}),e.jsx(di,{type:"monotone",dataKey:"price",stroke:"hsl(var(--primary))",fillOpacity:1,fill:"url(#colorPrice)"})]})})}),e.jsx(de,{value:"regional",className:"h-[400px]",children:e.jsx(Us,{width:"100%",height:"100%",children:e.jsxs(pt,{data:o,children:[e.jsx(zs,{strokeDasharray:"3 3"}),e.jsx(Bs,{dataKey:"region"}),e.jsx(Gs,{}),e.jsx(qs,{}),e.jsx(Vs,{type:"monotone",dataKey:"price",stroke:"hsl(var(--primary))"}),e.jsx(Vs,{type:"monotone",dataKey:"growth",stroke:"hsl(var(--chart-1))"})]})})}),e.jsx(de,{value:"heatmap",className:"h-[400px] overflow-y-auto",children:e.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4 min-h-[300px]",children:[e.jsx("h3",{className:"font-semibold text-lg sticky top-0 bg-background border-b py-2 px-2 rounded-t-lg",children:"Regional Price Growth"}),e.jsx("div",{className:"space-y-2 overflow-y-auto px-2",children:i.sort((F,f)=>f.priceGrowth-F.priceGrowth).map(F=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-8 rounded-full",style:{backgroundColor:`hsl(${120*(F.priceGrowth/10)}, 70%, 50%)`}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:F.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Â£",F.averagePrice.toLocaleString()]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-emerald-500",children:["+",F.priceGrowth,"%"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[F.transactions," sales"]})]})]},F.name))})]}),e.jsx("div",{className:"relative hidden lg:flex items-center justify-center bg-muted/30 rounded-xl min-h-[300px]",children:e.jsx(p,{data:i})})]})})]})})]})}),e.jsx("div",{className:"container mx-auto px-4 mb-16",children:e.jsxs(E,{className:"bg-card border-border relative ai-border-animation",children:[e.jsxs(z,{className:"flex flex-row items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"AI Market Analysis"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:Y,className:`h-8 w-8 ${m?"animate-spin":""}`,disabled:m||h,children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsx(D,{children:h?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:Oo(c)}})})]})}),e.jsxs("div",{className:"container mx-auto px-4 mb-16 grid gap-6 md:grid-cols-2",children:[e.jsxs(E,{className:"bg-card border-border relative ai-border-animation",children:[e.jsxs(z,{className:"flex flex-row items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Predictive Market Analytics"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:Z,className:`h-8 w-8 ${L?"animate-spin":""}`,disabled:L||b,children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsx(D,{children:b?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"space-y-4",children:S.map((F,f)=>e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:F.region}),e.jsxs("div",{className:"text-sm font-medium text-emerald-500",children:["+",((F.predictedValue-F.currentValue)/F.currentValue*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"w-full bg-background rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full",style:{width:`${F.confidence}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Confidence: ",F.confidence,"%"]})]})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:F.growthFactors&&Array.isArray(F.growthFactors)&&F.growthFactors.length>0?F.growthFactors[0]:"No growth factors available"})]},f))})})]}),e.jsxs(E,{className:"bg-card border-border relative ai-border-animation",children:[e.jsxs(z,{className:"flex flex-row items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Emerging Investment Hotspots"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:$,className:`h-8 w-8 ${T?"animate-spin":""}`,disabled:T||C,children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsx(D,{children:C?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):j.length>0?e.jsx("div",{className:"space-y-4",children:j.map((F,f)=>e.jsxs("div",{className:"bg-card border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-1",children:F.area}),e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium mr-2",children:"Investment Score:"}),e.jsx("div",{className:"h-2 w-24 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${F.score}%`}})}),e.jsxs("span",{className:"ml-2 text-sm font-medium",children:[F.score,"/100"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(te,{className:"bg-primary/80",children:["+",F.predictedGrowth,"% Growth"]}),e.jsx(te,{variant:"outline",children:F.investmentType})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Why Invest:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:F.factors&&Array.isArray(F.factors)?F.factors.map((M,H)=>e.jsxs("li",{className:"text-sm flex items-start",children:[e.jsx(Ms,{className:"h-4 w-4 mr-1 mt-1 text-primary"}),M]},H)):e.jsxs("li",{className:"text-sm flex items-start",children:[e.jsx(Ms,{className:"h-4 w-4 mr-1 mt-1 text-primary"}),"Data unavailable"]})})]})]},f))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No investment hotspots data available"})})]})]}),e.jsxs("div",{className:"container mx-auto px-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-12 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Market Trends & Insights"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Stay informed with the latest real estate market trends and expert insights to make better property decisions."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",children:s.map((F,f)=>e.jsx(E,{className:`bg-card border-border hover:scale-[1.02] transition-all duration-300 ${f===0?"bg-gradient-to-r from-emerald-400/10 to-cyan-400/10":""}`,children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground/80",children:F.title}),f===0?e.jsx(ye,{className:"w-5 h-5 text-emerald-500"}):f===1?e.jsx(Xs,{className:"w-5 h-5 text-emerald-500"}):e.jsx(Ns,{className:"w-5 h-5 text-emerald-500"})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-2xl font-bold text-foreground",children:F.value}),e.jsx("span",{className:`flex items-center ${F.isPositive?"text-emerald-500":"text-red-500"}`,children:F.change})]})]})},f))}),e.jsx("div",{className:"container mx-auto px-4 mb-16 grid gap-6 md:grid-cols-3",children:a.map((F,f)=>e.jsxs(E,{className:"bg-card border-border hover:scale-[1.02] transition-all duration-300",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:F.title}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(F.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:F.excerpt}),e.jsxs(w,{variant:"ghost",className:"group hover:text-emerald-500",onClick:()=>{window.location.href=`/article/${encodeURIComponent(F.title)}`},children:["Read More",e.jsx(Ms,{className:"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"})]})]})]},f))}),e.jsx("div",{className:"w-full bg-muted/50 py-12",children:e.jsxs("div",{className:"max-w-[1200px] mx-auto px-4 sm:px-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Market Trends"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Bitcoin Price (GBP)"}),me?e.jsx("div",{className:"animate-pulse h-8 bg-muted rounded"}):W?e.jsx("p",{className:"text-red-500",children:W}):Q?e.jsx("p",{className:"text-2xl font-bold",children:ue(Q)}):e.jsx("p",{className:"text-muted-foreground",children:"Price unavailable"})]})})]})})]})]})]})},Uo=({children:s})=>{try{return ee(),e.jsx(e.Fragment,{children:s})}catch{return e.jsx(ce,{children:e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:e.jsxs(E,{className:"p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:"Authentication Error"}),e.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:"Unable to load authentication. Please refresh the page or try again later."}),e.jsx(w,{className:"w-full",onClick:()=>window.location.reload(),children:"Refresh Page"})]})})})}},zo=()=>e.jsx(Uo,{children:e.jsx(Bo,{})}),Bo=()=>{const{user:s,profile:a}=ee();return e.jsx(ce,{children:e.jsx(ke,{children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx($o,{user:s,profile:a})})})})};function Go({title:s="Understanding the Current Real Estate Market",content:a="Default content",date:t=new Date().toISOString(),readTime:r="5 min read"}){const{user:n,profile:o}=ee();return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ws,{isAuthenticated:!!n,userProfile:o||void 0}),e.jsx("main",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(E,{children:e.jsxs(D,{className:"p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:s}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(t).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:r})]})]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:a.split(`

`).map((i,p)=>e.jsx("p",{className:"mb-4",children:i},p))})]})})})})]})}const qo=[{id:1,title:"UK Property Market Outlook 2024",slug:"uk-property-market-outlook-2024",summary:"Comprehensive analysis of the UK property market trends, investment opportunities, and forecasts for 2024.",date:"2024-05-15",author:"Property Analysis Team",category:"Market Analysis",isPremium:!0},{id:2,title:"Regional Investment Hotspots",slug:"regional-investment-hotspots",summary:"Detailed report on emerging regional investment opportunities across the UK, with focus on yields and growth potential.",date:"2024-04-22",author:"Investment Research Division",category:"Investment",isPremium:!0},{id:3,title:"First-Time Buyer Guide 2024",slug:"first-time-buyer-guide-2024",summary:"Essential information and advice for first-time buyers navigating the property market in 2024.",date:"2024-03-10",author:"Homebuyer Advisory Team",category:"Guides",isPremium:!1}],Vo=({user:s,profile:a})=>{const[t,r]=l.useState([]),[n,o]=l.useState(!0),i=be();l.useEffect(()=>{(async()=>{try{o(!0),setTimeout(()=>{r(qo),o(!1)},1e3)}catch(h){console.error("Error fetching research reports:",h),o(!1)}})()},[]);const p=(a==null?void 0:a.subscription_tier)!=="free",c=g=>{i(`/research/reports/${g.slug}`)};return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n?Array(3).fill(0).map((g,h)=>e.jsx(E,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"h-6 bg-muted rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-24 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-1/2"})]})},h)):t.length>0?t.map(g=>e.jsxs(E,{className:"overflow-hidden flex flex-col",children:[e.jsxs(z,{className:"flex flex-row items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:g.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{children:mi(new Date(g.date),new Date,{addSuffix:!0})})]})]}),g.isPremium&&e.jsx(te,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20",children:"Premium"})]}),e.jsxs(D,{className:"flex-grow",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:g.summary}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(It,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:g.category})]})]}),e.jsx(Ss,{className:"border-t pt-4",children:g.isPremium&&!p?e.jsxs(w,{variant:"outline",className:"w-full",onClick:()=>window.location.href="/pricing",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Upgrade to Access"]}):e.jsxs(w,{className:"w-full",onClick:()=>c(g),children:[e.jsx(ui,{className:"h-4 w-4 mr-2"}),"View Report"]})})]},g.id)):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No reports available"}),e.jsx("p",{className:"text-muted-foreground",children:"There are currently no research reports available."})]})})})},rn=async(s=1,a=6)=>{try{const t=(s-1)*a;console.log("Fetching deals with params:",{page:s,limit:a,start:t});const{data:r,error:n}=await we.from("deals").select(`
        id,
        title,
        description,
        location,
        price,
        roi_percentage,
        investment_term,
        property_type,
        deal_type,
        image_url,
        created_at,
        updated_at
      `).range(t,t+a-1).order("created_at",{ascending:!1});if(console.log("Raw Supabase response:",{data:r,error:n}),n)throw console.error("Supabase query error:",n.message,n),new Error(`Failed to fetch deals: ${n.message}`);if(!r||r.length===0)return console.log("No deals found in database"),[];const o=r.map(i=>({id:i.id,title:i.title,description:i.description,location:i.location,price:Number(i.price),roi_percentage:Number(i.roi_percentage),investment_term:i.investment_term,property_type:i.property_type,deal_type:i.deal_type,image_url:i.image_url,created_at:i.created_at,updated_at:i.updated_at}));return console.log("Transformed deals:",o),o}catch(t){throw console.error("Error in getDeals:",t instanceof Error?t.message:t),t}};function Be({className:s,...a}){return e.jsx("div",{className:k("animate-pulse rounded-md bg-muted",s),...a})}function Ho(){return e.jsxs("div",{className:"overflow-hidden rounded-lg border bg-card",children:[e.jsx(Be,{className:"aspect-video w-full"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx(Be,{className:"h-6 w-3/4"}),e.jsx(Be,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Be,{className:"h-4 w-full"}),e.jsx(Be,{className:"h-4 w-5/6"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Be,{className:"h-4 w-20 mb-1"}),e.jsx(Be,{className:"h-6 w-24"})]}),e.jsxs("div",{children:[e.jsx(Be,{className:"h-4 w-20 mb-1"}),e.jsx(Be,{className:"h-6 w-24"})]})]})]})]})}function jt({deal:s,isSubscriber:a,onClick:t,isLoading:r,user:n,showMessageButton:o=!0}){const i=be(),[p,c]=l.useState(!1);if(r)return e.jsx(Ho,{});const g=h=>{if(h.stopPropagation(),!n){i("/login");return}c(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",onClick:n?t:()=>i("/login"),children:[e.jsxs("div",{className:"relative aspect-video overflow-hidden bg-muted",children:[e.jsx("img",{src:s.image_url,alt:s.title,className:"object-cover w-full h-full",loading:"lazy"}),!n&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(te,{variant:"secondary",children:"Sign in to View"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx(te,{variant:"secondary",className:"bg-white/90 text-black hover:bg-white/75",children:s.property_type}),e.jsx(te,{variant:"secondary",className:"bg-primary/90 text-white hover:bg-primary/75",children:s.deal_type})]})]}),e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold line-clamp-2 mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Zs,{className:"h-4 w-4"}),e.jsx("span",{className:"line-clamp-1",children:s.location})]})]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price"}),e.jsx("p",{className:"text-lg font-semibold",children:ue(s.price)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ROI"}),e.jsxs("p",{className:"text-lg font-semibold text-emerald-500",children:[s.roi_percentage,"%"]})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Investment Term"}),e.jsx("p",{className:"font-medium",children:s.investment_term})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Expected Returns"}),e.jsx("p",{className:"font-medium text-emerald-500",children:"High Yield"})]})]})}),n&&o&&e.jsxs(w,{variant:"outline",className:"w-full",onClick:g,children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Enquire About This Deal"]})]})})]}),n&&e.jsx(tn,{isOpen:p,onClose:()=>c(!1),receiverId:"admin",dealId:s.id,deal:s})]})}const Xe=vi,Qe=yi,Ke=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(dr,{ref:r,className:k("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[a,e.jsx(hi,{asChild:!0,children:e.jsx(St,{className:"h-4 w-4 opacity-50"})})]}));Ke.displayName=dr.displayName;const nn=l.forwardRef(({className:s,...a},t)=>e.jsx(mr,{ref:t,className:k("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(xi,{className:"h-4 w-4"})}));nn.displayName=mr.displayName;const ln=l.forwardRef(({className:s,...a},t)=>e.jsx(ur,{ref:t,className:k("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(St,{className:"h-4 w-4"})}));ln.displayName=ur.displayName;const Je=l.forwardRef(({className:s,children:a,position:t="popper",...r},n)=>e.jsx(pi,{children:e.jsxs(hr,{ref:n,className:k("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...r,children:[e.jsx(nn,{}),e.jsx(gi,{className:k("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(ln,{})]})}));Je.displayName=hr.displayName;const Wo=l.forwardRef(({className:s,...a},t)=>e.jsx(xr,{ref:t,className:k("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a}));Wo.displayName=xr.displayName;const le=l.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(pr,{ref:r,className:k("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(fi,{children:e.jsx(xe,{className:"h-4 w-4"})})}),e.jsx(ji,{children:a})]}));le.displayName=pr.displayName;const Yo=l.forwardRef(({className:s,...a},t)=>e.jsx(gr,{ref:t,className:k("-mx-1 my-1 h-px bg-muted",s),...a}));Yo.displayName=gr.displayName;const Ko=({user:s,profile:a})=>{const[t,r]=l.useState("property"),[n,o]=l.useState(""),[i,p]=l.useState("standard"),[c,g]=l.useState(!1),[h,d]=l.useState([{id:1,type:"Market Analysis",details:"Detailed analysis of the Leeds property market, focusing on rental yields and capital growth potential in different neighborhoods.",priority:"high",status:"in-progress",submittedAt:"2024-05-01T10:30:00Z",estimatedCompletion:"2024-05-08T10:30:00Z"},{id:2,type:"Property",details:"Research on the historical price trends and planning permissions for 123 High Street, Manchester, M1 1AA.",priority:"standard",status:"completed",submittedAt:"2024-04-15T14:45:00Z",completedAt:"2024-04-20T09:15:00Z"}]),m=u=>{u.preventDefault(),g(!0),setTimeout(()=>{const b={id:h.length+1,type:t==="property"?"Property":"Market Analysis",details:n,priority:i,status:"pending",submittedAt:new Date().toISOString(),estimatedCompletion:new Date(Date.now()+6048e5).toISOString()};d([b,...h]),o(""),g(!1)},1500)},y=(a==null?void 0:a.subscription_tier)!=="free",x=y,S=y?"Unlimited":"2 / 3",v=u=>{switch(u){case"completed":return e.jsx(xe,{className:"h-5 w-5 text-green-500"});case"in-progress":return e.jsx(rs,{className:"h-5 w-5 text-blue-500"});case"pending":return e.jsx(rs,{className:"h-5 w-5 text-amber-500"});default:return e.jsx(bi,{className:"h-5 w-5 text-red-500"})}},j=u=>new Date(u).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{children:[e.jsxs(E,{className:"mb-8",children:[e.jsx(z,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Request Custom Research"})}),e.jsx(D,{children:e.jsx("form",{onSubmit:m,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"request-type",children:"Request Type"}),e.jsxs(Xe,{value:t,onValueChange:r,children:[e.jsx(Ke,{id:"request-type",children:e.jsx(Qe,{placeholder:"Select request type"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"property",children:"Property Research"}),e.jsx(le,{value:"market",children:"Market Analysis"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"request-details",children:"Details"}),e.jsx(ks,{id:"request-details",placeholder:"Please provide specific details about what you'd like us to research...",rows:5,value:n,onChange:u=>o(u.target.value)})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"request-priority",children:"Priority"}),e.jsxs(Xe,{value:i,onValueChange:p,disabled:!x&&i==="high",children:[e.jsx(Ke,{id:"request-priority",children:e.jsx(Qe,{placeholder:"Select priority"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"standard",children:"Standard (7 days)"}),e.jsxs(le,{value:"high",disabled:!x,children:["High Priority (3 days)",!x&&" - Premium Feature"]})]})]})]})]})})}),e.jsxs(Ss,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-t pt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4 sm:mb-0",children:["Requests remaining this month: ",e.jsx("span",{className:"font-medium",children:S})]}),e.jsx(w,{type:"submit",onClick:m,disabled:!n.trim()||c,children:c?"Submitting...":"Submit Request"})]})]}),e.jsxs(E,{children:[e.jsx(z,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Your Research Requests"})}),e.jsx(D,{children:h.length>0?e.jsx("div",{className:"space-y-4",children:h.map(u=>e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"h-4 w-4"}),e.jsxs("h4",{className:"font-medium",children:[u.type," Request"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:u.details}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Submitted: ",j(u.submittedAt)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v(u.status),e.jsx("span",{className:"text-sm font-medium capitalize",children:u.status.replace("-"," ")})]})]}),u.status==="in-progress"&&e.jsxs("div",{className:"mt-4 pt-4 border-t text-xs text-muted-foreground",children:["Estimated completion: ",j(u.estimatedCompletion)]}),u.status==="completed"&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(w,{variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Download Report"]})})]},u.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Xt,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No requests yet"}),e.jsx("p",{className:"text-muted-foreground",children:"You haven't submitted any research requests yet."})]})})]})]})},Jo=({children:s})=>{try{return ee(),e.jsx(e.Fragment,{children:s})}catch{return e.jsx(ce,{children:e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:e.jsxs(E,{className:"p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:"Authentication Error"}),e.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:"Unable to load authentication. Please refresh the page or try again later."}),e.jsx(w,{className:"w-full",onClick:()=>window.location.reload(),children:"Refresh Page"})]})})})}},Zo=()=>e.jsx(Jo,{children:e.jsx(Xo,{})}),Xo=()=>{const{user:s,profile:a,isLoading:t}=ee(),r=be(),[n,o]=l.useState([]),[i,p]=l.useState(!0),[c,g]=N.useState(!1),[h,d]=N.useState("reports");return l.useEffect(()=>{let m=!0;async function y(){try{const x=await rn();m&&(o(x),p(!1))}catch(x){console.error("Error loading deals:",x),m&&p(!1)}}return s&&!t?y():!t&&!s&&r("/login"),()=>{m=!1}},[s,t,r]),t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{children:"Loading..."})}):s?e.jsx(ce,{children:e.jsx(ke,{children:e.jsxs("div",{className:"min-h-screen bg-neutral",children:[e.jsx(Ce,{title:"Research & Analysis",subtitle:"Discover in-depth market insights and property analysis",showSearch:!1,showStats:!1,height:"h-[400px]",image:"/research-hero.jpg"}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4 text-primary",children:"Latest Research"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Stay informed with our comprehensive research reports and expert analysis"})]}),e.jsxs(es,{defaultValue:"reports",value:h,onValueChange:d,className:"mb-8",children:[e.jsxs(ss,{className:"mb-4",children:[e.jsx(ge,{value:"reports",children:"Research Reports"}),e.jsx(ge,{value:"requests",children:"Research Requests"})]}),e.jsx(de,{value:"reports",children:e.jsx(Vo,{user:s,profile:a})}),e.jsx(de,{value:"requests",children:e.jsx(Ko,{user:s,profile:a})})]})]}),i?e.jsx("div",{className:"text-center py-8",children:"Loading deals..."}):e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Latest Deals"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:n.map(m=>e.jsx(jt,{deal:m,isSubscriber:(a==null?void 0:a.subscription_tier)!=="free"},m.id))})]})]}),e.jsx(Qs,{isOpen:c,onClose:()=>g(!1)})]})})}):null};function Qo(){const{user:s,profile:a}=ee(),t=[{title:"Understanding Property Market Cycles",excerpt:"A comprehensive guide to property market cycles and how to identify market phases for optimal investment timing.",category:"Market Analysis",date:"2024-03-20",readTime:"8 min read",image:"https://images.unsplash.com/photo-1460472178825-e5240623afd5?ixlib=rb-4.0.3"},{title:"Buy-to-Let Investment Strategy Guide",excerpt:"Expert insights into creating a successful buy-to-let investment strategy in today's market conditions.",category:"Investment",date:"2024-03-18",readTime:"10 min read",image:"https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3"},{title:"Property Tax Changes in 2024",excerpt:"Stay updated with the latest property tax regulations and how they affect property investors and homeowners.",category:"Legal",date:"2024-03-15",readTime:"6 min read",image:"https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3"}];return e.jsx(ke,{children:e.jsxs(ce,{children:[e.jsx(Ce,{title:"Property Investment Blog",subtitle:"Expert insights and analysis on the UK property market",backgroundImage:"https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3",showSearch:!1,showStats:!1,height:"h-[400px]"}),e.jsx("main",{className:"container mx-auto px-4 py-8 pt-24 sm:pt-8",children:e.jsx("div",{className:"max-w-7xl mx-auto space-y-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((r,n)=>e.jsxs(E,{className:"flex flex-col h-full hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"relative h-48 w-full overflow-hidden rounded-t-lg",children:e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover"})}),e.jsxs(z,{className:"flex flex-row items-center gap-2",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.category})]}),e.jsxs(D,{className:"flex-1 flex flex-col",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:r.title}),e.jsx("p",{className:"text-muted-foreground mb-4 flex-1",children:r.excerpt}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(r.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:r.readTime})]})]}),e.jsxs(w,{variant:"ghost",className:"group hover:text-primary",onClick:()=>{window.location.href=`/blog/${r.title.toLowerCase().replace(/ /g,"-")}`},children:["Read More",e.jsx(Ms,{className:"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"})]})]})]})]},n))})})})]})})}function ec(){const s=[{title:"Getting Started",icon:e.jsx(Ni,{className:"w-5 h-5"}),description:"Learn the basics of using our platform",content:["How to search for properties","Understanding market insights","Setting up your account","Subscription plans overview"]},{title:"Account & Billing",icon:e.jsx(ve,{className:"w-5 h-5"}),description:"Manage your account and subscription",content:["Updating account details","Subscription management","Billing history","Payment methods"]},{title:"Technical Support",icon:e.jsx(wi,{className:"w-5 h-5"}),description:"Get help with technical issues",content:["Troubleshooting guide","System requirements","Known issues","Browser compatibility"]}],a=[{icon:e.jsx(fr,{className:"w-5 h-5"}),title:"Email Support",description:"Get help via email",action:"support@myvge.co.uk",buttonText:"Send Email",onClick:()=>window.location.href="mailto:support@myvge.co.uk"},{icon:e.jsx(Si,{className:"w-5 h-5"}),title:"Phone Support",description:"Speak to our team",action:"0800 123 4567",buttonText:"Call Now",onClick:()=>window.location.href="tel:08001234567"},{icon:e.jsx(bs,{className:"w-5 h-5"}),title:"Live Chat",description:"Chat with our support team",action:"Available 24/7",buttonText:"Start Chat",onClick:()=>{const t=new CustomEvent("open-messages",{detail:{receiverId:"support"}});window.dispatchEvent(t)}}];return e.jsx(ke,{children:e.jsxs(ce,{children:[e.jsx(Ce,{title:"Help & Support Center",subtitle:"Get the assistance you need with our comprehensive support resources",backgroundImage:"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-4.0.3",showSearch:!1,showStats:!1,height:"h-[400px]"}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-12",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:s.map((t,r)=>e.jsxs(E,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(z,{className:"flex flex-row items-center gap-2",children:[t.icon,e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsx(D,{children:e.jsx("ul",{className:"space-y-2",children:t.content.map((n,o)=>e.jsxs("li",{className:"text-sm",children:["â€¢ ",n]},o))})})]},r))}),e.jsxs("div",{className:"bg-card shadow rounded-lg p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Contact Support"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose your preferred method of contact"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.map((t,r)=>e.jsx(E,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(D,{className:"p-6 text-center",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:t.icon}),e.jsx("h3",{className:"font-semibold mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),e.jsx("p",{className:"text-sm font-medium mb-4",children:t.action}),e.jsx(w,{onClick:t.onClick,className:"w-full",children:t.buttonText})]})},r))})]})]})})]})})}const sc=s=>{let a=s.replace(/\*\*(.*?)\*\*/g,'<span class="font-bold">$1</span>');return a=a.replace(/\*(.*?)\*/g,'<span class="italic">$1</span>'),a=a.replace(/^- (.+)$/gm,'<span class="block ml-2">â€¢ $1</span>'),a=a.replace(/^\d+\. (.+)$/gm,'<span class="block ml-2">$&</span>'),a.split(`
`).map(t=>t?`<span class="block">${t}</span>`:'<span class="block h-2"></span>').join("")},tc="AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",ac="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";function rc(){const{user:s,profile:a}=ee(),[t,r]=N.useState(!1),[n,o]=N.useState("ai"),[i,p]=N.useState([]),[c,g]=N.useState([]),[h,d]=N.useState([]),[m,y]=N.useState(""),[x,S]=N.useState(!1),[v,j]=N.useState([]),[u,b]=N.useState(null),A=N.useRef(null),L=be();N.useEffect(()=>{if(s){P();const C=_=>{r(!0),o("messages");const R=_.detail.receiverId,B=v.find(Y=>Y.id===R);B&&b(B)};return window.addEventListener("open-messages",C),()=>window.removeEventListener("open-messages",C)}},[s,v]);const P=async()=>{try{const{data:C}=await U.from("messages").select(`
          *,
          sender:profiles!messages_sender_id_fkey(id, full_name, email),
          receiver:profiles!messages_receiver_id_fkey(id, full_name, email)
        `).or(`sender_id.eq.${s==null?void 0:s.id},receiver_id.eq.${s==null?void 0:s.id}`).order("created_at",{ascending:!1});if(!C)return;const _=new Map;C.forEach(R=>{const B=R.sender.id===(s==null?void 0:s.id)?R.receiver:R.sender;_.has(B.id)||_.set(B.id,{id:B.id,full_name:B.full_name,email:B.email,last_message:R.content,unread_count:R.receiver_id===(s==null?void 0:s.id)&&!R.is_read?1:0})}),j(Array.from(_.values()))}catch(C){console.error("Error loading contacts:",C)}},T=async C=>{if(C.trim())if(n==="ai"){p(_=>[..._,{text:C,isUser:!0}]),y(""),S(!0);try{const _=await fetch(`${ac}?key=${tc}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:C}]}]})});if(!_.ok)throw new Error(`AI API error: ${_.status}`);const B=(await _.json()).candidates[0].content.parts[0].text;if(s){const Y=`ai_${s.id}_${Date.now()}`;await U.from("messages").insert([{sender_id:s.id,receiver_id:s.id,content:C,is_support:!1,conversation_id:Y},{sender_id:null,receiver_id:s.id,content:B,is_support:!0,conversation_id:Y}])}p(Y=>[...Y,{text:B,isUser:!1}])}catch(_){console.error("Error in AI chat:",_),p(R=>[...R,{text:"Sorry, I encountered an error. Please try again.",isUser:!1}])}finally{S(!1)}}else if(s)if(n==="support"){g(_=>[..._,{text:C,isUser:!0}]),y("");try{const _=`support_${s.id}_${Date.now()}`,{error:R}=await U.from("messages").insert({sender_id:s.id,receiver_id:"support",content:C,is_support:!0,conversation_id:_});if(R)throw R;const B="Thank you for your message. Our support team will get back to you soon.",{error:Y}=await U.from("messages").insert({sender_id:null,receiver_id:s.id,content:B,is_support:!0,conversation_id:_});if(Y)throw Y;g(Z=>[...Z,{text:B,isUser:!1}])}catch(_){console.error("Error handling support message:",_),g(R=>[...R,{text:"Sorry, there was an error sending your message. Please try again.",isUser:!1}])}}else{if(!s||!u)return;try{console.log("Sending message to Supabase:",{sender_id:s.id,receiver_id:u.id,content:C,is_support:n==="support"});const{data:_,error:R}=await U.from("messages").insert([{sender_id:s.id,receiver_id:u.id,content:C,is_support:n==="support"}]);if(R)throw console.error("Supabase insert error:",R),R;console.log("Supabase insert success:",_),d(B=>[...B,{text:C,isUser:!0,sender:{full_name:(a==null?void 0:a.full_name)||"",email:(a==null?void 0:a.email)||""},timestamp:new Date().toISOString()}]),y("")}catch(_){console.error("Error sending message:",_)}}else{p(_=>[..._,{text:"Please sign in to use support and direct messaging features.",isUser:!1}]);return}},O=()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)};return N.useEffect(()=>{O()},[i,c,h]),N.useEffect(()=>{O()},[x]),N.useEffect(()=>{if(!s||!u)return;const C=U.channel(`messages:${s.id}:${u.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`or(and(sender_id.eq.${s.id},receiver_id.eq.${u.id}),and(sender_id.eq.${u.id},receiver_id.eq.${s.id}))`},_=>{console.log("Realtime message received:",_);const R=_.new;R.sender_id!==s.id&&d(B=>[...B,{text:R.content,isUser:!1,sender:u,timestamp:R.created_at}])}).subscribe();return()=>{C.unsubscribe()}},[s,u]),e.jsx(e.Fragment,{children:e.jsx("div",{className:`fixed bottom-4 right-4 z-50 ${t?"w-96":"w-auto"}`,children:t?e.jsxs("div",{className:"bg-background border rounded-lg shadow-lg",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold",children:"AI Assistant"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>L("/messages"),title:"Chat with Users",children:e.jsx(Ct,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>r(!1),children:e.jsx(Ia,{className:"h-4 w-4"})})]})]}),e.jsxs(es,{defaultValue:n,onValueChange:o,children:[e.jsxs(de,{value:"ai",className:"m-0 bg-white",children:[e.jsxs("div",{ref:A,className:"h-96 p-4 space-y-4 overflow-y-auto",children:[i.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hello! I'm your property assistant. Ask me anything about property investment, or try one of these popular questions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Lo.map((C,_)=>e.jsx(w,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>T(C),children:C},_))})]}):i.map((C,_)=>e.jsx("div",{className:`flex ${C.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] rounded-lg p-3 ${C.isUser?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:C.isUser?C.text:sc(C.text)}})})},_)),x&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"max-w-[80%] rounded-lg p-3 bg-muted",children:e.jsx("p",{className:"text-sm",children:"Typing..."})})})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:m,onChange:C=>y(C.target.value),placeholder:"Ask me anything about property...",onKeyPress:C=>{C.key==="Enter"&&T(m)}}),e.jsx(w,{onClick:()=>T(m),disabled:!m.trim(),children:e.jsx(ms,{className:"h-4 w-4"})})]})})]}),e.jsxs(de,{value:"messages",className:"m-0 bg-white",children:[e.jsx("div",{ref:A,className:"h-96 p-4 space-y-4 overflow-y-auto",children:s?u?e.jsx("div",{className:"space-y-4",children:h.map((C,_)=>e.jsx("div",{className:`flex ${C.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] rounded-lg p-3 ${C.isUser?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx("p",{className:"text-sm",children:C.text})})},_))}):e.jsx("div",{className:"space-y-4",children:v.map(C=>{var _;return e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-lg cursor-pointer",onClick:()=>b(C),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($e,{className:"h-8 w-8",children:[e.jsx(Ue,{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(C.full_name)}&background=random`,alt:C.full_name}),e.jsx(ze,{children:(_=C.full_name)==null?void 0:_.split(" ").map(R=>R[0]).join("")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:C.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:C.last_message})]})]}),C.unread_count&&C.unread_count>0&&e.jsx("span",{className:"bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full",children:C.unread_count})]},C.id)})}):e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Please sign in to view messages"})})}),u&&e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:m,onChange:C=>y(C.target.value),placeholder:"Type a message...",onKeyPress:C=>{C.key==="Enter"&&T(m)}}),e.jsx(w,{onClick:()=>T(m),disabled:!m.trim(),children:e.jsx(ms,{className:"h-4 w-4"})})]})})]}),e.jsxs(de,{value:"support",className:"m-0 bg-white",children:[e.jsx("div",{ref:A,className:"h-96 p-4 space-y-4 overflow-y-auto",children:c.length===0?e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Welcome to support! How can we help you today?"})}):c.map((C,_)=>e.jsx("div",{className:`flex ${C.isUser?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] rounded-lg p-3 ${C.isUser?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx("p",{className:"text-sm",children:C.text})})},_))}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:m,onChange:C=>y(C.target.value),placeholder:"Type your support question...",onKeyPress:C=>{C.key==="Enter"&&T(m)}}),e.jsx(w,{onClick:()=>T(m),disabled:!m.trim(),children:e.jsx(ms,{className:"h-4 w-4"})})]})})]})]})]}):e.jsx(w,{onClick:()=>r(!0),className:"rounded-full h-12 w-12 flex items-center justify-center",children:e.jsx(bs,{className:"h-6 w-6"})})})})}function nc(){const s=be();return l.useEffect(()=>{U.auth.onAuthStateChange((t,r)=>{console.log("Auth state change:",t,r),t==="SIGNED_IN"&&s("/dashboard")}),(async()=>{const{data:{session:t}}=await U.auth.getSession();console.log("Initial session:",t),s(t?"/dashboard":"/")})()},[s]),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Authenticating..."}),e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we verify your credentials."})]})})}const ic=[{title:"AI Property Analysis",description:"Advanced AI algorithms analyze market trends, rental rates, and property conditions to optimize your investment returns.",icon:jr,badge:"AI-Powered"},{title:"Smart Tenant Matching",description:"AI-driven tenant screening and matching system to find the perfect tenants for your properties.",icon:Xs,badge:"Smart Match"},{title:"Predictive Maintenance",description:"AI predicts maintenance needs before they become issues, saving you time and money.",icon:xt,badge:"Predictive"},{title:"Automated Reporting",description:"AI-generated insights and reports on property performance, maintenance history, and financial metrics.",icon:vr,badge:"Automated"},{title:"AI Chat Support",description:"24/7 AI-powered chat support for tenants and property owners.",icon:ds,badge:"24/7 Support"},{title:"Smart Security",description:"AI-enhanced security monitoring and access control systems.",icon:ki,badge:"Enhanced"}],lc=[{title:"Tenant Screening",description:"Comprehensive tenant screening with AI-powered background checks and risk assessment."},{title:"Rent Collection",description:"Smart rent collection with predictive payment analysis and automated reminders."},{title:"Property Maintenance",description:"AI-driven maintenance scheduling and vendor management."},{title:"Financial Reporting",description:"Advanced financial analytics with AI-powered forecasting and recommendations."}];function oc(){return e.jsx(ke,{children:e.jsxs(ce,{children:[e.jsx(Ce,{title:"AI-Powered Property Management",subtitle:"Experience the future of property management with our advanced AI solutions.",backgroundImage:"https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3",showSearch:!1,showStats:!1,height:"h-[400px]"}),e.jsx("main",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-16",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Next-Generation Property Management"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Leveraging artificial intelligence to revolutionize property management and maximize your investment returns."})]}),e.jsxs("section",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-center",children:"AI-Powered Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ic.map((s,a)=>e.jsxs(E,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(s.icon,{className:"h-6 w-6 text-primary"}),e.jsx(te,{variant:"secondary",children:s.badge})]}),e.jsx(K,{className:"text-xl",children:s.title})]}),e.jsx(D,{children:e.jsx("p",{className:"text-muted-foreground",children:s.description})})]},a))})]}),e.jsxs("section",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-center",children:"Core Services Enhanced by AI"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:lc.map((s,a)=>e.jsxs(E,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(z,{children:e.jsx(K,{children:s.title})}),e.jsx(D,{children:e.jsx("p",{className:"text-muted-foreground",children:s.description})})]},a))})]}),e.jsxs("section",{className:"space-y-8 bg-muted p-8 rounded-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-center",children:"Why Choose Our AI-Powered Management?"}),e.jsx("div",{className:"prose prose-lg max-w-none",children:e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Reduce operational costs by up to 30% with AI automation"}),e.jsx("li",{children:"Minimize vacancy rates with smart tenant matching"}),e.jsx("li",{children:"Prevent maintenance issues before they occur"}),e.jsx("li",{children:"Get real-time insights and predictive analytics"}),e.jsx("li",{children:"24/7 automated support for tenants"}),e.jsx("li",{children:"Enhanced security and risk management"})]})})]}),e.jsxs("section",{className:"text-center space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Ready to Transform Your Property Management?"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Experience the power of AI-driven property management. Contact us to learn how we can help optimize your property portfolio."}),e.jsx(w,{size:"lg",className:"px-8",children:"Schedule a Demo"})]})]})})]})})}const Se=l.forwardRef(({className:s,...a},t)=>e.jsxs(yr,{ref:t,className:k("relative flex w-full touch-none select-none items-center",s),...a,children:[e.jsx(Ci,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(Ii,{className:"absolute h-full bg-primary"})}),e.jsx(Ai,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));Se.displayName=yr.displayName;let dt;async function Et(){if(!dt){const{GoogleGenerativeAI:s}=await Pi(async()=>{const{GoogleGenerativeAI:a}=await import("./vendor-B1tE1in9.js").then(t=>t.cl);return{GoogleGenerativeAI:a}},[]);dt=new s("AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo")}return dt}function Tt(s){const a=s.indexOf("{"),t=s.lastIndexOf("}")+1;if(a===-1||t===0)throw new Error("Invalid JSON response");return s.slice(a,t)}async function cc(s,a){const r=(await Et()).getGenerativeModel({model:"gemini-pro"}),n=`
    You are a UK property investment expert. Analyze investment opportunities for ${s} properties with a budget of Â£${a}.
    Respond with a JSON object containing ONLY these exact fields:
    {
      "analysis": "Brief overview of the investment opportunity",
      "roi_range": "Expected ROI range as a percentage",
      "risks": ["Risk 1", "Risk 2", "Risk 3"],
      "opportunities": ["Opportunity 1", "Opportunity 2", "Opportunity 3"],
      "market_trends": ["Trend 1", "Trend 2", "Trend 3"]
    }
    Ensure each array has exactly 3 items and all fields are present.
  `;try{const i=await(await r.generateContent(n)).response,p=Tt(i.text().trim());console.log("Raw Analysis Response:",p);const c=JSON.parse(p);if(!c.analysis||!c.roi_range||!Array.isArray(c.risks)||!Array.isArray(c.opportunities)||!Array.isArray(c.market_trends))throw new Error("Invalid response format");return{analysis:c.analysis,roi_range:c.roi_range,risks:c.risks.slice(0,3),opportunities:c.opportunities.slice(0,3),market_trends:c.market_trends.slice(0,3)}}catch(o){return console.error("Error in getInvestmentAnalysis:",o),{analysis:`Analysis for ${s} properties with Â£${a} budget is currently unavailable`,roi_range:"8-12%",risks:["Market volatility","Economic uncertainty","Property condition risks"],opportunities:["Value appreciation potential","Rental income opportunities","Development possibilities"],market_trends:["Rising demand in key areas","Stable price growth","Infrastructure development"]}}}async function dc(s){const t=(await Et()).getGenerativeModel({model:"gemini-pro"}),r=`
    You are a UK property market expert. Predict property market trends for ${s} in the next 12 months.
    Respond ONLY with a JSON object in this exact format:
    {
      "price_prediction": "2-3 sentence prediction of price movements",
      "demand_factors": ["3 specific demand factors"],
      "recommendations": ["3 specific investment recommendations"]
    }
  `;try{const o=await(await t.generateContent(r)).response,i=Tt(o.text().trim());return console.log("Raw Predictions Response:",i),JSON.parse(i)}catch(n){return console.error("Error in getMarketPredictions:",n),{price_prediction:"Market prediction currently unavailable",demand_factors:["Population growth","Economic development","Infrastructure improvements"],recommendations:["Research thoroughly","Consider long-term potential","Evaluate local amenities"]}}}async function mc(s){const t=(await Et()).getGenerativeModel({model:"gemini-pro"}),r=`
    You are a UK property investment advisor. Create a strategy for a ${s.experience} investor with Â£${s.budget} budget and ${s.riskTolerance} risk tolerance.
    Respond ONLY with a JSON object in this exact format:
    {
      "strategy": "2-3 sentence overview of recommended strategy",
      "portfolio_allocation": "Suggested portfolio breakdown percentages",
      "timeline": "Recommended investment timeline",
      "expected_returns": "Projected returns overview"
    }
  `;try{const o=await(await t.generateContent(r)).response,i=Tt(o.text().trim());return console.log("Raw Strategy Response:",i),JSON.parse(i)}catch(n){return console.error("Error in getInvestmentStrategy:",n),{strategy:"Investment strategy currently unavailable",portfolio_allocation:"Residential: 60%, Commercial: 30%, Cash: 10%",timeline:"5-10 years recommended holding period",expected_returns:"8-12% annual return potential"}}}function uc(){const[s,a]=N.useState(!1),[t,r]=N.useState(null),[n,o]=N.useState("residential"),[i,p]=N.useState(25e4),[c,g]=N.useState("London"),[h,d]=N.useState(null),[m,y]=N.useState(null),[x,S]=N.useState(null),v={experience:"intermediate",budget:i,riskTolerance:"moderate"},j=async()=>{a(!0),r(null);try{const u=await cc(n,i);if(!u||typeof u!="object")throw new Error("Invalid analysis data received");d(u);const b=await dc(c);if(!b||typeof b!="object")throw new Error("Invalid predictions data received");y(b);const A=await mc(v);if(!A||typeof A!="object")throw new Error("Invalid strategy data received");S(A)}catch(u){console.error("Error in analysis:",u),r(u instanceof Error?u.message:"Failed to generate analysis. Please try again."),d(null),y(null),S(null)}finally{a(!1)}};return e.jsx(ke,{children:e.jsxs(ce,{children:[e.jsx(Ce,{title:"AI-Powered Investment Analysis",subtitle:"Make data-driven investment decisions with our advanced AI analytics",showSearch:!1,height:"h-[400px]",onSearch:()=>{}}),e.jsx("main",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-12",children:[e.jsxs("section",{className:"bg-card p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Investment Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Property Type"}),e.jsxs(Xe,{defaultValue:n,onValueChange:u=>o(u),children:[e.jsx(Ke,{className:"w-full",children:e.jsx(Qe,{placeholder:"Select property type"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"residential",children:"Residential"}),e.jsx(le,{value:"commercial",children:"Commercial"}),e.jsx(le,{value:"industrial",children:"Industrial"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Location"}),e.jsx(G,{type:"text",value:c,onChange:u=>g(u.target.value),placeholder:"Enter location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Budget: Â£",i.toLocaleString()]}),e.jsx(Se,{value:[i],onValueChange:u=>p(u[0]),min:1e5,max:1e6,step:5e4})]})]}),e.jsx(w,{onClick:j,disabled:s,className:"mt-6",size:"lg",children:s?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"mr-2 h-4 w-4 animate-spin"}),"Analyzing..."]}):"Analyze Investment Opportunity"})]}),t&&e.jsx("div",{className:"bg-destructive/10 text-destructive p-4 rounded-lg",children:t}),h&&m&&x&&!t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(Ns,{className:"h-6 w-6 text-primary mb-2"}),e.jsx(K,{children:"Market Analysis"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Analysis"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.analysis||"Analysis not available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"ROI Range"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.roi_range||"ROI range not available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Risks"}),e.jsx("ul",{className:"list-disc pl-4 text-sm text-muted-foreground",children:Array.isArray(h.risks)?h.risks.map((u,b)=>e.jsx("li",{children:u},b)):e.jsx("li",{children:"Risks data not available"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Market Trends"}),e.jsx("ul",{className:"list-disc pl-4 text-sm text-muted-foreground",children:Array.isArray(h.market_trends)?h.market_trends.map((u,b)=>e.jsx("li",{children:u},b)):e.jsx("li",{children:"Market trends not available"})})]})]})]}),e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(jr,{className:"h-6 w-6 text-primary mb-2"}),e.jsx(K,{children:"AI Predictions"})]}),e.jsxs(D,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Price Trend"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.price_prediction||"Price prediction not available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Demand Factors"}),e.jsx("ul",{className:"list-disc pl-4 text-sm text-muted-foreground",children:Array.isArray(m.demand_factors)?m.demand_factors.map((u,b)=>e.jsx("li",{children:u},b)):e.jsx("li",{children:"Demand factors not available"})})]})]})]}),e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(vr,{className:"h-6 w-6 text-primary mb-2"}),e.jsx(K,{children:"Recommended Strategy"})]}),e.jsxs(D,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Portfolio Allocation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.portfolio_allocation||"Portfolio allocation not available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Expected Returns"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.expected_returns||"Expected returns not available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Timeline"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.timeline||"Timeline not available"})]})]})]})]})]})})]})})}function hc(){return e.jsx(ke,{children:e.jsxs(ce,{children:[e.jsx(Ce,{title:"About MyVGE",subtitle:"Learn more about our mission and our team",backgroundImage:"https://images.unsplash.com/photo-1507585495646-50c2b6dbd483?ixlib=rb-4.0.3",showSearch:!1,showStats:!1,height:"h-[400px]"}),e.jsx("main",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Our Story"}),e.jsx("p",{className:"text-muted-foreground",children:"MyVGE is dedicated to providing property investors with the tools and insights they need to succeed."})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Our Mission"}),e.jsx("p",{children:"To empower property investors with comprehensive data, expert analysis, and innovative tools to make informed decisions and achieve their financial goals. We are committed to ethical practices, diversity, and transparency in all our operations."})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Our Values"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"**Ethical Practices:** We adhere to the highest ethical standards in all our dealings, ensuring fairness and integrity."}),e.jsx("li",{children:"**Diversity:** We embrace diversity and inclusion, fostering a welcoming environment for all."}),e.jsx("li",{children:"**Transparency:** We are committed to open and honest communication, providing clear and accurate information to our users."})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Our Team"}),e.jsx("p",{children:"Our team consists of experienced property professionals, data scientists, and technology experts who are passionate about helping investors navigate the complexities of the real estate market. We are a diverse group of individuals with a shared commitment to excellence."})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Contact Us"}),e.jsx("p",{children:"We'd love to hear from you! Contact us to learn more about our services or to discuss your investment needs."}),e.jsx(w,{children:"Contact Us"})]})]})})]})})}const xc=({isOpen:s,onClose:a,deal:t,isSubscriber:r})=>t?e.jsx(Ee,{open:s,onOpenChange:a,children:e.jsxs(Ie,{className:"max-w-3xl w-[95vw] max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsx(Ae,{children:e.jsxs(Pe,{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold break-words pr-4",children:t.title}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(te,{className:"text-xs",children:t.property_type}),e.jsx(te,{variant:"secondary",className:"text-xs",children:t.deal_type})]})]})}),e.jsx("div",{className:"relative aspect-video mb-3 sm:mb-4 overflow-hidden rounded-lg",children:e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 sm:mb-4 text-sm sm:text-base text-muted-foreground",children:[e.jsx(Zs,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"break-words",children:t.location})]}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:t.description})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2",children:"Price"}),e.jsx("p",{className:"text-base sm:text-lg",children:ue(t.price)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2",children:"ROI"}),e.jsxs("p",{className:"text-base sm:text-lg text-emerald-500",children:[t.roi_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2",children:"Investment Term"}),e.jsx("p",{className:"text-base sm:text-lg",children:t.investment_term})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2",children:"Property Type"}),e.jsx("p",{className:"text-base sm:text-lg",children:t.property_type})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2",children:"Deal Type"}),e.jsx(te,{variant:"outline",className:"text-xs sm:text-sm",children:t.deal_type})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2",children:"Location"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words",children:t.location})]})]})]})}):null,pc=({children:s})=>{try{return ee(),e.jsx(e.Fragment,{children:s})}catch{return e.jsx(ce,{children:e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:e.jsxs(E,{className:"p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:"Authentication Error"}),e.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:"Unable to load authentication. Please refresh the page or try again later."}),e.jsx(w,{className:"w-full",onClick:()=>window.location.reload(),children:"Refresh Page"})]})})})}};function gc({onSignIn:s,onSignUp:a}){return e.jsx(pc,{children:e.jsx(fc,{onSignIn:s,onSignUp:a})})}function fc({onSignIn:s,onSignUp:a}){const{user:t,profile:r,isLoading:n}=ee(),[o,i]=l.useState([]),[p,c]=l.useState(!0),[g,h]=l.useState(null);return l.useEffect(()=>{let d=!0;async function m(){try{const y=await rn();d&&(i(y),c(!1))}catch(y){console.error("Error loading deals:",y),d&&c(!1)}}return m(),()=>{d=!1}},[]),n?e.jsx(ce,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{children:"Loading..."})})}):e.jsx(ce,{children:e.jsx(ke,{children:e.jsxs("div",{className:"min-h-screen bg-neutral",children:[e.jsx(Ce,{title:"Property Deals",subtitle:"Discover exclusive property investment opportunities",showSearch:!0,showStats:!1,height:"h-[400px]",image:"/deals-hero.jpg"}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:p?e.jsx("div",{className:"text-center py-8",children:"Loading deals..."}):t?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:o.map(d=>e.jsx(jt,{deal:d,isSubscriber:(r==null?void 0:r.subscription_tier)!=="free",onClick:()=>h(d),user:t},d.id))}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(E,{className:"p-8 text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Sign in to View Full Deal Details"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Get access to exclusive property deals and investment opportunities. Create an account or sign in to view all available deals."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs(w,{onClick:s,className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 w-4"}),"Sign In"]}),e.jsxs(w,{variant:"outline",onClick:a,className:"flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 w-4"}),"Create Account"]})]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:o.map(d=>e.jsx(jt,{deal:d,isSubscriber:!1,onClick:s,user:null},d.id))})]})}),e.jsx(xc,{isOpen:!!g,onClose:()=>h(null),deal:g,isSubscriber:(r==null?void 0:r.subscription_tier)!=="free"})]})})})}function jc(){var me,fe,pe,F;const{user:s}=ee(),[a,t]=l.useState([]),[r,n]=l.useState(null),[o,i]=l.useState([]),[p,c]=l.useState(""),[g,h]=l.useState(!0),[d,m]=l.useState(!1),[y,x]=l.useState(null),[S,v]=l.useState(""),[j,u]=l.useState([]),[b,A]=l.useState(!1),[L,P]=l.useState(!1),[T,O]=l.useState(!1),[C,_]=l.useState(!1),R=l.useRef(null),{data:B}=_i("session",async()=>{var M,H;const{data:f}=await U.auth.getSession();return console.log("SWR session check:",{hasSession:!!f.session,sessionUser:(H=(M=f.session)==null?void 0:M.user)==null?void 0:H.id}),f.session}),Y=!!s||!!B;l.useEffect(()=>{var f;console.log("Authentication state:",{authUser:!!s,authUserId:s==null?void 0:s.id,session:!!B,sessionUserId:(f=B==null?void 0:B.user)==null?void 0:f.id,isAuthenticated:Y})},[s,B,Y]),l.useEffect(()=>{const f=()=>{O(window.innerWidth<768)};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),l.useEffect(()=>{T&&r&&_(!0)},[r,T]),l.useEffect(()=>{if(Y){console.log("User is authenticated, loading conversations"),Z();const f=Ol(M=>{(M.sender_id===r||M.receiver_id===r)&&i(H=>[...H,M]),Z()});return()=>{f==null||f.unsubscribe()}}else console.log("User is not authenticated"),x("Please sign in to view your messages"),h(!1)},[Y,r]),l.useEffect(()=>{const{data:f}=U.auth.onAuthStateChange((M,H)=>{console.log("Auth state change detected:",M,!!H),H&&(M==="SIGNED_IN"||M==="INITIAL_SESSION")&&(console.log("Auth event triggered conversation loading"),x(null),Z())});return()=>{f.subscription.unsubscribe()}},[]),l.useEffect(()=>{r&&$(r)},[r]),l.useEffect(()=>{X()},[o]),l.useEffect(()=>{L&&W("")},[L]);const Z=async()=>{try{h(!0);const f=(B==null?void 0:B.user)||s;if(!(f!=null&&f.id)){console.log("No active user found for loading conversations"),t([]);return}console.log(`Loading conversations for user: ${f.id}`);const M=await Ll();console.log("Loaded conversations:",M),t(M),x(null)}catch(f){console.error("Error getting conversations:",f),x("Failed to load conversations. Please try again.")}finally{h(!1)}},$=async f=>{try{m(!0);const M=await sn(f);i(M)}catch(M){console.error("Error loading messages:",M)}finally{m(!1)}},Q=async f=>{if(f.preventDefault(),!(!r||!p.trim()))try{await en(r,p.trim())&&c("")}catch(M){console.error("Error sending message:",M)}},X=()=>{var f;(f=R.current)==null||f.scrollIntoView({behavior:"smooth"})},W=async f=>{A(!0);try{console.log(`Starting user search with term: "${f||"all users"}"`);const M=await $l(f);console.log(`Search returned ${(M==null?void 0:M.length)||0} users:`,M),u(M||[])}catch(M){console.error("Error searching users:",M),u([])}finally{A(!1)}},he=()=>{_(!1)};return!Y&&!g?e.jsx(ce,{children:e.jsx(ke,{children:e.jsx("div",{className:"container mx-auto py-8 pt-24 px-4",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(js,{variant:"destructive",className:"shadow-md",children:[e.jsx(Rt,{className:"font-semibold",children:"Authentication Required"}),e.jsx(vs,{children:"Please sign in to view and send messages"})]})})})})}):e.jsx(ce,{children:e.jsx(ke,{children:e.jsx("div",{className:"bg-gradient-to-b from-blue-50 to-white min-h-screen",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 pt-20 md:pt-24",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Your Messages"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:gap-6 h-[calc(100vh-220px)] md:h-[calc(100vh-260px)]",children:[e.jsx("div",{className:k("md:w-1/3 lg:w-1/4 flex-shrink-0",T&&C?"hidden":"flex flex-col"),children:e.jsxs(E,{className:"flex-1 flex flex-col overflow-hidden shadow-lg border-2 border-blue-100 rounded-xl",children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-4 border-b bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-5 w-5 text-blue-500"}),e.jsx(K,{children:"Messages"})]}),e.jsxs(Ee,{open:L,onOpenChange:P,children:[e.jsx(Zr,{asChild:!0,children:e.jsx(w,{size:"icon",variant:"outline",className:"rounded-full h-8 w-8 border-blue-200 bg-white",children:e.jsx(Ri,{className:"h-4 w-4 text-blue-500"})})}),e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"h-5 w-5 text-blue-500"}),"New Conversation"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{placeholder:"Search users...",value:S,onChange:f=>{v(f.target.value)},onKeyDown:f=>{f.key==="Enter"&&W(S)},className:"flex-1"}),e.jsx(w,{size:"icon",variant:"ghost",disabled:b,className:"shrink-0",onClick:()=>W(S),children:b?e.jsx(fs,{className:"h-4 w-4 animate-spin"}):e.jsx(ar,{className:"h-4 w-4"})})]}),e.jsxs(as,{className:"h-[300px]",children:[b&&e.jsx("div",{className:"flex justify-center items-center h-[100px]",children:e.jsx(Fe,{})}),!b&&j.length===0&&e.jsxs("div",{className:"text-center text-muted-foreground p-4 bg-muted/30 rounded-lg",children:[e.jsx(Ct,{className:"h-12 w-12 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-sm mt-2",children:S?`No users match "${S}"`:"There are no other users in the system"}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("p",{children:"Try the following:"}),e.jsxs("ul",{className:"list-disc text-left pl-8 mt-2 space-y-1",children:[e.jsx("li",{children:"Check if other users have registered"}),e.jsx("li",{children:"Make sure your internet connection is working"}),e.jsx("li",{children:"Try refreshing the page"}),e.jsx("li",{children:"Check your authentication status"})]})]})]}),!b&&j.map(f=>{var M,H;return e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-blue-50 rounded-lg cursor-pointer transition-colors",onClick:()=>{n(f.id),P(!1)},children:[e.jsxs($e,{className:"h-10 w-10 border-2 border-blue-200",children:[e.jsx(Ue,{src:f.avatar_url||void 0}),e.jsx(ze,{className:"bg-blue-100 text-blue-600",children:((M=f.full_name)==null?void 0:M.charAt(0))||((H=f.email)==null?void 0:H.charAt(0))||"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.full_name||f.email}),f.full_name&&f.email&&e.jsx("p",{className:"text-xs text-muted-foreground",children:f.email})]})]},f.id)})]})]})]})]})]}),e.jsxs(D,{className:"flex-1 p-0 overflow-hidden",children:[y&&e.jsx(js,{variant:"destructive",className:"m-3 shadow-sm",children:e.jsx(vs,{children:y})}),g?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(Fe,{size:"lg"})}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4 py-10 bg-blue-50/50",children:[e.jsx(ds,{className:"h-16 w-16 mb-4 text-blue-200"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No conversations yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Start a new conversation by clicking the plus icon above"}),e.jsxs(w,{onClick:()=>P(!0),className:"gap-2 bg-blue-500 hover:bg-blue-600",size:"sm",children:[e.jsx(ps,{className:"h-4 w-4"}),"New Conversation"]})]}):e.jsx(as,{className:"h-full",children:e.jsx("div",{className:"divide-y divide-blue-100",children:a.map(f=>e.jsx("div",{className:k("p-3 cursor-pointer hover:bg-blue-50 transition-colors",r===f.user.id?"bg-blue-100":""),onClick:()=>n(f.user.id),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs($e,{className:"h-12 w-12 border-2 border-blue-200",children:[e.jsx(Ue,{src:f.user.avatar_url||void 0}),e.jsx(ze,{className:"bg-blue-100 text-blue-600",children:f.user.full_name.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium truncate",children:f.user.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground whitespace-nowrap pl-2",children:gs(new Date(f.lastMessage.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[f.lastMessage.sender_id===s.id&&"You: ",f.lastMessage.content]}),f.unreadCount>0&&e.jsx("div",{className:"bg-blue-500 text-white rounded-full h-5 min-w-5 px-1.5 flex items-center justify-center text-xs ml-2",children:f.unreadCount})]})]})]})},f.user.id))})})]})]})}),e.jsx("div",{className:k("md:flex-1 flex flex-col overflow-hidden",T&&!C?"hidden":"flex flex-col"),children:e.jsxs(E,{className:"flex-1 flex flex-col overflow-hidden shadow-lg border-2 border-blue-100 rounded-xl",children:[e.jsx(z,{className:"flex flex-row items-center justify-between space-y-0 px-4 py-3 border-b bg-blue-50",children:r?e.jsxs(e.Fragment,{children:[T&&e.jsx(w,{variant:"ghost",size:"icon",className:"mr-1 hover:bg-blue-100",onClick:he,children:e.jsx(br,{className:"h-5 w-5 text-blue-500"})}),((me=a.find(f=>f.user.id===r))==null?void 0:me.user)&&e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsxs($e,{className:"h-8 w-8 border-2 border-blue-200",children:[e.jsx(Ue,{src:((fe=a.find(f=>f.user.id===r))==null?void 0:fe.user.avatar_url)||void 0}),e.jsx(ze,{className:"bg-blue-100 text-blue-600",children:((pe=a.find(f=>f.user.id===r))==null?void 0:pe.user.full_name.charAt(0))||"U"})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"font-medium text-sm truncate",children:(F=a.find(f=>f.user.id===r))==null?void 0:F.user.full_name})})]})]}):e.jsx("div",{className:"font-medium",children:"Messages"})}),e.jsx(D,{className:"flex-1 p-0 overflow-hidden",children:r?e.jsxs("div",{className:"h-full flex flex-col",children:[d?e.jsx("div",{className:"flex-1 flex justify-center items-center",children:e.jsx(Fe,{size:"lg"})}):e.jsx(as,{className:"flex-1 p-4",children:o.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center px-4 bg-blue-50/50",children:[e.jsx(ds,{className:"h-16 w-16 mb-4 text-blue-200"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Send a message to start the conversation"})]}):e.jsxs("div",{className:"space-y-4",children:[o.map((f,M)=>{const H=f.sender_id===s.id,re=!H&&(M===0||o[M-1].sender_id!==f.sender_id);return e.jsxs("div",{className:k("flex",H?"justify-end":"justify-start"),children:[re?e.jsxs($e,{className:"mr-2 mt-1 h-8 w-8 border-2 border-blue-200",children:[e.jsx(Ue,{src:f.sender.avatar_url}),e.jsx(ze,{className:"bg-blue-100 text-blue-600",children:f.sender.full_name.charAt(0)})]}):!H&&e.jsx("div",{className:"w-10"}),e.jsxs("div",{className:k("max-w-[75%] rounded-2xl px-4 py-2.5 break-words shadow-sm",H?"bg-blue-500 text-white rounded-tr-none":"bg-blue-100 rounded-tl-none"),children:[e.jsx("p",{className:"text-sm",children:f.content}),e.jsx("p",{className:k("text-xs mt-1",H?"text-blue-100":"text-blue-500"),children:gs(new Date(f.created_at),{addSuffix:!0})})]})]},f.id)}),e.jsx("div",{ref:R})]})}),e.jsx("form",{onSubmit:Q,className:"p-3 border-t bg-blue-50",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:p,onChange:f=>c(f.target.value),placeholder:"Type a message...",className:"flex-1 border-blue-200 bg-white"}),e.jsxs(w,{type:"submit",className:"shrink-0 bg-blue-500 hover:bg-blue-600",disabled:!p.trim(),children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Send"]})]})})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center px-4 bg-blue-50/50",children:[e.jsx(ds,{className:"h-16 w-16 mb-4 text-blue-200"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Choose a conversation from the list or start a new one"})]})})]})})]})})]})})})})}const Ls="apify_api_aPVtpmUSZzjriimnhQ6qsQuVXxqSpB12oY5r",da="dhrumil/rightmove-scraper",vc=12;console.log("Apify API token status:","Token configured");const yc=(s,a=vc)=>{const t=new Date(s).getTime(),r=new Date().getTime(),n=a*60*60*1e3;return r-t<n},Os=async()=>{try{console.log("Checking if scraper_cache table exists using simplified approach...");const{error:s}=await U.from("scraper_cache").select("*",{count:"exact",head:!0});if(!s)return console.log("âœ… scraper_cache table exists - count check successful"),!0;console.log("Count check failed:",s);const a=`test-existence-${Date.now()}`,{error:t}=await U.from("scraper_cache").insert({key:a,data:{test:!0},created_at:new Date().toISOString()});return t?(console.error("Insert test failed:",t),console.error("The scraper_cache table does not appear to be accessible"),!1):(console.log("âœ… Successfully verified scraper_cache table exists via insert test!"),!0)}catch(s){return console.error("Error in ensureScraperCacheTableExists:",s),!1}},on=async()=>{try{const s=await fetch("https://api.apify.com/v2/users/me",{headers:{Authorization:`Bearer ${Ls}`}});return s.ok?{success:!0,message:`Valid Apify token for user: ${(await s.json()).data.username||"unknown"}`}:{success:!1,message:`Apify API token validation failed: ${s.status} ${s.statusText}`}}catch(s){return console.error("Error testing Apify token:",s),{success:!1,message:`Connection error: ${s instanceof Error?s.message:String(s)}`}}},bc=async s=>{try{console.log("Running Apify actor with input:",s);const a=!1;console.log(`Running in ${a?"development":"production"} mode`),console.log(`Making API request to: https://api.apify.com/v2/acts/${da}/runs`);const t=await fetch(`https://api.apify.com/v2/acts/${da}/runs`,{method:"POST",headers:{Authorization:`Bearer ${Ls}`,"Content-Type":"application/json"},body:JSON.stringify({run:{input:s}})});if(!t.ok){const h=await t.text();throw console.error("Apify actor start failed:",{status:t.status,statusText:t.statusText,responseText:h}),new Error(`Failed to start Apify actor: ${t.status} ${t.statusText} - ${h}`)}const n=(await t.json()).data.id;console.log(`Apify actor run started with ID: ${n}`);let o=!1,i=0;const p=60;for(;!o&&i<p;){await new Promise(m=>setTimeout(m,5e3)),console.log(`Checking status of run ${n}, attempt ${i+1}/${p}`);const h=await fetch(`https://api.apify.com/v2/actor-runs/${n}`,{headers:{Authorization:`Bearer ${Ls}`}});if(!h.ok)throw console.error("Failed to check actor run status:",{status:h.status,statusText:h.statusText}),new Error(`Failed to check actor run status: ${h.status} ${h.statusText}`);const d=await h.json();if(console.log(`Run status: ${d.data.status}, status message: ${d.data.statusMessage||"None"}`),["SUCCEEDED","FAILED","ABORTED","TIMED-OUT"].includes(d.data.status)&&(o=!0,d.data.status!=="SUCCEEDED"))throw new Error(`Apify actor run failed with status: ${d.data.status} - ${d.data.statusMessage||"No message"}`);i++}if(!o)throw new Error("Apify actor run timed out while waiting for completion");console.log(`Fetching results for run ${n}`);const c=await fetch(`https://api.apify.com/v2/actor-runs/${n}/dataset/items`,{headers:{Authorization:`Bearer ${Ls}`}});if(!c.ok)throw console.error("Failed to fetch actor results:",{status:c.status,statusText:c.statusText}),new Error(`Failed to fetch actor results: ${c.status} ${c.statusText}`);const g=await c.json();return console.log(`Retrieved ${g.length} results from Apify`),g}catch(a){throw console.error("Error running Apify actor:",a),a}};function Nc(s){console.log(`Extracting images for property ${s.id||"unknown"}`);const a={mainImage:null,allImages:[]};try{return console.log("Full item structure for image extraction:",JSON.stringify(s,null,2)),s.propertyImages&&typeof s.propertyImages=="object"&&(console.log("Found propertyImages object:",s.propertyImages),s.propertyImages.mainImageSrc&&(a.mainImage=s.propertyImages.mainImageSrc,a.allImages.push(s.propertyImages.mainImageSrc)),Array.isArray(s.propertyImages.images)&&s.propertyImages.images.forEach(t=>{t.srcUrl&&a.allImages.push(t.srcUrl)})),Array.isArray(s.images)&&(console.log("Found images array with length:",s.images.length),s.images.forEach(t=>{if(typeof t=="string")a.allImages.push(t);else if(t&&typeof t=="object"){const r=t.url||t.srcUrl||t.src||t.imageUrl;r&&a.allImages.push(r)}})),Array.isArray(s.imageUrls)&&(console.log("Found imageUrls array with length:",s.imageUrls.length),s.imageUrls.forEach(t=>{typeof t=="string"&&a.allImages.push(t)})),Array.isArray(s.image_urls)&&(console.log("Found image_urls array with length:",s.image_urls.length),s.image_urls.forEach(t=>{typeof t=="string"&&a.allImages.push(t)})),s.mainImage&&(console.log("Found mainImage:",s.mainImage),typeof s.mainImage=="string"?(a.mainImage=s.mainImage,a.allImages.push(s.mainImage)):s.mainImage.srcUrl&&(a.mainImage=s.mainImage.srcUrl,a.allImages.push(s.mainImage.srcUrl))),s.mainImageUrl&&typeof s.mainImageUrl=="string"&&(console.log("Found mainImageUrl:",s.mainImageUrl),a.mainImage=s.mainImageUrl,a.allImages.push(s.mainImageUrl)),Array.isArray(s.photos)&&(console.log("Found photos array with length:",s.photos.length),s.photos.forEach(t=>{if(typeof t=="string")a.allImages.push(t);else if(t&&typeof t=="object"){const r=t.url||t.srcUrl||t.src;r&&a.allImages.push(r)}})),s.propertyInfo&&typeof s.propertyInfo=="object"&&Array.isArray(s.propertyInfo.images)&&(console.log("Found propertyInfo.images array:",s.propertyInfo.images),s.propertyInfo.images.forEach(t=>{const r=typeof t=="string"?t:t.srcUrl||t.url||t.src;r&&a.allImages.push(r)})),a.allImages.length>0&&!a.mainImage&&(a.mainImage=a.allImages[0]),a.allImages=[...new Set(a.allImages)],console.log(`Extraction results for property ${s.id||"unknown"}:`,{mainImage:a.mainImage,totalImages:a.allImages.length,imageUrls:a.allImages.slice(0,2)}),a}catch(t){return console.error("Error extracting images:",t),a}}function Ys(s){if(!s)throw new Error("Cannot convert null or undefined item to property");console.log(`Converting Apify item to RightmoveProperty: ${s.id||"unknown"}`);const{mainImage:a,allImages:t}=Nc(s);let r={name:"Unknown Agent"};s.agent&&(r={name:s.agent.name||"Unknown Agent",logo_url:s.agent.logoUrl||null,phone:s.agent.phoneNumber||s.agent.contactPhoneNumber||null},console.log("Agent information:",r));let n=0;typeof s.price=="number"?n=s.price:typeof s.price=="string"&&(n=parseInt(s.price.replace(/[Â£$,]/g,""),10)||0);const o=s.address||s.displayAddress||"Address not available";let i=s.postcode||"";if(!i&&o){const c=/[A-Z]{1,2}[0-9][0-9A-Z]?\s?[0-9][A-Z]{2}/i,g=o.match(c);g&&(i=g[0])}const p={id:s.id?String(s.id):`apify-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,address:o,price:n,property_type:s.propertyType||s.property_type||"Not specified",bedrooms:parseInt(s.bedrooms,10)||0,bathrooms:parseInt(s.bathrooms,10)||0,description:s.propertyDescription||s.description||"",features:Array.isArray(s.features)?s.features:[],main_image_url:a||"",image_urls:t,floor_area:s.floorArea?{size:s.floorArea.value||s.floorArea.size||0,unit:s.floorArea.unit||"mÂ²"}:void 0,rightmove_url:s.url||"",postcode:i,date_listed:s.listingDate||s.addedReduced||s.firstVisibleDate||"",is_active:!0,new_build:s.isNewHome||!1,tenure:s.tenure||"",agent:r};return console.log(`Converted property ${p.id} with ${p.image_urls.length} images`),p}async function cn(){try{const s=["/src/lib/apifydataset.json","/apifydataset.json","apifydataset.json"];for(const a of s)try{console.log(`Trying to load dataset from ${a}`);const t=await fetch(a);if(t.ok){const r=await t.json();return console.log(`Successfully loaded ${r.length} properties from ${a}`),r}}catch(t){console.log(`Failed to load from ${a}:`,t)}return null}catch(s){return console.error("Error loading local dataset:",s),null}}async function wc(s){console.log("Searching for properties with filters:",s);try{const a=`rightmove_search_${JSON.stringify(s)}`,t=await dn(a);if(t)return console.log("Found cached data for search"),{properties:t.data.properties||[],totalPages:t.data.totalPages||1};const r=await cn();if(r){console.log("Using local dataset for development");const p=r.map(g=>Ys(g));console.log(`Converted ${p.length} properties from local dataset`);let c=p;if(s.location&&s.location!=="all"){const g=s.location.toLowerCase();c=p.filter(h=>h.address.toLowerCase().includes(g)||h.postcode&&h.postcode.toLowerCase().includes(g)),console.log(`Filtered to ${c.length} properties matching location: ${s.location}`)}if(s.minPrice&&(c=c.filter(g=>g.price>=s.minPrice)),s.maxPrice&&(c=c.filter(g=>g.price<=s.maxPrice)),s.minBeds&&(c=c.filter(g=>g.bedrooms>=s.minBeds)),s.maxBeds&&(c=c.filter(g=>g.bedrooms<=s.maxBeds)),s.propertyType&&s.propertyType!=="any"){const g=s.propertyType.toLowerCase();c=c.filter(h=>h.property_type.toLowerCase().includes(g))}return await Ks(a,{properties:c,totalPages:1}),{properties:c,totalPages:1}}console.log("Using Apify API to search for properties");const n={search:s.location||void 0,locationIdentifier:s.locationIdentifier||void 0,minPrice:s.minPrice||void 0,maxPrice:s.maxPrice||void 0,minBedrooms:s.minBeds||void 0,maxBedrooms:s.maxBeds||void 0,propertyType:s.propertyType==="any"?void 0:s.propertyType,maxPages:1},o=await mn(n);if(!o||!Array.isArray(o))throw console.error("Invalid data returned from Apify:",o),new Error("Failed to get property data from Apify");const i=o.map(p=>Ys(p));return console.log(`Converted ${i.length} properties from Apify API`),await Ks(a,{properties:i,totalPages:1}),{properties:i,totalPages:1}}catch(a){throw console.error("Error searching properties:",a),new Error(`Failed to search properties: ${a instanceof Error?a.message:"Unknown error"}`)}}async function Sc(s){console.log(`Getting details for property with ID: ${s}`);try{const a=`rightmove_property_${s}`,t=await dn(a);if(t)return console.log(`Using cached data for property ${s}`),t.data;const r=await cn();if(r){console.log(`Searching for property ${s} in local dataset`);const p=r.find(c=>String(c.id)===s||String(c.propertyId)===s);if(p){console.log(`Found property ${s} in local dataset`);const c=Ys(p);return await Ks(a,c),c}console.log(`Property ${s} not found in local dataset`)}console.log(`Using Apify API to get details for property ${s}`);const n={propertyUrls:[`https://www.rightmove.co.uk/properties/${s}`]},o=await mn(n);if(!o||!Array.isArray(o)||o.length===0)return console.error(`No data returned from Apify for property ${s}`),null;const i=Ys(o[0]);return await Ks(a,i),i}catch(a){throw console.error(`Error getting property details for ${s}:`,a),new Error(`Failed to get property details: ${a instanceof Error?a.message:"Unknown error"}`)}}async function dn(s){try{const{data:a,error:t}=await U.from("scraper_cache").select("*").eq("key",s).maybeSingle();return t?(console.error("Error getting from cache:",t),null):a?yc(a.created_at)?a:(console.log(`Cache for ${s} is expired`),null):null}catch(a){return console.error("Error in getFromCache:",a),null}}async function Ks(s,a){try{const{error:t}=await U.from("scraper_cache").upsert({key:s,data:a,created_at:new Date().toISOString()},{onConflict:"key"});t&&console.error("Error saving to cache:",t)}catch(t){console.error("Error in saveToCache:",t)}}async function mn(s){return await bc(s)}console.log("Initializing Apify Rightmove scraper..."),on().then(s=>{s.success?console.log(`âœ… Apify API token validated: ${s.message}`):(console.error(`âš ï¸ INVALID APIFY API TOKEN: ${s.message}`),console.error("Get a valid token at https://apify.com/ and set it in .env.local as VITE_APIFY_API_TOKEN"))}),Os().then(s=>{s||console.warn("Scraper cache table does not exist. This may affect performance.")});console.log("Gemini API status:","Configured");const mt=s=>{console.log("Generating mock investment analysis for property:",s.id);const a=s.price||25e4,r=.004+(s.bedrooms||2)*1e-4,n=Math.round(a*r),o=n*12,i=+(o/a*100).toFixed(2),p=o*.3,c=o-p,g=Math.round(c/12),h=+(c/a*100).toFixed(2),d=a*.25,m=+(c/d*100).toFixed(2),y=+((a-a*.7)/c).toFixed(1),x=.05+Math.random()*.05,S=Math.round(a*(1-x));return{estimatedRent:n,rentalYield:i,cashFlow:g,capRate:h,roiFirstYear:m,breakEvenPoint:y,suggestedOfferPrice:S,commentary:`This ${s.property_type} in ${s.address} could generate approximately Â£${n} per month in rent, yielding a ${i}% rental yield. With estimated monthly cash flow of Â£${g} after expenses, you could break even in around ${y} years. Consider offering around Â£${S} for this property.`}},kc={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_NAME:"Property Insight",VITE_GEMINI_API_KEY:"AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",VITE_PATMA_API_KEY:"3160af39c66686f66e595371584faa9d8087132c",VITE_PATMA_API_URL:"https://api.patma.co.uk/v1",VITE_SCRAPER_API_KEY:"162910ce5fe80080edef0fe026506f0e",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjdWFwdXZ2eWdhaGt6bGp1aHlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MTQwMzcsImV4cCI6MjA1MzQ5MDAzN30.GIhphzkznmDXgrUApGW479uHHluqDWqy_9cfG5sU5Xc",VITE_SUPABASE_URL:"https://zcuapuvvygahkzljuhyg.supabase.co",VITE_SUPPORT_EMAIL:"info@myvge.com",VITE_USE_MOCK_AI:"true",VITE_USE_MOCK_DATA:"false"},De=({name:s,value:a})=>{const t=String(a),r=a===!0||a===!1||a==="true"||a==="false",o=(s.toLowerCase().includes("api_key")||s.toLowerCase().includes("apikey")||s.toLowerCase().includes("api_token")||s.toLowerCase().includes("token"))&&t&&t.length>8?`${t.substring(0,4)}...${t.substring(t.length-4)}`:t;return e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsxs("div",{className:"font-mono font-medium w-60",children:[s,":"]}),e.jsx("div",{className:`font-mono ${r?t==="true"?"text-green-600 font-bold":t==="false"?"text-red-600":"":""}`,children:o||"(undefined)"})]})},ma=()=>{const[s,a]=l.useState(!1),[t,r]=l.useState(null),[n,o]=l.useState(!1),[i,p]=l.useState(null),[c,g]=l.useState(null),[h,d]=l.useState(!1),[m,y]=l.useState(null),[x,S]=l.useState(!1),[v,j]=l.useState("OUTCODE%5E2445"),[u,b]=l.useState(!1),[A,L]=l.useState(null),[P,T]=l.useState(null),[O,C]=l.useState(!1),_={...kc},R="false",B=R,Y=R.toLowerCase()==="true",Z="162910ce5fe80080edef0fe026506f0e",$="apify_api_aPVtpmUSZzjriimnhQ6qsQuVXxqSpB12oY5r",Q=async()=>{d(!0),g(null);try{const W=await on();g(W.success?`âœ… ${W.message}`:`âŒ ${W.message}`)}catch(W){console.error("Error testing Apify token:",W),g("âŒ Error: "+(W instanceof Error?W.message:String(W)))}finally{d(!1)}},X=async()=>{S(!0),y(null);try{console.log(`Testing Apify Rightmove scraper with location: ${v}`);const he={listUrls:[{url:`https://www.rightmove.co.uk/property-for-sale/find.html?locationIdentifier=${v}`,method:"GET"}],fullScrape:!0,monitoringMode:!1,fullPropertyDetails:!0,maxProperties:1,proxy:{useApifyProxy:!0}},me=await fetch("https://api.apify.com/v2/acts/dhrumil/rightmove-scraper/runs",{method:"POST",headers:{Authorization:`Bearer ${$}`,"Content-Type":"application/json"},body:JSON.stringify({run:{input:he}})});if(!me.ok){const pe=await me.text();console.error("Test failed:",{status:me.status,statusText:me.statusText,response:pe}),y(`âŒ Failed to start Apify actor: ${me.status} ${me.statusText}`);return}const fe=await me.json();console.log("Apify actor started:",fe),y(`âœ… Successfully started Apify Rightmove scraper with run ID: ${fe.data.id}`)}catch(W){console.error("Error testing Apify Rightmove scraper:",W),y("âŒ Error: "+(W instanceof Error?W.message:String(W)))}finally{S(!1)}};return e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50 my-4",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer font-medium",onClick:()=>a(!s),children:[e.jsx("h3",{className:"text-lg",children:"Environment Variables Debug"}),e.jsx("span",{children:s?"â–¼":"â–º"})]}),s&&e.jsxs("div",{className:"mt-3 text-sm",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Mock Data Settings"}),e.jsx(De,{name:"VITE_USE_MOCK_DATA (raw)",value:B}),e.jsx(De,{name:"VITE_USE_MOCK_DATA (interpreted)",value:Y}),e.jsx("h4",{className:"font-semibold mb-2 mt-4",children:"Apify Settings"}),e.jsx(De,{name:"VITE_APIFY_API_TOKEN",value:$}),e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"Token Status:"}),e.jsx("div",{className:"font-mono text-yellow-600",children:"Using provided token"})]}),c&&e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"Apify Test Result:"}),e.jsx("div",{className:"font-mono",children:c})]}),e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("button",{onClick:W=>{W.stopPropagation(),Q()},disabled:h,className:"px-3 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 disabled:bg-blue-300",children:h?"Testing...":"Test Apify Token"})}),e.jsx("h4",{className:"font-semibold mb-2 mt-4",children:"Apify Rightmove Scraper Test"}),e.jsxs("div",{className:"mb-2 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"Test Location:"}),e.jsx("input",{type:"text",value:v,onChange:W=>j(W.target.value),className:"border rounded px-2 py-1 text-sm font-mono w-64",placeholder:"OUTCODE%5E2445"})]}),m&&e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"Rightmove Test:"}),e.jsx("div",{className:"font-mono max-w-lg break-words",children:m})]}),e.jsxs("div",{className:"mt-2 mb-4",children:[e.jsx("button",{onClick:W=>{W.stopPropagation(),X()},disabled:x,className:"px-3 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 disabled:bg-blue-300",children:x?"Testing...":"Test Rightmove Scraper"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Try with ",e.jsx("code",{children:"OUTCODE%5E2445"})," (replace with your desired location)"]})]}),e.jsx("h4",{className:"font-semibold mb-2 mt-4",children:"ScraperAPI Settings (Legacy)"}),e.jsx(De,{name:"VITE_SCRAPER_API_KEY",value:Z}),e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"Key Status:"}),e.jsx("div",{className:"font-mono text-red-500 font-bold",children:"Using default key (NOT WORKING)"})]}),i&&e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"API Response:"}),e.jsx("div",{className:`font-mono ${i.status&&i.status>=200&&i.status<300?"text-green-600":"text-red-500"}`,children:i.status?`${i.status} - ${i.message}`:i.message})]}),t&&e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"API Test Result:"}),e.jsx("div",{className:"font-mono",children:t})]}),e.jsx("h4",{className:"font-semibold mb-2 mt-4",children:"Gemini API Settings"}),e.jsx(De,{name:"VITE_GEMINI_API_KEY",value:"AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo"}),e.jsxs("div",{className:"mb-1 flex items-start",children:[e.jsx("div",{className:"font-mono font-medium w-60",children:"Gemini API Status:"}),e.jsx("div",{className:"font-mono text-green-600",children:"Using custom key"})]}),e.jsx("h4",{className:"font-semibold mb-2 mt-4",children:"Other Environment Variables"}),e.jsx(De,{name:"NODE_ENV",value:void 0}),e.jsx(De,{name:"MODE",value:"production"}),e.jsx(De,{name:"DEV",value:!1}),e.jsx(De,{name:"PROD",value:!0}),e.jsx("h4",{className:"font-semibold mb-2 mt-4",children:"All Environment Variables"}),Object.entries(_).filter(([W])=>W!=="SSR").map(([W,he])=>e.jsx(De,{name:W,value:he},W)),!1,e.jsxs("div",{className:"mt-4 p-2 bg-blue-50 text-blue-800 text-xs rounded",children:[e.jsx("p",{className:"font-semibold",children:"Troubleshooting Tips:"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1",children:[e.jsx("li",{children:"If VITE_USE_MOCK_DATA is 'true', the app will use mock data"}),e.jsx("li",{children:"VITE_USE_MOCK_DATA must be set to 'false' (string) to disable mock data"}),e.jsx("li",{className:"font-bold",children:"A valid Apify API token is required for property searches"}),e.jsx("li",{children:"Add your Apify token to .env.local as VITE_APIFY_API_TOKEN=your_token_here"}),e.jsx("li",{children:"Restart your dev server after changing environment variables"}),e.jsx("li",{className:"font-bold mt-1",children:"For Rightmove searches:"}),e.jsxs("li",{children:["For outcodes (e.g., SW1) use format: ",e.jsx("code",{children:"OUTCODE%5E1234"})]}),e.jsxs("li",{children:["For regions/areas use format: ",e.jsx("code",{children:"REGION%5ELondon"})]})]})]}),e.jsxs("div",{className:"mt-4 p-2 bg-yellow-50 text-yellow-800 text-xs rounded",children:[e.jsx("p",{className:"font-semibold",children:"CORS Limitations in Development:"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1",children:[e.jsx("li",{children:"When running in development mode, direct API calls to Apify have CORS restrictions"}),e.jsx("li",{children:"The application uses sample data in development to work around these limitations"}),e.jsx("li",{children:"In production deployment, CORS issues won't occur as requests will be server-side"}),e.jsx("li",{children:"If you need to test with live data during development, consider using a CORS proxy or browser extension"})]})]}),e.jsxs("div",{className:"mt-4 p-2 bg-green-50 text-green-800 text-xs rounded",children:[e.jsx("p",{className:"font-semibold",children:"Gemini API Status:"}),e.jsx("div",{children:P==null?void 0:P.message})]})]})]})},Cc=`
  @keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .animate-fadein {
    animation: fadein 0.5s ease-in;
  }
  
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
`,Ic=({property:s,onClose:a,saleHistoryData:t=[],areaInsights:r,investmentAnalysis:n})=>{const[o,i]=l.useState(!1),[p,c]=l.useState(0);if(l.useEffect(()=>{s&&(i(!1),c(0),console.log(`PropertyModal: Loading property ${s.id} with ${s.image_urls.length} images`))},[s]),!s)return null;const g=new Intl.NumberFormat("en-UK",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(s.price),h=s.image_urls[p]||s.main_image_url||"";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:g}),e.jsx("p",{className:"text-gray-600",children:s.address})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden h-80 w-full mb-2 bg-gray-100",children:!o&&h?e.jsx("img",{src:h,alt:`${s.property_type} in ${s.address}`,className:"h-full w-full object-contain",onError:()=>{console.log(`Main image error for property ${s.id}`),i(!0)}}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-200 text-gray-500",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{children:"No image available"})]})})}),s.image_urls.length>1&&e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:s.image_urls.map((d,m)=>e.jsx("div",{className:`w-20 h-20 flex-shrink-0 rounded cursor-pointer border-2 ${p===m?"border-blue-500":"border-transparent"}`,onClick:()=>c(m),children:e.jsx("img",{src:d,alt:`Property view ${m+1}`,className:"w-full h-full object-cover rounded",onError:y=>{y.currentTarget.style.display="none"}})},m))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Property Details"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Property Type"}),e.jsx("span",{children:s.property_type})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Bedrooms"}),e.jsx("span",{children:s.bedrooms})]}),s.bathrooms&&e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Bathrooms"}),e.jsx("span",{children:s.bathrooms})]}),s.tenure&&e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tenure"}),e.jsx("span",{children:s.tenure})]}),s.floor_area&&e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Floor Area"}),e.jsxs("span",{children:[s.floor_area.size," ",s.floor_area.unit]})]}),s.date_listed&&e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Listed On"}),e.jsx("span",{children:s.date_listed})]})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Property Features"}),s.features&&s.features.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:s.features.map((d,m)=>e.jsx("li",{className:"text-gray-700",children:d},m))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No features listed"})]})]}),n&&e.jsxs("div",{className:"mb-6 bg-blue-50 p-4 rounded",children:[e.jsx("h3",{className:"font-semibold text-blue-700 mb-2",children:"Investment Analysis"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Estimated Rent"}),e.jsxs("div",{className:"text-lg font-semibold",children:["Â£",n.estimatedRent,"/mo"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Rental Yield"}),e.jsxs("div",{className:"text-lg font-semibold",children:[n.rentalYield,"%"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Monthly Cash Flow"}),e.jsxs("div",{className:"text-lg font-semibold",children:["Â£",n.cashFlow]})]}),e.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Break Even"}),e.jsxs("div",{className:"text-lg font-semibold",children:[n.breakEvenPoint," years"]})]})]}),e.jsx("div",{className:"text-sm text-gray-700",children:n.commentary})]}),t&&t.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Sale History"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-gray-200",children:[e.jsx("th",{className:"pb-2",children:"Date"}),e.jsx("th",{className:"pb-2",children:"Price"})]})}),e.jsx("tbody",{children:t.map((d,m)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2",children:d.date}),e.jsxs("td",{className:"py-2",children:["Â£",d.price.toLocaleString()]})]},m))})]})})]}),r&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Area Insights"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Average Price"}),e.jsxs("div",{className:"font-medium",children:["Â£",r.averagePrice.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"1 Year Growth"}),e.jsxs("div",{className:"font-medium",children:[r.priceGrowth1Year,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"5 Year Growth"}),e.jsxs("div",{className:"font-medium",children:[r.priceGrowth5Years,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Schools Rating"}),e.jsxs("div",{className:"font-medium",children:[r.schoolsRating,"/10"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Transport Rating"}),e.jsxs("div",{className:"font-medium",children:[r.transportRating,"/10"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Crime Rate"}),e.jsxs("div",{className:"font-medium",children:[r.crimeRate,"/100"]})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-700 text-sm whitespace-pre-line",children:s.description})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[s.agent.logo_url&&e.jsx("img",{src:s.agent.logo_url,alt:s.agent.name,className:"h-10 mr-3",onError:d=>{d.currentTarget.style.display="none"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:s.agent.name}),s.agent.phone&&e.jsx("p",{className:"text-gray-500 text-sm",children:s.agent.phone})]})]}),e.jsx("a",{href:s.rightmove_url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm",children:"View on Rightmove"})]})]})})})},Ac=N.memo(({property:s,onClick:a})=>{var h,d;const[t,r]=l.useState(!1),[n,o]=l.useState(!1);l.useEffect(()=>{r(!1),o(!1)},[s.id]),l.useEffect(()=>{var m,y,x;console.log(`Property Card ${s.id} - Image Details:`,{mainImageUrl:s.main_image_url,hasAdditionalImages:((m=s.image_urls)==null?void 0:m.length)>0,imageCount:((y=s.image_urls)==null?void 0:y.length)||0,firstFewImages:((x=s.image_urls)==null?void 0:x.slice(0,3))||[]})},[s]);const i=()=>{var m;console.log(`Image error for property ${s.id}`,{mainImageUrl:s.main_image_url,tryingAlternative:!t&&((m=s.image_urls)==null?void 0:m.length)>0}),r(!0)},p=()=>{console.log(`Image loaded successfully for property ${s.id}`),o(!0)};let c=s.main_image_url;t&&((h=s.image_urls)==null?void 0:h.length)>0&&s.image_urls[0]!==s.main_image_url&&(c=s.image_urls[0]);const g=m=>!!m&&m.trim()!==""&&m.startsWith("http");return e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-md transition-shadow",onClick:()=>a(s),children:[e.jsxs("div",{className:"relative aspect-video overflow-hidden bg-gray-100",children:[g(c)?e.jsx("img",{src:c,alt:s.address,className:"w-full h-full object-cover",onError:i,onLoad:p}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200 text-gray-600",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"No image available"}),e.jsxs("p",{className:"text-xs mt-1",children:["Images: ",((d=s.image_urls)==null?void 0:d.length)||0]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:e.jsx("p",{className:"text-white font-bold text-lg",children:Pc(s.price)})})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-1",children:s.address}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.bedrooms," ",s.bedrooms===1?"bed":"beds"," â€¢",s.bathrooms?` ${s.bathrooms} ${s.bathrooms===1?"bath":"baths"} â€¢ `:" ",s.property_type]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.agent.name})]})]})},(s,a)=>s.property.id===a.property.id),Pc=s=>s?`Â£${s.toLocaleString("en-GB")}`:"Â£0";function _c(){const[s,a]=N.useState(!1),[t,r]=N.useState(null),[n,o]=N.useState([]),[i,p]=N.useState(null),[c,g]=N.useState([]),[h,d]=N.useState(void 0),[m,y]=N.useState(null),[x,S]=N.useState(""),[v,j]=N.useState(""),[u,b]=N.useState(""),[A,L]=N.useState(""),[P,T]=N.useState(""),[O,C]=N.useState(""),[_,R]=N.useState(1),[,B]=N.useState(1),[,Y]=N.useState(0);N.useState("grid");const[Z,$]=N.useState(!1),[Q,X]=N.useState(!1),[W,he]=N.useState(!1),[me,fe]=N.useState(null),[pe,F]=N.useState(!1),[f,M]=N.useState(null),[H,re]=N.useState(""),[ls,Cs]=N.useState(!1),[st,qt]=N.useState(!1),[vn,ad]=N.useState(!1),[rd,yn]=N.useState(null),[nd,id]=N.useState({}),[ld,od]=N.useState([]),[tt,cd]=N.useState(null),[,dd]=N.useState(!1),[md]=N.useState(!1),[Is]=N.useState(""),bn=I=>{I?I.split("").reduce((Ne,Re)=>Ne+Re.charCodeAt(0),0):Math.random();const V=new Date;V.setFullYear(V.getFullYear()-15);const ae=2+Math.floor(Math.random()*3),je=[];let J=new Date(V),ne=1e5+Math.floor(Math.random()*15e4);for(let Ne=0;Ne<ae;Ne++){je.push({date:J.toISOString().split("T")[0],price:ne});const Re=2+Math.floor(Math.random()*4);J=new Date(J.setFullYear(J.getFullYear()+Re));const Te=.1+Math.random()*.2;ne=Math.floor(ne*(1+Te))}return je},Nn=I=>({postcode:I,averagePrice:25e4+Math.floor(Math.random()*5e5),priceGrowth1Year:2+Math.random()*8,priceGrowth5Years:10+Math.random()*30,crimeRate:30+Math.random()*40,schoolsRating:5+Math.random()*5,transportRating:4+Math.random()*6}),os=async I=>{typeof I!="string"&&I.preventDefault();const V=typeof I=="string"?I:x;if(!V){oe({title:"Location Required",description:"Please enter a location to search for properties",variant:"destructive"});return}a(!0),r(null),o([]);try{const ae=Date.now();oe({title:"Searching",description:`Searching for properties in ${V}...`,variant:"default"});const je={location:V,minPrice:v?parseInt(v,10):void 0,maxPrice:u?parseInt(u,10):void 0,minBeds:A?parseInt(A,10):void 0,maxBeds:P?parseInt(P,10):void 0,propertyType:O||void 0,page:_};console.log("Search filters:",je);const J=!1;$(J);const ne=await wc(je),Re=Date.now()-ae;console.log(`Search completed in ${Re}ms, found ${ne.properties.length} properties`),o(ne.properties),B(ne.totalPages),Y(ne.properties.length);const Te={originalLocation:V,formattedLocation:`${V} (${ne.properties.length} properties)`,isOutcode:V.match(/^[A-Z]{1,2}[0-9]{1,2}$/i)!==null,timestamp:new Date().toISOString(),searchDurationMs:Re,propertiesFound:ne.properties.length};yn(Te),ne.properties.length>0?(oe({title:"Search Completed",description:`Found ${ne.properties.length} properties in ${V}`,variant:"default"}),typeof rt=="function"&&rt(ne.properties.slice(0,10))):(console.warn(`No properties found in ${V}`),r(`No properties found in ${V}. Please try a different location or search criteria.`),oe({title:"No Properties Found",description:`No properties found in ${V}. Please try a different location or search criteria.`,variant:"destructive"}))}catch(ae){console.error("Search error:",ae);const je=ae instanceof Error?ae.message:String(ae);r(je),oe({title:"Search Failed",description:je,variant:"destructive"})}finally{a(!1)}};N.useEffect(()=>{_>1&&x&&os(x)},[_,x]),N.useEffect(()=>{S(Is),Is&&os(Is)},[Is]);const wn=N.useCallback(I=>{S(I),I&&os(I)},[os]);N.useEffect(()=>{(async()=>{const V=await Os();he(V)})()},[]);const Vt=async()=>{X(!0);try{const I=await Os();he(I),oe(I?{title:"Setup complete",description:"The scraper_cache table has been set up successfully",variant:"default"}:{title:"Setup failed",description:"Failed to set up the scraper_cache table. Check console for details.",variant:"destructive"})}catch(I){console.error("Error initializing scraper:",I),oe({title:"Setup error",description:"An error occurred while setting up the scraper",variant:"destructive"})}finally{X(!1)}},Ht=async()=>{F(!0);try{const I=await Tl();console.log("Supabase connection test:",I);let V={exists:!1,error:null,count:0};try{const{error:J,count:ne}=await U.from("scraper_cache").select("*",{count:"exact",head:!0});V={exists:!J,error:J?`${J.code}: ${J.message}`:null,count:ne||0},console.log("Direct table check:",V)}catch(J){console.error("Error in direct table check:",J),V.error=J instanceof Error?J.message:String(J)}let ae={success:!1,error:null};if(V.exists)try{const J=`diagnostic-test-${Date.now()}`,{error:ne}=await U.from("scraper_cache").insert({key:J,data:{test:"diagnostics"},created_at:new Date().toISOString()});ae={success:!ne,error:ne?`${ne.code}: ${ne.message}`:null},console.log("Insert test:",ae),ne||await U.from("scraper_cache").delete().eq("key",J)}catch(J){console.error("Error in insert test:",J),ae.error=J instanceof Error?J.message:String(J)}const je=await Os();console.log("Helper function check result:",je),fe({connectionTest:I,tableExists:je,directTableTest:V,insertTest:ae,timestamp:new Date().toISOString(),env:{mockData:"false",nodeEnv:void 0,mode:"production"}}),V.exists&&ae.success?oe({title:"Database Ready",description:"Your scraper_cache table exists and is working correctly!",variant:"default"}):V.exists&&!ae.success?oe({title:"Table Exists But Can't Insert",description:"The table exists but we can't write to it. Check RLS policies.",variant:"warning"}):oe({title:I.success?"Table Missing":"Connection Issues",description:I.success?"The scraper_cache table doesn't exist or isn't accessible.":I.message,variant:"destructive"})}catch(I){console.error("Error running diagnostics:",I),fe({error:I instanceof Error?I.message:"Unknown error",timestamp:new Date().toISOString()}),oe({title:"Failed to run database diagnostics",description:"See console for details.",variant:"destructive"})}finally{F(!1)}},at=async I=>{try{console.log(`Getting investment analysis for property: ${I.id}`);const V=`property_analysis_${I.id}`,ae=localStorage.getItem(V);if(ae)return console.log("Using cached analysis data"),JSON.parse(ae);const je="AIzaSyD0MjDEtw7El7GSzOm9F8iIKE2uGDkVBWo",J={id:I.id,address:I.address,postcode:I.postcode,price:I.price,property_type:I.property_type,bedrooms:I.bedrooms,description:I.description};console.log("Sending property data to Gemini API for analysis:",J);const Ne=await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=${je}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Analyze this property as an investment: ${JSON.stringify(J)}`}]}],generationConfig:{temperature:.2,maxOutputTokens:1e3}})});if(!Ne.ok){const Me=await Ne.json();return console.error("Gemini API error:",Me),console.error(`Gemini API request failed with status ${Ne.status}: ${Ne.statusText}`),console.error("Check your API key and endpoint URL"),oe({title:"Analysis Failed",description:"Could not get investment analysis. Using estimated data instead.",variant:"destructive"}),mt(I)}const Re=await Ne.json();console.log("Received response from Gemini API:",Re);let Te;try{const Me=Re.candidates[0].content.parts[0].text;if(Me.includes("{")&&Me.includes("}")){const As=Me.match(/\{[\s\S]*\}/);if(As)Te=JSON.parse(As[0]);else throw new Error("Could not extract JSON from response")}else Te={estimatedRent:Math.round(I.price*.005),rentalYield:5,cashFlow:200,capRate:4.5,roiFirstYear:7.2,breakEvenPoint:15,suggestedOfferPrice:Math.round(I.price*.95),commentary:Me||"Analysis generated based on property details."}}catch(Me){console.error("Error extracting analysis from API response:",Me),Te=mt(I)}return localStorage.setItem(V,JSON.stringify(Te)),Te}catch(V){return console.error("Error getting property analysis:",V),oe({title:"Analysis Error",description:"Could not complete investment analysis. Using estimated data.",variant:"destructive"}),mt(I)}},Sn=async I=>{if(!I||!I.id){console.error("Cannot select property: Invalid property data",I);return}console.log("Selected property:",I),console.log("Property images:",{mainImage:I.main_image_url,allImages:I.image_urls,agent:I.agent});try{const V=bn(I.id),ae=Nn(I.postcode||""),je=await at(I);p(I),g(V),d(ae),y(je)}catch(V){console.error("Error selecting property:",V),oe({title:"Selection Error",description:`Error selecting property: ${V instanceof Error?V.message:"Unknown error"}`,variant:"destructive"}),p(I),g([]),d(void 0),y(null)}};N.useEffect(()=>{n.length>0&&rt(n)},[n]);const rt=(I,V=3,ae=2e3)=>{if(!I||I.length===0)return;if(console.log(`Starting batch analysis of ${I.length} properties`),I.slice(0,V).forEach(J=>at(J)),I.length>V){let J=1;const ne=Math.ceil((I.length-V)/V),Ne=()=>{if(J<=ne){const Re=J*V,Te=Math.min(Re+V,I.length),Me=I.slice(Re,Te);console.log(`Processing batch ${J}/${ne} (${Me.length} properties)`),Me.forEach((As,Cn)=>{setTimeout(()=>at(As),Cn*500)}),J++,setTimeout(Ne,ae)}};setTimeout(Ne,ae)}},kn=async()=>{if(!H||H.trim()===""){oe({title:"Property ID required",description:"Please enter a Rightmove property ID",variant:"destructive"});return}Cs(!0),o([]),$(!1),M(null),qt(!1);try{oe({title:"Fetching property details",description:"This may take up to 30 seconds as we fetch data from Rightmove",variant:"default"});const I=await Sc(H.trim());I?(o([I]),B(1),oe({title:"Property Found",description:"Successfully loaded the property details",variant:"default"})):oe({title:"Property Not Found",description:"No details found for that property ID",variant:"destructive"})}catch(I){console.error("Error fetching property:",I);const V=I instanceof Error?I.message:String(I);V.includes("Apify token validation failed")?(qt(!0),oe({title:"Apify Token Invalid",description:"Your Apify API token appears to be invalid. Please check your settings.",variant:"destructive"})):V.includes("actor run failed")?(M(`Apify scraper failed: ${V}`),oe({title:"Scraper Failed",description:"The Rightmove scraper encountered an error. Please try again later.",variant:"destructive"})):(M(V),oe({title:"Property Search Failed",description:V,variant:"destructive"}))}finally{Cs(!1)}};return e.jsxs(ce,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:Cc}}),e.jsx(Ce,{title:"Find Your Perfect Investment Property",subtitle:"Search thousands of properties to discover your next investment opportunity",onSearch:wn,showSearch:!0,height:"h-[400px]"}),e.jsxs("div",{className:"container mx-auto p-4 -mt-12 relative z-10",children:[!W&&e.jsxs("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800 border border-red-200",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Database Setup Required"}),e.jsx("p",{className:"mb-3",children:"The scraper_cache table is not set up in your Supabase database. This is needed to cache property data."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(w,{onClick:Vt,disabled:Q||pe,variant:"destructive",children:Q?e.jsx(Fe,{size:"sm"}):"Initialize Database"}),e.jsx(w,{onClick:Ht,disabled:pe||Q,variant:"outline",children:pe?e.jsx(Fe,{size:"sm"}):"Run Diagnostics"})]}),me&&e.jsx("div",{className:"mt-4 p-3 bg-white rounded border text-xs font-mono text-black overflow-auto max-h-40",children:e.jsx("pre",{children:JSON.stringify(me,null,2)})}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("p",{className:"font-semibold",children:"Manual Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal ml-5 mt-1 space-y-1",children:[e.jsx("li",{children:"Go to your Supabase dashboard"}),e.jsx("li",{children:'Navigate to the "SQL Editor" section'}),e.jsx("li",{children:"Create a new query"}),e.jsxs("li",{children:["Copy and paste the SQL from ",e.jsx("code",{children:"src/lib/migrations/fix_scraper_cache.sql"})]}),e.jsx("li",{children:"Run the query"}),e.jsx("li",{children:"Return to this page and refresh"})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ma,{})}),st&&e.jsxs("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800 border-2 border-red-300 shadow-md",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Invalid Apify API Token"}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-600",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-md",children:"The application cannot connect to the Apify API with the current token. Property searches require a valid Apify token."})})]}),e.jsxs("div",{className:"mt-4 bg-white p-4 rounded-md border border-red-200",children:[e.jsx("h4",{className:"font-bold mb-2",children:"How to Fix This Issue:"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Verify your Apify token"}),": Check that you're using the correct token from your Apify account."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Add it to your .env.local file"}),":",e.jsx("code",{className:"bg-gray-100 px-1 py-0.5 rounded ml-1",children:"VITE_APIFY_API_TOKEN=your_token_here"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Restart your dev server"}),": Using ",e.jsx("code",{className:"bg-gray-100 px-1 py-0.5 rounded",children:"npm run dev"})," or ",e.jsx("code",{className:"bg-gray-100 px-1 py-0.5 rounded",children:"yarn dev"})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 text-yellow-800 border border-yellow-200 rounded-md",children:[e.jsx("h4",{className:"font-bold",children:"About Apify"}),e.jsx("p",{className:"mt-1",children:"This application uses Apify's Rightmove Scraper to fetch property data from Rightmove. You need a valid Apify account and API token to use this feature."})]})]}),f&&f.includes("Failed to fetch")&&e.jsxs("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800 border-2 border-red-300 shadow-md",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Network Connection Error"}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-600",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-md",children:"The application failed to connect to the Apify API. This is typically a network connectivity issue."})})]}),e.jsxs("div",{className:"mt-4 bg-white p-4 rounded-md border border-red-200",children:[e.jsx("h4",{className:"font-bold mb-2",children:"How to Fix This Issue:"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Check your internet connection"}),": Ensure you have a stable internet connection."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Check your firewall settings"}),": Your firewall might be blocking connections to api.apify.com."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Try using a direct property search"}),": If you have a specific property ID, try using the direct search below."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Use the Rightmove Scraper Test"}),': Expand the Environment Debug panel and use the "Test Rightmove Scraper" button to check if the API is accessible.']})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 text-blue-800 border border-blue-200 rounded-md",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Try Direct Property ID Search"}),e.jsx("p",{className:"mb-2 text-sm",children:"Search for a specific property by ID:"}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx(G,{placeholder:"Enter Rightmove property ID (e.g. 150455012)",value:H,onChange:I=>re(I.target.value),className:"max-w-xs"}),e.jsx(w,{onClick:kn,disabled:ls,variant:"default",size:"sm",children:ls?e.jsx(Fe,{size:"sm"}):"Search Property"})]}),e.jsxs("p",{className:"mt-2 text-xs",children:['The property ID is the number in the Rightmove URL after "/properties/". Example: https://www.rightmove.co.uk/properties/',e.jsx("strong",{children:"150455012"})]})]})]}),vn&&!1,e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx("label",{className:"mb-2 block font-medium",htmlFor:"location",children:"Location"}),e.jsx(G,{id:"location",type:"text",placeholder:"e.g. London, Manchester, B16",value:x,onChange:I=>S(I.target.value),className:"w-full"})]}),!1,e.jsxs("div",{className:"w-full sm:w-1/2 md:w-32",children:[e.jsx("label",{className:"mb-2 block font-medium",htmlFor:"minPrice",children:"Min Price"}),e.jsx(G,{id:"minPrice",type:"number",placeholder:"Min Â£",value:v,onChange:I=>j(I.target.value),className:"w-full"})]}),e.jsxs("div",{className:"w-full sm:w-1/2 md:w-32",children:[e.jsx("label",{className:"mb-2 block font-medium",htmlFor:"maxPrice",children:"Max Price"}),e.jsx(G,{id:"maxPrice",type:"number",placeholder:"Max Â£",value:u,onChange:I=>b(I.target.value),className:"w-full"})]}),e.jsxs("div",{className:"w-full sm:w-1/2 md:w-32",children:[e.jsx("label",{className:"mb-2 block font-medium",htmlFor:"minBeds",children:"Min Beds"}),e.jsx(G,{id:"minBeds",type:"number",placeholder:"Min",value:A,onChange:I=>L(I.target.value),className:"w-full"})]}),e.jsxs("div",{className:"w-full sm:w-1/2 md:w-32",children:[e.jsx("label",{className:"mb-2 block font-medium",htmlFor:"maxBeds",children:"Max Beds"}),e.jsx(G,{id:"maxBeds",type:"number",placeholder:"Max",value:P,onChange:I=>T(I.target.value),className:"w-full"})]}),e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx("label",{className:"mb-2 block font-medium",htmlFor:"propertyType",children:"Property Type"}),e.jsxs("select",{id:"propertyType",value:O,onChange:I=>C(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2",children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"detached",children:"Detached"}),e.jsx("option",{value:"semi-detached",children:"Semi-Detached"}),e.jsx("option",{value:"terraced",children:"Terraced"}),e.jsx("option",{value:"flat",children:"Flat"}),e.jsx("option",{value:"bungalow",children:"Bungalow"})]})]}),e.jsx("div",{className:"flex w-full items-end md:w-auto",children:e.jsx(w,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{s||os(x)},disabled:s,children:s?"Searching...":"Search"})})]}),Z&&e.jsxs("div",{className:"mb-4 rounded-md bg-amber-50 p-4 text-amber-800 border border-amber-200",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Using Mock Data"}),e.jsxs("p",{className:"flex items-center mb-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mr-2 h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"Mock data is being displayed instead of real Rightmove properties."]}),e.jsx(ma,{}),e.jsxs("div",{className:"text-sm mt-3",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Possible reasons:"}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsxs("li",{className:"",children:["Environment variable VITE_USE_MOCK_DATA is set to 'true'",!1]}),e.jsxs("li",{className:W?"":"font-bold",children:["The scraper_cache table is not properly set up",!W&&" âœ“"]}),e.jsx("li",{children:"The Rightmove scraper encountered an error fetching property data"}),e.jsx("li",{children:"Network connectivity issues accessing Rightmove"})]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:Ht,disabled:pe,children:pe?e.jsx(Fe,{size:"sm"}):"Run Diagnostics"}),e.jsx(w,{variant:"outline",size:"sm",onClick:Vt,disabled:Q,children:Q?e.jsx(Fe,{size:"sm"}):"Initialize Database"})]})]}),tt&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-md mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-5 w-5 text-red-600",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Search Error"}),e.jsx("p",{className:"mt-1 text-sm",children:tt})]})]})}),s?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 min-h-[200px] bg-white rounded-lg shadow-md animate-fadein",children:[e.jsx("div",{className:"animate-spin h-12 w-12 border-b-2 border-blue-600 rounded-full mb-4"}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["Searching properties in ",x,"..."]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take 15-30 seconds"}),e.jsx("div",{className:"mt-4 w-64 bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full animate-pulse",style:{width:"70%"}})})]}):n.length>0?e.jsx(N.Fragment,{children:(()=>{try{return console.log("First few properties:",n.slice(0,3).map(I=>{var V,ae;return{id:I.id,address:I.address,mainImage:I.main_image_url,hasImages:I.image_urls&&I.image_urls.length>0,agentLogo:(V=I.agent)==null?void 0:V.logo_url,agentName:(ae=I.agent)==null?void 0:ae.name}})),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(I=>e.jsx("div",{children:e.jsx(Ac,{property:I,onClick:()=>Sn(I)})},I.id||Math.random().toString()))})}catch(I){return console.error("Error rendering property grid:",I),e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-md",children:[e.jsx("h3",{className:"font-bold",children:"Error Displaying Properties"}),e.jsx("p",{className:"mt-2",children:"There was an error displaying the property results. Please try refreshing the page."}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-sm",children:"Error details"}),e.jsx("pre",{className:"mt-2 text-xs p-2 bg-red-100 rounded",children:I instanceof Error?I.message:String(I)})]})]})}})()}):!tt&&x?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No properties found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try searching for a different location or adjusting your filters."})]}):null]}),i&&e.jsx(Ic,{property:i,onClose:()=>p(null),saleHistoryData:c,areaInsights:h,investmentAnalysis:m})]})}const Rc=()=>{const[s,a]=l.useState(25e4),[t,r]=l.useState(5e4),[n,o]=l.useState(4.5),[i,p]=l.useState(25),[c,g]=l.useState(null),[h,d]=l.useState(null),[m,y]=l.useState(null),x=()=>{const v=s-t,j=n/100/12,u=i*12,b=Math.pow(1+j,u),A=v*b*j/(b-1),L=A*u,P=L-v;g(A),d(L),y(P)},S=(s-t)/s*100;return e.jsxs(E,{className:"w-full",children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center text-xl font-semibold",children:[e.jsx(Nr,{className:"mr-2 h-5 w-5"}),"Mortgage Payment Calculator"]})}),e.jsx(D,{className:"grid gap-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"property-value",children:"Property Value"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",s.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"property-value",min:5e4,max:2e6,step:5e3,defaultValue:[s],onValueChange:v=>a(v[0])})]}),e.jsx(G,{type:"number",value:s,onChange:v=>a(Number(v.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"deposit",children:"Deposit"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",t.toLocaleString()," (",S.toFixed(1),"% LTV)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"deposit",min:0,max:s,step:5e3,defaultValue:[t],onValueChange:v=>r(v[0])})]}),e.jsx(G,{type:"number",value:t,onChange:v=>r(Number(v.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"interest-rate",children:"Interest Rate"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ei,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"interest-rate",min:.1,max:15,step:.1,defaultValue:[n],onValueChange:v=>o(v[0])})]}),e.jsx(G,{type:"number",value:n,onChange:v=>o(Number(v.target.value)),className:"mt-2",step:.1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"mortgage-term",children:"Mortgage Term"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i," years"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"mortgage-term",min:5,max:40,step:1,defaultValue:[i],onValueChange:v=>p(v[0])})]}),e.jsx(G,{type:"number",value:i,onChange:v=>p(Number(v.target.value)),className:"mt-2"})]}),e.jsx(w,{onClick:x,className:"w-full mt-4",children:"Calculate"})]}),e.jsxs("div",{className:"space-y-6",children:[c!==null&&e.jsxs("div",{className:"rounded-lg border p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Mortgage Summary"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Loan Amount:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",(s-t).toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Monthly Payment:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",c.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Repayment:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",h==null?void 0:h.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Interest:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",m==null?void 0:m.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-4 border-t",children:[e.jsx("div",{className:"text-muted-foreground",children:"Loan to Value (LTV):"}),e.jsxs("div",{className:"text-right font-medium",children:[S.toFixed(1),"%"]})]})]})]}),e.jsx(E,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-5",children:[e.jsx("li",{children:"A higher deposit lowers your monthly payments and improves rates."}),e.jsx("li",{children:"Shorter mortgage terms have higher monthly payments but less total interest."}),e.jsx("li",{children:"Most lenders offer better rates for LTV under 75%."}),e.jsx("li",{children:"Consider fees and early repayment charges when comparing mortgages."})]})]})})]})]})})]})},$s=l.forwardRef(({className:s,...a},t)=>e.jsx(wr,{ref:t,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(Ti,{className:k("flex items-center justify-center text-current"),children:e.jsx(Ga,{className:"h-4 w-4"})})}));$s.displayName=wr.displayName;const Ec=()=>{const[s,a]=l.useState(3e5),[t,r]=l.useState(!1),[n,o]=l.useState(!1),[i,p]=l.useState(!1),[c,g]=l.useState(null),[h,d]=l.useState([]),m=()=>{let y=[],x=0,S=[];t?y=[{start:0,end:425e3,rate:0},{start:425e3,end:625e3,rate:.05},{start:625e3,end:null,rate:.05}]:y=[{start:0,end:25e4,rate:0},{start:25e4,end:925e3,rate:.05},{start:925e3,end:15e5,rate:.1},{start:15e5,end:null,rate:.12}];const v=n?.03:0,j=i?.02:0;let u=s;y.forEach(b=>{if(u>0){const A=b.end?b.end-b.start:u,L=Math.min(u,A),P=b.rate+v+j,T=L*P;if(T>0){const O=b.end?`Â£${b.start.toLocaleString()} - Â£${b.end.toLocaleString()}`:`Over Â£${b.start.toLocaleString()}`;S.push({band:`${O} @ ${(P*100).toFixed(1)}%`,tax:T})}x+=T,u-=L}}),g(x),d(S)};return e.jsxs(E,{className:"w-full",children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center text-xl font-semibold",children:[e.jsx(Nr,{className:"mr-2 h-5 w-5"}),"Stamp Duty Land Tax Calculator"]})}),e.jsx(D,{className:"grid gap-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"property-value",children:"Property Value"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",s.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"property-value",min:4e4,max:2e6,step:5e3,defaultValue:[s],onValueChange:y=>a(y[0])})]}),e.jsx(G,{type:"number",value:s,onChange:y=>a(Number(y.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($s,{id:"first-time-buyer",checked:t,onCheckedChange:y=>{r(y===!0),y&&o(!1)}}),e.jsx(q,{htmlFor:"first-time-buyer",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"First-time buyer"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($s,{id:"additional-property",checked:n,onCheckedChange:y=>{o(y===!0),y&&r(!1)},disabled:t}),e.jsx(q,{htmlFor:"additional-property",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Additional property (3% surcharge)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($s,{id:"non-uk-resident",checked:i,onCheckedChange:y=>p(y===!0)}),e.jsx(q,{htmlFor:"non-uk-resident",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Non-UK resident (2% surcharge)"})]})]}),e.jsx(w,{onClick:m,className:"w-full mt-4",children:"Calculate Stamp Duty"})]}),e.jsxs("div",{className:"space-y-6",children:[c!==null&&e.jsxs("div",{className:"rounded-lg border p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Stamp Duty Summary"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsxs("div",{className:"text-lg font-semibold text-center",children:["Total Stamp Duty: Â£",c.toFixed(2)]})}),h.length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Breakdown:"}),h.map((y,x)=>e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:y.band}),e.jsxs("div",{className:"text-right",children:["Â£",y.tax.toFixed(2)]})]},x))]})]})]}),e.jsx(E,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Notes"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-5",children:[e.jsx("li",{children:"First-time buyers get relief on properties up to Â£625,000."}),e.jsx("li",{children:"Additional properties incur a 3% surcharge on all bands."}),e.jsx("li",{children:"Non-UK residents pay an additional 2% on all bands."}),e.jsx("li",{children:"This is for standard residential property in England and Northern Ireland."}),e.jsx("li",{children:"Different rates apply in Scotland and Wales."})]})]})})]})]})})]})},Tc=()=>{const[s,a]=l.useState(25e4),[t,r]=l.useState(1200),[n,o]=l.useState(2e3),[i,p]=l.useState(null),[c,g]=l.useState(null),h=()=>{const d=t*12,m=d/s*100,y=(d-n)/s*100;p(m),g(y)};return e.jsxs(E,{className:"w-full",children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center text-xl font-semibold",children:[e.jsx(Mi,{className:"mr-2 h-5 w-5"}),"Rental Yield Calculator"]})}),e.jsx(D,{className:"grid gap-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"property-value",children:"Property Value"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",s.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"property-value",min:5e4,max:1e6,step:5e3,defaultValue:[s],onValueChange:d=>a(d[0])})]}),e.jsx(G,{type:"number",value:s,onChange:d=>a(Number(d.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"monthly-rent",children:"Monthly Rent"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",t]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"monthly-rent",min:200,max:5e3,step:50,defaultValue:[t],onValueChange:d=>r(d[0])})]}),e.jsx(G,{type:"number",value:t,onChange:d=>r(Number(d.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"annual-expenses",children:"Annual Expenses"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",n]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"annual-expenses",min:0,max:1e4,step:100,defaultValue:[n],onValueChange:d=>o(d[0])})]}),e.jsx(G,{type:"number",value:n,onChange:d=>o(Number(d.target.value)),className:"mt-2"})]}),e.jsx(w,{onClick:h,className:"w-full mt-4",children:"Calculate Yield"})]}),e.jsxs("div",{className:"space-y-6",children:[i!==null&&e.jsxs("div",{className:"rounded-lg border p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Yield Results"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Annual Rental Income:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",(t*12).toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Annual Expenses:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",n.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-4 border-t",children:[e.jsx("div",{className:"text-muted-foreground",children:"Gross Yield:"}),e.jsxs("div",{className:"text-right font-medium",children:[i.toFixed(2),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Net Yield:"}),e.jsxs("div",{className:"text-right font-medium",children:[c.toFixed(2),"%"]})]})]})]}),e.jsx(E,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"What Makes a Good Yield?"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Below 3%:"})," Generally considered low yield"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"3-5%:"})," Average yield in expensive areas like London"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"5-7%:"})," Good yield for most UK locations"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Above 7%:"})," Excellent yield, but check location quality"]})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Remember to include all expenses when calculating net yield:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-2",children:[e.jsx("li",{children:"Management fees"}),e.jsx("li",{children:"Maintenance costs"}),e.jsx("li",{children:"Insurance"}),e.jsx("li",{children:"Service charges"}),e.jsx("li",{children:"Void periods"})]})]})]})})]})]})})]})},Mc=()=>{const[s,a]=l.useState(25e4),[t,r]=l.useState(25e3),[n,o]=l.useState(2500),[i,p]=l.useState(3e3),[c,g]=l.useState(1200),[h,d]=l.useState(2400),[m,y]=l.useState(5),[x,S]=l.useState(3),[v,j]=l.useState("cash"),[u,b]=l.useState(62500),[A,L]=l.useState(4.5),[P,T]=l.useState(25),[O,C]=l.useState(null),_=()=>{const R=v==="cash"?s+t+n+i:u+t+n+i,B=c*12;let Y=0;if(v==="mortgage"){const F=s-u,f=A/100/12,M=P*12,H=Math.pow(1+f,M);Y=F*H*f/(H-1)*12}const Z=B-h-Y,$=Z/R*100,Q=s*Math.pow(1+x/100,m);let X=0;if(v==="mortgage"){const F=s-u,f=A/100/12,M=P*12,H=F*Math.pow(1+f,M)*f/(Math.pow(1+f,M)-1);let re=F;for(let ls=0;ls<m*12;ls++){const Cs=re*f,st=H-Cs;re-=st}X=Math.max(0,re)}const W=Z*m,he=Q-s-X,me=W+he,fe=me/R*100,pe=Math.pow(1+fe/100,1/m)-1;C({totalInvestment:R,cashFlow:Z,cashOnCashReturn:$,estimatedSalePrice:Q,totalProfit:me,totalROI:fe,annualizedROI:pe*100})};return e.jsxs(E,{className:"w-full",children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center text-xl font-semibold",children:[e.jsx(Ns,{className:"mr-2 h-5 w-5"}),"Return on Investment (ROI) Calculator"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Property Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"purchase-price",children:"Purchase Price"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"purchase-price",type:"number",value:s,onChange:R=>a(Number(R.target.value)),className:"rounded-l-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"renovation-cost",children:"Renovation Cost"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"renovation-cost",type:"number",value:t,onChange:R=>r(Number(R.target.value)),className:"rounded-l-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"stamp-duty",children:"Stamp Duty"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"stamp-duty",type:"number",value:n,onChange:R=>o(Number(R.target.value)),className:"rounded-l-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"other-costs",children:"Other Costs (Legal, Survey, etc.)"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"other-costs",type:"number",value:i,onChange:R=>p(Number(R.target.value)),className:"rounded-l-none"})]})]}),e.jsx("h3",{className:"text-lg font-medium pt-4",children:"Rental Income & Expenses"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"monthly-rent",children:"Monthly Rent"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"monthly-rent",type:"number",value:c,onChange:R=>g(Number(R.target.value)),className:"rounded-l-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"annual-expenses",children:"Annual Expenses"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"annual-expenses",type:"number",value:h,onChange:R=>d(Number(R.target.value)),className:"rounded-l-none"})]})]}),e.jsx("h3",{className:"text-lg font-medium pt-4",children:"Investment Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"financing-method",children:"Financing Method"}),e.jsxs(Xe,{defaultValue:v,onValueChange:R=>j(R),children:[e.jsx(Ke,{id:"financing-method",children:e.jsx(Qe,{placeholder:"Select financing method"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"cash",children:"Cash Purchase"}),e.jsx(le,{value:"mortgage",children:"Mortgage"})]})]})]}),v==="mortgage"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"mortgage-deposit",children:"Mortgage Deposit"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"mortgage-deposit",type:"number",value:u,onChange:R=>b(Number(R.target.value)),className:"rounded-l-none"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[(u/s*100).toFixed(1),"% of purchase price"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"interest-rate",children:"Interest Rate (%)"}),e.jsx(G,{id:"interest-rate",type:"number",value:A,onChange:R=>L(Number(R.target.value)),step:.1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"mortgage-term",children:"Mortgage Term (years)"}),e.jsx(G,{id:"mortgage-term",type:"number",value:P,onChange:R=>T(Number(R.target.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"holding-period",children:"Investment Holding Period (years)"}),e.jsx(G,{id:"holding-period",type:"number",value:m,onChange:R=>y(Number(R.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"annual-appreciation",children:"Annual Property Appreciation (%)"}),e.jsx(G,{id:"annual-appreciation",type:"number",value:x,onChange:R=>S(Number(R.target.value)),step:.1})]}),e.jsx(w,{onClick:_,className:"w-full mt-4",children:"Calculate ROI"})]}),e.jsxs("div",{className:"space-y-6",children:[O&&e.jsxs("div",{className:"rounded-lg border p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-medium",children:"ROI Summary"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Investment:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",O.totalInvestment.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Annual Cash Flow:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",O.cashFlow.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Cash-on-Cash Return:"}),e.jsxs("div",{className:"text-right font-medium",children:[O.cashOnCashReturn.toFixed(2),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-4 border-t",children:[e.jsx("div",{className:"text-muted-foreground",children:"Estimated Sale Price:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",O.estimatedSalePrice.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Profit:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",O.totalProfit.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-4 border-t font-bold",children:[e.jsx("div",{children:"Total ROI:"}),e.jsxs("div",{className:"text-right",children:[O.totalROI.toFixed(2),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 font-bold",children:[e.jsx("div",{children:"Annualized ROI:"}),e.jsxs("div",{className:"text-right",children:[O.annualizedROI.toFixed(2),"%"]})]})]})]}),e.jsx(E,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"ROI Explained"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Cash-on-Cash Return:"})," Annual cash flow divided by your initial investment."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Total ROI:"})," Total profit (cash flow + equity gain) as a percentage of your investment."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Annualized ROI:"})," The yearly rate of return that would give you the total ROI over the holding period."]})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:"For buy-to-let investments, aim for:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-2",children:[e.jsx("li",{children:"Cash-on-Cash Return: 5-8%"}),e.jsx("li",{children:"Total ROI: 40%+ over 5 years"}),e.jsx("li",{children:"Annualized ROI: 7%+"})]})]})]})})]})]})})]})},Dc=()=>{const[s,a]=l.useState(6e4),[t,r]=l.useState(0),[n,o]=l.useState(4e4),[i,p]=l.useState(500),[c,g]=l.useState(4.5),[h,d]=l.useState(25),[m,y]=l.useState(4.5),[x,S]=l.useState(null),v=()=>{const j=s+t,u=j*m,b=u+n,A=c/100/12,L=h*12,P=Math.pow(1+A,L),T=u*P*A/(P-1),O=j/12,C=T/O*100,_=(c+3)/100/12,R=Math.pow(1+_,L),B=u*R*_/(R-1);S({maxMortgage:u,maxPropertyPrice:b,monthlyPayment:T,affordabilityRatio:C,stressTestedPayment:B})};return e.jsxs(E,{className:"w-full",children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center text-xl font-semibold",children:[e.jsx(Sr,{className:"mr-2 h-5 w-5"}),"Mortgage Affordability Calculator"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Income Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"annual-income",children:"Your Annual Income"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",s.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"annual-income",min:1e4,max:2e5,step:1e3,defaultValue:[s],onValueChange:j=>a(j[0])})]}),e.jsx(G,{type:"number",value:s,onChange:j=>a(Number(j.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"additional-income",children:"Additional Annual Income (e.g., partner)"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"additional-income",type:"number",value:t,onChange:j=>r(Number(j.target.value)),className:"rounded-l-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"deposit",children:"Deposit Available"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Â£",n.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Se,{id:"deposit",min:0,max:2e5,step:5e3,defaultValue:[n],onValueChange:j=>o(j[0])})]}),e.jsx(G,{type:"number",value:n,onChange:j=>o(Number(j.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"monthly-debts",children:"Monthly Debt Payments"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"flex items-center bg-muted px-3 rounded-l-md",children:"Â£"}),e.jsx(G,{id:"monthly-debts",type:"number",value:i,onChange:j=>p(Number(j.target.value)),className:"rounded-l-none"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Include credit cards, loans, car finance, etc."})]}),e.jsx("h3",{className:"text-lg font-medium pt-4",children:"Mortgage Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"interest-rate",children:"Interest Rate (%)"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[c,"%"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Se,{id:"interest-rate",min:1,max:10,step:.1,defaultValue:[c],onValueChange:j=>g(j[0])})}),e.jsx(G,{type:"number",value:c,onChange:j=>g(Number(j.target.value)),className:"mt-2",step:.1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(q,{htmlFor:"mortgage-term",children:"Mortgage Term (years)"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[h," years"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Se,{id:"mortgage-term",min:5,max:40,step:1,defaultValue:[h],onValueChange:j=>d(j[0])})}),e.jsx(G,{type:"number",value:h,onChange:j=>d(Number(j.target.value)),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"loan-to-income",children:"Loan to Income Multiple"}),e.jsxs(Xe,{defaultValue:m.toString(),onValueChange:j=>y(Number(j)),children:[e.jsx(Ke,{id:"loan-to-income",children:e.jsx(Qe,{placeholder:"Select loan to income multiple"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"4",children:"4.0x income"}),e.jsx(le,{value:"4.5",children:"4.5x income"}),e.jsx(le,{value:"5",children:"5.0x income"}),e.jsx(le,{value:"5.5",children:"5.5x income"}),e.jsx(le,{value:"6",children:"6.0x income"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Lenders typically offer between 4-6x your annual income"})]}),e.jsx(w,{onClick:v,className:"w-full mt-4",children:"Calculate Affordability"})]}),e.jsxs("div",{className:"space-y-6",children:[x&&e.jsxs("div",{className:"rounded-lg border p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Affordability Results"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center py-4 border-b",children:[e.jsx("div",{className:"text-muted-foreground text-sm",children:"Maximum Property Price"}),e.jsxs("div",{className:"text-3xl font-bold mt-1",children:["Â£",x.maxPropertyPrice.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Maximum Mortgage:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",x.maxMortgage.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Monthly Payment:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",x.monthlyPayment.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Affordability Ratio:"}),e.jsxs("div",{className:"text-right font-medium",children:[x.affordabilityRatio.toFixed(1),"%",e.jsx("span",{className:`ml-2 px-2 py-0.5 text-xs rounded-full ${x.affordabilityRatio<=35?"bg-green-100 text-green-800":x.affordabilityRatio<=45?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:x.affordabilityRatio<=35?"Good":x.affordabilityRatio<=45?"Moderate":"High"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-4 border-t",children:[e.jsx("div",{className:"text-muted-foreground",children:"Stress Tested Payment:"}),e.jsxs("div",{className:"text-right font-medium",children:["Â£",x.stressTestedPayment.toFixed(2)]}),e.jsx("div",{className:"col-span-2 text-xs text-muted-foreground",children:"(Monthly payment if rates increase by 3%)"})]})]})]}),e.jsx(E,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Lender Requirements"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground list-disc pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affordability Ratio:"})," Most lenders prefer this to be below 35% of your gross monthly income."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Debt-to-Income Ratio:"})," Your total debt payments (including mortgage) should ideally be below 45% of income."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Stress Testing:"})," Lenders will check if you can afford payments if interest rates rise by 3%."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deposit:"})," Higher deposits (15%+) typically secure better interest rates."]})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium",children:"Additional costs to consider:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-2",children:[e.jsx("li",{children:"Stamp Duty Land Tax"}),e.jsx("li",{children:"Legal fees (typically Â£1,000-Â£1,500)"}),e.jsx("li",{children:"Surveyor fees (Â£400-Â£1,500)"}),e.jsx("li",{children:"Mortgage arrangement fees (Â£0-Â£2,000)"}),e.jsx("li",{children:"Moving costs"})]})]})]})})]})]})})]})},Fc=()=>(l.useEffect(()=>{console.log("Calculators page mounted - HeroSection should render")},[]),e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx("div",{className:"w-full",children:e.jsx(Ce,{title:"Property Investment Calculators",subtitle:"Powerful tools to analyze investments, calculate mortgage payments, and estimate potential returns",showSearch:!1,showStats:!1,height:"h-[400px]"})}),e.jsx("div",{className:"container mx-auto px-4 py-12 mt-6",children:e.jsxs(es,{defaultValue:"mortgage",className:"w-full",children:[e.jsx(ss,{className:"w-full mb-8",children:e.jsxs("div",{className:"grid w-full grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-2",children:[e.jsx(ge,{value:"mortgage",className:"w-full",children:"Mortgage"}),e.jsx(ge,{value:"stampduty",className:"w-full",children:"Stamp Duty"}),e.jsx(ge,{value:"yield",className:"w-full",children:"Rental Yield"}),e.jsx(ge,{value:"roi",className:"w-full",children:"ROI"}),e.jsx(ge,{value:"affordability",className:"w-full",children:"Affordability"})]})}),e.jsx(de,{value:"mortgage",className:"mt-6",children:e.jsx(Rc,{})}),e.jsx(de,{value:"stampduty",className:"mt-6",children:e.jsx(Ec,{})}),e.jsx(de,{value:"yield",className:"mt-6",children:e.jsx(Tc,{})}),e.jsx(de,{value:"roi",className:"mt-6",children:e.jsx(Mc,{})}),e.jsx(de,{value:"affordability",className:"mt-6",children:e.jsx(Dc,{})})]})})]})),ua=[{id:1,title:"UK Property Market Outlook 2024",slug:"uk-property-market-outlook-2024",summary:"Comprehensive analysis of the UK property market trends, investment opportunities, and forecasts for 2024.",content:`
      <h2>Executive Summary</h2>
      <p>The UK property market in 2024 continues to demonstrate resilience despite economic challenges. This report provides a comprehensive analysis of current trends, regional variations, and forecasts for the remainder of the year.</p>
      
      <h2>Market Overview</h2>
      <p>UK house prices have shown moderate growth of 2.3% year-on-year, with significant regional variations. The market has stabilized following the volatility of previous years, with transaction volumes returning to pre-pandemic levels.</p>
      
      <h3>Key Findings</h3>
      <ul>
        <li>Average UK house price stands at Â£289,950 as of May 2024</li>
        <li>Northern regions continue to outperform London and the South East</li>
        <li>First-time buyer activity has increased by 7% compared to 2023</li>
        <li>Rental yields remain robust at national average of 5.5%</li>
      </ul>
      
      <h2>Regional Analysis</h2>
      <p>The North West remains the strongest performing region with annual price growth of 4.8%. Liverpool and Manchester continue to lead with strong rental yields exceeding 7% in some areas. London has shown minimal growth at 0.2%, though prime central areas have begun to recover.</p>
      
      <h2>Investment Opportunities</h2>
      <p>Based on our analysis, we identify several key opportunity areas for property investors:</p>
      <ol>
        <li>Northern city regeneration zones, particularly in Leeds and Sheffield</li>
        <li>Commuter belt towns with improved transport links</li>
        <li>University cities with strong student rental demand</li>
        <li>Coastal locations with growing demand from remote workers</li>
      </ol>
      
      <h2>Forecast and Recommendations</h2>
      <p>We project continued moderate growth of 3-4% nationally for the remainder of 2024, with the potential for stronger performance in regional hotspots. Interest rates are expected to stabilize, potentially decreasing in Q4, which may stimulate additional market activity.</p>
      
      <p>For investors, we recommend focusing on areas with strong fundamentals: employment growth, infrastructure improvements, and demographic advantages. Diversification across regions and property types remains advisable in the current market.</p>
    `,date:"2024-05-15",author:"Property Analysis Team",authorBio:"Our Property Analysis Team consists of economists, data scientists, and real estate professionals with decades of combined experience in the UK property market.",category:"Market Analysis",readTime:"12 min read",isPremium:!0,relatedReports:[2,3],coverImage:"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8aG91c2V8ZW58MHx8MHx8&ixlib=rb-1.2.1&w=1000&q=80"},{id:2,title:"Regional Investment Hotspots",slug:"regional-investment-hotspots",summary:"Detailed report on emerging regional investment opportunities across the UK, with focus on yields and growth potential.",content:`
      <h2>Executive Summary</h2>
      <p>This report identifies and analyzes emerging investment hotspots across UK regions, focusing on areas with strong yield potential and capital growth prospects.</p>
      
      <h2>Methodology</h2>
      <p>Our analysis combines economic data, infrastructure developments, demographic trends, and rental yield calculations to identify areas with the strongest investment potential.</p>
      
      <h2>Top Investment Locations</h2>
      <h3>1. Liverpool - Merseyside</h3>
      <p>Liverpool continues to offer some of the highest rental yields in the UK, averaging 7.2%. Regeneration projects and growing employment opportunities make this a prime investment location.</p>
      
      <h3>2. Manchester - Greater Manchester</h3>
      <p>With significant job creation in technology and media sectors, Manchester maintains strong rental demand and price growth potential. Average yields stand at 6.7%.</p>
      
      <h3>3. Leeds - West Yorkshire</h3>
      <p>Substantial infrastructure investment and a growing financial sector support Leeds' position as a key northern investment hub, with yields averaging 6.1%.</p>
      
      <h3>4. Birmingham - West Midlands</h3>
      <p>The ongoing HS2 development and city center regeneration continue to boost Birmingham's investment appeal, with rental yields of 5.5%.</p>
      
      <h3>5. Glasgow - Scotland</h3>
      <p>Offering a compelling combination of affordable property prices and strong rental demand, Glasgow presents excellent value for investors with yields around 5.8%.</p>
      
      <h2>Emerging Areas to Watch</h2>
      <p>Besides established hotspots, we've identified several emerging areas showing strong investment potential:</p>
      <ul>
        <li>Sheffield - South Yorkshire</li>
        <li>Nottingham - East Midlands</li>
        <li>Preston - Lancashire</li>
        <li>Swansea - Wales</li>
      </ul>
      
      <h2>Conclusion and Outlook</h2>
      <p>Regional cities continue to offer superior yield potential compared to London and the South East. The leveling up agenda and infrastructure improvements are likely to sustain this trend, making northern and midland cities particularly attractive for investors focused on rental returns.</p>
    `,date:"2024-04-22",author:"Investment Research Division",authorBio:"The Investment Research Division specializes in analyzing property investment trends and identifying high-potential opportunities across the UK and international markets.",category:"Investment",readTime:"15 min read",isPremium:!0,relatedReports:[1,3],coverImage:"https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8cHJvcGVydHl8ZW58MHx8MHx8&ixlib=rb-1.2.1&w=1000&q=80"},{id:3,title:"First-Time Buyer Guide 2024",slug:"first-time-buyer-guide-2024",summary:"Essential information and advice for first-time buyers navigating the property market in 2024.",content:`
      <h2>Introduction</h2>
      <p>Buying your first home is both exciting and challenging. This guide provides first-time buyers with essential information and practical advice for navigating the property market in 2024.</p>
      
      <h2>Current Market Conditions for First-Time Buyers</h2>
      <p>The 2024 market presents a mixed picture for first-time buyers. While price growth has moderated to 2.3% nationally, affordability remains challenging in many areas. However, various government schemes and competitive mortgage products designed specifically for first-time buyers offer valuable support.</p>
      
      <h2>Financial Preparation</h2>
      <h3>Saving for a Deposit</h3>
      <p>The average first-time buyer deposit currently stands at Â£53,000, though this varies significantly by region. We recommend:</p>
      <ul>
        <li>Setting up a dedicated savings account</li>
        <li>Considering a Lifetime ISA to benefit from government bonuses</li>
        <li>Exploring family support options including gifted deposits</li>
      </ul>
      
      <h3>Mortgage Options</h3>
      <p>Several mortgage products cater specifically to first-time buyers:</p>
      <ul>
        <li>95% LTV mortgages with government guarantees</li>
        <li>Longer-term mortgages (up to 35 years) to improve affordability</li>
        <li>Joint borrower sole proprietor mortgages for family assistance</li>
        <li>Green mortgages offering preferential rates for energy-efficient properties</li>
      </ul>
      
      <h2>Government Schemes</h2>
      <p>Several programs exist to help first-time buyers:</p>
      <ul>
        <li>First Homes scheme - discounted properties for local first-time buyers</li>
        <li>Shared Ownership - buy a portion of a property and pay rent on the remainder</li>
        <li>Help to Build - support for self-builders and custom home projects</li>
      </ul>
      
      <h2>The Buying Process</h2>
      <ol>
        <li>Establish your budget and secure a mortgage in principle</li>
        <li>Research areas and property types within your price range</li>
        <li>View properties and make an offer</li>
        <li>Instruct a solicitor and arrange surveys</li>
        <li>Exchange contracts and complete the purchase</li>
      </ol>
      
      <h2>Common Pitfalls to Avoid</h2>
      <p>First-time buyers should be aware of these common mistakes:</p>
      <ul>
        <li>Overlooking additional costs such as stamp duty, legal fees, and moving expenses</li>
        <li>Neglecting to research the local area thoroughly</li>
        <li>Skipping professional surveys to save money</li>
        <li>Stretching finances too thin without maintaining a financial cushion</li>
      </ul>
      
      <h2>Conclusion</h2>
      <p>While the process of buying your first home can seem daunting, careful preparation and the right support can make it manageable. Current market conditions offer a balanced environment for first-time buyers, with various support mechanisms available to help you take that important first step onto the property ladder.</p>
    `,date:"2024-03-10",author:"Homebuyer Advisory Team",authorBio:"Our Homebuyer Advisory Team specializes in providing practical guidance to first-time buyers and those navigating the property market.",category:"Guides",readTime:"10 min read",isPremium:!1,relatedReports:[1,2],coverImage:"https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8aG9tZSUyMGtleXN8ZW58MHx8MHx8&w=1000&q=80"}],Lc=()=>{const{slug:s}=kr(),{user:a,profile:t}=ee(),r=be(),[n,o]=l.useState(null),[i,p]=l.useState(!0),[c,g]=l.useState(!1),[h,d]=l.useState([]),m=(t==null?void 0:t.subscription_tier)!=="free";if(l.useEffect(()=>{s&&(async()=>{p(!0);try{setTimeout(()=>{const S=ua.find(v=>v.slug===s);if(o(S||null),S!=null&&S.relatedReports){const v=ua.filter(j=>S.relatedReports.includes(j.id)&&j.id!==S.id);d(v)}p(!1)},800)}catch(S){console.error("Error fetching report:",S),p(!1)}})()},[s]),i)return e.jsx(ce,{children:e.jsx(ke,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/4 mb-8"}),e.jsx("div",{className:"h-64 bg-muted rounded mb-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-muted rounded"}),e.jsx("div",{className:"h-4 bg-muted rounded"}),e.jsx("div",{className:"h-4 bg-muted rounded w-5/6"})]})]})})})})});if(!n)return e.jsx(ce,{children:e.jsx(ke,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[e.jsx(ve,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Report Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"The report you're looking for doesn't exist or has been removed."}),e.jsx(w,{onClick:()=>r("/research"),children:"Return to Research"})]})})})});const y=!n.isPremium||m;return e.jsxs(ce,{children:[e.jsx(ke,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs(w,{variant:"outline",size:"sm",className:"mb-6",onClick:()=>r("/research"),children:[e.jsx(br,{className:"h-4 w-4 mr-2"}),"Back to Research"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold mb-4",children:n.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(We,{className:"h-4 w-4 mr-1"}),ts(new Date(n.date))]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(Cr,{className:"h-4 w-4 mr-1"}),n.author]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(It,{className:"h-4 w-4 mr-1"}),n.category]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),n.readTime]})]}),e.jsx("div",{className:"relative aspect-[16/9] rounded-lg overflow-hidden mb-8",children:e.jsx("img",{src:n.coverImage,alt:n.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"text-lg mb-6",children:e.jsx("p",{className:"font-medium",children:n.summary})}),y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:n.content}}),e.jsxs("div",{className:"flex justify-between items-center mt-12 pt-6 border-t",children:[e.jsxs(w,{variant:"outline",onClick:()=>window.print(),children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(w,{variant:"outline",size:"icon",children:e.jsx(Di,{className:"h-4 w-4"})}),e.jsx(w,{variant:"outline",size:"icon",children:e.jsx(Fi,{className:"h-4 w-4"})})]})]})]}):e.jsxs("div",{className:"bg-muted p-8 rounded-lg text-center my-12",children:[e.jsx(Li,{className:"h-12 w-12 mx-auto text-primary mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Premium Content"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"This research report is available exclusively to Pro and Premium subscribers."}),e.jsx(w,{onClick:()=>g(!0),children:"Upgrade to Access"})]})]}),e.jsxs("div",{className:"border-t border-b py-6 my-8",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"About the Author"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.authorBio})]}),h.length>0&&e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Related Reports"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:h.map(x=>e.jsxs("div",{className:"border rounded-lg p-4 hover:border-primary transition-colors cursor-pointer",onClick:()=>r(`/research/reports/${x.slug}`),children:[e.jsx("h4",{className:"font-medium mb-2",children:x.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:x.summary}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(We,{className:"h-3 w-3 mr-1"}),ts(new Date(x.date))]})]},x.id))})]})]})})}),e.jsx(Qs,{isOpen:c,onClose:()=>g(!1),currentUser:a,userProfile:t})]})},Oc=us.object({email:us.string().email({message:"Please enter a valid email address"})});function $c(){const{toast:s}=_e();be(),ee();const[a,t]=l.useState(!1),[r,n]=l.useState(!1),[o,i]=l.useState(!1),[p,c]=l.useState(""),[g,h]=l.useState(""),[d,m]=l.useState(!1),{register:y,handleSubmit:x,formState:{errors:S}}=Ir({resolver:Ar(Oc)}),v=async u=>{t(!0);try{const{error:b}=await U.from("waitlist").insert([{email:u.email,signed_up_at:new Date().toISOString()}]);b?b.code==="23505"?s({title:"You're already on the waitlist",description:"We already have your email on our waitlist. We'll notify you when you're invited to the alpha.",variant:"default"}):(console.error("Error submitting to waitlist:",b),s({title:"Submission error",description:"There was a problem adding you to the waitlist. Please try again.",variant:"destructive"})):(n(!0),s({title:"You're on the list!",description:"Thanks for joining our waitlist. We'll notify you when you're invited to the alpha.",variant:"default"}))}catch(b){console.error("Submission error:",b),s({title:"Submission error",description:"There was a problem adding you to the waitlist. Please try again.",variant:"destructive"})}finally{t(!1)}},j=async u=>{if(u.preventDefault(),!p||!g){s({title:"Missing information",description:"Please enter both email and password.",variant:"destructive"});return}try{m(!0);const{data:b,error:A}=await U.auth.signInWithPassword({email:p,password:g,options:{persistSession:!0}});if(A)throw A;s({title:"Signed in successfully",description:"Welcome to VGE Alpha.",variant:"default"}),localStorage.setItem("vge_user_authenticated","true"),localStorage.setItem("vge_auth_timestamp",Date.now().toString()),console.log("Login success, session established:",!!b.session),window.location.href="/"}catch(b){console.error("Sign in error:",b),s({title:"Authentication error",description:b.message||"There was a problem signing in. Please try again.",variant:"destructive"})}finally{m(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("header",{className:"border-b border-border py-4 px-6",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"h-8 mr-2",children:e.jsx("img",{src:"/logo.svg",alt:"VGE Alpha",className:"h-full",onError:u=>{const b=u.target;b.style.display="none",b.parentElement.innerHTML+='<span class="font-bold text-2xl text-primary">VGE Alpha</span>'}})})}),e.jsx(w,{variant:"ghost",onClick:()=>i(!o),size:"sm",children:o?"Hide Developer Access":"Developer Access"})]})}),e.jsx("main",{className:"flex-grow container mx-auto px-4 py-10 flex flex-col items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-10 items-start",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground leading-tight",children:"Property Investment Analytics Platform"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Discover high-yield investment properties, analyze market trends, and make data-driven decisions."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"p-6 border-muted shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-foreground",children:r?"Thanks for joining our waitlist!":"Join our waitlist"}),r?e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Sr,{className:"h-8 w-8 text-primary"})}),e.jsx("p",{className:"text-muted-foreground",children:"We've added your email to our waitlist. We'll notify you when you're invited to try out our platform."})]}):e.jsxs("form",{onSubmit:x(v),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(fr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(G,{id:"email",placeholder:"you@example.com",className:"pl-10",autoComplete:"email",...y("email")})]}),S.email&&e.jsx("p",{className:"text-sm text-destructive",children:S.email.message})]}),e.jsxs(w,{type:"submit",className:"w-full",disabled:a,children:[a?"Submitting...":"Join Waitlist",e.jsx(Oi,{className:"ml-2 h-4 w-4"})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-2",children:"We'll notify you when you're invited to our alpha release."})]})]}),o&&e.jsxs(E,{className:"p-6 border-muted bg-muted/30 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 text-foreground flex items-center",children:[e.jsx($i,{className:"mr-2 h-5 w-5 text-yellow-500"}),"Developer Access"]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"loginEmail",children:"Email"}),e.jsx(G,{id:"loginEmail",type:"email",placeholder:"developer@vgealpha.com",autoComplete:"email",value:p,onChange:u=>c(u.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"loginPassword",children:"Password"}),e.jsx(G,{id:"loginPassword",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"current-password",value:g,onChange:u=>h(u.target.value),required:!0})]}),e.jsx(w,{type:"submit",className:"w-full",disabled:d,children:d?"Signing in...":"Sign in with Email"})]})]})]}),e.jsx("div",{className:"md:hidden mt-10",children:e.jsxs(E,{className:"p-6 border-muted",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Platform Features"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(qe,{title:"Property Analytics",description:"Comprehensive analysis of potential investments",color:"bg-blue-500"}),e.jsx(qe,{title:"Market Trends",description:"Up-to-date information on property market changes",color:"bg-green-500"}),e.jsx(qe,{title:"Investment ROI",description:"Calculate potential returns on property investments",color:"bg-purple-500"}),e.jsx(qe,{title:"AI Recommendations",description:"Smart suggestions based on your investment criteria",color:"bg-orange-500"})]})]})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"relative rounded-lg overflow-hidden border border-border shadow-md",children:e.jsxs("div",{className:"aspect-video bg-muted p-6 flex flex-col justify-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Features"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(qe,{title:"Property Analytics",description:"Comprehensive analysis of potential investments",color:"bg-blue-500"}),e.jsx(qe,{title:"Market Trends",description:"Up-to-date information on property market changes",color:"bg-green-500"}),e.jsx(qe,{title:"Investment ROI",description:"Calculate potential returns on property investments",color:"bg-purple-500"}),e.jsx(qe,{title:"AI Recommendations",description:"Smart suggestions based on your investment criteria",color:"bg-orange-500"})]})]})})})]})})]})}function qe({title:s,description:a,color:t}){return e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`${t} h-5 w-1 rounded-full mt-1`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a})]})]})}const un=()=>{const{user:s}=ee(),[a,t]=l.useState(!0),[r,n]=l.useState([]),[o,i]=l.useState(null),p=async()=>{if(s)try{t(!0),i(null);const{data:y,error:x}=await U.from("report_requests").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(x)throw x;const{data:S,error:v}=await U.from("profiles").select("id, full_name, email").eq("id",s.id).single();v&&console.warn("Error fetching profile data:",v);const j=y.map(u=>({...u,profiles:S?{full_name:S.full_name,email:S.email}:null}));n(j)}catch(y){console.error("Error fetching report requests:",y),i(y.message||"Failed to load report requests")}finally{t(!1)}},c=async(y,x)=>{if(!s)return null;try{t(!0),i(null);const{data:S,error:v}=await U.from("report_requests").insert([{user_id:s.id,title:y,description:x}]).select("*").single();if(v)throw v;return await p(),S}catch(S){return console.error("Error creating report request:",S),i(S.message||"Failed to create report request"),null}finally{t(!1)}},g=async y=>{try{t(!0),i(null);const{data:x,error:S}=await U.from("report_requests").select("file_url, file_name").eq("id",y).eq("user_id",s==null?void 0:s.id).single();if(S)throw S;if(!(x!=null&&x.file_url))throw new Error("No file is available for download");const v=document.createElement("a");return v.href=x.file_url,v.download=x.file_name||"report.pdf",document.body.appendChild(v),v.click(),document.body.removeChild(v),!0}catch(x){return console.error("Error downloading report:",x),i(x.message||"Failed to download report"),!1}finally{t(!1)}},h=async()=>{if(!s)return[];try{t(!0),i(null);const{data:y,error:x}=await U.from("report_requests").select("*").order("created_at",{ascending:!1});if(x)throw x;const{data:S,error:v}=await U.from("profiles").select("id, full_name, email");v&&console.warn("Error fetching profiles data:",v);const j=(S||[]).reduce((b,A)=>(A.id&&(b[A.id]=A),b),{});return y.map(b=>({...b,profiles:b.user_id&&j[b.user_id]?{full_name:j[b.user_id].full_name,email:j[b.user_id].email}:null}))}catch(y){return console.error("Error fetching all report requests:",y),i(y.message||"Failed to load all report requests"),[]}finally{t(!1)}},d=async(y,x,S)=>{try{t(!0),i(null);const v={status:x};S&&(v.notes=S),x==="completed"&&(v.completed_at=new Date().toISOString());const{error:j}=await U.from("report_requests").update(v).eq("id",y);if(j)throw j;return await p(),!0}catch(v){return console.error("Error updating report status:",v),i(v.message||"Failed to update report status"),!1}finally{t(!1)}},m=async(y,x)=>{if(!s)return!1;try{t(!0),i(null);const S=x.name.split(".").pop(),v=`${y}-${Date.now()}.${S}`,j=`${s.id}/${v}`,{error:u}=await U.storage.from("report_files").upload(j,x,{cacheControl:"3600",upsert:!0});if(u)throw u;const{data:{publicUrl:b}}=U.storage.from("report_files").getPublicUrl(j),{error:A}=await U.from("report_requests").update({file_url:b,file_name:x.name,status:"completed",completed_at:new Date().toISOString()}).eq("id",y);if(A)throw A;return await p(),!0}catch(S){return console.error("Error uploading report file:",S),i(S.message||"Failed to upload report file"),!1}finally{t(!1)}};return l.useEffect(()=>{s&&p()},[s]),{reports:r,loading:a,error:o,fetchReportRequests:p,createReportRequest:c,downloadReport:g,getAllReportRequests:h,updateReportStatus:d,uploadReportFile:m}},Mt=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:k("w-full caption-bottom text-sm",s),...a})}));Mt.displayName="Table";const Dt=l.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:k("[&_tr]:border-b",s),...a}));Dt.displayName="TableHeader";const Ft=l.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:k("[&_tr:last-child]:border-0",s),...a}));Ft.displayName="TableBody";const Uc=l.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:k("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));Uc.displayName="TableFooter";const ys=l.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:k("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));ys.displayName="TableRow";const Le=l.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:k("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Le.displayName="TableHead";const Oe=l.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:k("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Oe.displayName="TableCell";const Lt=l.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:k("mt-4 text-sm text-muted-foreground",s),...a}));Lt.displayName="TableCaption";const hn=zi,xn=Bi,zc=Ui,pn=l.forwardRef(({className:s,...a},t)=>e.jsx(Pr,{className:k("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));pn.displayName=Pr.displayName;const Ot=l.forwardRef(({className:s,...a},t)=>e.jsxs(zc,{children:[e.jsx(pn,{}),e.jsx(_r,{ref:t,className:k("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));Ot.displayName=_r.displayName;const $t=({className:s,...a})=>e.jsx("div",{className:k("flex flex-col space-y-2 text-center sm:text-left",s),...a});$t.displayName="AlertDialogHeader";const Ut=({className:s,...a})=>e.jsx("div",{className:k("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Ut.displayName="AlertDialogFooter";const zt=l.forwardRef(({className:s,...a},t)=>e.jsx(Rr,{ref:t,className:k("text-lg font-semibold",s),...a}));zt.displayName=Rr.displayName;const Bt=l.forwardRef(({className:s,...a},t)=>e.jsx(Er,{ref:t,className:k("text-sm text-muted-foreground",s),...a}));Bt.displayName=Er.displayName;const gn=l.forwardRef(({className:s,...a},t)=>e.jsx(Tr,{ref:t,className:k(At(),s),...a}));gn.displayName=Tr.displayName;const Gt=l.forwardRef(({className:s,...a},t)=>e.jsx(Mr,{ref:t,className:k(At({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));Gt.displayName=Mr.displayName;const Bc=qi,fn=l.createContext({}),ha=({...s})=>e.jsx(fn.Provider,{value:{name:s.name},children:e.jsx(Vi,{...s})}),et=()=>{const s=l.useContext(fn),a=l.useContext(jn),{getFieldState:t,formState:r}=Gi(),n=t(s.name,r);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:o}=a;return{id:o,name:s.name,formItemId:`${o}-form-item`,formDescriptionId:`${o}-form-item-description`,formMessageId:`${o}-form-item-message`,...n}},jn=l.createContext({}),vt=l.forwardRef(({className:s,...a},t)=>{const r=l.useId();return e.jsx(jn.Provider,{value:{id:r},children:e.jsx("div",{ref:t,className:k("space-y-2",s),...a})})});vt.displayName="FormItem";const yt=l.forwardRef(({className:s,...a},t)=>{const{error:r,formItemId:n}=et();return e.jsx(q,{ref:t,className:k(r&&"text-destructive",s),htmlFor:n,...a})});yt.displayName="FormLabel";const bt=l.forwardRef(({...s},a)=>{const{error:t,formItemId:r,formDescriptionId:n,formMessageId:o}=et();return e.jsx(Sa,{ref:a,id:r,"aria-describedby":t?`${n} ${o}`:`${n}`,"aria-invalid":!!t,...s})});bt.displayName="FormControl";const Nt=l.forwardRef(({className:s,...a},t)=>{const{formDescriptionId:r}=et();return e.jsx("p",{ref:t,id:r,className:k("text-[0.8rem] text-muted-foreground",s),...a})});Nt.displayName="FormDescription";const wt=l.forwardRef(({className:s,children:a,...t},r)=>{const{error:n,formMessageId:o}=et(),i=n?String(n==null?void 0:n.message):a;return i?e.jsx("p",{ref:r,id:o,className:k("text-[0.8rem] font-medium text-destructive",s),...t,children:i}):null});wt.displayName="FormMessage";const Gc=us.object({title:us.string().min(3,"Title must be at least 3 characters").max(100,"Title cannot exceed 100 characters"),description:us.string().min(10,"Description must be at least 10 characters").max(2e3,"Description cannot exceed 2000 characters")});function qc(){const{user:s,profile:a}=ee(),{reports:t,loading:r,error:n,createReportRequest:o,downloadReport:i}=un(),[p,c]=l.useState(!1),[g,h]=l.useState(!1),{toast:d}=_e(),m=Ir({resolver:Ar(Gc),defaultValues:{title:"",description:""}}),y=async v=>{if(!s){d({title:"Authentication required",description:"You must be logged in to request a report.",variant:"destructive"});return}try{if(h(!0),await o(v.title,v.description))d({title:"Report request submitted",description:"Your research report request has been submitted successfully."}),m.reset(),c(!1);else throw new Error("Failed to create report request")}catch(j){d({title:"Error submitting request",description:j.message||"There was a problem submitting your request. Please try again.",variant:"destructive"})}finally{h(!1)}},x=async v=>{try{await i(v)||d({title:"Download failed",description:"The report file couldn't be downloaded. Please try again later.",variant:"destructive"})}catch(j){d({title:"Error downloading report",description:j.message||"There was a problem downloading the report. Please try again.",variant:"destructive"})}},S=v=>{switch(v){case"completed":return e.jsx(te,{className:"bg-green-500",children:"Completed"});case"in_progress":return e.jsx(te,{className:"bg-blue-500",children:"In Progress"});case"rejected":return e.jsx(te,{className:"bg-red-500",children:"Rejected"});case"pending":default:return e.jsx(te,{className:"bg-yellow-500",children:"Pending"})}};return s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto py-10 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Research & Reports"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Request custom research reports for your property investment analysis"})]}),e.jsxs(Ee,{open:p,onOpenChange:c,children:[e.jsx(Zr,{asChild:!0,children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Hi,{size:16}),e.jsx("span",{children:"Request New Report"})]})}),e.jsxs(Ie,{className:"sm:max-w-[500px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"Request a Research Report"}),e.jsx(Ge,{children:"Provide details about the research report you need for your property investment analysis."})]}),e.jsx(Bc,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(y),className:"space-y-4",children:[e.jsx(ha,{control:m.control,name:"title",render:({field:v})=>e.jsxs(vt,{children:[e.jsx(yt,{children:"Report Title"}),e.jsx(bt,{children:e.jsx(G,{placeholder:"e.g., Manchester Rental Market Analysis",...v})}),e.jsx(Nt,{children:"A clear title describing the report you need"}),e.jsx(wt,{})]})}),e.jsx(ha,{control:m.control,name:"description",render:({field:v})=>e.jsxs(vt,{children:[e.jsx(yt,{children:"Description"}),e.jsx(bt,{children:e.jsx(ks,{placeholder:"Please describe in detail what information you need in this report...",className:"min-h-[120px]",...v})}),e.jsx(Nt,{children:"Be specific about the property types, locations, and metrics you want analyzed"}),e.jsx(wt,{})]})}),e.jsxs(ns,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(w,{type:"submit",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Request"})]})]})})]})]})]}),e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(K,{children:"Your Report Requests"}),e.jsx(Ze,{children:"View the status of your research report requests"})]}),e.jsx(D,{children:r?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(fs,{className:"h-8 w-8 animate-spin text-primary"})}):n?e.jsxs("div",{className:"text-center py-10 text-red-600",children:[e.jsx(kt,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:n})]}):t.length===0?e.jsxs("div",{className:"text-center py-10 text-muted-foreground",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:"No report requests yet"}),e.jsx("p",{className:"mt-1",children:"Request your first research report to get started"})]}):e.jsxs(Mt,{children:[e.jsx(Lt,{children:"List of your report requests"}),e.jsx(Dt,{children:e.jsxs(ys,{children:[e.jsx(Le,{children:"Title"}),e.jsx(Le,{children:"Requested"}),e.jsx(Le,{children:"Status"}),e.jsx(Le,{className:"text-right",children:"Actions"})]})}),e.jsx(Ft,{children:t.map(v=>e.jsxs(ys,{children:[e.jsx(Oe,{className:"font-medium max-w-[280px] truncate",children:v.title}),e.jsx(Oe,{className:"text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(rs,{size:14}),e.jsx("span",{children:gs(new Date(v.created_at),{addSuffix:!0})})]})}),e.jsx(Oe,{children:S(v.status)}),e.jsx(Oe,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(hn,{children:[e.jsx(xn,{asChild:!0,children:e.jsx(w,{size:"sm",variant:"outline",children:"Details"})}),e.jsxs(Ot,{children:[e.jsxs($t,{children:[e.jsx(zt,{children:v.title}),e.jsx(Bt,{children:e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:["Status: ",v.status]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Requested: ",new Date(v.created_at).toLocaleDateString(),", ",new Date(v.created_at).toLocaleTimeString()]}),v.completed_at&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Completed: ",new Date(v.completed_at).toLocaleDateString(),", ",new Date(v.completed_at).toLocaleTimeString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Description:"}),e.jsx("p",{className:"text-sm whitespace-pre-line",children:v.description})]}),v.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Admin Notes:"}),e.jsx("p",{className:"text-sm whitespace-pre-line",children:v.notes})]})]})})]}),e.jsxs(Ut,{children:[e.jsx(Gt,{children:"Close"}),v.status==="completed"&&v.file_url&&e.jsx(gn,{asChild:!0,children:e.jsxs(w,{onClick:()=>x(v.id),children:[e.jsx(Hs,{className:"mr-2 h-4 w-4"}),"Download Report"]})})]})]})]}),v.status==="completed"&&v.file_url&&e.jsxs(w,{size:"sm",onClick:()=>x(v.id),children:[e.jsx(Hs,{className:"mr-2 h-4 w-4"}),"Download"]})]})})]},v.id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(E,{children:[e.jsx(z,{children:e.jsxs(K,{className:"text-lg flex items-center",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-primary"}),"Market Analysis"]})}),e.jsx(D,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Comprehensive analysis of property markets in specific locations, including price trends, rental yields, and growth forecasts."})})]}),e.jsxs(E,{children:[e.jsx(z,{children:e.jsxs(K,{className:"text-lg flex items-center",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-primary"}),"Investment Comparison"]})}),e.jsx(D,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed comparison of investment potential across different property types and locations to help you make informed decisions."})})]}),e.jsxs(E,{children:[e.jsx(z,{children:e.jsxs(K,{className:"text-lg flex items-center",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-primary"}),"Custom Research"]})}),e.jsx(D,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tailored research based on your specific investment criteria, including demographic analysis, regulatory insights, and more."})})]})]})]})}):e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(K,{children:"Research & Reports"}),e.jsx(Ze,{children:"You need to be logged in to access research reports."})]}),e.jsx(D,{children:e.jsx("p",{children:"Please log in or create an account to request and view property research reports."})})]})})}function Vc(){var Z;const{user:s,profile:a}=ee(),t=be(),{toast:r}=_e(),{error:n,getAllReportRequests:o,updateReportStatus:i,uploadReportFile:p}=un(),[c,g]=l.useState([]),[h,d]=l.useState(!0),[m,y]=l.useState(null),[x,S]=l.useState("all"),[v,j]=l.useState(!1),[u,b]=l.useState(!1),[A,L]=l.useState(null),[P,T]=l.useState(""),[O,C]=l.useState("pending");l.useEffect(()=>{var $;s&&a&&(a.role==="admin"||(($=s.app_metadata)==null?void 0:$.role)==="admin"||(r({title:"Access denied",description:"You need admin privileges to access this page.",variant:"destructive"}),t("/")))},[s,a,t,r]),l.useEffect(()=>{(async()=>{var X;const Q=(a==null?void 0:a.role)==="admin"||((X=s==null?void 0:s.app_metadata)==null?void 0:X.role)==="admin";if(s&&Q){d(!0);const W=await o();g(W),d(!1)}})()},[s,a,o]);const _=async()=>{if(m)try{if(await i(m.id,O,P)){r({title:"Status updated",description:`Report status has been updated to ${O}.`});const Q=await o();g(Q),j(!1),T("")}else throw new Error("Failed to update status")}catch($){r({title:"Error updating status",description:$.message||"There was a problem updating the report status.",variant:"destructive"})}},R=async()=>{if(!(!m||!A))try{if(await p(m.id,A)){r({title:"File uploaded",description:"The report file has been uploaded successfully."});const Q=await o();g(Q),b(!1),L(null)}else throw new Error("Failed to upload file")}catch($){r({title:"Error uploading file",description:$.message||"There was a problem uploading the report file.",variant:"destructive"})}},B=$=>{switch($){case"completed":return e.jsx(te,{className:"bg-green-500",children:"Completed"});case"in_progress":return e.jsx(te,{className:"bg-blue-500",children:"In Progress"});case"rejected":return e.jsx(te,{className:"bg-red-500",children:"Rejected"});case"pending":default:return e.jsx(te,{className:"bg-yellow-500",children:"Pending"})}},Y=x==="all"?c:c.filter($=>$.status===x);return!s||(a==null?void 0:a.role)!=="admin"&&((Z=s.app_metadata)==null?void 0:Z.role)!=="admin"?e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(K,{children:"Admin Reports Dashboard"}),e.jsx(Ze,{children:"You need admin privileges to access this page."})]}),e.jsx(D,{children:e.jsx("p",{children:"Please log in with an admin account to manage report requests."})})]})}):e.jsxs("div",{className:"container mx-auto py-10 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Report Requests Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and process user research report requests"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wi,{size:16,className:"text-muted-foreground"}),e.jsxs(Xe,{value:x,onValueChange:$=>S($),children:[e.jsx(Ke,{className:"w-[180px]",children:e.jsx(Qe,{placeholder:"Filter by status"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"all",children:"All Requests"}),e.jsx(le,{value:"pending",children:"Pending"}),e.jsx(le,{value:"in_progress",children:"In Progress"}),e.jsx(le,{value:"completed",children:"Completed"}),e.jsx(le,{value:"rejected",children:"Rejected"})]})]})]})]}),e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx(K,{children:"Report Requests"}),e.jsx(Ze,{children:"Manage user research report requests"})]}),e.jsx(D,{children:h?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(fs,{className:"h-8 w-8 animate-spin text-primary"})}):n?e.jsxs("div",{className:"text-center py-10 text-red-600",children:[e.jsx(kt,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:n})]}):Y.length===0?e.jsxs("div",{className:"text-center py-10 text-muted-foreground",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:"No report requests found"}),e.jsx("p",{className:"mt-1",children:"There are no report requests matching your filter criteria"})]}):e.jsxs(Mt,{children:[e.jsx(Lt,{children:"List of report requests"}),e.jsx(Dt,{children:e.jsxs(ys,{children:[e.jsx(Le,{children:"Title"}),e.jsx(Le,{children:"Requested By"}),e.jsx(Le,{children:"Requested"}),e.jsx(Le,{children:"Status"}),e.jsx(Le,{className:"text-right",children:"Actions"})]})}),e.jsx(Ft,{children:Y.map($=>{var Q,X,W,he;return e.jsxs(ys,{children:[e.jsx(Oe,{className:"font-medium max-w-[280px] truncate",children:$.title}),e.jsx(Oe,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cr,{size:14}),e.jsx("span",{children:((Q=$.profiles)==null?void 0:Q.full_name)||((X=$.profiles)==null?void 0:X.email)||"Unknown user"})]})}),e.jsx(Oe,{className:"text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(rs,{size:14}),e.jsx("span",{children:gs(new Date($.created_at),{addSuffix:!0})})]})}),e.jsx(Oe,{children:B($.status)}),e.jsx(Oe,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(hn,{children:[e.jsx(xn,{asChild:!0,children:e.jsx(w,{size:"sm",variant:"outline",children:"Details"})}),e.jsxs(Ot,{children:[e.jsxs($t,{children:[e.jsx(zt,{children:$.title}),e.jsx(Bt,{children:e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:["Status: ",$.status]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Requested: ",new Date($.created_at).toLocaleDateString(),", ",new Date($.created_at).toLocaleTimeString()]}),$.completed_at&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Completed: ",new Date($.completed_at).toLocaleDateString(),", ",new Date($.completed_at).toLocaleTimeString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"User:"}),e.jsxs("p",{className:"text-sm",children:[((W=$.profiles)==null?void 0:W.full_name)||"No name"," (",((he=$.profiles)==null?void 0:he.email)||"No email",")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Description:"}),e.jsx("p",{className:"text-sm whitespace-pre-line",children:$.description})]}),$.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Admin Notes:"}),e.jsx("p",{className:"text-sm whitespace-pre-line",children:$.notes})]}),$.file_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"File:"}),e.jsx("p",{className:"text-sm",children:e.jsx("a",{href:$.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:$.file_name||"View uploaded file"})})]})]})})]}),e.jsx(Ut,{children:e.jsx(Gt,{children:"Close"})})]})]}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>{y($),C($.status),T($.notes||""),j(!0)},children:"Update Status"}),e.jsxs(w,{size:"sm",onClick:()=>{y($),b(!0)},children:[e.jsx(cr,{className:"mr-2 h-4 w-4"}),"Upload File"]})]})})]},$.id)})})]})})]}),e.jsx(Ee,{open:v,onOpenChange:j,children:e.jsxs(Ie,{className:"sm:max-w-[500px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"Update Report Status"}),e.jsx(Ge,{children:"Update the status of the report request and add notes."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Report Title"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m==null?void 0:m.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Current Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m==null?void 0:m.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Status"}),e.jsxs(Xe,{value:O,onValueChange:$=>C($),children:[e.jsx(Ke,{className:"w-full",children:e.jsx(Qe,{placeholder:"Select new status"})}),e.jsxs(Je,{children:[e.jsx(le,{value:"pending",children:"Pending"}),e.jsx(le,{value:"in_progress",children:"In Progress"}),e.jsx(le,{value:"completed",children:"Completed"}),e.jsx(le,{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Admin Notes"}),e.jsx(ks,{value:P,onChange:$=>T($.target.value),placeholder:"Add notes about the report status, progress, or any additional information...",className:"min-h-[100px]"})]})]}),e.jsxs(ns,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(w,{type:"button",onClick:_,children:"Update Status"})]})]})}),e.jsx(Ee,{open:u,onOpenChange:b,children:e.jsxs(Ie,{className:"sm:max-w-[500px]",children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"Upload Report File"}),e.jsx(Ge,{children:"Upload a file for the requested report."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Report Title"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m==null?void 0:m.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"File"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"file",className:`block w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-md file:border-0
                    file:text-sm file:font-semibold
                    file:bg-primary file:text-white
                    hover:file:bg-primary/90`,onChange:$=>{$.target.files&&$.target.files[0]&&L($.target.files[0])}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supported file types: PDF, DOCX, XLSX, PNG, JPG"})]}),A&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Selected file:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[A.name," (",(A.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Uploading a file will automatically set the report status to "completed".'})]}),e.jsxs(ns,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(w,{type:"button",onClick:R,disabled:!A,children:"Upload File"})]})]})})]})}const Hc="162910ce5fe80080edef0fe026506f0e",Wc="https://api.scraperapi.com/scrape";console.log("ScraperAPI key status:","Using default key");const Yc=async()=>{try{console.log("Checking if scraper_cache table exists using simplified approach...");const{data:s,error:a}=await U.from("scraper_cache").select("*",{count:"exact",head:!0});if(!a)return console.log("âœ… scraper_cache table exists - count check successful"),!0;console.log("Count check failed:",a);const t=`test-existence-${Date.now()}`,{error:r}=await U.from("scraper_cache").insert({key:t,data:{test:!0},created_at:new Date().toISOString()});return r?(console.error("Insert test failed:",r),console.error("The scraper_cache table does not appear to be accessible"),!1):(console.log("âœ… Successfully verified scraper_cache table exists via insert test!"),!0)}catch(s){return console.error("Error in ensureScraperCacheTableExists:",s),!1}};console.log("Initializing Rightmove scraper... (using Apify exclusively)"),console.log("âœ… ScraperAPI validation skipped - application now uses Apify exclusively"),Yc().then(s=>{s||console.warn("Scraper cache table does not exist. This may affect performance.")});const Kc=async s=>{try{const a=`https://www.rightmove.co.uk/properties/${s}`,t=`${Wc}?api_key=${Hc}&url=${encodeURIComponent(a)}&render=true`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch property status: ${r.status} ${r.statusText}`);const n=await r.text(),o=n.includes("This property has been removed by the agent")||n.includes("This property is no longer available")||n.includes("has now been sold subject to contract");if(o)try{await U.rpc("mark_property_inactive",{property_id:s}),console.log(`Marked property ${s} as inactive`)}catch(i){console.error("Failed to update property active status in cache:",i)}return!o}catch(a){throw console.error("Error checking property active status:",a),a}},Jc=async()=>{try{const{data:s,error:a}=await U.rpc("purge_expired_cache");if(a)throw a;return s||0}catch(s){return console.error("Error purging expired cache:",s),0}},Zc=async()=>{try{const{data:s,error:a}=await U.from("scraper_cache").select("key").like("key","rightmove:property:%").eq("is_active",!0).limit(50);if(a)throw a;if(!s||s.length===0)return console.log("No properties to check"),0;console.log(`Checking active status for ${s.length} properties`);let t=0;for(const r of s){const n=r.key.replace("rightmove:property:","");await Kc(n)||t++,await new Promise(i=>setTimeout(i,500))}return console.log(`Found ${t} inactive properties`),t}catch(s){return console.error("Error checking active listings:",s),0}},Xc=async()=>{try{const s=await Jc();return console.log(`Purged ${s} expired cache entries`),s}catch(s){return console.error("Error cleaning up expired cache:",s),0}},xa=async()=>{console.log("Running background jobs..."),await Xc(),await Zc(),console.log("Background jobs completed")},Qc=()=>{setTimeout(()=>xa(),3e4),setInterval(()=>xa(),24*60*60*1e3),console.log("Background jobs scheduled")};function pa(){const{title:s}=kr();return e.jsx(Go,{title:s||"Loading...",content:"Content is loading...",date:new Date().toISOString().split("T")[0]})}let Es=!1;function ie({children:s}){const{user:a,isLoading:t}=ee(),r=be(),n=Dr(),[o,i]=l.useState(!1);return l.useEffect(()=>{const p=localStorage.getItem("vge_user_authenticated")==="true",c=parseInt(localStorage.getItem("vge_auth_timestamp")||"0"),g=Date.now()-c<1e3*60*60;if(Es)return;(async()=>{Es=!0;try{if(console.log("Checking auth in PrivateRoute. User:",!!a,"Path:",n.pathname),p&&g){console.log("Local auth confirmed from waitlist login"),i(!0),Es=!1;return}t||(a?(console.log("Auth confirmed from user context"),i(!0)):n.pathname!=="/waitlist"&&(console.log("No auth, redirecting to waitlist"),r("/waitlist",{replace:!0})))}catch(d){console.error("Error in PrivateRoute auth check:",d)}finally{Es=!1}})()},[a,t,r,n.pathname]),(t||!o)&&!a?e.jsx(qr,{}):o||a?e.jsx(e.Fragment,{children:s}):null}function ed(){const[s,a]=l.useState(!0),t=Dr(),{user:r,profile:n,signOut:o,refreshProfile:i}=ee(),[p,c]=l.useState(!0),g=be();return l.useEffect(()=>{let h=!0;return t.pathname==="/waitlist"||t.pathname==="/auth/callback"?void 0:((async()=>{try{console.log("Performing initial auth check");const{data:m}=await U.auth.getSession();h&&(console.log("Initial auth check result:",!!m.session),!m.session&&t.pathname!=="/waitlist"&&g("/waitlist",{replace:!0}))}catch(m){console.error("Error in initial auth check:",m)}})(),()=>{h=!1})},[]),l.useEffect(()=>{r?(console.log("Auth state in App: User is authenticated"),localStorage.setItem("vge_user_authenticated","true"),localStorage.setItem("vge_auth_timestamp",Date.now().toString()),i&&i()):console.log("Auth state in App: User is not authenticated")},[i,r]),l.useEffect(()=>{const h=()=>a(!0),d=()=>a(!1);h();const m=setTimeout(d,100);return()=>clearTimeout(m)},[t.pathname]),l.useEffect(()=>{document.documentElement.classList.remove("dark")},[]),l.useEffect(()=>{Qc()},[]),e.jsxs("div",{className:"min-h-screen bg-background",children:[t.pathname!=="/waitlist"&&e.jsx(ws,{isAuthenticated:!!r,userProfile:n||void 0,onSignIn:()=>{},onSignUp:()=>{},onSignOut:()=>{localStorage.removeItem("vge_user_authenticated"),localStorage.removeItem("vge_auth_timestamp"),o&&o()}}),e.jsx("main",{children:e.jsxs(Yi,{children:[e.jsx(se,{path:"/waitlist",element:e.jsx($c,{})}),e.jsx(se,{path:"/auth/callback",element:e.jsx(nc,{})}),e.jsx(se,{path:"/",element:e.jsx(ie,{children:e.jsx(Xl,{})})}),e.jsx(se,{path:"/listings",element:e.jsx(ie,{children:e.jsx(_c,{})})}),e.jsx(se,{path:"/deals",element:e.jsx(ie,{children:e.jsx(gc,{})})}),e.jsx(se,{path:"/trends",element:e.jsx(ie,{children:e.jsx(zo,{})})}),e.jsx(se,{path:"/insights",element:e.jsx(ie,{children:e.jsx(To,{})})}),e.jsx(se,{path:"/calculators",element:e.jsx(ie,{children:e.jsx(Fc,{})})}),e.jsx(se,{path:"/profile",element:e.jsx(ie,{children:e.jsx(na,{})})}),e.jsx(se,{path:"/login",element:e.jsx(Qt,{to:"/",replace:!0})}),e.jsx(se,{path:"/dashboard",element:e.jsx(ie,{children:e.jsx(io,{})})}),e.jsx(se,{path:"/pricing",element:e.jsx(ie,{children:e.jsx(oo,{})})}),e.jsx(se,{path:"/subscription/success",element:e.jsx(ie,{children:e.jsx(mo,{})})}),e.jsx(se,{path:"/subscription/cancel",element:e.jsx(ie,{children:e.jsx(uo,{})})}),e.jsx(se,{path:"/account",element:e.jsx(ie,{children:e.jsx(na,{})})}),e.jsx(se,{path:"/research",element:e.jsx(ie,{children:e.jsx(Zo,{})})}),e.jsx(se,{path:"/research/reports/:slug",element:e.jsx(ie,{children:e.jsx(Lc,{})})}),e.jsx(se,{path:"/blog",element:e.jsx(ie,{children:e.jsx(Qo,{})})}),e.jsx(se,{path:"/article/:title",element:e.jsx(ie,{children:e.jsx(pa,{})})}),e.jsx(se,{path:"/blog/:slug",element:e.jsx(ie,{children:e.jsx(pa,{})})}),e.jsx(se,{path:"/help",element:e.jsx(ie,{children:e.jsx(ec,{})})}),e.jsx(se,{path:"/property-management",element:e.jsx(ie,{children:e.jsx(oc,{})})}),e.jsx(se,{path:"/investment-opportunities",element:e.jsx(ie,{children:e.jsx(uc,{})})}),e.jsx(se,{path:"/about-us",element:e.jsx(ie,{children:e.jsx(hc,{})})}),e.jsx(se,{path:"/messages",element:e.jsx(ie,{children:e.jsx(jc,{})})}),e.jsx(se,{path:"/research-reports",element:e.jsx(ie,{children:e.jsx(qc,{})})}),e.jsx(se,{path:"/admin/reports",element:e.jsx(ie,{children:e.jsx(Vc,{})})}),!1,e.jsx(se,{path:"",element:e.jsx(Qt,{to:r?"/":"/waitlist",replace:!0})}),e.jsx(se,{path:"*",element:e.jsx(po,{})})]})}),t.pathname!=="/waitlist"&&e.jsx(rc,{}),e.jsx(ol,{}),e.jsx(ml,{isAnimating:s})]})}function sd(){return e.jsx(Gr,{children:e.jsx(l.Suspense,{fallback:e.jsx(qr,{}),children:e.jsx(ed,{})})})}Ki.TempoDevtools.init();Ji.init("phc_Pg1VGdZoazG7KyDNxnUXNZZz6zPVrGNSRtFlDnlZCcA",{api_host:"https://eu.i.posthog.com",person_profiles:"identified_only"});const td=new Zi;Xi.createRoot(document.getElementById("root")).render(e.jsx(N.StrictMode,{children:e.jsx(Qi,{client:td,children:e.jsx(el,{children:e.jsx(Gr,{children:e.jsx(sd,{})})})})}));
//# sourceMappingURL=index-DnxjxgeY.js.map
